try{!function(){let t,e="getMinigameLiveGlobalVar";globalThis[e]?t=globalThis[e]:void 0!==globalThis.WeixinJSBridge&&globalThis.WeixinJSBridge[e]&&(t=globalThis.WeixinJSBridge[e]);var{console:i,wxNativeConsole:s,__wxConfig:n,__errorTracer__:o,wxConsole:r,wxGA:a,Reporter:h,Foundation:l,WeixinJSBridge:c,__appServiceSDK__:d,__IS_MINIGAME_LIVE_SUB_PACKAGE__:u,wxRunOnDebug:p}=t();(()=>{var t={426:t=>{function e(t,e,i,s,n,o,r){try{var a=t[o](r),h=a.value}catch(t){return void i(t)}a.done?e(h):Promise.resolve(h).then(s,n)}t.exports=function(t){return function(){var i=this,s=arguments;return new Promise((function(n,o){var r=t.apply(i,s);function a(t){e(r,n,o,a,h,"next",t)}function h(t){e(r,n,o,a,h,"throw",t)}a(void 0)}))}},t.exports.__esModule=!0,t.exports.default=t.exports},666:(t,e,i)=>{var s,n,o;globalThis,n=[e,i(474),i(276)],s=function(t,e,i){t.animate=e,t.Scroller=i},void 0===(o="function"==typeof s?s.apply(e,n):s)||(t.exports=o)},276:(t,e,i)=>{var s,n,o;globalThis,n=[i(474)],void 0===(o="function"==typeof(s=function(t){var e=function(){},i=function(t,i){for(var s in this.__callback=t,this.options={scrollingX:!0,scrollingY:!0,animating:!0,animationDuration:250,bouncing:!0,locking:!0,paging:!1,snapping:!1,zooming:!1,minZoom:.5,maxZoom:3,speedMultiplier:1,scrollingComplete:e,penetrationDeceleration:.03,penetrationAcceleration:.08},i)this.options[s]=i[s]},s=function(t){return Math.pow(t-1,3)+1},n=function(t){return(t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)};return i.prototype={__isSingleTouch:!1,__isTracking:!1,__didDecelerationComplete:!1,__isGesturing:!1,__isDragging:!1,__isDecelerating:!1,__isAnimating:!1,__clientLeft:0,__clientTop:0,__clientWidth:0,__clientHeight:0,__contentWidth:0,__contentHeight:0,__snapWidth:100,__snapHeight:100,__zoomLevel:1,__scrollLeft:0,__scrollTop:0,__maxScrollLeft:0,__maxScrollTop:0,__scheduledLeft:0,__scheduledTop:0,__scheduledZoom:0,__lastTouchLeft:null,__lastTouchTop:null,__lastTouchMove:null,__positions:null,__minDecelerationScrollLeft:null,__minDecelerationScrollTop:null,__maxDecelerationScrollLeft:null,__maxDecelerationScrollTop:null,__decelerationVelocityX:null,__decelerationVelocityY:null,setDimensions:function(t,e,i,s){null!==t&&(this.__clientWidth=t),null!==e&&(this.__clientHeight=e),null!==i&&(this.__contentWidth=i),null!==s&&(this.__contentHeight=s),this.__computeScrollMax(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0)},setPosition:function(t,e){this.__clientLeft=t||0,this.__clientTop=e||0},setSnapSize:function(t,e){this.__snapWidth=t,this.__snapHeight=e},getValues:function(){return{left:this.__scrollLeft,top:this.__scrollTop,right:this.__scrollLeft+this.__clientWidth/this.__zoomLevel,bottom:this.__scrollTop+this.__clientHeight/this.__zoomLevel,zoom:this.__zoomLevel}},getPoint:function(t,e){var i=this.getValues();return{left:t/i.zoom,top:e/i.zoom}},getScrollMax:function(){return{left:this.__maxScrollLeft,top:this.__maxScrollTop}},zoomTo:function(e,i,s,n,o){if(!this.options.zooming)throw new Error("Zooming is not enabled!");o&&(this.__zoomComplete=o),this.__isDecelerating&&(t.stop(this.__isDecelerating),this.__isDecelerating=!1);var r=this.__zoomLevel;void 0===s&&(s=this.__clientWidth/2),void 0===n&&(n=this.__clientHeight/2),e=Math.max(Math.min(e,this.options.maxZoom),this.options.minZoom),this.__computeScrollMax(e);var a=e/r,h=a*(this.__scrollLeft+s)-s,l=a*(this.__scrollTop+n)-n;h>this.__maxScrollLeft?h=this.__maxScrollLeft:h<0&&(h=0),l>this.__maxScrollTop?l=this.__maxScrollTop:l<0&&(l=0),this.__publish(h,l,e,i)},zoomBy:function(t,e,i,s,n){this.zoomTo(this.__zoomLevel*t,e,i,s,n)},scrollTo:function(e,i,s,n){if(this.__isDecelerating&&(t.stop(this.__isDecelerating),this.__isDecelerating=!1),void 0!==n&&n!==this.__zoomLevel){if(!this.options.zooming)throw new Error("Zooming is not enabled!");e*=n,i*=n,this.__computeScrollMax(n)}else n=this.__zoomLevel;this.options.scrollingX?this.options.paging?e=Math.round(e/this.__clientWidth)*this.__clientWidth:this.options.snapping&&(e=Math.round(e/this.__snapWidth)*this.__snapWidth):e=this.__scrollLeft,this.options.scrollingY?this.options.paging?i=Math.round(i/this.__clientHeight)*this.__clientHeight:this.options.snapping&&(i=Math.round(i/this.__snapHeight)*this.__snapHeight):i=this.__scrollTop,e=Math.max(Math.min(this.__maxScrollLeft,e),0),i=Math.max(Math.min(this.__maxScrollTop,i),0),e===this.__scrollLeft&&i===this.__scrollTop&&(s=!1),this.__publish(e,i,n,s)},scrollBy:function(t,e,i){var s=this.__isAnimating?this.__scheduledLeft:this.__scrollLeft,n=this.__isAnimating?this.__scheduledTop:this.__scrollTop;this.scrollTo(s+(t||0),n+(e||0),i)},doMouseZoom:function(t,e,i,s){var n=t>0?.97:1.03;return this.zoomTo(this.__zoomLevel*n,!1,i-this.__clientLeft,s-this.__clientTop)},doTouchStart:function(e,i){if(void 0===e.length)throw new Error("Invalid touch list: "+e);if(i instanceof Date&&(i=i.valueOf()),"number"!=typeof i)throw new Error("Invalid timestamp value: "+i);var s,n;this.__interruptedAnimation=!0,this.__isDecelerating&&(t.stop(this.__isDecelerating),this.__isDecelerating=!1,this.__interruptedAnimation=!0),this.__isAnimating&&(t.stop(this.__isAnimating),this.__isAnimating=!1,this.__interruptedAnimation=!0);var o=1===e.length;o?(s=e[0].pageX,n=e[0].pageY):(s=Math.abs(e[0].pageX+e[1].pageX)/2,n=Math.abs(e[0].pageY+e[1].pageY)/2),this.__initialTouchLeft=s,this.__initialTouchTop=n,this.__zoomLevelStart=this.__zoomLevel,this.__lastTouchLeft=s,this.__lastTouchTop=n,this.__lastTouchMove=i,this.__lastScale=1,this.__enableScrollX=!o&&this.options.scrollingX,this.__enableScrollY=!o&&this.options.scrollingY,this.__isTracking=!0,this.__didDecelerationComplete=!1,this.__isDragging=!o,this.__isSingleTouch=o,this.__positions=[]},doTouchMove:function(t,e,i){if(void 0===t.length)throw new Error("Invalid touch list: "+t);if(e instanceof Date&&(e=e.valueOf()),"number"!=typeof e)throw new Error("Invalid timestamp value: "+e);if(this.__isTracking){var s,n;2===t.length?(s=Math.abs(t[0].pageX+t[1].pageX)/2,n=Math.abs(t[0].pageY+t[1].pageY)/2):(s=t[0].pageX,n=t[0].pageY);var o=this.__positions;if(this.__isDragging){var r=s-this.__lastTouchLeft,a=n-this.__lastTouchTop,h=this.__scrollLeft,l=this.__scrollTop,c=this.__zoomLevel;if(void 0!==i&&this.options.zooming){var d=c;if(c=c/this.__lastScale*i,d!==(c=Math.max(Math.min(c,this.options.maxZoom),this.options.minZoom))){var u=s-this.__clientLeft,p=n-this.__clientTop;h=(u+h)*c/d-u,l=(p+l)*c/d-p,this.__computeScrollMax(c)}}if(this.__enableScrollX){h-=r*this.options.speedMultiplier;var g=this.__maxScrollLeft;(h>g||h<0)&&(this.options.bouncing?h+=r/2*this.options.speedMultiplier:h=h>g?g:0)}if(this.__enableScrollY){l-=a*this.options.speedMultiplier;var v=this.__maxScrollTop;(l>v||l<0)&&(this.options.bouncing?l+=a/2*this.options.speedMultiplier:l=l>v?v:0)}o.length>60&&o.splice(0,30),o.push(h,l,e),this.__publish(h,l,c)}else{var m=this.options.locking?3:0,f=5,_=Math.abs(s-this.__initialTouchLeft),y=Math.abs(n-this.__initialTouchTop);this.__enableScrollX=this.options.scrollingX&&_>=m,this.__enableScrollY=this.options.scrollingY&&y>=m,o.push(this.__scrollLeft,this.__scrollTop,e),this.__isDragging=(this.__enableScrollX||this.__enableScrollY)&&(_>=f||y>=f),this.__isDragging&&(this.__interruptedAnimation=!1)}this.__lastTouchLeft=s,this.__lastTouchTop=n,this.__lastTouchMove=e,this.__lastScale=i}},doTouchEnd:function(t){if(t instanceof Date&&(t=t.valueOf()),"number"!=typeof t)throw new Error("Invalid timestamp value: "+t);if(this.__isTracking){if(this.__isTracking=!1,this.__isDragging)if(this.__isDragging=!1,this.__isSingleTouch&&this.options.animating&&t-this.__lastTouchMove<=100){for(var e=this.__positions,i=e.length-1,s=i,n=i;n>0&&e[n]>this.__lastTouchMove-100;n-=3)s=n;if(s!==i){var o=e[i]-e[s],r=this.__scrollLeft-e[s-2],a=this.__scrollTop-e[s-1];this.__decelerationVelocityX=r/o*(1e3/60),this.__decelerationVelocityY=a/o*(1e3/60);var h=this.options.paging||this.options.snapping?4:1;(Math.abs(this.__decelerationVelocityX)>h||Math.abs(this.__decelerationVelocityY)>h)&&this.__startDeceleration(t)}else this.options.scrollingComplete()}else t-this.__lastTouchMove>100&&this.options.scrollingComplete();this.__isDecelerating||((this.__interruptedAnimation||this.__isDragging)&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,!0,this.__zoomLevel)),this.__positions.length=0}},__publish:function(e,i,o,r){var a=this.__isAnimating;if(a&&(t.stop(a),this.__isAnimating=!1),r&&this.options.animating){this.__scheduledLeft=e,this.__scheduledTop=i,this.__scheduledZoom=o;var h=this.__scrollLeft,l=this.__scrollTop,c=this.__zoomLevel,d=e-h,u=i-l,p=o-c,g=function(t,e,i){i&&(this.__scrollLeft=h+d*t,this.__scrollTop=l+u*t,this.__zoomLevel=c+p*t,this.__callback&&this.__callback(this.__scrollLeft,this.__scrollTop,this.__zoomLevel))}.bind(this),v=function(t){return this.__isAnimating===t}.bind(this),m=function(t,e,i){e===this.__isAnimating&&(this.__isAnimating=!1),(this.__didDecelerationComplete||i)&&this.options.scrollingComplete(),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))}.bind(this);this.__isAnimating=t.start(g,v,m,this.options.animationDuration,a?s:n)}else this.__scheduledLeft=this.__scrollLeft=e,this.__scheduledTop=this.__scrollTop=i,this.__scheduledZoom=this.__zoomLevel=o,this.__callback&&this.__callback(e,i,o),this.options.zooming&&(this.__computeScrollMax(),this.__zoomComplete&&(this.__zoomComplete(),this.__zoomComplete=null))},__computeScrollMax:function(t){void 0===t&&(t=this.__zoomLevel),this.__maxScrollLeft=Math.max(this.__contentWidth*t-this.__clientWidth,0),this.__maxScrollTop=Math.max(this.__contentHeight*t-this.__clientHeight,0)},__startDeceleration:function(e){if(this.options.paging){var i=Math.max(Math.min(this.__scrollLeft,this.__maxScrollLeft),0),s=Math.max(Math.min(this.__scrollTop,this.__maxScrollTop),0),n=this.__clientWidth,o=this.__clientHeight;this.__minDecelerationScrollLeft=Math.floor(i/n)*n,this.__minDecelerationScrollTop=Math.floor(s/o)*o,this.__maxDecelerationScrollLeft=Math.ceil(i/n)*n,this.__maxDecelerationScrollTop=Math.ceil(s/o)*o}else this.__minDecelerationScrollLeft=0,this.__minDecelerationScrollTop=0,this.__maxDecelerationScrollLeft=this.__maxScrollLeft,this.__maxDecelerationScrollTop=this.__maxScrollTop;var r=function(t,e,i){this.__stepThroughDeceleration(i)}.bind(this),a=this.options.snapping?4:.1,h=function(){var t=Math.abs(this.__decelerationVelocityX)>=a||Math.abs(this.__decelerationVelocityY)>=a;return t||(this.__didDecelerationComplete=!0),t}.bind(this),l=function(t,e,i){this.__isDecelerating=!1,this.__didDecelerationComplete&&this.options.scrollingComplete(),this.scrollTo(this.__scrollLeft,this.__scrollTop,this.options.snapping)}.bind(this);this.__isDecelerating=t.start(r,h,l)},__stepThroughDeceleration:function(t){var e=this.__scrollLeft+this.__decelerationVelocityX,i=this.__scrollTop+this.__decelerationVelocityY;if(!this.options.bouncing){var s=Math.max(Math.min(this.__maxDecelerationScrollLeft,e),this.__minDecelerationScrollLeft);s!==e&&(e=s,this.__decelerationVelocityX=0);var n=Math.max(Math.min(this.__maxDecelerationScrollTop,i),this.__minDecelerationScrollTop);n!==i&&(i=n,this.__decelerationVelocityY=0)}if(t?this.__publish(e,i,this.__zoomLevel):(this.__scrollLeft=e,this.__scrollTop=i),!this.options.paging){var o=.95;this.__decelerationVelocityX*=o,this.__decelerationVelocityY*=o}if(this.options.bouncing){var r=0,a=0,h=this.options.penetrationDeceleration,l=this.options.penetrationAcceleration;e<this.__minDecelerationScrollLeft?r=this.__minDecelerationScrollLeft-e:e>this.__maxDecelerationScrollLeft&&(r=this.__maxDecelerationScrollLeft-e),i<this.__minDecelerationScrollTop?a=this.__minDecelerationScrollTop-i:i>this.__maxDecelerationScrollTop&&(a=this.__maxDecelerationScrollTop-i),0!==r&&(r*this.__decelerationVelocityX<=0?this.__decelerationVelocityX+=r*h:this.__decelerationVelocityX=r*l),0!==a&&(a*this.__decelerationVelocityY<=0?this.__decelerationVelocityY+=a*h:this.__decelerationVelocityY=a*l)}}},i})?s.apply(e,n):s)||(t.exports=o)},474:(t,e)=>{var i,s,n;globalThis,s=[e],i=function(t){var e="undefined"==typeof window?this:window,i=Date.now||function(){return+new Date},s=60,n=1e3,o={},r=1;t.requestAnimationFrame=function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame,i=!!t;if(t&&!/requestAnimationFrame\(\)\s*\{\s*\[native code\]\s*\}/i.test(t.toString())&&(i=!1),i)return function(e,i){t(e,i)};var s=60,n={},o=1,r=null,a=+new Date;return function(t,e){var i=o++;return n[i]=t,null===r&&(r=setInterval((function(){var t=+new Date,e=n;for(var i in n={},e)e.hasOwnProperty(i)&&(e[i](t),a=t);t-a>2500&&(clearInterval(r),r=null)}),1e3/s)),i}}(),t.stop=function(t){var e=null!==o[t];return e&&(o[t]=null),e},t.isRunning=function(t){return null!==o[t]},t.start=function(e,a,h,l,c,d){var u=i(),p=u,g=0,v=0,m=r++;if(m%20==0){var f={};for(var _ in o)f[_]=!0;o=f}var y=function(r){var f=!0!==r,_=i();if(!o[m]||a&&!a(m))return o[m]=null,void h(s-v/((_-u)/n),m,!1);if(f)for(var b=Math.round((_-p)/(n/s))-1,T=0;T<Math.min(b,4);T++)y(!0),v++;l&&(g=(_-u)/l)>1&&(g=1);var w=c?c(g):g;!1!==e(w,_,f)&&1!==g||!f?f&&(p=_,t.requestAnimationFrame(y,d)):(o[m]=null,h(s-v/((_-u)/n),m,1===g||void 0===l))};return o[m]=!0,t.requestAnimationFrame(y,d),m}},void 0===(n="function"==typeof i?i.apply(e,s):i)||(t.exports=n)},820:t=>{function e(){}e.prototype={on:function(t,e,i){var s=this.e||(this.e={});return(s[t]||(s[t]=[])).push({fn:e,ctx:i}),this},once:function(t,e,i){var s=this;function n(){s.off(t,n),e.apply(i,arguments)}return n._=e,this.on(t,n,i)},emit:function(t){for(var e=[].slice.call(arguments,1),i=((this.e||(this.e={}))[t]||[]).slice(),s=0,n=i.length;s<n;s++)i[s].fn.apply(i[s].ctx,e);return this},off:function(t,e){var i=this.e||(this.e={}),s=i[t],n=[];if(s&&e)for(var o=0,r=s.length;o<r;o++)s[o].fn!==e&&s[o].fn._!==e&&n.push(s[o]);return n.length?i[t]=n:delete i[t],this}},t.exports=e,t.exports.TinyEmitter=e},724:t=>{t.exports=function(t){return t=(t=t.trim()).replace(/<!--[\s\S]*?-->/g,""),function(){return{declaration:e(),root:i()}}();function e(){if(n(/^<\?xml\s*/)){for(var t={attributes:{}};!o()&&!r("?>");){var e=s();if(!e)return t;t.attributes[e.name]=e.value}return n(/\?>\s*/),t}}function i(){var t=n(/^<([\w-:.]+)\s*/);if(t){for(var e,a={name:t[1],attributes:{},children:[]};!(o()||r(">")||r("?>")||r("/>"));){var h=s();if(!h)return a;a.attributes[h.name]=h.value}if(n(/^\s*\/>\s*/))return a;for(n(/\??>\s*/),a.content=function(){var t=n(/^([^<]*)/);return t?t[1]:""}();e=i();)a.children.push(e);return n(/^<\/[\w-:.]+>\s*/),a}}function s(){var t,e=n(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);if(e)return{name:e[1],value:(t=e[2],t.replace(/^['"]|['"]$/g,""))}}function n(e){var i=t.match(e);if(i)return t=t.slice(i[0].length),i}function o(){return 0==t.length}function r(e){return 0==t.indexOf(e)}}}},e={};function o(i){var s=e[i];if(void 0!==s)return s.exports;var n=e[i]={exports:{}};return t[i](n,n.exports,o),n.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var a={};(()=>{"use strict";o.d(a,{default:()=>ls});var t,e={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}}},h="undefined"==typeof self&&"undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},l=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=h()),void 0===e&&(e=!1);var i=Object.keys(this._tweens);if(0===i.length)return!1;for(;i.length>0;){this._tweensAddedDuringUpdate={};for(var s=0;s<i.length;s++){var n=this._tweens[i[s]],o=!e;n&&!1===n.update(t,o)&&!e&&delete this._tweens[i[s]]}i=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),u={Linear:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),o=u.Utils.Linear;return e<0?o(t[0],t[1],s):e>1?o(t[i],t[i-1],i-s):o(t[n],t[n+1>i?i:n+1],s-n)},Bezier:function(t,e){for(var i=0,s=t.length-1,n=Math.pow,o=u.Utils.Bernstein,r=0;r<=s;r++)i+=n(1-e,s-r)*n(e,r)*t[r]*o(s,r);return i},CatmullRom:function(t,e){var i=t.length-1,s=i*e,n=Math.floor(s),o=u.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(s=i*(1+e))),o(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],s-n)):e<0?t[0]-(o(t[0],t[0],t[1],t[1],-s)-t[0]):e>1?t[i]-(o(t[i],t[i],t[i-1],t[i-1],s-i)-t[i]):o(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],s-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=u.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:(t=[1],function(e){var i=1;if(t[e])return t[e];for(var s=e;s>1;s--)i*=s;return t[e]=i,i}),CatmullRom:function(t,e,i,s,n){var o=.5*(i-t),r=.5*(s-e),a=n*n;return(2*e-2*i+o+r)*(n*a)+(-3*e+3*i-2*o-r)*a+o*n+e}}},p=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),g=new l,v=function(){function t(t,i){void 0===i&&(i=g),this._object=t,this._group=i,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=e.Linear.None,this._interpolationFunction=u.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=p.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?h()+parseFloat(t):t:h(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,i,s){for(var n in i){var o=t[n],r=Array.isArray(o),a=r?"array":typeof o,h=!r&&Array.isArray(i[n]);if("undefined"!==a&&"function"!==a){if(h){var l=i[n];if(0===l.length)continue;l=l.map(this._handleRelativeValue.bind(this,o)),i[n]=[o].concat(l)}if("object"!==a&&!r||!o||h)void 0===e[n]&&(e[n]=o),r||(e[n]*=1),s[n]=h?i[n].slice().reverse():e[n]||0;else{for(var c in e[n]=r?[]:{},o)e[n][c]=o[c];s[n]=r?[]:{},this._setupProperties(o,e[n],i[n],s[n])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=h()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=h()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=h()),void 0===e&&(e=!0),this._isPaused)return!0;var i,s,n=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>n)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),s=(t-this._startTime)/this._duration,s=0===this._duration||s>1?1:s;var o=this._easingFunction(s);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,s),1===s){if(this._repeat>0){for(i in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[i]||(this._valuesStartRepeat[i]=this._valuesStartRepeat[i]+parseFloat(this._valuesEnd[i])),this._yoyo&&this._swapEndStartRepeatValues(i),this._valuesStart[i]=this._valuesStartRepeat[i];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var r=0,a=this._chainedTweens.length;r<a;r++)this._chainedTweens[r].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,i,s){for(var n in i)if(void 0!==e[n]){var o=e[n]||0,r=i[n],a=Array.isArray(t[n]),h=Array.isArray(r);!a&&h?t[n]=this._interpolationFunction(r,s):"object"==typeof r&&r?this._updateProperties(t[n],o,r,s):"number"==typeof(r=this._handleRelativeValue(o,r))&&(t[n]=o+(r-o)*s)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],i=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof i?this._valuesStartRepeat[t]+parseFloat(i):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),m=p.nextId,f=g,_=f.getAll.bind(f),y=f.removeAll.bind(f),b=f.add.bind(f),T=f.remove.bind(f),w=f.update.bind(f);const x={Easing:e,Group:l,Interpolation:u,now:h,Sequence:p,nextId:m,Tween:v,VERSION:"18.6.4",getAll:_,removeAll:y,add:b,remove:T,update:w};var S,C,k,I,M=o(820);function L(){}function D(t,e,i){return Math.max(e,Math.min(t,i))}function A(t,e){for(var i=t.split("."),s=e.split("."),n=Math.max(i.length,s.length);i.length<n;)i.push("0");for(;s.length<n;)s.push("0");for(var o=0;o<n;o++){var r=parseInt(i[o],10),a=parseInt(s[o],10);if(r>a)return 1;if(r<a)return-1}return 0}function E(t){return"number"==typeof t&&isFinite(t)}function P(t){var e=t;try{"object"==typeof t&&(e="string"==typeof t.errMsg?t.errMsg:"string"==typeof t.errmsg?t.errmsg:"string"==typeof t.message?t.message:JSON.stringify(t))}catch(t){i.error(t)}return e}function B(t){return t.lastIndexOf("…")===t.length-1?t:t+"…"}!function(t){t[t.Front=1]="Front",t[t.Background=2]="Background"}(S||(S={})),function(t){t[t.Default=0]="Default",t[t.GameTransfer=1]="GameTransfer",t[t.Request=2]="Request",t[t.DownloadFile=3]="DownloadFile",t[t.CgiSpeedMeasure=4]="CgiSpeedMeasure",t[t.BadJs=5]="BadJs",t[t.Init=6]="Init",t[t.CostTime=7]="CostTime",t[t.Error=8]="Error",t[t.UploadFile=9]="UploadFile",t[t.Login=10]="Login"}(C||(C={})),function(t){t[t.Info=101]="Info",t[t.Warn=102]="Warn",t[t.Error=103]="Error"}(k||(k={})),function(t){t.GameTransferReport="GameTransferReport",t.KeyValueReport="KeyValueReport",t.WxRequestReport="WxRequestReport"}(I||(I={}));Object.values(C).filter((t=>E(t)));class R extends M.TinyEmitter{constructor(){super(...arguments),this.innerTweenGroup=null,this.deviceScale=1,this.devicePixelRatio=1,this.innerDebug=!1}init(t){var e,{pixiJs:s,TWEEN:n,designWidth:o,gameWX:r,scale:a=1,debug:h=!1}=t;this.innerPixi=s,this.innerTween=n,this.innerTweenGroup=new n.Group,this.gameWX=r,this.innerDebug=h,this.designWithSystemInfo({designWidth:o,scale:a}),null===(e=r.onDeviceOrientationChange)||void 0===e||e.call(r,(()=>{this.designWithSystemInfo({designWidth:o,scale:a}),this.emit("onDeviceOrientationChange")})),h&&i.log("[minigamefe PixiCore]: Common inited")}get debug(){return this.innerDebug}get PIXI(){return this.innerPixi}get TWEEN(){return this.innerTween}get tweenGroup(){return this.innerTweenGroup}get systemInfo(){return this.innerSystemInfo}get scale(){return this.deviceScale}get dpr(){return this.devicePixelRatio}get wx(){return this.gameWX}destroy(){this.innerTweenGroup&&(this.innerTweenGroup.removeAll(),this.innerTweenGroup=null)}designWithSystemInfo(t){var{designWidth:e=375,scale:i=1}=t;this.innerSystemInfo=this.gameWX.getSystemInfoSync();var{screenWidth:s,screenHeight:n,pixelRatio:o}=this.innerSystemInfo,r=Math.min(s,n);this.deviceScale=Math.min(1,r/e)*i,this.devicePixelRatio=Math.round(o*this.scale*1e3)/1e3}}const O=new R;var F;!function(t){t[t.Unknown=0]="Unknown",t[t.Buffer=1]="Buffer",t[t.Blob=2]="Blob",t[t.Json=3]="Json",t[t.Xml=4]="Xml",t[t.Image=5]="Image",t[t.Audio=6]="Audio",t[t.Video=7]="Video",t[t.Text=8]="Text"}(F||(F={}));class H extends M.TinyEmitter{constructor(){super(),this.resLoadTicker=null,this.resLoadRetryCount=3;var{PIXI:t}=O;this.loader=new t.Loader,O.debug&&i.log("[minigamefe PixiCore]: LoaderManager constructor")}load(t){if(this.resLoadTicker)return Promise.reject({errMsg:"正在加载中"});var{timeout:e=1e4,list:s,mainTextureName:n,bindingScreen:o=0}=t;return s.forEach((t=>{var i,{name:s,url:n}=t;null===(i=this.loader)||void 0===i||i.add({name:s,url:n,bindingScreen:o,timeout:e})})),O.debug&&i.log("[minigamefe PixiCore]: loadResources start"),new Promise(((o,r)=>{var a,h=t=>{s.forEach((e=>{this.loadError(t,e.name||e.url)})),o({resources:t})};null===(a=this.loader)||void 0===a||a.load((()=>{if(this.loader){var{resources:t}=this.loader;O.debug&&i.log("[minigamefe PixiCore]: loadResources success:",t),this.clearLoadTicker(),n?this.checkMainRes(t,n)?h(t):r({errMsg:`关键资源${n}加载失败`,resources:t}):h(t)}})),this.resLoadTicker=setTimeout((()=>{if(this.loader){var{resources:e}=this.loader;if(this.clearLoadTicker(),this.emit("info",e),n&&this.checkMainRes(e,n))h(e);else{var i=`resources load error，资源加载超时 retryCount:${this.resLoadRetryCount}`;this.emit("info",i),this.resLoadRetryCount-=1,this.resLoadRetryCount>0?this.load(t).then((t=>{o({resources:t.resources})})).catch((t=>{r({errMsg:"资源加载失败",resources:t.resources})})):r({errMsg:"资源加载失败，请求超时"})}}}),e)}))}clearLoadTicker(){var t;this.resLoadTicker&&(null===(t=this.loader)||void 0===t||t.reset(),clearTimeout(this.resLoadTicker),this.resLoadTicker=null)}destroy(){var t;null===(t=this.loader)||void 0===t||t.destroy(),delete this.loader}checkMainRes(t,e){return!(!t[e]||t[e].error||!t[e].textures||!t[`${e}_image`])}loadError(t,e){var i="";t[e]?(t[e].error&&(i=`resources load error, ${e}:${t[e].error}`),t[e].type!==F.Json&&t[e].type!==F.Text||(t[e].children.length<1?i=`resources load error, ${e}_image: 子资源加载失败`:this.loadError(t,t[e].children[0].name||t[e].children[0].url))):i=`resources load error, ${e}: 资源加载失败`,i&&this.emit("error",i)}}class W extends M.TinyEmitter{constructor(t){super(),this.canvas=null,this.isNormalCanvas=!1,this.realX=0,this.realY=0,this.realWidth=0,this.realHeight=0,this.realZIndex="1",this.pixelRatio=1,this.scale=1;var{createScreenCanvas:e,pixelRatio:i=1,scale:s=1,isNormalCanvas:n=!1}=t;this.pixelRatio=i,this.scale=s,this.canvas=e(),this.canvas.getBoundingClientRect=()=>({x:this.x,y:this.y,left:this.x,top:this.y,width:this.width,height:this.height,bottom:0,right:0,toJSON:L}),this.isNormalCanvas=n,this.canvas.style||(this.isNormalCanvas=!0,Object.assign(this.canvas,{style:{x:0,y:0,left:0,top:0,width:0,height:0,zIndex:0}}))}set x(t){var e=Math.round(1e3*t)/1e3;this.realX=e,this.changeStyle("left",`${e}px`)}get x(){return this.realX}set y(t){var e=Math.round(1e3*t)/1e3;this.realY=e,this.changeStyle("top",`${e}px`)}get y(){return this.realY}set width(t){this.realWidth=t*this.scale,this.canvas&&(this.canvas.width=this.realWidth*this.pixelRatio,this.changeStyle("width",`${this.realWidth}px`))}get width(){return this.realWidth}get renderWidth(){return this.width/this.scale*this.pixelRatio}set height(t){this.realHeight=t*this.scale,this.canvas&&(this.canvas.height=this.realHeight*this.pixelRatio,this.changeStyle("height",`${this.realHeight}px`))}get height(){return this.realHeight}get renderHeight(){return this.height/this.scale*this.pixelRatio}set zIndex(t){this.realZIndex=t,this.changeStyle("zIndex",t)}get zIndex(){return this.realZIndex}set bindingScreen(t){this.canvas&&(this.canvas.bindingScreen=t)}get bindingScreen(){var t,e;return null!==(e=null===(t=this.canvas)||void 0===t?void 0:t.bindingScreen)&&void 0!==e?e:0}remove(){var t,e;null===(e=null===(t=this.canvas)||void 0===t?void 0:t.remove)||void 0===e||e.call(t),this.canvas=null}changeStyle(t,e){this.canvas&&this.canvas.style&&(this.canvas.style[t]=e,this.emit("changed"))}}class N extends M.TinyEmitter{constructor(t){super(),this.histroyPosList=[],this.hideData={isHide:!1,x:0,y:0},this.screenCanvas=t}get isHide(){return this.hideData.isHide}set(t){var{x:e,y:s}=t;O.debug&&i.log("[minigamefe PixiCore]: Set Canvas Position",e,s),this.screenCanvas.x===e&&this.screenCanvas.y===s||(this.histroyPosList.push({x:this.screenCanvas.x,y:this.screenCanvas.y}),this.histroyPosList.length>10&&this.histroyPosList.shift(),this.hideData.isHide?(E(e)&&(this.hideData.x=e),E(s)&&(this.hideData.y=s)):(E(e)&&(this.screenCanvas.x=e),E(s)&&(this.screenCanvas.y=s),this.emit("moved")))}back(){var t=this.histroyPosList.pop();t&&this.set(t)}get(){return{x:this.screenCanvas.x,y:this.screenCanvas.y}}hide(){this.hideData.isHide||(this.hideData.isHide=!0,this.hideData.x=this.screenCanvas.x,this.hideData.y=this.screenCanvas.y,this.screenCanvas.x=9999,this.screenCanvas.y=9999)}show(t){if(t&&E(t.x)&&E(t.y)&&(this.hideData.x=t.x,this.hideData.y=t.y,this.hideData.isHide=!0),this.hideData.isHide){var{x:e,y:i}=this.hideData;this.hideData.isHide=!1,E(e)&&(this.screenCanvas.x=e),E(i)&&(this.screenCanvas.y=i),this.emit("moved")}}}class G extends M.TinyEmitter{constructor(t){super();var{createScreenCanvas:e,createCanvas:s}=t;this.createScreenCanvas=e,this.createCanvas=s,O.debug&&i.log("[minigamefe PixiCore]: CanvasManager constructor")}init(t=!0){if(this.canvas)return this.canvas;try{this.canvas=new W({createScreenCanvas:t?this.createScreenCanvas:this.createCanvas,pixelRatio:O.dpr,scale:O.scale,isNormalCanvas:!t}),this.canvas.on("changed",(()=>{this.emit("render")})),this.canvas.x=0,this.canvas.y=0,this.canvas.width=1,this.canvas.height=1,this.canvas.zIndex="1",this.position=new N(this.canvas),this.position.on("moved",(()=>{this.emit("moved")})),this.emit("info","ScreenCanvas init success")}catch(t){var e=`ScreenCanvas init error:${P(t)}`;this.emit("error",e)}return this.canvas}get screenCanvas(){return this.canvas}get bindingScreen(){return this.canvas?this.canvas.isNormalCanvas?0:this.canvas.bindingScreen:(O.debug&&i.warn("[minigamefe PixiCore]: 无法获取bindingScreen，尚未创建ScreenCanvas"),0)}set zIndex(t){this.canvas&&(this.canvas.zIndex=t)}resize(t){var{width:e,height:s,resetTouchArea:n=!1}=t;O.debug&&i.log("[minigamefe PixiCore]: changeCanvasSize",e,s),this.canvas&&(void 0!==e&&(this.canvas.width=e),void 0!==s&&(this.canvas.height=s),this.emit("resize",{width:this.canvas.renderWidth,height:this.canvas.renderHeight,resetTouchArea:n}),this.emit("render"))}hide(){var t;null===(t=this.position)||void 0===t||t.hide()}show(t){var e;null===(e=this.position)||void 0===e||e.show(t)}destroy(){this.canvas&&(this.canvas.remove(),this.canvas=void 0)}}class V extends M.TinyEmitter{constructor(){super(...arguments),this.defaultTextStyle={fill:16777215,fontName:"Arial",fontSize:12,whiteSpace:"normal",textBaseline:"middle",lineHeight:17},this.maxFontSize=50,this.maxLineHeight=71,this.defaultFontSize=12,this.defaultLineHeight=17,this.textures={},this.bindingScreen=0,this.cacheTextures=[],this.cachePixiTexts=[]}init(t){var{bindingScreen:e,defaultTextStyle:s,defaultTextureName:n,defaultTextureKey:o}=t;this.bindingScreen=e,this.initDesign(s),this.defaultTextureName=n,this.defaultTextureKey=o,O.debug&&i.log("[minigamefe PixiCore]: DisplayManager inited")}addTextures(t){Object.assign(this.textures,t)}getTexture(t=this.defaultTextureKey,e=this.defaultTextureName){var s,n,o;return e&&t?(this.textures&&this.textures[e]&&this.textures[e].textures||O.debug&&i.error("[minigamefe PixiCore]: 请先加载对应的纹理资源！",t,e),null!==(o=null===(n=null===(s=this.textures)||void 0===s?void 0:s[e].textures)||void 0===n?void 0:n[t])&&void 0!==o?o:PIXI.Texture.EMPTY):(O.debug&&i.error("[minigamefe PixiCore]: 请先设置通用纹理"),PIXI.Texture.EMPTY)}createContainer(t){var{PIXI:e}=O,{x:i,y:s,isButton:n=!1}=t||{},o=new e.Container;return n&&this.isButton(o),this.setNodeData({node:o,x:i,y:s}),o}createSprite(t){var{PIXI:e}=O,{key:i=this.defaultTextureKey,name:s=this.defaultTextureName,isButton:n=!1,x:o,y:r,width:a,height:h}=t||{},l=new e.Sprite(this.getTexture(i,s));return n&&this.isButton(l),this.setNodeData({node:l,x:o,y:r,width:a,height:h}),l}createSpriteFrom(t){var{PIXI:e}=O,{bindingScreen:i}=this,{url:s=e.Texture.EMPTY,isButton:n=!1,x:o,y:r,width:a,height:h}=t,l=s;"string"==typeof s&&(l=this.createTextureFrom({url:s}));var c=e.Sprite.from(l,{bindingScreen:i});return n&&this.isButton(c),this.setNodeData({node:c,x:o,y:r,width:a,height:h}),c}createTexture(t){var{PIXI:e}=O,{bindingScreen:i}=this,{url:s}=t;if(!s)return this.getTexture();var n=new e.Texture(new e.BaseTexture(s,{bindingScreen:i}));return this.cacheTextures.push(n),n}createTextureFrom(t){var{PIXI:e}=O,{bindingScreen:i}=this,{url:s}=t;if(!s)return this.getTexture();var n=e.Texture.from(s,{bindingScreen:i});return this.cacheTextures.push(n),n}createGraphics(){O.debug&&i.warn("[minigamefe PixiCore]: 如非必需请不要使用Graphics，会增加drawcall");var{PIXI:t}=O,{bindingScreen:e}=this;return new t.Graphics(null,{bindingScreen:e})}createBitmapText(t){var e,i,{PIXI:s}=O,{textString:n="",textStyle:o,anchor:r=new s.Point(0,.5),isButton:a=!1,x:h,y:l,width:c,height:d}=t||{},u=this.defaultFontSize;return o?(e=Object.assign({},this.defaultTextStyle,o),u=+(o.fontSize||this.defaultFontSize)):e=this.defaultTextStyle,s.BitmapText&&s.BitmapFont&&e&&e.fontName&&s.BitmapFont.available[e.fontName]?(i=new s.BitmapText(n,Object.assign({},e,{fontSize:u})),r&&(i.anchor=r),a&&this.isButton(i),this.setNodeData({node:i,x:h,y:l,width:c,height:d})):i=this.createText({textString:n,textStyle:e,anchor:r,isButton:a,x:h,y:l,width:c,height:d}),i}createText(t){var e,{PIXI:i}=O,{textString:s="",textStyle:n,anchor:o=new i.Point(0,0),isButton:r=!1,x:a,y:h,width:l,height:c}=t||{},d=this.defaultFontSize,u=this.defaultLineHeight;n?(e=Object.assign({},this.defaultTextStyle,n),d=+(n.fontSize||this.defaultFontSize),u=+(n.lineHeight||this.defaultLineHeight)):e=this.defaultTextStyle,e.wordWrapWidth&&(e.wordWrapWidth/=d/this.maxFontSize);var p=new i.Text(s,Object.assign({},e,{fontSize:this.maxFontSize,lineHeight:this.maxLineHeight*(u/this.defaultLineHeight)}),this.bindingScreen);return p.scale.set(d/this.maxFontSize),o&&(p.anchor=o),r&&this.isButton(p),this.setNodeData({node:p,x:a,y:h,width:l,height:c}),this.cachePixiTexts.push(p),p}setHitArea(t,e,s,n=!1){var{PIXI:o,dpr:r}=O,{x:a=0,y:h=0,width:l,height:c}=e,d=s||this.defaultTextureKey;if(d){var u=1/t.scale.x,p=this.createSprite({key:d,x:a*u,y:h*u,width:l*u,height:c*u});n?(p.tint=16711680,p.alpha=.3):p.alpha=0,t.addChild(p)}else O.debug&&i.warn("[minigamefe PixiCore]: hitArea在x和y使用负数时有bug，建议传key或者设置默认精灵key"),t.hitArea=new o.Rectangle(a*r,h*r,l*r,c*r)}renderLabel(t){var e,i,s,{PIXI:n}=O,{textString:o="",textStyle:r=this.defaultTextStyle,padding:a,backgroundColor:h,backgroundRadius:l,getLabelContainer:c}=t,d=!c;return c?(e=(s=c).children[0],i=s.children[1]):(s=new n.Container,e=this.createGraphics(),i=this.createText({textString:o,textStyle:r})),i.text=o,i.position.set(a.left||0,a.top||0),e.clear(),e.beginFill(h.fill,h.alpha),e.drawRoundedRect(0,0,i.width+(a.left||0)+(a.right||0),i.height+(a.top||0)+(a.bottom||0),l),e.endFill(),d&&s&&s.addChild(e,i),{labelContainer:s,labelBackground:e,labelText:i}}createTextStyle(t){return new PIXI.TextStyle(t)}getTextScale(t=this.defaultFontSize){return t/this.maxFontSize}isButton(t){t.interactive=!0,t.on("pointerup",(()=>{t.alpha=1,this.emit("render")})),t.on("pointerdown",(()=>{t.alpha=.5,this.emit("render")})),t.on("pointerupoutside",(()=>{t.alpha=1,this.emit("render")})),t.on("pointercancel",(()=>{t.alpha=1,this.emit("render")}))}removeButton(t){t.interactive=!1,t.removeAllListeners("pointerup"),t.removeAllListeners("pointerdown"),t.removeAllListeners("pointerupoutside"),t.removeAllListeners("pointertap"),t.removeAllListeners("pointercancel")}get commonTextStyle(){return this.defaultTextStyle}destroy(){for(var t of Object.values(this.textures))t.spritesheet&&t.spritesheet.destroy(!0);for(var e of this.cacheTextures)e.destroy(!0);for(var i of this.cachePixiTexts)i.canvas&&i.destroy({children:!0,texture:!0,baseTexture:!0});this.cacheTextures=[],this.cachePixiTexts=[],this.textures={},this.defaultTextureName="",this.defaultTextureKey=""}setNodeData(t){var{node:e,width:i,height:s,x:n=0,y:o=0}=t||{};E(i)&&(e.width=i),E(s)&&(e.height=s),E(n)&&E(o)&&e.position.set(n,o)}initDesign(t){t&&(Object.assign(this.defaultTextStyle,t),this.defaultFontSize=+(t.fontSize||12),this.defaultLineHeight=+(t.lineHeight||17),this.maxFontSize=50,this.maxLineHeight=50/this.defaultFontSize*this.defaultLineHeight)}}class X extends M.TinyEmitter{constructor(){super(),this.needRender=!1,this.ticker=null,this.autoRender=!1,O.debug&&i.log("[minigamefe PixiCore]: RendererManager constructor")}init(t,e=!1,i=!1){var{PIXI:s}=O;return this.renderer=new s.Renderer({view:t.canvas,antialias:!1,transparent:!e,width:t.renderWidth,height:t.renderWidth,clearBeforeRender:!1,preserveDrawingBuffer:!0}),this.innerStage=new s.Container,this.innerStage.scale.set(O.dpr),this.autoRender=i,this.renderer.on("postrender",(()=>{this.emit("render")})),this.ticker=new s.Ticker,this.ticker.add(this.render.bind(this)),this.ticker.start(),this.emit("info","Renderer init success"),this.renderer}update(){this.needRender=!0}resize(t,e){var i;null===(i=this.renderer)||void 0===i||i.resize(t,e)}get stage(){return this.innerStage}destroy(){this.ticker&&(this.ticker.remove(this.render.bind(this)),this.ticker.destroy(),this.ticker=null),this.innerStage&&(this.innerStage.destroy(),this.innerStage=void 0),this.renderer&&(this.renderer.destroy(),this.renderer=void 0)}render(){var t;null===(t=O.tweenGroup)||void 0===t||t.update(),(this.autoRender||this.needRender)&&(this.needRender=!1,this.renderer&&this.renderer.render(this.stage,void 0,!0))}}var z,U,Y,j,$,Q,q,K,J="pixi_error",Z=t=>{z=t},tt=()=>z;function et(t,e,i){return!!t.find((t=>e>=t.left&&e<=t.left+t.width&&i>=t.top&&i<=t.top+t.height))}!function(t){t[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.Left=3]="Left",t[t.Right=4]="Right",t[t.Top=5]="Top",t[t.Bottom=6]="Bottom",t[t.All=7]="All"}(U||(U={})),function(t){t.devtools="devtools",t.android="android",t.ios="ios",t.windows="windows",t.mac="mac"}(Y||(Y={})),function(t){t.portrait="portrait",t.landscape="landscape",t.landscapeLeft="landscapeLeft",t.landscapeRight="landscapeRight"}(j||(j={})),function(t){t.DEVELOP="develop",t.TRIAL="trial",t.RELEASE="release"}($||($={})),function(t){t[t.release=1]="release",t[t.develop=2]="develop",t[t.trial=3]="trial"}(Q||(Q={})),function(t){t[t.Android=0]="Android",t[t.IOSJscore=1]="IOSJscore",t[t.IOSWK=2]="IOSWK",t[t.UnKnow=3]="UnKnow",t[t.PC=4]="PC",t[t.Devtools=5]="Devtools",t[t.IPadJscore=6]="IPadJscore",t[t.IPadWK=7]="IPadWK"}(q||(q={}));var it,st,nt,ot,rt=!("undefined"==typeof pluginEnv),at="undefined"!=typeof wx&&"undefined"!=typeof Page,ht=!("undefined"==typeof wx||at)||rt,lt=!1,ct=!1,dt=!1,ut=!1,pt=!1,gt=!1,vt=!1,mt=!1,ft=q.UnKnow,_t="",yt="";if(ht||at){if(rt){var{customEnv:bt}=pluginEnv;bt.customEnv&&(pluginEnv.customEnv=bt.customEnv),ot="undefined"!=typeof wx?wx:{}}if(it=rt&&pluginEnv.customEnv.wx?pluginEnv.customEnv.wx:wx||{}){try{if(ft=function(t){var e,i,s=q.UnKnow;t.platform===Y.devtools?s=q.Devtools:t.platform===Y.ios?(s=(null===(e=o.g)||void 0===e?void 0:e.isIOSHighPerformanceMode)?q.IOSWK:q.IOSJscore,t.model.indexOf("iPad")>-1&&(s=(null===(i=o.g)||void 0===i?void 0:i.isIOSHighPerformanceMode)?q.IPadWK:q.IPadJscore)):t.platform===Y.android?s=q.Android:t.platform===Y.windows&&(s=q.PC);return s}(st=it.getSystemInfoSync()||{}),st.platform===Y.devtools?dt=!0:st.platform===Y.ios?(lt=!0,vt=!!(null===o.g||void 0===o.g?void 0:o.g.isIOSHighPerformanceMode)):st.platform===Y.android?ct=!0:st.platform===Y.windows?pt=!0:st.platform===Y.mac&&(gt=!0),(pt||gt)&&(ut=!0),st.model.indexOf("iPad")>-1&&(mt=!0),A(st.SDKVersion,"2.24.4")>=0&&(null==ot?void 0:ot.getAccountInfoSync))try{var Tt=ot.getAccountInfoSync()||{},{plugin:wt={}}=Tt;_t=wt.appId,yt=wt.version}catch(t){i.log(t)}}catch(t){i.error(t),st={}}try{nt=it.getAccountInfoSync()||{}}catch(t){i.error(t),nt={}}}else st={},nt={}}else it={},st={},nt={};var xt={isMiniGamePlugin:rt,isMiniGame:ht,isMiniProgram:at,isIOS:lt,isAndroid:ct,isDevtools:dt,isWindows:pt,isMac:gt,isPC:ut,isWK:vt,isIPad:mt,systemInfo:st,accountInfo:nt,wx:it,runtimeType:ft,pluginWx:ot,pluginAppId:_t,pluginVersion:yt};null===(K=it.onDeviceOrientationChange)||void 0===K||K.call(it,(()=>{xt.systemInfo=it.getSystemInfoSync()||{}})),rt&&(xt.pluginEnv=pluginEnv);const St=xt;var Ct=null;function kt(t=!1,e){if(t&&Ct)return Ct;var{safeArea:i,deviceOrientation:s,screenWidth:n,screenHeight:o}=e||St.systemInfo,{left:r,top:a,right:h,bottom:l,width:c,height:d}=i;return n>o&&s===j.portrait&&(r=i.top,a=i.left,h=i.bottom,l=i.right,c=i.height,d=i.width),Ct={left:r,top:a,right:h,bottom:l,width:c,height:d}}class It{constructor(t){this.target=null,this.currentTarget=[],this.touches=[],this.targetTouches=[],this.changedTouches=[],this.timeStamp=0,this.buttons=0,this.clientX=0,this.clientY=0,this.offsetX=0,this.offsetY=0,this.pageX=0,this.pageY=0,this.screenX=0,this.screenY=0,this.type=t}preventDefault(){}stopPropagation(){}}function Mt(t,e){var i=new It("touch"),s=e.touches,n=e.changedTouches;return e.target&&(s=Object.values(e.touches),n=Object.values(e.changedTouches)),i.touches=s,i.targetTouches=Array.prototype.slice.call(s),i.changedTouches=n,i.timeStamp=e.timeStamp,i.target=t,i}class Lt extends M.TinyEmitter{constructor(t){super(),this.disabled=!1,this.dragArea=[],this.padding=8,this.preventArea=[],this.enableDrag=!0,this.enableSnap=U.Horizontal,this.isDraged=!1,this.isMouseDown=!1,this.isNormalCanvas=!1,this.isPC=O.systemInfo.platform===Y.windows||O.systemInfo.platform===Y.mac,this.tweenGroup=O.tweenGroup,this.innerTween=O.TWEEN,this.borderAreaChanged=!1,this.destroyed=!1,this.dragParams={identifier:0,flag:!1,pageX:0,pageY:0,startX:0,startY:0},this.pcListener={},this.setBorderArea=t=>{this.outDragArea=t,this.borderAreaChanged=!0,this.resize()},this.setTouchArea=t=>{this.dragArea=t,this.preventArea=t},this.canvas=t,this.screenCanvas=t.screenCanvas,this.outDragArea=kt(!1,O.systemInfo),this.isNormalCanvas="devtools"===O.systemInfo.platform||t.screenCanvas.isNormalCanvas,O.on("onDeviceOrientationChange",(()=>{this.borderAreaChanged||(this.outDragArea=kt(!1,O.systemInfo),this.resize())})),this.canvas.on("moved",(()=>{this.resize()}))}set canDrag(t){this.enableDrag=t}set snapType(t){this.enableSnap=t}resize(){this.canvas.position.isHide||(this.canvas.position.set({x:D(this.screenCanvas.x,this.minDragX,this.maxDragX),y:D(this.screenCanvas.y,this.minDragY,this.maxDragY)}),this.emit("render"),this.snap(!0))}inDragArea(t,e){return!!this.enableDrag&&(0!==this.dragArea.length&&et(this.dragArea,t,e))}inPreventArea(t,e){return 0!==this.preventArea.length&&et(this.preventArea,t,e)}enable(){this.disabled=!1}disable(){this.disabled=!0}get minDragX(){return this.outDragArea.left+this.padding}get minDragY(){return this.outDragArea.top+this.padding}get maxDragX(){return this.outDragArea.left+this.outDragArea.width-this.screenCanvas.width-this.padding}get maxDragY(){return this.outDragArea.top+this.outDragArea.height-this.screenCanvas.height-this.padding}bindScreenCanvasEventDispatch(t){var{dragParams:e,screenCanvas:i}=this,s=s=>{var n,o;if(this.destroyed)return!1;if(this.isPC&&"mousedown"===s.type){if(0===s.buttons)return!1;this.isMouseDown=!0;var r={identifier:0,clientX:s.clientX,clientY:s.clientY,pageX:s.pageX,pageY:s.pageY,offsetX:s.offsetX,offsetY:s.offsetY,force:1,screenX:s.screenX,screenY:s.screenY};s.touches=[r],s.changedTouches=[r]}var a=s.changedTouches[0]||s.touches[0],{pageX:h,pageY:l}=a,{offsetX:c,offsetY:d}=a;(this.isNormalCanvas||this.isPC)&&(c=h-i.x,d=l-i.y);var u=this.inPreventArea(c,d);return!u||(this.disabled?(null===(n=null==t?void 0:t.start)||void 0===n||n.call(t,{event:s,isPrevent:u,isDraging:e.flag}),!u):(this.inDragArea(c,d)&&(e.identifier=a.identifier,e.flag=!0,e.pageX=h,e.pageY=l,e.startX=h,e.startY=l),this.isDraged=!1,null===(o=null==t?void 0:t.start)||void 0===o||o.call(t,{event:s,isPrevent:u,isDraging:e.flag}),!u))},n=s=>{var n,o;if(this.destroyed)return!1;if(this.isPC&&!this.isMouseDown)return!1;var r=s.changedTouches[0]||s.touches[0],{pageX:a,pageY:h}=r,{offsetX:l,offsetY:c}=r;(this.isNormalCanvas||this.isPC)&&(l=a-i.x,c=h-i.y);var d=this.inPreventArea(l,c);if(this.disabled)return null===(n=null==t?void 0:t.move)||void 0===n||n.call(t,{event:s,isPrevent:d}),!d;if(e.flag&&e.identifier===r.identifier){var u=a-e.pageX,p=h-e.pageY,g=i.x+u,v=i.y+p;g=D(g,this.minDragX,this.maxDragX),v=D(v,this.minDragY,this.maxDragY),i.x=g,i.y=v,e.pageX=a,e.pageY=h;var m=Math.abs(a-e.startX),f=Math.abs(h-e.startY);(m>.5||f>.5)&&(this.isDraged=!0,this.emit("dragStart"))}else null===(o=null==t?void 0:t.move)||void 0===o||o.call(t,{event:s,isPrevent:d});return!d},o=s=>{var n,o;if(this.destroyed)return!1;if(this.isPC){if(!this.isMouseDown)return!1;this.isMouseDown=!1}var r=s.changedTouches[0]||s.touches[0],{pageX:a,pageY:h}=r,{offsetX:l,offsetY:c}=r;(this.isNormalCanvas||this.isPC)&&(l=a-i.x,c=h-i.y),this.isDraged&&this.snap();var d=this.inPreventArea(l,c);if(this.disabled)return null===(n=null==t?void 0:t.end)||void 0===n||n.call(t,{event:s,isPrevent:d,isDraged:this.isDraged}),this.isDraged=!1,e.flag=!1,!d;if(e.flag){if(e.identifier!==r.identifier)return!d;e.flag=!1,this.emit("dragEnd"),this.emit("render")}return null===(o=null==t?void 0:t.end)||void 0===o||o.call(t,{event:s,isPrevent:d,isDraged:this.isDraged}),this.isDraged=!1,!d};if(i.canvas){if(i.isNormalCanvas)return{touchStartHandler:s,touchMoveHandler:n,touchEndHandler:o};if(this.isNormalCanvas)i.canvas.addEventListener("touchstart",s),i.canvas.addEventListener("touchmove",n),i.canvas.addEventListener("touchend",o),i.canvas.addEventListener("touchcancel",o);else if(this.isPC){i.canvas.addEventListener("mousedown",(t=>{"function"==typeof transformNativeEvent&&(t=transformNativeEvent(t)),s(t)}));var{onTouchMove:r,onTouchEnd:a,onTouchCancel:h}=O.wx,l=t=>e=>{var{touches:i,changedTouches:s}=e,n=new It("mouse");n.touches=i,n.changedTouches=s,t&&t(n)};this.pcListener.moveListener=l(n),this.pcListener.endListener=l(o),this.pcListener.cancelListener=l(o),null==r||r(this.pcListener.moveListener),null==a||a(this.pcListener.endListener),null==h||h(this.pcListener.cancelListener)}else i.canvas.ontouchstart=s,i.canvas.ontouchmove=n,i.canvas.ontouchend=o,i.canvas.ontouchcancel=o}}snap(t=!1){if(O.debug&&i.log("snap",this.enableSnap===U.None,this.disabled),this.enableSnap!==U.None&&!this.disabled){var e,{screenCanvas:s}=this,n=0,o="x",r=this.getSnapDirection();r===U.Right?n=this.maxDragX:r===U.Left?n=this.minDragX:r===U.Top?(o="y",n=this.minDragY):r===U.Bottom&&(o="y",n=this.maxDragY),e=Math.round(2*Math.abs(n-s[o])),this.emit("snapStart",r);var a=()=>{s[o]=n,this.emit("snapEnd",r),this.emit("render")};t?a():e&&e>0?this.tweenGroup&&this.innerTween?(this.disable(),new this.innerTween.Tween(s,this.tweenGroup).to({[o]:n},e).easing(this.innerTween.Easing.Quadratic.InOut).onComplete((()=>{this.enable(),this.emit("snapEnd",r),this.emit("render")})).start()):(O.debug&&i.error("[minigamefe PixiCore]: tweenGroup&tween实例异常"),a()):a()}}destroy(){if(this.destroyed=!0,this.isPC){var{offTouchMove:t,offTouchEnd:e,offTouchCancel:i}=O.wx;this.pcListener.moveListener&&(null==t||t(this.pcListener.moveListener)),this.pcListener.endListener&&(null==e||e(this.pcListener.endListener)),this.pcListener.cancelListener&&(null==i||i(this.pcListener.cancelListener))}}getSnapDirection(){var{screenCanvas:t,outDragArea:e}=this,i=this.enableSnap,s=t.x+t.width/2,n=t.y+t.height/2;if(this.enableSnap===U.Horizontal)i=s<=e.left+e.width/2?U.Left:U.Right;else if(this.enableSnap===U.Vertical)i=n<=e.top+e.height/2?U.Top:U.Bottom;else if(this.enableSnap===U.All){var o=Math.round(n-e.top),r=Math.round(e.height+e.top-n),a=Math.round(s-e.left),h=Math.round(e.width+e.left-s),l=Math.min(a,h,o,r);i=l===a?U.Left:l===r?U.Bottom:l===h?U.Right:l===o?U.Top:U.Left}return i}}function Dt(t,e=null){var i=new(tt().Point);return e?(i.x=e.x+t.x,i.y=e.y+t.y):(i.x=t.x,i.y=t.y),t.parent?Dt(t.parent,i):i}class At extends M.TinyEmitter{constructor(t){var e;super(),this.destroyed=!1;var{TWEEN:s,mgp:n,xlog:o,quality:r,designWidth:a=375,createScreenCanvas:h,createCanvas:l,gameWX:c,scale:d=1,debug:u=!1}=t;!c&&u&&i.error("[minigamefe PixiCore]: 请正确传入gameWX对象");var p=tt();p&&p.settings?p.settings.SPRITE_MAX_TEXTURES=32:u&&i.error("[minigamefe PixiCore]: 请先引入插件环境或者基础库环境的PIXI，并调用setPIXI"),!s&&u&&i.error("[minigamefe PixiCore]: 请先传入TWEEN"),n?(this.xlog=n.xlog,this.quality=n.quality):(r&&o||!u||i.error("[minigamefe PixiCore]: 插件环境请传入MGP，基础库环境单独传入quality和xlog"),this.xlog=o,this.quality=r),O.init({pixiJs:p,TWEEN:s,gameWX:c,designWidth:a,scale:d,debug:u}),u&&void 0===h&&void 0===l&&i.error("[minigamefe PixiCore]: 至少传入一种创建canvas函数"),this.canvas=new G({createScreenCanvas:h,createCanvas:l}),this.renderer=new X,this.display=new V,this.bindEvent(this.canvas),this.bindEvent(this.renderer),this.bindEvent(this.display),null===(e=null==c?void 0:c.onShow)||void 0===e||e.call(c,(()=>{this.updateRender()})),u&&i.info("[minigamefe PixiCore]: inited")}get isSupportBitMapText(){return!!O.systemInfo&&A(O.systemInfo.SDKVersion,"2.24.7")>=0}init(t){if(this.canvas.screenCanvas){var e,{defaultTextureName:s,defaultTextureKey:n,defaultTextStyle:o,autoRender:r=!1,debug:a=!1}=t,h=this.renderer.init(this.canvas.screenCanvas,a,r);A(O.systemInfo.SDKVersion,"2.20.2")<=0&&((e=h).plugins.interaction.mapPositionToPoint=(t,i,s)=>{if(e){var n=e.plugins.interaction.interactionDOMElement,o=n.getBoundingClientRect(),r=1/e.plugins.interaction.resolution;t.set((i-o.left)*(n.width/o.width)*r,(s-o.top)*(n.height/o.height)*r)}}),this.touch=new Lt(this.canvas),this.bindTouchEvent(h),this.canvas.on("resize",(t=>{var e,i,{width:s,height:n,resetTouchArea:o}=t;this.renderer.resize(s,n),null===(e=this.touch)||void 0===e||e.resize(),o&&this.canvas.screenCanvas&&(null===(i=this.touch)||void 0===i||i.setTouchArea([{top:0,left:0,width:this.canvas.screenCanvas.width,height:this.canvas.screenCanvas.height}]))})),this.display.init({bindingScreen:this.canvas.bindingScreen,defaultTextureName:s,defaultTextureKey:n,defaultTextStyle:o}),this.bindEvent(this.touch),O.on("onDeviceOrientationChange",(()=>{this.emit("onDeviceOrientationChange"),this.updateRender()}))}else O.debug&&i.error("[minigamefe PixiCore]: 请先调用pixiJsCore.canvas.init()")}load(t){this.canvas.screenCanvas||O.debug&&i.warn("[minigamefe PixiCore]: 请先调用pixiJsCore.canvas.init()");var{timeout:e,list:s,mainTextureName:n}=t;return this.loader||(this.loader=new H,this.bindEvent(this.loader)),new Promise(((t,i)=>{this.loader?this.loader.load({timeout:e,mainTextureName:n,list:s,bindingScreen:this.canvas.bindingScreen}).then((e=>{e&&e.resources?(this.display.addTextures(e.resources),t(e.resources)):(this.qualityReport(J,e.errMsg||"minigamefe PixiCore Load资源加载失败"),i({errorMsg:e.errMsg||"加载失败"}))})).catch((t=>{this.qualityReport(J,t.errMsg||"minigamefe PixiCore Load资源加载失败"),i({errorMsg:t.errMsg||"加载失败"})})):i({errorMsg:"已销毁"})}))}tween(t){if(O.TWEEN)return new O.TWEEN.Tween(t,this.tweenGroup).onUpdate((()=>{this.updateRender()}));i.error("[minigamefe PixiCore]: 没有传入TWEEN！")}removeTween(t){this.tweenGroup.remove(t)}destroy(){var t,e;this.destroyed||(this.destroyed=!0,null===(t=this.loader)||void 0===t||t.destroy(),this.renderer.destroy(),this.canvas.destroy(),this.display.destroy(),null===(e=this.touch)||void 0===e||e.destroy(),O.destroy())}get touchEventHandler(){return this.innerTouchEventHandler}get tweenGroup(){return O.tweenGroup}updateRender(){this.renderer.update()}get stage(){return this.renderer.stage}get pixelRatio(){return O.dpr}bindTouchEvent(t){var e;if(this.canvas.screenCanvas){var i=function(t,e){return{start:i=>{var{event:s}=i;t.plugins.interaction.onPointerDown(Mt(e,s),"touchstart")},move:i=>{var{event:s}=i;t.plugins.interaction.onPointerMove(Mt(e,s),"touchmove")},end:i=>{var{event:s,isDraged:n}=i;n?t.plugins.interaction.onPointerCancel(Mt(e,s),"pointercancel"):t.plugins.interaction.onPointerUp(Mt(e,s),"touchend")}}}(t,this.canvas.screenCanvas.canvas);this.innerTouchEventHandler=null===(e=this.touch)||void 0===e?void 0:e.bindScreenCanvasEventDispatch(i)}}bindEvent(t){t.on("render",(()=>{this.emit("render")})),t.on("error",(t=>{this.qualityReport(J,t)})),t.on("info",this.xlogReport.bind(this))}xlogReport(t){var e;null===(e=this.xlog)||void 0===e||e.info(t)}qualityReport(t,e){var i;null===(i=this.quality)||void 0===i||i.report({Type:C.Error,Target:t,IsError:1,Result:e})}}const Et=d;var Pt,{parse:Bt,stringify:Rt}=JSON,{keys:Ot}=Object,Ft=String,Ht="string",Wt="object",Nt=(t,e)=>e,Gt=(t,e,i)=>{var s=Ft(e.push(i)-1);return t.set(i,s),s},Vt=(t,e,i)=>{for(var s=e&&typeof e===Wt?(t,i)=>""===t||-1<e.indexOf(t)?i:void 0:e||Nt,n=new Map,o=[],r=[],a=+Gt(n,o,s.call({"":t},"",t)),h=!a;a<o.length;)h=!0,r[a]=Rt(o[a++],l,i);return"["+r.join(",")+"]";function l(t,e){if(h)return h=!h,e;var i=s.call(this,t,e);switch(typeof i){case Wt:if(null===i)return i;case Ht:return n.get(i)||Gt(n,o,i)}return i}};!function(t){t.log="log",t.info="info",t.warn="warn",t.error="error"}(Pt||(Pt={}));class Xt{constructor({reportFunc:t,base:e,debug:s,delimiter:n,namespace:o}){this.reportFunc=null,this.debug=!1,this.base={},this.delimiter=" ",this.namespace="",t?(this.reportFunc=t,e&&this.setBase(e),this.debug=!!s,n&&(this.delimiter=n),this.namespace=o?` ${o} `:" "):i.error("[minigamefe XLog]: 未传入上报函数。")}setBase(t){this.base=Object.assign(Object.assign({},this.base),t)}log(...t){this.report(Pt.log,t)}info(...t){this.report(Pt.info,t)}warn(...t){this.report(Pt.warn,t)}error(...t){this.report(Pt.error,t)}getLogStr(t,e){var s;if(!this.reportFunc)return i.error(`[minigamefe${this.namespace}XLog]: 未传入上报函数。`),"";if(!e)return"";var n="";e.forEach((t=>{n.length>0&&(n+=this.delimiter);var e=t;"object"==typeof e&&(e=e instanceof TypeError?e.message:Vt(e)),n+=`${String(e).trim()}`}));var o=`[minigamefe${this.namespace}XLog]: ${JSON.stringify(Object.assign(Object.assign({},this.base),{type:t,appId:St.accountInfo.miniProgram.appId,content:n}))}`;return this.debug&&(null===(s=i[t])||void 0===s||s.call(i,o)),o}report(t,e){var{reportFunc:s}=this;if(s)if(s[t]&&"function"==typeof s[t]){var n=this.getLogStr(t,e);n&&s[t](n)}else i.error(`[minigamefe${this.namespace}XLog]: 传入的上报函数格式不对。`);else i.error(`[minigamefe${this.namespace}XLog]: 未传入上报函数。`)}}Z(PIXI);var zt,{_onShow:Ut,getSystemInfoSync:Yt,qualityReport:jt,onDeviceOrientationChange:$t}=Et;var Qt=function(t){return t[t.Unknown=0]="Unknown",t[t.Anchor_Notice=1]="Anchor_Notice",t[t.Audience_Comment=2]="Audience_Comment",t[t.Audience_Join=3]="Audience_Join",t[t.Top=4]="Top",t[t.Official=5]="Official",t[t.Official_BanComment=6]="Official_BanComment",t[t.Official_OpenComment=7]="Official_OpenComment",t[t.Official_ConnectMic=8]="Official_ConnectMic",t[t.Official_LiveRewardEnable=9]="Official_LiveRewardEnable",t[t.ComboLiveReward=10]="ComboLiveReward",t[t.RewardRankingNotice=11]="RewardRankingNotice",t[t.Official_Location=12]="Official_Location",t[t.RedPacket_Sent=13]="RedPacket_Sent",t[t.RedPacket_Received=14]="RedPacket_Received",t[t.Official_PureAudioMode=15]="Official_PureAudioMode",t[t.First_Notice=16]="First_Notice",t}({}),qt=function(t){return t[t.Unknown=0]="Unknown",t[t.Info=1]="Info",t[t.DisableInfo=2]="DisableInfo",t[t.GetCurrentRoomMemberInfo=3]="GetCurrentRoomMemberInfo",t[t.GetCurrentRoomInfo=4]="GetCurrentRoomInfo",t[t.EnableMic=5]="EnableMic",t[t.DisableMic=6]="DisableMic",t[t.GetCurrentMicState=7]="GetCurrentMicState",t[t.EnableMicInfo=8]="EnableMicInfo",t[t.DisableMicInfo=8]="DisableMicInfo",t[t.SetRoomTopic=10]="SetRoomTopic",t[t.GameLiveInfoControlActionSetMusic=11]="GameLiveInfoControlActionSetMusic",t[t.GetCurrentMusicState=12]="GetCurrentMusicState",t}({}),Kt=function(t){return t[t.End=0]="End",t[t.Start=1]="Start",t[t.PreStart=2]="PreStart",t[t.Cancel=3]="Cancel",t}({}),Jt={[Kt.End]:"liveEnd",[Kt.Start]:"liveStart",[Kt.PreStart]:"livePreStart",[Kt.Cancel]:"liveCancel"},Zt=function(t){return t[t.unknow=0]="unknow",t[t.friend=1]="friend",t[t.timeline=2]="timeline",t}({}),te=function(t){return t[t.Share=0]="Share",t[t.SetTopic=1]="SetTopic",t}({}),ee={[te.Share]:"1",[te.SetTopic]:"2"},ie=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};function se(){this._events={},this._conf&&ne.call(this,this._conf)}function ne(t){t?(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),this._maxListeners=void 0!==t.maxListeners?t.maxListeners:20,t.newListener&&(this._newListener=t.newListener),t.removeListener&&(this._removeListener=t.removeListener)):this._maxListeners=20}function oe(t,e){i.warn(`[Event] ${t} listeners of event ${e} have been added, possibly causing memory leak.`)}function re(t){this._events={},this._newListener=!1,this._removeListener=!1,ne.call(this,t)}re.prototype.delimiter=".",re.prototype.setMaxListeners=function(t){void 0!==t&&(this._maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t)},re.prototype.event="",re.prototype.once=function(t,e){return this._once(t,e,!1)},re.prototype.prependOnceListener=function(t,e){return this._once(t,e,!0)},re.prototype._once=function(t,e,i){return this._many(t,1,e,i),this},re.prototype.many=function(t,e,i){return this._many(t,e,i,!1)},re.prototype.prependMany=function(t,e,i){return this._many(t,e,i,!0)},re.prototype._many=function(t,e,i,s){var n=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function o(){return 0==--e&&n.off(t,o),i.apply(this,arguments)}return o._origin=i,this._on(t,o,s),n},re.prototype.emit=function(){this._events||se.call(this);var t=arguments[0];if("newListener"===t&&!this._newListener&&!this._events.newListener)return!1;var e,i,s,n,o,r=arguments.length;if(this._all&&this._all.length){if(o=this._all.slice(),r>3)for(e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];for(s=0,i=o.length;s<i;s++)switch(this.event=t,r){case 1:o[s].call(this,t);break;case 2:o[s].call(this,t,arguments[1]);break;case 3:o[s].call(this,t,arguments[1],arguments[2]);break;default:o[s].apply(this,e)}}if("function"==typeof(o=this._events[t])){switch(this.event=t,r){case 1:o.call(this);break;case 2:o.call(this,arguments[1]);break;case 3:o.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(r-1),n=1;n<r;n++)e[n-1]=arguments[n];o.apply(this,e)}return!0}if(o&&(o=o.slice()),o&&o.length){if(r>3)for(e=new Array(r-1),n=1;n<r;n++)e[n-1]=arguments[n];for(s=0,i=o.length;s<i;s++)switch(this.event=t,r){case 1:o[s].call(this);break;case 2:o[s].call(this,arguments[1]);break;case 3:o[s].call(this,arguments[1],arguments[2]);break;default:o[s].apply(this,e)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},re.prototype.emitAsync=function(){this._events||se.call(this);var t=arguments[0];if("newListener"===t&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var e,i,s,n,o,r=[],a=arguments.length;if(this._all){if(a>3)for(e=new Array(a),n=1;n<a;n++)e[n]=arguments[n];for(s=0,i=this._all.length;s<i;s++)switch(this.event=t,a){case 1:r.push(this._all[s].call(this,t));break;case 2:r.push(this._all[s].call(this,t,arguments[1]));break;case 3:r.push(this._all[s].call(this,t,arguments[1],arguments[2]));break;default:r.push(this._all[s].apply(this,e))}}if("function"==typeof(o=this._events[t]))switch(this.event=t,a){case 1:r.push(o.call(this));break;case 2:r.push(o.call(this,arguments[1]));break;case 3:r.push(o.call(this,arguments[1],arguments[2]));break;default:for(e=new Array(a-1),n=1;n<a;n++)e[n-1]=arguments[n];r.push(o.apply(this,e))}else if(o&&o.length){if(o=o.slice(),a>3)for(e=new Array(a-1),n=1;n<a;n++)e[n-1]=arguments[n];for(s=0,i=o.length;s<i;s++)switch(this.event=t,a){case 1:r.push(o[s].call(this));break;case 2:r.push(o[s].call(this,arguments[1]));break;case 3:r.push(o[s].call(this,arguments[1],arguments[2]));break;default:r.push(o[s].apply(this,e))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(r)},re.prototype.on=function(t,e){return this._on(t,e,!1)},re.prototype.prependListener=function(t,e){return this._on(t,e,!0)},re.prototype.onAny=function(t){return this._onAny(t,!1)},re.prototype.prependAny=function(t){return this._onAny(t,!0)},re.prototype.addListener=re.prototype.on,re.prototype._onAny=function(t,e){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),e?this._all.unshift(t):this._all.push(t),this},re.prototype._on=function(t,e,i){if("function"==typeof t)return this._onAny(t,e),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");return this._events||se.call(this),this._newListener&&this.emit("newListener",t,e),this._events[t]?("function"==typeof this._events[t]&&(this._events[t]=[this._events[t]]),i?this._events[t].unshift(e):this._events[t].push(e),!this._events[t].warned&&this._maxListeners>0&&this._events[t].length>this._maxListeners&&(this._events[t].warned=!0,oe.call(this,this._events[t].length,t))):this._events[t]=e,this},re.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var i,s=[];if(!this._events[t])return this;i=this._events[t],s.push({_listeners:i});for(var n=0;n<s.length;n++){if(i=s[n]._listeners,ie(i)){for(var o=-1,r=0,a=i.length;r<a;r++)if(i[r]===e||i[r].listener&&i[r].listener===e||i[r]._origin&&i[r]._origin===e){o=r;break}if(o<0)continue;return this._events[t].splice(o,1),0===i.length&&delete this._events[t],this._removeListener&&this.emit("removeListener",t,e),this}(i===e||i.listener&&i.listener===e||i._origin&&i._origin===e)&&(delete this._events[t],this._removeListener&&this.emit("removeListener",t,e))}return function t(e){if(void 0!==e){var i=Object.keys(e);for(var s in i){var n=i[s],o=e[n];o instanceof Function||"object"!=typeof o||null===o||(Object.keys(o).length>0&&t(e[n]),0===Object.keys(o).length&&delete e[n])}}}(this.listenerTree),this},re.prototype.offAny=function(t){var e,i=0,s=0;if(t&&this._all&&this._all.length>0){for(i=0,s=(e=this._all).length;i<s;i++)if(t===e[i])return e.splice(i,1),this._removeListener&&this.emit("removeListenerAny",t),this}else{if(e=this._all,this._removeListener)for(i=0,s=e.length;i<s;i++)this.emit("removeListenerAny",e[i]);this._all=[]}return this},re.prototype.removeListener=re.prototype.off,re.prototype.removeAllListeners=function(t){return void 0===t?(!this._events||se.call(this),this):(this._events&&delete this._events[t],this)},re.prototype.listeners=function(t){return this._events||se.call(this),this._events[t]||(this._events[t]=[]),ie(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},re.prototype.eventNames=function(){return Object.keys(this._events)},re.prototype.listenerCount=function(t){return this.listeners(t).length},re.prototype.listenersAny=function(){return this._all?this._all:[]};var{KeyValueReport20267:ae}=Et,he=new ae;function le(){he.send({UIArea:3605,PositionID:6,ActionID:1})}function ce(t){he.send({UIArea:3607,PositionID:0,ActionID:7,ExternInfo:ee[t]})}var{Quality:de}=Et,ue=new de({pluginAppId:"wxapplib_live",pluginVersion:"1.0.0"}),pe=0;function ge(t){ue.report({Type:k.Error,Target:"liveInvokeFail",Result:t})}var{innerShareInvitationToLiveRoom:ve,invokeOperateWXDataPromise:me}=Et;const fe=new class{shareToFriend(t=!1){!function(t=!1){he.send({UIArea:t?3606:3605,PositionID:t?1:2,ActionID:2})}(t),c.invoke("shareGameLive",{type:Zt.friend},(e=>{try{!function(t,e,i=!1){he.send({UIArea:i?3606:3605,PositionID:i?1:2,ActionID:10,ActionStatus:t?"1":"2",Object:e})}(!!(e.errMsg.indexOf("ok")>-1&&(e.singleChat||e.groupChat)),`singleChat=${e.singleChat||0}:groupChat=${e.groupChat||0}`,t)}catch(t){ge(P(t))}}))}shareToTimeline(t=!1){!function(t=!1){he.send({UIArea:t?3606:3605,PositionID:t?2:3,ActionID:2})}(t),c.invoke("shareGameLive",{type:Zt.timeline},(e=>{try{!function(t,e=!1){he.send({UIArea:e?3606:3605,PositionID:e?2:3,ActionID:10,ActionStatus:t?"1":"2"})}(!!(e.errMsg.indexOf("ok")>-1),t)}catch(t){ge(P(t))}}))}exitGameLive(t=L){var e;e=Math.round(Date.now()/1e3)-ii.liveStartTime,he.send({UIArea:3605,PositionID:1,ActionID:2,Time:e}),c.invoke("exitGameLive",{},(e=>{t(e)}))}openFansClub(t=L){he.send({UIArea:3605,PositionID:7,ActionID:2}),c.invoke("openFansClub",{},(e=>{t(e)}))}openMusic(t=L){c.invoke("gameLiveInfoControl",{action:qt.GameLiveInfoControlActionSetMusic},(e=>{t(e)}))}openPlayTogether(){he.send({UIArea:3605,PositionID:6,ActionID:2}),ve()}checkPlayTogether(t){me({apiName:"webapi_game_transfer",reqData:{reqPath:"gamelive.getminigameteamupconfig"}}).then((e=>{var i,s;t(null!==(i=null==e||null===(s=e.data)||void 0===s?void 0:s.enable_teamup)&&void 0!==i&&i)}))}enterGameLiveRoom(t=L){he.send({UIArea:3605,PositionID:5,ActionID:2}),c.invoke("enterGameLiveRoom",{},(e=>{t(e)}))}minimizeGameLive(t=L){he.send({UIArea:3602,PositionID:4,ActionID:2}),c.invoke("minimizeGameLive",{},(e=>{t(e)}))}gameLiveInfoControl(t){return new Promise((e=>{c.invoke("gameLiveInfoControl",{action:t},(t=>{e(t)}))}))}setGameLiveTopic(t,e=L){c.invoke("gameLiveInfoControl",{action:qt.SetRoomTopic,topic:t},(t=>{e(t)}))}micOp(t,e=L){var i=t?qt.EnableMic:qt.DisableMic;t?he.send({UIArea:3605,PositionID:4,ActionID:2,OpType:3}):he.send({UIArea:3605,PositionID:4,ActionID:2,OpType:7}),c.invoke("gameLiveInfoControl",{action:i},(t=>{e(t)}))}getMicState(t=L){c.invoke("gameLiveInfoControl",{action:qt.GetCurrentMicState},(e=>{t(e)}))}getMusicState(t=L){c.invoke("gameLiveInfoControl",{action:qt.GetCurrentMusicState},(e=>{t(e)}))}};var{createFeedbackLogger:_e}=Et,ye=_e("gamelive"),be=[/\ufe0e/,/\ufe0f/,/\u20e3/],Te=[/\ud83c[\udde6-\uddff]\ud83c[\udde6-\uddff]/,/\ud83c\udff4(?:\udb40[\udc20-\udc7e])+?\udb40\udc7f/,/[\ud800-\udbff][\udc00-\udfff]/,new RegExp(`.(?:${be.map((t=>t.source)).join("|")})+`),/[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u00A9\u00AE\u203C\u2049\u2122\u2139\u2194\u2195\u2196\u2197\u2198\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263a\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u26F9\u2702\u2708\u2709\u270C\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u2764\u27A1\u2934\u2935\u2B05-\u2b07\u3030\u303D\u3297\u3299\u261D\u26F9\u270A-\u270d]/],we=[/\ud83c[\udffb-\udfff]/].concat(be),xe="text",Se=new RegExp(`^${/\u200d/.source}`),Ce=new RegExp(`^(?:${Te.map((t=>t.source)).join("|")})`),ke=new RegExp(`(?:${Te.map((t=>t.source)).join("|")})`),Ie=new RegExp(`${Ce.source}(?:${we.map((t=>`(?:${t.source})`)).join("|")})*`),Me=new RegExp(`${ke.source}(?:${we.map((t=>`(?:${t.source})`)).join("|")})*`);function Le(t,e=!0){var i="";if((e?Ce:ke).test(t)){var s=e?Ie:Me,n=t.match(s);n&&(i+=n[0],i+=function(t){var e="",i=t.match(Se);return i&&(e+=i[0],e+=Le(t=t.substr(i[0].length))),e}(t=t.substr(t.indexOf(i)+n[0].length)))}return i}function De(t=""){for(var e=[];t.length>0;){var i=Le(t,!1);if(i){var s=t.indexOf(i);s>0&&e.push({text:t.slice(0,s),type:xe}),e.push({text:i,type:"other"}),t=t.slice(s+i.length)}else e.push({text:t,type:xe}),t=""}return e}function Ae(t="",e=0,i=1/0){var s=Ee(t);return e<0&&(e=s.length+e),s.slice(e,e+i).join("")}function Ee(t=""){for(var e=[],i=De(t),s=0;s<i.length;s++)i[s].type===xe?e=e.concat(i[s].text.split("")):e.push(i[s].text);return e}function Pe(t,e,s){if(0===t.length)return t;e.breakWords=!0,e.wordWrap=!0,e.wordWrapWidth||(s||(i.error("[minigamefe PixiCore]: 请设置换行宽度"),s=100),e.wordWrapWidth=s);for(var n=tt(),o=e instanceof n.TextStyle?e:new n.TextStyle(e),r=t,a=n.TextMetrics.measureText(r,o,!0);a.lines.length>1;){var h=a.lines[0];if(r=B(h=Ae(h,0,Ee(h).length-1)),h.length<=1)return r;a=n.TextMetrics.measureText(r,o,!0)}return r}var Be,Re;function Oe(){return Re||(Re=Et.getAccountInfoSync())}function Fe(t){if(!t)return"";if(t.indexOf("回复")>-1)return t;var e=Ee(t);return Pe(e.length>6?e.slice(0,6).join("")+"…":e.join(""),Ve.commonStyle,100)}const He={debug:!1,icons:"https://res.wx.qq.com/wechatgame/product/minigameLive/20221214d2bbd/icons.json",MAX_MESSAGE_LENGTH:20,MAX_USER_LENGTH:20,ENTER_ANIMATE_ID:0,TOAST_ANIMATE_ID:1,SYSTEMTIPS_ANIMATE_ID:2,MAX_HEIGHT:252,MAX_WIDTH:300,PADDING:4,GIFT_HEIGHT:244,RANK_COLORS:["#E1B363","#B6C8CD","#DFB599","#E0E0E0"]};var We={ready:!1,position:{x:0,y:0},IS_DEVTOOLS:!1,designSize:{width:He.MAX_WIDTH,height:He.MAX_HEIGHT},lockSize:{width:He.MAX_WIDTH,height:112},device:{width:He.MAX_WIDTH,height:He.MAX_HEIGHT},screenWidth:0,screenHeight:0,toolWidth:32,headerHeight:48,initPosition:{x:16,y:16}},Ne={fill:16777215,fontSize:12,whiteSpace:"normal",textBaseline:"middle",lineHeight:16,dropShadow:!0,dropShadowColor:"rgba(0, 0, 0, 0.8)",dropShadowDistance:1},Ge=Object.assign({},Ne,{fill:14737632,breakWords:!0,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-72}),Ve={commonStyle:Ne,dataStyle:Ge,listStyle:Object.assign({},Ne,{fill:14737632,breakWords:!0,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-72}),tipsStyle:Object.assign({},Ge,{fill:10592673}),linkStyle:Object.assign({},Ge,{fill:8425639}),userNameStyle:Object.assign({},Ne,{fill:14737632}),contextStyle:Object.assign({},Ne,{breakWords:!0,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-48}),joinStyle:Object.assign({},Ne,{lineHeight:20,breakWords:!0,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-56}),giftStyle:Object.assign({},Ne,{fill:9621832}),titleStyle:Object.assign({},Ne,{breakWords:!0,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-184,dropShadow:!1}),shareTitleStyle:Object.assign({},Ne,{dropShadow:!1}),timeStyle:Object.assign({},Ne,{lineHeight:14,fontSize:10,dropShadow:!1}),tipStyle:Object.assign({},Ne,{fill:10592673,lineHeight:14,dropShadow:!1}),newMessageStyle:Object.assign({},Ne,{fill:0,lineHeight:12,dropShadow:!1}),toastStyle:Object.assign({},Ne,{fill:16777215,lineHeight:20,dropShadow:!1}),musicNameStyle:Object.assign({},Ne,{fill:"rgba(255, 255, 255, 0.5)",fontSize:10,wordWrapWidth:60,breakWords:!0,wordWrap:!0,dropShadow:!1}),systemTipsStyle:Object.assign({},Ne,{fill:"rgba(0, 0, 0, 0.9)",breakWords:!0,lineHeight:17,dropShadow:!1,wordWrap:!0,wordWrapWidth:He.MAX_WIDTH-(We.toolWidth+48)})},Xe=t=>{We.ready=!0;var{screenWidth:e,screenHeight:i,platform:s,safeArea:n}=t;We.IS_DEVTOOLS="devtools"===s,We.IS_DEVTOOLS||(We.position.x=We.initPosition.x+n.left,We.position.y=We.initPosition.y+n.top,e>i&&("ios"!==s||We.IS_DEVTOOLS||(We.position.x=We.initPosition.x+n.top,We.position.y=We.initPosition.y+n.left),We.position.y+=16)),We.screenWidth=e,We.screenHeight=i};function ze(t=!1){if(!We.ready||t){var e=Be||(Be=Et.getSystemInfoSync());Xe(e)}}function Ue(){return new Promise((t=>{We.ready?t(We):new Promise((t=>{t(Be||(Be=Et.getSystemInfoSync()))})).then((e=>{Xe(e),t(We)}))}))}var{_onHide:Ye,_onShow:je,_onGameLiveStateChange:$e,onAudioInterruptionBegin:Qe,onAudioInterruptionEnd:qe,showToast:Ke,packageChannel:Je,onWindowResize:Ze}=Et;function ti(t,e,i){if(i!==t[`_${e}`]){var s=function(t){return t<1e3?`${t}`:t>=1e3&&t<1e4?`${parseFloat(""+t/1e3).toFixed(1)}k`:t>1e4&&t<1e5?`${parseFloat(""+t/1e4).toFixed(1)}w`:"10w+"}(i);s!==t[e]&&(t[`inner${e}`]=i,t[`inner${e}Str`]=s)}}var ei=!1;var ii=new class extends re{constructor(){super(),this.lastEvent=null,this.msgList=[],this.liveId=0,this.liveStartTime=Math.round(Date.now()/1e3),this.liveTopic="",this.liveMemberList=[],this.account=null,this.gameLiveState=void 0,this.locked=!1,this.isMusicPlaying=!1,this.isHide=!1,this.innerCurrLikeCount=0,this.innerCurrLikeCountStr="0",this.innerCurrOnlineCount=0,this.innerCurrOnlineCountStr="0",this.innerTotalRewardCount=0,this.innerTotalRewardCountStr="0",this.innerTotalViewCount=0,this.innerTotalViewCountStr="0",this.innerReadyToStart=!1,this.innerNetThresholdCount=0,this.innerNetToasted=!1,ze(),Ze((()=>{ze(!0)})),this.init()}reset(){this.lastEvent=null,this.innerCurrLikeCount=0,this.innerCurrLikeCountStr="0",this.innerCurrOnlineCount=0,this.innerCurrOnlineCountStr="0",this.innerTotalRewardCount=0,this.innerTotalRewardCountStr="0",this.innerTotalViewCount=0,this.innerTotalViewCountStr="0",this.msgList=[],this.locked=!1}bindHideAndShowEvent(){var t=()=>{this.isHide=!1,this.innerReadyToStart&&(this.innerReadyToStart=!1,this.emit("liveStart")),this.msgList.length&&(this.emit("msgListChange",this.msgList),this.msgList=[])};Qe((()=>{this.isHide=!0})),qe((()=>{var e;null==ye||null===(e=ye.info)||void 0===e||e.call(ye,"[直播面板] 音频中断结束 onAudioInterruptionEnd"),t()})),Ye((()=>{this.isHide=!0})),je((()=>{var e;null==ye||null===(e=ye.info)||void 0===e||e.call(ye,"[直播面板] 后台切前台 onShow"),t()}))}init(){this.bindHideAndShowEvent(),c.on("onGameLiveInfo",this.gameLiveInfoEventHandler.bind(this)),c.on("onGameLiveNetStateChange",this.gameLiveNetStateEventHandler.bind(this)),$e(this.gameLiveStateChagneHandler.bind(this)),c.on("onGameLiveMicStateChange",this.micStateChangeHandler.bind(this)),c.on("onGameLiveMusicPlayStateChange",this.musicStateChangeHandler.bind(this)),Je.on("transferGameLiveStateChange",(t=>{this.gameLiveStateChagneHandler(t)}))}destroy(){this.reset(),this.removeAllListeners("musicStateChange"),this.removeAllListeners("systemTipsUpdate"),this.removeAllListeners("teamupConfigChange"),this.removeAllListeners("roomListChange"),this.removeAllListeners("micStateChange"),this.removeAllListeners("msgListChange"),this.removeAllListeners("roomInfoChange")}gameLiveNetStateEventHandler(t){var e,{quality:i,threshold:s}=t;this.innerNetToasted||(i>=s?(this.innerNetThresholdCount+=1,null==ye||null===(e=ye.info)||void 0===e||e.call(ye,`[直播面板] 当前网络质量 quality: ${i}, threshold: ${s}`),this.innerNetThresholdCount>3&&(Ke({icon:"none",title:"当前网络信号差"}),this.innerNetToasted=!0,setTimeout((()=>{this.innerNetToasted=!1}),6e4))):this.innerNetThresholdCount=0)}micStateChangeHandler(t){this.emit("micStateChange",t)}musicStateChangeHandler(t){this.isMusicPlaying=(null==t?void 0:t.isPlaying)||!1,this.emit("musicStateChange",t)}gameLiveStateChagneHandler(t){var e,i,s,n,o;this.gameLiveState=t.event,null===(e=r)||void 0===e||null===(i=e.info)||void 0===i||i.call(e,`[直播面板] 直播状态 event:${null!==(s=null==Jt?void 0:Jt[t.event])&&void 0!==s?s:t.event}`),null==ye||null===(n=ye.info)||void 0===n||n.call(ye,`[直播面板] 直播状态 event:${null!==(o=null==Jt?void 0:Jt[t.event])&&void 0!==o?o:t.event}`),t.event===Kt.End||t.event===Kt.Cancel?(ei=!1,this.emit("liveEnd",t)):t.event===Kt.Start?ei||(ei=!0,t.extra&&(this.account=t.extra,this.liveId=this.account.liveId,he.setBase({FuncID:`${this.account.finderUsername}:${this.liveId}`})),this.getRoomInfo(),fe.getMusicState(this.musicStateChangeHandler.bind(this)),this.isHide?this.innerReadyToStart=!0:Ue().then((()=>{setTimeout((()=>{this.emit("liveStart")}),0)}))):t.event===Kt.PreStart&&this.emit("livePreStart");var a,h=JSON.parse(JSON.stringify(t));delete h.extra,a=h,he.send({UIArea:0,PositionID:1,ActionID:28,ExternInfo:"string"==typeof a?encodeURIComponent(a):encodeURIComponent(JSON.stringify(a))})}gameLiveInfoEventHandler(t){this.lastEvent=t;var{msgList:e=[]}=t;if(this.isHide)this.msgList.push(...e);else{e.length&&this.emit("msgListChange",e);var i=!1;t.currLikeCount===this.innerCurrLikeCount&&t.currOnlineCount===this.innerCurrOnlineCount&&t.totalRewardCount===this.innerTotalRewardCount&&t.totalViewCount===this.innerTotalViewCount||(i=!0),this.innerCurrOnlineCount===t.currOnlineCount&&this.innerTotalRewardCount===t.totalRewardCount||this.emit("roomListChange"),this.currLikeCount=t.currLikeCount||0,this.currOnlineCount=t.currOnlineCount||0,this.totalRewardCount=t.totalRewardCount||0,this.totalViewCount=t.totalViewCount||0,i&&this.emit("roomInfoChange",this.roomInfo)}}getCurrentRoomMemberInfo(){return fe.gameLiveInfoControl(qt.GetCurrentRoomMemberInfo).then((t=>{this.liveMemberList=t&&t.memberList||[]}))}getRoomInfo(){return fe.gameLiveInfoControl(qt.GetCurrentRoomInfo).then((t=>{if(t.errMsg.indexOf(":ok")>-1){var{startTime:e,topic:i}=t;E(e)&&e>0&&(this.liveStartTime=e),this.liveTopic=null!=i?i:""}}))}setLocked(t){this.locked=t}get roomInfo(){return`${this.currLikeCount}喝彩·${this.totalViewCount}人看过·${this.currOnlineCount}人在线·${this.totalRewardCount}热度`}get currLikeCount(){return this.innerCurrLikeCountStr}set currLikeCount(t){ti(this,"CurrLikeCount",t)}get currOnlineCount(){return this.innerCurrOnlineCountStr}set currOnlineCount(t){ti(this,"CurrOnlineCount",t)}get totalRewardCount(){return this.innerTotalRewardCountStr}set totalRewardCount(t){ti(this,"TotalRewardCount",t)}get totalViewCount(){return this.innerTotalViewCountStr}set totalViewCount(t){ti(this,"TotalViewCount",t)}},si=(()=>(n.onReady((()=>{si!==n&&void 0!==si&&Object.assign(si,n)})),n))();const ni=si;var oi={};function ri(t,e,i){var s=Dt(t);oi[e]={x:s.x,y:s.y,width:t.width,height:t.height,check:i}}function ai(){Object.keys(oi).forEach((t=>{delete oi[t]}))}ni.onReady((()=>{Ue().then((t=>{t&&t.device&&(oi.canvas={width:t.device.width,height:t.device.height,check:()=>!1})}))}));var hi=[];function li(t,e,i=2e3,s=null){hi[t]?(zt.removeTween(hi[t]),e.alpha=1,hi[t]=zt.tween(e).delay(i).to({alpha:0},300).easing(x.Easing.Quadratic.InOut).onComplete((()=>{hi[t]=null,s&&s()})).start()):(e.alpha=0,hi[t]=zt.tween(e).to({alpha:1},300).easing(x.Easing.Quadratic.InOut).onComplete((()=>{hi[t]=zt.tween(e).delay(i).to({alpha:0},300).easing(x.Easing.Quadratic.InOut).onComplete((()=>{hi[t]=null,s&&s()})).start()})).start())}function ci(t,e,i,s,n,o=0,r,a=!1){var h;h="number"==typeof o?{tl:o,tr:o,br:o,bl:o}:o,a&&t.clear(),t.beginFill(r.fill,r.alpha),t.moveTo(e+h.tl,i),t.lineTo(e+s-h.tr,i),t.quadraticCurveTo(e+s,i,e+s,i+h.tr),t.lineTo(e+s,i+n-h.br),t.quadraticCurveTo(e+s,i+n,e+s-h.br,i+n),t.lineTo(e+h.bl,i+n),t.quadraticCurveTo(e,i+n,e,i+n-h.bl),t.lineTo(e,i+h.tl),t.quadraticCurveTo(e,i,e+h.tl,i),t.endFill()}var di=o(666);class ui extends M.TinyEmitter{constructor(t){super(),this.enabled=!0,this.scrollWidth=0,this.scrollHeight=0,this.padding={},this.contentWidth=0,this.contentHeight=0,this.useAutoSize=!0,this.debug=!1,this.destroyed=!1;var e=tt(),{width:i,height:s,padding:n,maskTexture:o,scrollerOptions:r={},debug:a}=t;this.contentWidth=i||0,this.contentHeight=s||0,this.padding=n||{},this.maskTexture=o||e.Texture.WHITE,this.debug=!!a,this.initScroll(r),this.initMask()}get container(){return this.view}enable(){this.enabled=!0}disable(){this.enabled=!1}setPosition(t,e){this.view.position.set(t,e)}updateScrollSize(t){this.useAutoSize=!1;var{width:e,height:i}=t;"number"==typeof e&&isFinite(e)&&(this.scrollWidth=Math.round(100*e)/100),"number"==typeof i&&isFinite(i)&&(this.scrollHeight=Math.round(100*i)/100),this.update()}resetScrollSize(t=!1,e=!1){t&&(this.scrollWidth=this.content.width+(this.padding.left||0)+(this.padding.right||0)),e&&(this.scrollHeight=this.content.height+(this.padding.top||0)+(this.padding.bottom||0)),this.update()}updateContentSize(t){var{width:e,height:i}=t;if(E(e)&&(this.contentWidth=e),E(i)&&(this.contentHeight=i),this.view.mask){var s=this.view.mask;s.width=this.contentWidth,s.height=this.contentHeight}this.update()}scrollTo(t,e,i=!1){var s;null===(s=this.scrollContainer)||void 0===s||s.scrollTo(t,e,i)}scrollBy(t,e,i=!1){var s;null===(s=this.scrollContainer)||void 0===s||s.scrollBy(t,e,i)}scrollToBottom(t=!1){var e=Math.max(this.scrollHeight-this.contentHeight,0);this.debug&&i.log("scrollToBottom:",e),this.scrollTo(0,e,t)}addChild(...t){this.content.addChild(...t),this.useAutoSize&&this.resetScrollSize(!0,!0)}removeChild(...t){this.content.removeChild(...t),this.useAutoSize&&this.resetScrollSize(!0,!0)}removeChildren(){this.content.removeChildren().forEach((t=>t.destroy({children:!0}))),this.useAutoSize&&this.resetScrollSize(!0,!0)}destroy(){this.view.destroy({children:!0}),this.destroyed=!0}get isBottom(){return Math.floor(-this.content.position.y)>=Math.floor(Math.max(this.scrollHeight-this.contentHeight,0))}get top(){return-this.content.position.y}get left(){return-this.content.position.x}initScroll(t={}){var e=tt();this.view=new e.Container,this.content=new e.Container,this.view.addChild(this.content);var s=Object.assign({scrollingY:!0,scrollingX:!1},t);this.scrollContainer=new di.Scroller(((t,e)=>{this.destroyed||(this.debug&&i.log("scroll:",e,t),s.scrollingY&&(this.content.position.y=-e),s.scrollingX&&(this.content.position.x=-t),this.emit("scrollEvent",{x:this.content.position.x,y:this.content.position.y}))}),s),this.resetScrollSize(!0,!0),this.eventDispatch()}initMask(){var t=new(tt().Sprite)(this.maskTexture);t.width=this.contentWidth,t.height=this.contentHeight,this.view.addChild(t),this.view.mask=t}eventDispatch(){this.view.interactive=!0,this.view.on("pointerdown",(t=>{var e;if(this.debug&&i.log("pointerdown"),this.enabled){var s=t.data.originalEvent;null===(e=this.scrollContainer)||void 0===e||e.doTouchStart(s.changedTouches||s.touches,s.timeStamp)}})),this.view.on("pointermove",(t=>{var e;if(this.debug&&i.log("pointermove"),this.enabled){var s=t.data.originalEvent;null===(e=this.scrollContainer)||void 0===e||e.doTouchMove(s.changedTouches||s.touches,s.timeStamp),this.emit("scrollMove")}})),this.view.on("pointerup",(t=>{var e;if(this.debug&&i.log("pointerup"),this.enabled){var s=t.data.originalEvent;null===(e=this.scrollContainer)||void 0===e||e.doTouchEnd(s.timeStamp)}})),this.view.on("pointerupoutside",(t=>{var e;if(this.debug&&i.log("pointerupoutside"),this.enabled){var s=t.data.originalEvent;null===(e=this.scrollContainer)||void 0===e||e.doTouchEnd(s.timeStamp)}}))}update(){var t;null===(t=this.scrollContainer)||void 0===t||t.setDimensions(this.contentWidth,this.contentHeight,this.scrollWidth,this.scrollHeight)}}class pi extends PIXI.Container{constructor(t){super(),this.app=void 0,this.animating=!1,this.renderY=0,this.viewerData=[],this.scrollBox=void 0,this.viewerText=void 0,this.giftText=void 0,this.rankBackground=void 0,this.rankList=void 0,this.shareText=void 0,this.tipsText=void 0,this.hasScrollReport=!1,this.overTips=void 0,this.autoTicker=null,this.app=t,this.init(),this.visible=!1}init(){this.position.set(We.toolWidth,We.headerHeight),this.initMask(),this.scrollBox=new ui({width:We.device.width-We.toolWidth,height:We.device.height-We.headerHeight,scrollerOptions:{scrollingX:!1,scrollingY:!0}}),this.scrollBox.on("scrollevent",(()=>{this.hasScrollReport||(this.hasScrollReport=!0,he.send({UIArea:3604,PositionID:1,ActionID:21}))}));this.viewerText=zt.display.createText({textString:`在线观众 (${this.viewerData.length}人)`,textStyle:Ve.dataStyle}),this.viewerText.position.set(8,0),this.giftText=zt.display.createText({textString:"贡献热度",textStyle:Ve.dataStyle}),this.giftText.position.set(We.device.width-We.toolWidth-this.giftText.width-8,0),this.giftText.cacheAsBitmap=!0,this.tipsText=zt.display.createText({textString:"暂无在线观众，",textStyle:Ve.tipsStyle}),this.tipsText.visible=!1,this.tipsText.cacheAsBitmap=!0,this.shareText=zt.display.createText({textString:"邀请朋友观看",textStyle:Ve.linkStyle,isButton:!0}),this.shareText.visible=!1,this.shareText.cacheAsBitmap=!0;var t=(He.GIFT_HEIGHT-We.headerHeight-this.tipsText.height)/2;this.tipsText.position.set(56,t),this.shareText.position.set(56+this.tipsText.width,t),this.shareText.on("pointertap",(()=>{fe.shareToFriend()})),this.rankBackground=zt.display.createGraphics(),this.rankBackground.position.set(0,0),this.rankList=zt.display.createContainer(),this.rankList.position.set(0,26),this.scrollBox.addChild(this.rankBackground,this.viewerText,this.giftText,this.rankList,this.tipsText,this.shareText),this.addChild(this.scrollBox.container),ri(this.shareText,"userShare",(()=>!this.app.animating&&this.visible)),this.renderList()}initMask(){var t=zt.display.createGraphics();t.beginFill(16777215,1),ci(t,0,4-We.headerHeight,We.device.width-We.toolWidth-4,He.GIFT_HEIGHT,{tl:4,tr:4,br:4,bl:4},{fill:16777215,alpha:1}),t.endFill(),this.addChild(t),this.mask=t,this.mask.scale.y=0}renderRankBackground(){this.rankBackground.clear(),this.rankBackground.beginFill(16777215,.1);for(var t=50,e=Math.min(He.MAX_USER_LENGTH,this.viewerData.length),i=0;i<e;i++)this.rankBackground.drawRect(24,t,We.device.width-We.toolWidth-24,1),t+=32;this.rankBackground.endFill()}renderList(){var t=[];if(this.rankList.children.length>0&&(t=this.rankList.removeChildren()),0===this.viewerData.length)this.tipsText.visible=!0,this.shareText.visible=!0,this.viewerText.visible=!1,this.giftText.visible=!1,this.rankBackground.clear();else{this.renderY=0,t.forEach(((t,e)=>{t.visible=!1,e>this.viewerData.length&&t.destroy({children:!0,texture:!0,baseTexture:!0})}));for(var e=Math.min(He.MAX_USER_LENGTH,this.viewerData.length),i=0;i<e;i++){var s=this.viewerData[i];s.rank=i+1,this.renderItem(s,t[i])}this.tipsText.visible=!1,this.shareText.visible=!1,this.viewerText.visible=!0,this.giftText.visible=!0,this.viewerText.text=`在线观众 (${this.viewerData.length}人)`,this.renderRankBackground(),this.renderTips(),this.scrollBox.updateScrollSize({height:this.rankList.y+this.rankList.height+16})}}renderTips(){this.viewerData.length>He.MAX_USER_LENGTH?this.overTips?this.overTips.visible=!0:(this.overTips=zt.display.createText({textString:`只展示前${He.MAX_MESSAGE_LENGTH}位在线观众，完整列表请进视频号查看。`,textStyle:Ve.tipStyle}),this.overTips.position.set((We.device.width-We.toolWidth-this.overTips.width)/2,this.rankList.y+this.rankList.height+16),this.overTips.cacheAsBitmap=!0,this.scrollBox.addChild(this.overTips)):this.overTips&&(this.overTips.visible=!1)}renderItem(t,e=null){var i=`${t.amount||t.rewardAmountInHeat||0}`,s=He.RANK_COLORS[3];t.rank<4&&i&&(s=He.RANK_COLORS[t.rank-1]);var n=e;n?(n.style.groupText=!1,n.text=i,n.visible=!0):n=zt.display.createText({textString:i,textStyle:Ve.contextStyle});var o=Fe(t.nickname),r=zt.display.getTextScale(12);n.style.groupText=[{length:`${t.rank}`.length,color:s,paddingLeft:8/r,absolute:!0},{length:o.length,color:"#ffffff",paddingLeft:24/r,absolute:!0},{length:`${i}`.length,color:"#ffffff",paddingLeft:(We.device.width-We.toolWidth-8-n.width)/r,absolute:!0}],n.text=`${(+i?t.rank:"-")+o+i}`,n.position.set(0,this.renderY),this.rankList.addChild(n),this.renderY+=32}updateViewData(t){this.viewerData=t,this.renderList()}show(){this.animating||(this.animating=!0,this.autoTicker&&(clearTimeout(this.autoTicker),this.autoTicker=null),this.scrollBox.enable(),this.scrollBox.scrollTo(0,0),this.alpha=1,this.visible=!0,this.mask&&zt.tween(this.mask.scale).to({y:1},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.animating=!1})).start(),he.send({UIArea:3604,PositionID:0,ActionID:1}))}hide(t=!1){this.animating||(this.animating=!0,this.scrollBox.disable(),t&&zt.tween(this).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.visible=!1})).start(),this.mask&&zt.tween(this.mask.scale).to({y:0},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.animating=!1,this.visible=!1})).start(),this.autoDestroy())}autoDestroy(){this.autoTicker=setTimeout((()=>{this.rankList.removeChildren().forEach((t=>{t.destroy({children:!0,texture:!0,baseTexture:!0})})),this.autoTicker=null}),5e3)}}var gi=o(426),vi=o.n(gi),mi=o(724),fi=o.n(mi);var{onKeyboardComplete:_i,_onKeyboardHeightChange:yi,showKeyboard:bi,hideKeyboard:Ti,showToast:wi}=Et;function xi(t,e,i=!0){var s=t;i&&(s.on("touchstart",(()=>{s.style.opacity=.5})),s.on("touchend",(()=>{s.style.opacity=1}))),s.on("click",(t=>{(function(t){var e=t.absoluteX,i=t.absoluteY,s=t.absoluteEndX,n=t.absoluteEndY,o=t.pressInterval,r=!1;return Math.abs(n-i)<30&&Math.abs(s-e)<30&&o<300&&(r=!0),r})(t)&&e()}))}function Si(t,e){var{deviceOrientation:i,screenHeight:s,safeArea:n,theme:o}=e,r=t,a=(t=!0)=>{r.body.style.hidden=!0,r.keyboardVisible&&Ti(),t&&he.send({SceneID:52,UIArea:5201,PositionID:2,ActionID:2})};yi((t=>{var{height:e}=t;"portrait"===i?r.container.style.bottom=e?e-24:0:(r.container.style.bottom=e?88:0,r.bottomBar.style.bottom=e?s-24-64-8-80-16-40:s-n.bottom+24),r.keyboardVisible=!!e})),_i((t=>{var{value:e}=t,i=e.trim();e?(r.topicContent.value=i,r.topicContent.style.color="dark"===o?"#ffffffcc":"#000000e6"):(r.topicContent.value=r.topicPlaceholder,r.topicContent.style.color="dark"===o?"#ffffff4d":"#0000004d")})),xi(r.mask,(()=>{r.keyboardVisible&&Ti()}),!1),xi(r.topLeft,a),xi(r.topicContainer,(()=>{var t=r.topicContent.value,e=t&&t!==r.topicPlaceholder?t:"";bi({defaultValue:e,maxLength:60,confirmType:"done"})})),xi(r.bottomBarButton,(()=>{var t=t=>{var e=t!==r.topicPlaceholder?t:"";e?fe.setGameLiveTopic(e,(t=>{var e=t.errMsg.indexOf("ok")>-1;wi(e?{title:"主题已修改",icon:"success",success(){a(!1)}}:{title:"修改失败",icon:"error"}),function(t){he.send({SceneID:52,UIArea:5201,PositionID:1,ActionID:2,ActionStatus:t?1:2})}(e)})):wi({title:"主题不能为空",icon:"error"})};r.keyboardVisible?(Ti(),r.topicContent.nextUpdate().then((()=>{setTimeout((()=>{t(r.topicContent.value)}),100)}))):t(r.topicContent.value)}))}var{webviewLayout:Ci,getPrivateThis:ki,init:Ii,getSystemInfoSync:Mi}=Et;function Li(){var t=ki(this),e=Mi(),{template:i,style:s}=function(t){var{screenWidth:e,screenHeight:i,theme:s,deviceOrientation:n,safeArea:o}=t,r=24,a="portrait"===n?e:414,h={body:{position:"absolute",top:0,left:0,hidden:!0,width:e,height:i,zIndex:180},mask:{position:"absolute",top:0,left:0,backgroundColor:"#000000",opacity:.5,width:e,height:i},container:{position:"absolute",bottom:0,left:0,width:a,height:362,borderRadius:16,backgroundColor:"#FFFFFF"},topBar:{width:a,height:64,paddingTop:20,paddingBottom:20,paddingLeft:16,paddingRight:16,flexDirection:"row",justifyContent:"flex-start"},topLeft:{width:r,height:r,borderRadius:12,backgroundColor:"#0000000d",flexDirection:"row",justifyContent:"center",alignItems:"center"},topLeftClose:{width:16,height:16},topCenter:{fontSize:15,fontWeight:500,lineHeight:r,color:"#000000",textAlign:"center",width:a-80,height:r},topRight:{width:r,height:r},topicContainer:{width:a,height:96,marginTop:8,paddingLeft:24,paddingRight:24},topicBox:{width:a-48,height:96,backgroundColor:"#0000000d",borderRadius:4,padding:12},topicContent:{color:"#0000004d",fontSize:15,width:a-48-24,height:72,lineBreak:"break-word"},bottomBar:{width:a,height:40,position:"absolute",left:0,bottom:i-o.bottom+64,flexDirection:"row",justifyContent:"center"},bottomBarButton:{width:184,height:40,borderRadius:4,backgroundColor:"#FF6146"},bottomBarButtonText:{width:184,height:40,fontSize:17,fontWeight:500,lineHeight:40,color:"#FFFFFF",textAlign:"center"}};return"landscape"===n&&(h.container={...h.container,height:i-24,left:e/2-a/2},h.bottomBar={...h.bottomBar,bottom:i-o.bottom+24}),"dark"===s&&(h.container.backgroundColor="#2C2C2C",h.topicBox.backgroundColor="#ffffff14",h.topLeft.backgroundColor="#ffffff14",h.topCenter.color="#ffffffcc",h.topicContent.color="#ffffff4d"),{template:`\n    <view id="body">\n      <view id="mask" bubble-event="true"></view>\n      <view id="container">\n        \n    <view id="topBar">\n      <view id="topLeft">\n        <image\n          id="topLeftClose"\n          bubble-event="true"\n          src="${"dark"===s?"https://mmgame.qpic.cn/image/27e171d7df75224f2b3bb01329d70a10518824fac004565e3a6c52de5920bb42/0":"https://mmgame.qpic.cn/image/c601982993f0fa2b769023aeee333088f9f3f4217c653425f293dc2ea34389bc/0"}"\n        />\n      </view>\n      <text id="topCenter" value="编辑主题"></text>\n      <view id="topRight"></view>\n    </view>\n  \n        \n    <view id="topicContainer">\n      <view id="topicBox" bubble-event="true">\n        <text id="topicContent" value="填写主题" bubble-event="true"></text>\n      </view>\n    </view>\n  \n        \n    <view id="bottomBar">\n      <view id="bottomBarButton" bubble-event="true">\n        <text id="bottomBarButtonText" bubble-event="true" value="完成"></text>\n      </view>\n    </view>\n  \n      </view>\n    </view>\n  `,style:h}}(e),{root:n}=fi()(i);return Ii.call(this,n,s),Ci.add(t.body),Si(t,e),t.body.ready()}var Di,{Component:Ai,getPrivateThis:Ei,removePrivateThis:Pi,registerComponent:Bi,unregisterComponent:Ri,_offKeyboardHeightChange:Oi,offKeyboardComplete:Fi}=Et;class Hi extends Ai{constructor(){super();var t=Ei(this);t.xom="",t.style="",t.keyboardVisible=!1,t.topicPlaceholder="填写主题",Li.call(this).then((()=>{Bi({component:this,getVisibleAera:()=>t.style.body})}))}destroy(){Ri(this),Pi(this),Oi(),Fi(),Di=null}show(t){var e=Ei(this);t&&(e.topicContent.value=t,e.topicContent.style.color="#000000e6"),e.body.style.hidden=!1,he.send({SceneID:52,UIArea:5201,PositionID:0,ActionID:1})}}const Wi=()=>Di||(Di=new Hi);var{privateOpenUrl:Ni}=Et;class Gi extends PIXI.Container{constructor(t){var e,i;super(),this.app=void 0,this.liveData={headerUrl:"https://mmgame.qpic.cn/image/33e09bb06dc27e8aa876d96d003b3a2f1941346190bc1db68f6735bcdecf65f5/0",nickname:"用户昵称"},this.paddingTop=He.PADDING,this.background=void 0,this.tips=void 0,this.liveIcon=void 0,this.liveName=void 0,this.liveTime=void 0,this.liveTimeIcon=void 0,this.buttonTimeline=void 0,this.buttonShare=void 0,this.buttonFans=void 0,this.buttonPlay=void 0,this.buttonTopic=void 0,this.buttonFeedback=void 0,this.buttonExit=void 0,this.buttonReturn=void 0,this.buttonMic=void 0,this.buttonMicRedTex=void 0,this.buttonMicGrayTex=void 0,this.buttonMusic=void 0,this.buttonMusicOnTex=void 0,this.buttonMusicOffTex=void 0,this.textMusicName=void 0,this.scrollTopBox=void 0,this.scrollBottomBox=void 0,this.liveTimeTicker=null,this.toastNode=void 0,this.showButtonFansClub=!1,this.showButtonPlayTogether=void 0,this.showFeedback=!1,this.showButtonFansClub=!1,this.showFeedback=!(null===(e=Oe())||void 0===e||null===(i=e.miniProgram)||void 0===i||!i.appId),this.app=t,this.init(),this.initMask(),this.visible=!1}init(){this.setData(),this.position.set(We.toolWidth,0),this.initBackground();var t=zt.display.createGraphics();this.initTopArea(t),this.initScrollTopBox(),this.initScrollBottomBox(),this.initBottomArea(),this.addChild(this.background,this.liveName,this.liveTime,this.liveTimeIcon,this.scrollTopBox.container,this.scrollBottomBox.container,this.tips,this.buttonExit,this.buttonReturn,this.liveIcon,t),ri(this.buttonTimeline,"moreTimeline",(()=>!this.app.animating&&this.visible)),ri(this.buttonShare,"moreShare",(()=>!this.app.animating&&this.visible)),ri(this.buttonExit,"moreExit",(()=>!this.app.animating&&this.visible)),ri(this.buttonMic,"moreMic",(()=>!this.app.animating&&this.visible)),ri(this.buttonReturn,"moreReturn",(()=>!this.app.animating&&this.visible))}setData(){ii.account&&(this.liveData.headerUrl===ii.account.headerUrl&&this.liveData.nickname===ii.account.nickname||(this.liveData=ii.account,this.liveIcon&&(this.liveIcon.texture=zt.display.createTextureFrom({url:this.liveData.headerUrl})),this.liveName&&(this.liveName.text=this.liveData.nickname)))}initBackground(){this.background=zt.display.createGraphics(),ci(this.background,0,this.paddingTop,We.device.width-We.toolWidth-4,We.designSize.height-8,{tl:8,tr:8,br:8,bl:8},{fill:2894892,alpha:1}),this.background.beginFill(16777215,.1),this.background.drawRect(0,this.paddingTop+47,We.device.width-We.toolWidth,1),this.background.drawRect(8,this.paddingTop+122,We.device.width-We.toolWidth,1),this.background.endFill()}initMask(){var t=zt.display.createGraphics();t.beginFill(16777215,1),t.drawRect(0,0,We.device.width-We.toolWidth-4,We.device.height),t.endFill(),this.addChild(t),this.mask=t,this.mask.scale.x=0}initTopArea(t){this.liveIcon=zt.display.createSpriteFrom({url:this.liveData.headerUrl}),this.liveIcon.width=32,this.liveIcon.height=32,this.liveIcon.position.set(8,this.paddingTop+8),t.beginFill(16777215,1),t.drawCircle(24,this.paddingTop+24,16),t.endFill(),this.liveIcon.mask=t;var e=Pe(this.liveData.nickname,Ve.titleStyle);this.liveName=zt.display.createText({textString:e,textStyle:Ve.titleStyle}),this.liveName.position.set(48,this.paddingTop+8),this.liveTime=zt.display.createText({textStyle:Ve.timeStyle}),this.liveTime.position.set(58,this.paddingTop+26),this.liveTime.alpha=.5;this.liveTimeIcon=zt.display.createGraphics(),this.liveTimeIcon.beginFill(16777215,.5),this.liveTimeIcon.drawCircle(51,this.paddingTop+30+3,3),this.liveTimeIcon.endFill(),this.liveTimeIcon.cacheAsBitmap=!0,this.buttonExit=zt.display.createSprite({key:"more/exit.png",isButton:!0,width:70,height:32}),this.buttonExit.position.set(We.device.width-We.toolWidth-80,this.paddingTop+8),zt.display.setHitArea(this.buttonExit,{x:-10,y:-10,width:90,height:52}),this.buttonExit.on("pointertap",(()=>{fe.exitGameLive()}))}initBottomArea(){this.tips=zt.display.createSprite({key:"more/tips.png"}),this.tips.width=268,this.tips.height=26,this.tips.position.set(0,216),this.buttonReturn=zt.display.createGraphics(),this.buttonReturn.beginFill(3355443,.3),this.buttonReturn.drawRect(0,0,86,38),zt.display.setHitArea(this.buttonReturn,{x:-10,y:-10,width:106,height:58}),this.buttonReturn.endFill(),this.buttonReturn.alpha=.3,this.buttonReturn.interactive=!0,this.buttonReturn.on("pointerup",(()=>{this.buttonReturn.alpha=.3})),this.buttonReturn.on("pointerdown",(()=>{this.buttonReturn.alpha=1})),this.buttonReturn.on("pointerupoutside",(()=>{this.buttonReturn.alpha=.3})),this.buttonReturn.on("pointertap",(()=>{fe.enterGameLiveRoom()})),this.buttonReturn.x=168,this.buttonReturn.y=216}initScrollTopBox(){var t=We.designSize.width-We.toolWidth-4,e=60,i=58;fe.checkPlayTogether((t=>{t&&(this.showButtonPlayTogether=t,this.renderAndUpdateButtons({buttonMarginTop:8,buttonMarginLeft:0,buttonHeight:i,buttonWidth:e})),(t&&(this.showButtonFansClub||this.showFeedback)||!t&&this.showButtonFansClub&&this.showFeedback)&&this.scrollTopBox.enable(),ii.emit("teamupConfigChange",t)})),this.scrollTopBox=new ui({width:t,height:74,scrollerOptions:{scrollingX:!0,scrollingY:!1}}),this.scrollTopBox.setPosition(0,this.paddingTop+We.headerHeight),this.scrollTopBox.updateScrollSize({height:74,width:this.showButtonFansClub?360:300}),this.scrollTopBox.disable(),this.buttonShare=zt.display.createSprite({key:"more/button_share.png",isButton:!0}),this.buttonShare.width=e,this.buttonShare.height=i,this.buttonShare.position.set(0,8),this.buttonShare.on("pointertap",(()=>{fe.shareToFriend()})),this.buttonTimeline=zt.display.createSprite({key:"more/button_timeline.png",isButton:!0}),this.buttonTimeline.width=e,this.buttonTimeline.height=i,this.buttonTimeline.position.set(60,8),this.buttonTimeline.on("pointertap",(()=>{fe.shareToTimeline()})),this.buttonTopic=zt.display.createSprite({key:"more/button_topic.png",isButton:!0}),this.buttonTopic.width=e,this.buttonTopic.height=i,this.buttonTopic.position.set(120,8),this.buttonTopic.on("pointertap",vi()((function*(){yield ii.getRoomInfo(),Wi().show(ii.liveTopic),he.send({UIArea:3605,PositionID:8,ActionID:2})}))),this.scrollTopBox.addChild(this.buttonShare,this.buttonTimeline,this.buttonTopic),this.showFeedback&&(this.buttonFeedback=zt.display.createSprite({key:"more/button_ifeedback.png",isButton:!0}),this.buttonFeedback.width=e,this.buttonFeedback.height=i,this.buttonFeedback.position.set(0+(this.showButtonFansClub?240:180),8),this.buttonFeedback.on("pointertap",(()=>{var t,e;Ni({url:`https://mp.weixin.qq.com/mp/wapreportwxadevlog?action=get_page&appid=${null===(t=Oe())||void 0===t||null===(e=t.miniProgram)||void 0===e?void 0:e.appId}&selectedReason=8#wechat_redirect`}),he.send({UIArea:3605,PositionID:10,ActionID:2})})),this.scrollTopBox.addChild(this.buttonFeedback)),this.showButtonFansClub&&(this.buttonFans=zt.display.createSprite({key:"more/button_fans.png",isButton:!0}),this.buttonFans.width=e,this.buttonFans.height=i,this.buttonFans.position.set(180,8),this.scrollTopBox.addChild(this.buttonFans),this.buttonFans.on("pointertap",(()=>{fe.openFansClub()})))}initScrollBottomBox(){var t=We.designSize.width-We.toolWidth-4;this.scrollBottomBox=new ui({width:t,height:88,scrollerOptions:{scrollingX:!0,scrollingY:!1}}),this.scrollBottomBox.setPosition(0,this.paddingTop+123),this.scrollBottomBox.updateScrollSize({height:88,width:300}),this.scrollBottomBox.disable(),this.buttonMicRedTex=zt.display.getTexture("more/button_mic-red.png"),this.buttonMicGrayTex=zt.display.getTexture("more/button_mic-gray.png"),this.buttonMic=zt.display.createSprite({key:"more/button_mic-red.png",isButton:!0}),this.buttonMic.width=60,this.buttonMic.height=72,this.buttonMic.position.set(0,8),this.buttonMusicOnTex=zt.display.getTexture("tool/music-on.png"),this.buttonMusicOffTex=zt.display.getTexture("tool/music-off.png"),this.buttonMusic=zt.display.createSprite({key:"tool/music-off.png",isButton:!0}),this.buttonMusic.visible=!1,this.buttonMusic.width=60,this.buttonMusic.height=72,this.buttonMusic.position.set(60,8),this.textMusicName=zt.display.createText({textStyle:Ve.musicNameStyle}),this.textMusicName.position.set(90,67),this.textMusicName.anchor.set(.5,0),this.textMusicName.visible=!1,this.buttonMusic.on("pointertap",(()=>{var t;t=ii.isMusicPlaying,he.send({SceneID:36,UIArea:3605,PositionID:9,ActionID:2,ExternInfo:encodeURIComponent(JSON.stringify({BGMPlay:t?1:0}))}),fe.openMusic()})),fe.getMusicState((t=>{this.buttonMusic.visible=(null==t?void 0:t.enableSettingBGMusic)||!1,this.textMusicName.visible=(null==t?void 0:t.enableSettingBGMusic)||!1,this.musicStateHandler(t)})),ii.on("musicStateChange",this.musicStateHandler.bind(this)),this.buttonMic.on("pointertap",(()=>{this.showToast("麦克风已打开"),fe.getMicState((t=>{var e=!!t.mute;fe.micOp(e,(e=>{e.errMsg.indexOf("ok")>-1&&(!t.mute?(this.buttonMic.texture=this.buttonMicRedTex,this.showToast("麦克风已关闭")):(this.buttonMic.texture=this.buttonMicGrayTex,this.showToast("麦克风已打开")))}))}))})),this.scrollBottomBox.addChild(this.buttonMic,this.buttonMusic,this.textMusicName)}renderAndUpdateButtons(t){var{buttonWidth:e,buttonMarginLeft:i,buttonHeight:s,buttonMarginTop:n}=t;this.buttonPlay=zt.display.createSprite({key:"more/button_play.png"}),this.buttonPlay.width=e,this.buttonPlay.height=s,this.buttonPlay.position.set(i+2*e,n),this.scrollTopBox.addChild(this.buttonPlay),this.changeButtonPlayEvent(!1),this.buttonTopic.position.set(i+3*e,n),this.showButtonFansClub&&this.buttonFans.position.set(i+4*e,n),this.showFeedback&&this.buttonFeedback.position.set(i+(this.showButtonFansClub?5*e:4*e),n),this.visible&&le()}changeButtonPlayEvent(t){t?(zt.display.removeButton(this.buttonPlay),zt.display.isButton(this.buttonPlay),this.buttonPlay.alpha=1,this.buttonPlay.on("pointertap",(()=>{fe.openPlayTogether()}))):(zt.display.removeButton(this.buttonPlay),this.buttonPlay.interactive=!0,this.buttonPlay.alpha=.3,this.buttonPlay.on("pointertap",(()=>{this.showToast("当前游戏状态暂不能发起一起玩",{customX:8,customY:65})})))}getPlayTogetherStatus(){return this.showButtonPlayTogether}refreshTime(){var t=Math.round(Date.now()/1e3)-ii.liveStartTime,e=Math.floor(t/3600),i=Math.floor((t-3600*e)/60),s=t-3600*e-60*i;e<10&&(e=`0${e}`),i<10&&(i=`0${i}`),s<10&&(s=`0${s}`),this.liveTime&&(this.liveTime.text=`${e}:${i}:${s}`)}showToast(t,e){var i,s,n,o=null!==(i=null==e?void 0:e.customX)&&void 0!==i?i:64,r=null!==(s=null==e?void 0:e.customY)&&void 0!==s?s:69,a=zt.display.renderLabel({textString:t,textStyle:Ve.toastStyle,padding:{top:6,bottom:6,left:12,right:12},backgroundColor:{fill:1710618,alpha:1},backgroundRadius:4,getLabelContainer:this.toastNode});this.toastNode||(this.toastNode=a.labelContainer,this.addChild(this.toastNode)),null===(n=this.toastNode)||void 0===n||n.position.set(o,r),li(He.TOAST_ANIMATE_ID,this.toastNode)}show(){he.send({UIArea:3605,PositionID:0,ActionID:1}),he.send({UIArea:3605,PositionID:2,ActionID:1}),he.send({UIArea:3605,PositionID:3,ActionID:1}),he.send({UIArea:3605,PositionID:8,ActionID:1}),he.send({UIArea:3605,PositionID:10,ActionID:1}),this.showButtonFansClub&&he.send({UIArea:3605,PositionID:7,ActionID:1}),this.showButtonPlayTogether&&le(),this.alpha=1,this.visible=!0,this.liveTimeFade(),fe.getMicState((t=>{t.mute?this.buttonMic.texture=this.buttonMicRedTex:this.buttonMic.texture=this.buttonMicGrayTex})),this.mask&&zt.tween(this.mask.scale).to({x:1},500).easing(x.Easing.Quadratic.InOut).start(),this.refreshTime()}hide(t=!1){t&&zt.tween(this).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).start(),this.mask?zt.tween(this.mask.scale).to({x:0},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.close()})).start():this.close()}close(){this.visible=!1,this.removeTicker()}liveTimeFade(){this.removeTicker(),this.liveTimeIcon.alpha=1,this.liveTimeTicker=zt.tween(this.liveTimeIcon).to({alpha:0},500).yoyo(!0).easing(x.Easing.Quadratic.InOut).repeat(1/0).onRepeat((()=>{this.refreshTime()})).start()}musicStateHandler(t){ii.isMusicPlaying?this.buttonMusic.texture=this.buttonMusicOnTex:this.buttonMusic.texture=this.buttonMusicOffTex;var e=ii.isMusicPlaying?"已打开":"未打开";ii.isMusicPlaying&&null!=t&&t.musicName&&(e=t.musicName),this.textMusicName.text=Pe(e,this.textMusicName.style)}removeTicker(){this.liveTimeTicker&&(zt.removeTween(this.liveTimeTicker),this.liveTimeTicker=null)}}var Vi={width:He.MAX_WIDTH,height:He.MAX_HEIGHT},Xi=[{left:0,top:0,width:We.toolWidth,height:Vi.height},{left:0,top:0,width:Vi.width,height:We.headerHeight}],zi=[{left:0,top:0,width:Vi.width,height:Vi.height}],Ui={left:We.toolWidth-4,top:-4,width:We.toolWidth+8,height:We.toolWidth+8},Yi=[Ui],ji=[Ui],$i=()=>{zt.touch.dragArea=Xi,zt.touch.preventArea=zi};class Qi extends PIXI.Container{constructor(t){super(),this.app=void 0,this.newMessageCount=0,this.hasScrollReport=!1,this.scrollBox=void 0,this.enterBox=void 0,this.newMessage=void 0,this.chatBox=void 0,this.systemTipsBox=void 0,this.systemTipsContainer=void 0,this.systemTipsFirstTime=!0,this.systemTipsContentList=[],this.overTips=void 0,this.isFading=!1,this.autoFade=void 0,this.renderY=0,this.nextTicker=0,this.titleTicker=0,this.app=t,this.init()}init(){this.scrollBox=new ui({width:We.designSize.width-We.toolWidth,height:We.designSize.height-We.headerHeight,maskTexture:zt.display.getTexture("mask/rect.png"),scrollerOptions:{scrollingX:!1,scrollingY:!0}}),this.scrollBox.on("scrollEvent",(()=>{this.hasScrollReport||(this.hasScrollReport=!0,he.send({UIArea:3603,PositionID:1,ActionID:21})),this.scrollBox.isBottom&&this.hideNewNessage()})),this.scrollBox.setPosition(We.toolWidth,We.headerHeight),this.renderY=2,this.chatBox=zt.display.createContainer(),this.scrollBox.addChild(this.chatBox),this.enterBox=zt.display.createContainer(),this.enterBox.position.set(We.toolWidth,We.headerHeight+2),this.systemTipsBox=zt.display.createContainer(),this.systemTipsBox.position.set(We.toolWidth+8,We.headerHeight+4),this.addChild(this.scrollBox.container,this.enterBox,this.systemTipsBox),ii.on("systemTipsUpdate",(()=>{this.systemTipsContentList.length&&this.renderSystemTipsMessage(this.systemTipsContentList[0])})),this.updateSystemTips({tipsType:te.Share,closeCallback:()=>{ce(te.Share)},contentConf:{normal:"发送给朋友或分享到朋友圈，一起围观你的精彩，",highlight:"去分享",callback:()=>{this.app.locked?this.app.unlock({unlockTweenCb:()=>{this.app.toggleMoreView()}}):this.app.toggleMoreView()}}}),this.titleTicker=setTimeout((()=>{var t;ii.liveTopic||this.updateSystemTips({tipsType:te.SetTopic,closeCallback:()=>{ce(te.SetTopic)},contentConf:{normal:"写个主题，据说能吸引更多粉丝，",highlight:"去填写",callback:(t=vi()((function*(){var t;yield ii.getRoomInfo(),Wi().show(null!==(t=ii.liveTopic)&&void 0!==t?t:"")})),function(){return t.apply(this,arguments)})}})}),3e3),he.send({UIArea:3603,PositionID:0,ActionID:1})}updateSystemTips(t){this.systemTipsContentList.push(t),1===this.systemTipsContentList.length&&ii.emit("systemTipsUpdate")}removeSystemTips(t){if(!this.isFading){this.isFading=!0;var{callback:e}=t;this.autoFade.stop(),this.autoFade=zt.tween(this.systemTipsContainer).to({alpha:0},300).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.isFading=!1,e&&e(),this.systemTipsContainer.visible=!1,this.systemTipsContainer.alpha=1,this.systemTipsContentList.shift(),Yi.splice(1,Yi.length),ii.locked&&(zt.touch.preventArea=Yi),this.nextTicker=setTimeout((()=>{ii.emit("systemTipsUpdate")}),5e3)})).start()}}updateMessage(t){t&&(t.msgType===Qt.Audience_Join?this.renderEnterMessage(t):this.renderMessage(t))}renderNewMessage(){var t=`${Math.min(this.newMessageCount,He.MAX_MESSAGE_LENGTH)}条新消息`,e=We.toolWidth+8,i=We.device.height-20-8,s={top:6,bottom:6,left:8,right:24},n={fill:16777215,alpha:1};if(this.newMessage){var o=this.newMessage.children[1],r=this.newMessage.children[2];zt.display.renderLabel({textString:t,textStyle:Ve.newMessageStyle,padding:s,backgroundColor:n,backgroundRadius:12,getLabelContainer:this.newMessage}),this.newMessage.position.set(e,i),r.position.x=8+o.width+4}else{var a=zt.display.renderLabel({textString:t,textStyle:Ve.newMessageStyle,padding:s,backgroundColor:n,backgroundRadius:12});this.newMessage=a.labelContainer,this.newMessage.position.set(e,i),zt.display.removeButton(this.newMessage),zt.display.isButton(this.newMessage),this.newMessage.on("pointertap",(()=>{this.scrollBox.scrollToBottom()})),this.addChild(this.newMessage),ri(this.newMessage,"chatNew",(()=>!this.app.animating&&this.visible&&this.newMessage.visible));var h=zt.display.createSprite({key:"icon/arrow-outlined.png"});h.position.set(8+a.labelText.width+4,6),h.width=12,h.height=12,this.newMessage.addChild(h),zt.display.setHitArea(this.newMessage,{x:-this.newMessage.width/2,y:-this.newMessage.height/2,width:2*this.newMessage.width,height:2*this.newMessage.height})}this.newMessage.visible=!0}hideNewNessage(){this.newMessage&&(this.newMessage.visible=!1),this.newMessageCount=0}renderEnterMessage(t){var e=`${Fe(t.senderNickName)} ${t.content}`,i=this.enterBox.children[0],s=zt.display.renderLabel({textString:e,textStyle:Ve.joinStyle,padding:{top:0,bottom:0,left:8,right:8},backgroundColor:{fill:3355443,alpha:1},backgroundRadius:12,getLabelContainer:i});i||(i=s.labelContainer,this.enterBox.addChild(i)),i.position.set(8,0),li(He.ENTER_ANIMATE_ID,i)}renderSystemTipsMessage(t){var e,i,s,n,{closeCallback:o,contentConf:r,containerConf:a={},tipsType:h}=t,{fadeCallBack:l}=a;!function(t){he.send({UIArea:3607,PositionID:0,ActionID:1,ExternInfo:ee[t]})}(h),this.systemTipsContainer=null!==(e=this.systemTipsBox.children[0])&&void 0!==e?e:null,this.systemTipsContainer?(s=this.systemTipsContainer.children[0],n=this.systemTipsContainer.children[1],i=this.systemTipsContainer.children[2]):(this.systemTipsContainer=zt.display.createContainer(),s=zt.display.createGraphics(),(n=zt.display.createText({textStyle:Ve.systemTipsStyle})).position.set(32,4),n.interactive=!0,(i=zt.display.createSprite({key:"more/button_tips-close.png"})).width=16,i.height=16,zt.display.removeButton(i),zt.display.isButton(i),this.systemTipsContainer.addChild(s,n,i),this.systemTipsBox.addChild(this.systemTipsContainer)),i.on("pointertap",(()=>{this.removeSystemTips({callback:o})})),this.systemTipsContainer.visible=!0,this.autoFade=zt.tween({}).delay(1e4).onComplete((()=>{this.removeSystemTips({callback:l})})).start();var c=n.height;this.reduceSystemTipsMsg(r,n,h);var d,u=n.height;if(u!==c||this.systemTipsFirstTime){this.systemTipsFirstTime=!1;var p=u+8,g=We.device.width-We.toolWidth-12;s.clear(),ci(s,0,0,g,p,8,{fill:16761600,alpha:1}),i.position.set(8,(p-i.height)/2),zt.display.setHitArea(i,{x:0,y:0,width:32,height:p}),d={left:this.systemTipsBox.position.x,top:this.systemTipsBox.position.y,width:g,height:p},Yi.push(d),ii.locked&&(zt.touch.preventArea=Yi)}}reduceSystemTipsMsg(t,e,i){var s=e,{normal:n="",highlight:o="",callback:r}=t;zt.display.removeButton(s),zt.display.isButton(s),s.on("pointertap",(()=>{this.removeSystemTips({callback:r}),function(t){he.send({UIArea:3607,PositionID:0,ActionID:2,ExternInfo:ee[t]})}(i)})),s.style.groupText=[{length:n.length},{length:o.length,color:"#ff6146"}],s.text=n+o}renderMessage(t){var e,i,s=!(t.msgType!==Qt.ComboLiveReward),n=!(t.msgType!==Qt.RewardRankingNotice),o=!!t.rankingPosition,r=!(t.msgType!==Qt.First_Notice),a=!(t.msgType!==Qt.Official),h=!(t.msgType!==Qt.Anchor_Notice),l=this.chatBox.children.length>=He.MAX_MESSAGE_LENGTH,c=0;l?([e]=this.chatBox.children,c=e.contentHeight,e.removeChildren(),this.renderTips()):e=zt.display.createContainer(),e.position.set(0,this.renderY);var d=0;(s||n||o||r||a||h)&&(s?i=zt.display.createSprite({key:"label/label_gift.png"}):r||n||a?i=zt.display.createSprite({key:"label/label_notice.png"}):o?i=zt.display.createSprite({key:`label/label_${t.rankingPosition}.png`}):h&&(i=zt.display.createSprite({key:"label/label_theme.png"}),t.content=t.content?t.content:"无主题描述"),i&&(i.width=i.width/3,i.height=i.height/3,i.position.set(8,0),e.addChild(i),e.label=i,d=(i.width+4)/zt.display.getTextScale(12)));var u,p,g,v=Fe(t.senderNickName);if(p=v&&!s?`${v}：`:v&&s?`${v} `:"",(g=l?e.messageNode:zt.display.createText({textStyle:Ve.contextStyle})).style.firstLine=d,g.style.groupText=[{length:p.length,color:"#e0e0e0",paddingLeft:d},{length:(t.content||"").length,color:"#ffffff",firstLine:d}],g.text=p+t.content,g.position.set(8,0),e.addChild(g),s){var m;e.gift?(m=e.gift).texture=zt.display.createTextureFrom({url:t.rewardThumbUrl}):((m=zt.display.createSpriteFrom({url:t.rewardThumbUrl})).width=16,m.height=16),m.position.set(8+g.width,0),e.addChild(m),e.gift=m;var f=`x${t.comboRewardCount||1}`;g.style.groupText.push({length:f.length,color:"#ffffff",paddingLeft:d+18/zt.display.getTextScale(12)}),g.text=p+t.content+f}u=g.height+4,e.messageNode=g,e.contentHeight=u;var{isBottom:_}=this.scrollBox;this.chatBox.addChild(e),l&&(this.chatBox.children.forEach((t=>{t.y-=c})),this.renderY-=c),this.renderY+=u,this.scrollBox.updateScrollSize({height:this.chatBox.height+8}),_||this.app.locked?this.scrollBox.scrollToBottom():(this.newMessageCount+=1,this.renderNewMessage(),this.scrollBox.scrollTo(0,Math.max(this.scrollBox.top-c,0)))}renderTips(){this.overTips||(this.overTips=zt.display.createText({textString:`只展示最新的${He.MAX_MESSAGE_LENGTH}条消息，更多请进视频号查看`,textStyle:Ve.tipStyle}),this.overTips.position.set((We.device.width-We.toolWidth-this.overTips.width)/2,-8-this.overTips.height),this.overTips.cacheAsBitmap=!0,this.scrollBox.addChild(this.overTips))}lock(){this.hideNewNessage(),this.scrollBox.disable();var t={height:We.designSize.height-We.headerHeight};zt.tween(t).to({height:We.lockSize.height-We.headerHeight},500).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.scrollBox.updateContentSize({height:t.height}),this.scrollBox.updateScrollSize({height:this.chatBox.height+8}),this.scrollBox.scrollToBottom()})).start()}unlock(){this.scrollBox.enable();var t={height:We.lockSize.height-We.headerHeight};zt.tween(t).to({height:We.designSize.height-We.headerHeight},500).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.scrollBox.updateContentSize({height:t.height}),this.scrollBox.updateScrollSize({height:this.chatBox.height+8}),this.scrollBox.scrollToBottom()})).start()}disableInteractive(){this.scrollBox.disable()}enableInteractive(){this.scrollBox.enable()}reset(){this.nextTicker&&(clearTimeout(this.nextTicker),this.nextTicker=0),this.titleTicker&&(clearTimeout(this.titleTicker),this.titleTicker=0)}}class qi extends PIXI.Container{constructor(t={}){super(),this.needBg=!1,this.volumnBg=void 0,this.innerMute=!1,this.micMask=void 0,this.volumnGraphics=void 0,this.innerVolumn=void 0,this.bgOpen=void 0,this.bgClose=void 0,this.volumnDefaultY=0,this.muteTicker=null,this.volumnTicker=null,this.init(t)}init(t){var e=32,{width:i=e,needBg:s=!1}=t,n=i/e;this.needBg=s;var o=e*n,r=32*n;this.bgOpen=zt.display.createSprite({key:"mic/open.png"}),this.bgOpen.width=o,this.bgOpen.height=r,this.bgClose=zt.display.createSprite({key:"mic/close.png"}),this.bgClose.width=o,this.bgClose.height=r,this.bgClose.visible=!1,this.micMask=zt.display.createSprite({key:"mic/mask.png"}),this.micMask.width=8*n,this.micMask.height=16*n,this.micMask.position.set(12*n,4*n),this.volumnDefaultY=4*n+this.micMask.height,this.volumnGraphics=zt.display.createSprite(),this.volumnGraphics.position.set(12*n,this.volumnDefaultY),this.volumnGraphics.width=this.micMask.width,this.volumnGraphics.height=this.micMask.height,this.volumnGraphics.mask=this.micMask,this.addChild(this.bgOpen,this.bgClose,this.volumnGraphics,this.micMask),this.volumn=0}calRenderHeight(t){return t<10?0:(Math.sin(Math.PI/100*t-Math.PI/2)/2+.5)*this.micMask.height}get volumn(){return this.innerVolumn}set volumn(t){var e=D(t,0,100);if(e!==this.volumn){this.innerVolumn=e;var i=this.calRenderHeight(e);0!==i?(this.volumnStopAnimate(),this.volumnGraphics.position.y=this.volumnDefaultY-i):this.volumnStartAnimate()}}get mute(){return this.innerMute}set mute(t){t?(this.micMask.visible=!1,this.volumnGraphics.visible=!1,this.bgOpen.visible=!1,this.bgClose.visible=!0,this.muteStartAnimate()):(this.micMask.visible=!0,this.volumnGraphics.visible=!0,this.volumn=0,this.bgOpen.visible=!0,this.bgClose.visible=!1,this.muteStopAnimate()),this.innerMute=t}muteStopAnimate(){this.muteTicker&&(zt.removeTween(this.muteTicker),this.muteTicker=null)}muteStartAnimate(){this.muteStopAnimate(),this.bgClose.alpha=1,this.muteTicker=zt.tween(this.bgClose).to({alpha:0},1e3).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.muteTicker=zt.tween(this.bgClose).to({alpha:1},500).easing(x.Easing.Quadratic.Out).onComplete((()=>{this.muteStartAnimate()})).start()})).start()}volumnStopAnimate(){this.volumnTicker&&(zt.removeTween(this.volumnTicker),this.volumnTicker=null)}volumnStartAnimate(){this.volumnTicker||(this.volumnGraphics.position.y=this.volumnDefaultY,this.volumnTicker=zt.tween(this.volumnGraphics.position).to({y:this.volumnDefaultY-.2*this.micMask.height},400).yoyo(!0).easing(x.Easing.Quadratic.InOut).repeat(1/0).start())}}class Ki extends PIXI.Container{constructor(t){super(),this.app=void 0,this.innerHeight=40,this.dataBackground=void 0,this.dataText=void 0,this.dataArrow=void 0,this.listText=void 0,this.mic=void 0,this.micStateChangeHandler=void 0,this.cacheList=[],this.app=t,this.init()}init(){this.position.set(We.toolWidth,0),this.interactive=!0,this.on("pointertap",(()=>{this.app.toggleGiftView()})),this.dataBackground=zt.display.createGraphics(),ci(this.dataBackground,0,4,We.device.width-We.toolWidth-4,this.innerHeight,{tl:8,tr:8,br:8,bl:8},{fill:2894892,alpha:1}),this.dataText=zt.display.createText({textStyle:Ve.dataStyle}),this.dataText.position.set(8,16),this.listText=zt.display.createText({textStyle:Ve.listStyle}),this.listText.position.set(8,24),this.listText.visible=!1,this.mic=new qi({width:12,needBg:!0}),this.mic.visible=!1,this.dataArrow=zt.display.createSprite({key:"icon/arrow.png"}),this.dataArrow.anchor.set(.5),this.dataArrow.width=16,this.dataArrow.height=8,this.dataArrow.position.set(We.device.width-We.toolWidth-24+8,22),this.addChild(this.dataBackground,this.dataText,this.listText,this.mic,this.dataArrow),ri(this,"infobar",(()=>this.visible&&!this.app.locked&&!this.app.animating)),this.updateData()}updateMicPosition(){this.listText.visible?this.mic.position.set(this.dataText.position.x+this.dataText.width+4,10):this.mic.position.set(this.dataText.position.x+this.dataText.width+4,18)}updateViewData(t=null){if(t&&(this.cacheList=t),this.cacheList.length>0&&!this.dataArrow.rotation){this.dataText.position.set(8,8),this.listText.visible=!0;var e="",i=[];this.cacheList.forEach(((t,s)=>{var n=t.amount||t.rewardAmountInHeat||0,o=He.RANK_COLORS[3];s<4&&n&&(o=He.RANK_COLORS[s]);var r=Fe(t.nickname);e+=`• ${r} `,i.push({length:`${r}`.length+3,color:o})})),this.listText.style.groupText=i,this.listText.text=Pe(e,this.listText.style),this.listText.updateText(!1)}else this.dataText.position.set(8,16),this.listText.visible=!1;this.updateMicPosition()}updateData(){this.dataText&&(this.dataText.text=Pe(ii.roomInfo,this.dataText.style),this.updateMicPosition())}micStateChange(t){zt.tween(this.mic).to({volumn:t.micVolume},200).easing(x.Easing.Quadratic.InOut).start()}show(){this.dataArrow.rotation=Math.PI,this.updateViewData(),zt.tween(this).to({innerHeight:He.GIFT_HEIGHT},500).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.dataBackground.clear(),ci(this.dataBackground,0,4,We.device.width-We.toolWidth-4,this.innerHeight,{tl:8,tr:8,br:8,bl:8},{fill:2894892,alpha:1})})).start()}hide(){this.dataArrow.rotation=0,zt.tween(this).to({innerHeight:40},500).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.dataBackground.clear(),ci(this.dataBackground,0,4,We.device.width-We.toolWidth-4,this.innerHeight,{tl:8,tr:8,br:8,bl:8},{fill:2894892,alpha:1})})).onComplete((()=>{this.updateViewData()})).start()}lock(){zt.tween(this.dataBackground).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).start(),zt.tween(this.dataArrow).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).start(),this.dataText.style.wordWrapWidth-=this.mic.width+4,this.updateData(),this.mic.visible=!0,fe.getMicState((t=>{t.mute?this.mic.mute=!0:this.mic.mute=!1})),this.micStateChangeHandler||(this.micStateChangeHandler=this.micStateChange.bind(this)),ii.on("micStateChange",this.micStateChangeHandler),zt.tween(this.position).delay(500).to({x:2*We.toolWidth},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.dataBackground.visible=!1,this.dataArrow.visible=!1})).start()}unlock(){zt.tween(this.position).to({x:We.toolWidth},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.dataBackground.visible=!0,this.dataArrow.visible=!0,zt.tween(this.dataBackground).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).start(),zt.tween(this.dataArrow).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).start()})).start(),this.dataText.style.wordWrapWidth+=this.mic.width+4,this.updateData(),this.micStateChangeHandler||(this.micStateChangeHandler=this.micStateChange.bind(this)),ii.off("micStateChange",this.micStateChangeHandler),this.mic.visible=!1}}class Ji extends PIXI.Container{constructor(){super(),this.locked=!1,this.animating=!1,this.background=void 0,this.name="Lock",this.color=255,this.lockUp=void 0,this.lockDown=void 0,this.init()}init(){this.background=zt.display.createSprite({key:"tool/lock-background.png"}),this.lockUp=zt.display.createSprite({key:"tool/lock-up.png"}),this.lockDown=zt.display.createSprite({key:"tool/lock-down.png"}),this.background.width=32,this.background.height=32,this.background.alpha=0,this.lockUp.width=6,this.lockUp.height=6,this.lockUp.position.set(8,9),this.lockUp.tint=16777215,this.lockDown.width=10,this.lockDown.height=8,this.lockDown.position.set(11,14),this.lockDown.tint=16777215,this.addChild(this.background,this.lockUp,this.lockDown)}unlock(){this.locked=!1,this.animating=!0,zt.tween(this.background).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).start(),zt.tween(this).to({color:255},250).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.color=Math.round(this.color),this.lockUp.tint=PIXI.utils.rgb2hex([this.color/255,this.color/255,this.color/255]),this.lockDown.tint=PIXI.utils.rgb2hex([this.color/255,this.color/255,this.color/255])})).start(),zt.tween(this.lockUp.position).to({y:9},100).easing(x.Easing.Quadratic.InOut).onComplete((()=>{zt.tween(this.lockUp.position).to({x:8},150).easing(x.Easing.Quadratic.InOut).start()})).start(),zt.tween(this.position).to({x:0},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.animating=!1})).start()}lock(){this.locked=!0,this.animating=!0,zt.tween(this.background).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).start(),zt.tween(this).to({color:128},250).easing(x.Easing.Quadratic.InOut).onUpdate((()=>{zt.updateRender(),this.color=Math.round(this.color),this.lockUp.tint=PIXI.utils.rgb2hex([this.color/255,this.color/255,this.color/255]),this.lockDown.tint=PIXI.utils.rgb2hex([this.color/255,this.color/255,this.color/255])})).start(),zt.tween(this.lockUp.position).to({x:13},150).easing(x.Easing.Quadratic.InOut).onComplete((()=>{zt.tween(this.lockUp.position).to({y:10},100).easing(x.Easing.Quadratic.InOut).start()})).start(),zt.tween(this.position).delay(500).to({x:38},500).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.animating=!1})).start()}}class Zi extends PIXI.Container{constructor(t){super(),this.app=void 0,this.toolLock=void 0,this.toolMore=void 0,this.toolSmall=void 0,this.textureBack=void 0,this.textureMore=void 0,this.app=t,this.init()}init(){this.toolLock=new Ji,zt.display.isButton(this.toolLock),this.toolLock.position.set(0,8);var t=0,e=null;this.toolLock.on("pointertap",(()=>{t+=1,this.app.toggleLock(),t>=2&&this.app.autoShowGiftView(),e&&clearTimeout(e),e=setTimeout((()=>{t=0,e=null}),300)})),this.textureMore=zt.display.getTexture("tool/share.png"),this.textureBack=zt.display.getTexture("tool/back.png"),this.toolMore=zt.display.createSprite({key:"tool/share.png",isButton:!0,width:32,height:32}),this.toolMore.position.set(0,56),this.toolMore.on("pointertap",(()=>{this.app.toggleMoreView()})),this.toolSmall=zt.display.createSprite({key:"tool/small.png",isButton:!0,width:32,height:32}),this.toolSmall.position.set(0,104),this.toolSmall.on("pointertap",(()=>{fe.minimizeGameLive()})),this.addChild(this.toolLock,this.toolMore,this.toolSmall),ri(this.toolLock,"toolLock",(()=>!this.app.animating&&!this.app.locked)),ri({x:this.toolLock.x+38,y:this.toolLock.y,width:this.toolLock.width,height:this.toolLock.height},"toolUnLock",(()=>!this.app.animating&&this.app.locked)),ri(this.toolMore,"toolMore",(()=>!this.app.animating&&!this.app.locked)),ri(this.toolSmall,"toolSmall",(()=>!this.app.animating&&!this.app.locked))}openMore(){this.toolMore.texture=this.textureBack}closeMore(){this.toolMore.texture=this.textureMore}lock(){this.toolLock.lock(),this.toolMore.interactive=!1,zt.tween(this.toolMore).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.toolMore.visible=!1})).start(),this.toolSmall.interactive=!1,zt.tween(this.toolSmall).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.toolSmall.visible=!1})).start()}unlock(){this.toolLock.unlock(),this.toolMore.interactive=!0,zt.tween(this.toolMore).delay(500).onStart((()=>{this.toolMore.visible=!0})).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).start(),this.toolSmall.interactive=!0,zt.tween(this.toolSmall).delay(500).onStart((()=>{this.toolSmall.visible=!0})).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).start()}}class ts{constructor(){this.locked=!1,this.animating=!1,this.lockAnimating=!1,this.view=void 0,this.chatView=void 0,this.giftView=void 0,this.moreView=void 0,this.infobar=void 0,this.toolbar=void 0,this.background=void 0,this.autoLockTicker=null,this.msgListenerFn=void 0,this.roomListenerFn=void 0,this.autoShowGift=!1,this.roomList=[],this.init(),$i(),this.autoLock()}init(){if(this.view=zt.stage,this.background=zt.display.createGraphics(),this.renderBackground(),this.toolbar=new Zi(this),this.infobar=new Ki(this),this.chatView=new Qi(this),this.giftView=new pi(this),this.moreView=new Gi(this),this.view.addChild(this.background,this.chatView,this.infobar,this.giftView,this.toolbar,this.moreView),ii.getRoomInfo(),ii.account){var t={msgType:Qt.First_Notice,content:ii.account.joinLiveTips,comboRewardCount:0,msgCreateTime:0,msgSeq:0,rankingPosition:0,senderHeadImgUrl:"",senderNickName:""};this.updateMessage(t)}if(ii.liveTopic){var e={msgType:Qt.Anchor_Notice,content:ii.liveTopic,comboRewardCount:0,msgCreateTime:0,msgSeq:0,rankingPosition:0,senderHeadImgUrl:"",senderNickName:""};this.updateMessage(e)}var i;this.msgListenerFn=t=>{t.forEach((t=>{this.updateMessage(t)}))},this.roomListenerFn=()=>{var t;null===(t=this.infobar)||void 0===t||t.updateData()},ii.on("msgListChange",this.msgListenerFn),ii.on("roomInfoChange",this.roomListenerFn),ii.on("roomListChange",(()=>{this.getCurrentRoomMemberInfo()})),i=ii.isMusicPlaying,he.send({UIArea:0,PositionID:0,ActionID:1,OpType:1,ExternInfo:encodeURIComponent(JSON.stringify({BGMPlay:i?1:0}))}),this.getCurrentRoomMemberInfo(),zt.updateRender()}getMoreViewIns(){return this.moreView}autoLock(){if(this.view){this.autoLockTicker=setTimeout((()=>{he.send({UIArea:0,PositionID:3,ActionID:3}),this.lock()}),3e3);var t=()=>{this.view&&(this.view.interactive=!1,this.autoLockTicker&&(clearTimeout(this.autoLockTicker),this.autoLockTicker=null),he.send({UIArea:0,PositionID:3,ActionID:7}),this.view.off("pointerdown",t))};this.view.interactive=!0,this.view.on("pointerdown",t)}}renderBackground(){this.background&&(this.background.clear(),this.background.beginFill(0,.9),this.background.drawRoundedRect(0,0,We.device.width,We.device.height,12),this.background.beginFill(16777215,.25),this.background.drawRoundedRect(0,0,We.device.width,We.device.height,12),this.background.endFill())}updateMessage(t){var e;null===(e=this.chatView)||void 0===e||e.updateMessage(t)}autoShowGiftView(){this.autoShowGift=!0}toggleGiftView(){var t;this.locked||(null!==(t=this.giftView)&&void 0!==t&&t.visible?this.closeGiftView():this.openGiftView())}getCurrentRoomMemberInfo(){ii.getCurrentRoomMemberInfo().then((()=>{this.roomList=ii.liveMemberList,this.renderRoomList()}))}renderRoomList(){this.giftView&&this.giftView.updateViewData(this.roomList),this.infobar&&this.infobar.updateViewData(this.roomList)}openGiftView(){var t,e,i;this.animating||(this.animating=!0,null===(t=this.chatView)||void 0===t||t.disableInteractive(),he.send({UIArea:3602,PositionID:3,ActionID:2,OpType:3}),setTimeout((()=>{this.animating=!1,this.chatView&&(this.chatView.visible=!1)}),500),null===(e=this.infobar)||void 0===e||e.show(),null===(i=this.giftView)||void 0===i||i.show(),this.getCurrentRoomMemberInfo())}closeGiftView(){var t,e;this.animating||(this.animating=!0,he.send({UIArea:3602,PositionID:3,ActionID:2,OpType:7}),this.chatView&&(this.chatView.enableInteractive(),this.chatView.visible=!0),setTimeout((()=>{this.animating=!1}),500),null===(t=this.infobar)||void 0===t||t.hide(),null===(e=this.giftView)||void 0===e||e.hide(this.locked))}toggleMoreView(){!this.locked&&this.moreView&&(this.moreView.visible?this.closeMoreView():this.openMoreView())}openMoreView(){var t;!this.animating&&this.view&&this.moreView&&(this.animating=!0,this.view.addChild(this.moreView),null===(t=this.toolbar)||void 0===t||t.openMore(),this.moreView.show(),he.send({UIArea:3602,PositionID:2,ActionID:2,OpType:3}),setTimeout((()=>{this.animating=!1,this.chatView&&(this.chatView.visible=!1),this.infobar&&(this.infobar.visible=!1)}),500))}closeMoreView(){var t,e;this.animating||(this.animating=!0,null===(t=this.toolbar)||void 0===t||t.closeMore(),this.infobar&&(this.infobar.visible=!0),null===(e=this.moreView)||void 0===e||e.hide(this.locked),he.send({UIArea:3602,PositionID:2,ActionID:2,OpType:7}),this.chatView&&this.giftView&&!this.giftView.visible&&(this.chatView.visible=!0),setTimeout((()=>{this.animating=!1}),500))}toggleLock(){this.locked?this.unlock():this.lock()}lock(){var t,e,i,s,n;this.lockAnimating||this.animating||this.locked||(this.lockAnimating=!0,this.locked=!0,ii.setLocked(!0),null!==(t=this.giftView)&&void 0!==t&&t.visible&&(this.animating=!1,this.closeGiftView()),null!==(e=this.moreView)&&void 0!==e&&e.visible&&(this.animating=!1,this.closeMoreView()),null===(i=this.toolbar)||void 0===i||i.lock(),zt.tween(this.background).to({alpha:0},250).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.background&&(this.background.visible=!1)})).start(),null===(s=this.infobar)||void 0===s||s.lock(),null===(n=this.chatView)||void 0===n||n.lock(),he.send({UIArea:3602,PositionID:1,ActionID:2,OpType:7}),setTimeout((()=>{zt.touch.dragArea=ji,zt.touch.preventArea=Yi,this.lockAnimating=!1}),1e3))}unlock(t={}){var e,i,s;if(!this.lockAnimating&&!this.animating&&this.locked){var{unlockTweenCb:n}=t;this.lockAnimating=!0,this.autoShowGift=!1,null===(e=this.toolbar)||void 0===e||e.unlock(),null===(i=this.infobar)||void 0===i||i.unlock(),null===(s=this.chatView)||void 0===s||s.unlock(),setTimeout((()=>{this.background&&(this.background.visible=!0,zt.tween(this.background).to({alpha:1},250).easing(x.Easing.Quadratic.InOut).onComplete((()=>{this.lockAnimating=!1,this.locked=!1,ii.setLocked(!1),n&&n()})).start(),he.send({UIArea:3602,PositionID:1,ActionID:2,OpType:3}),$i(),this.autoShowGift&&(this.autoShowGift=!1,this.openGiftView(),he.send({UIArea:3602,PositionID:1,ActionID:30,OpType:3})))}),500)}}destroy(){var t;this.msgListenerFn=null,this.roomListenerFn=null,null===(t=this.view)||void 0===t||t.destroy({children:!0,texture:!0,baseTexture:!0}),this.chatView&&(this.chatView.reset(),this.chatView=null),this.giftView=null,this.moreView=null,this.infobar=null,this.toolbar=null,this.background=null,this.view=void 0,this.autoLockTicker&&(clearTimeout(this.autoLockTicker),this.autoLockTicker=0),Wi().destroy()}}var es=(()=>"object"==typeof window&&window&&window.__wkrenderer_h5)();var is,ss,{beforeInvokeFail:ns,beforeInvokeCallback:os}=Et,rs="updateGameLivePanelMenu",as=t=>{(t=>{void 0===(null==t?void 0:t.enableInvitationMenu)?ns(rs,t,"parameter enableInvitationMenu can't be undefined"):(ss=t,void 0!==(null==ii?void 0:ii.gameLiveState)&&new Promise(((e,i)=>{var s,n,o=null===(s=is)||void 0===s||null===(n=s.getMoreViewIns())||void 0===n?void 0:n.getPlayTogetherStatus();void 0===o?ii.on("teamupConfigChange",(s=>{s?e(t):i("the minigame has't config invitationMenu function")})):o?e(t):i("the minigame has't config invitationMenu function")})).then((t=>{var e,{enableInvitationMenu:i=!0}=t;null===(e=is.getMoreViewIns())||void 0===e||e.changeButtonPlayEvent(i),os({name:rs,args:t})})).catch((e=>{ns(rs,t,e)})))})(t)};Z(PIXI),ni.onReady((()=>{Ue().then((()=>{var t;ii.on("livePreStart",(()=>{t||(t=new ls(!0)),t.load()})),ii.on("liveReload",(()=>{t||(t=new ls(!0)),t.reload()})),He.debug&&(t||(t=new ls(!0)),t.load(),t.init()),ii.on("liveStart",(()=>{t||(t=new ls(!0)),t.loaded||t.load(),setTimeout((()=>{t||(t=new ls(!0)),t.init()}),0)})),ii.on("liveEnd",(()=>{ai(),t&&(t.destroy(),t=null)}))}))}));var hs="icons";class ls{constructor(t=!1){this.app=null,this.renderer=null,this.loading=!1,this.loaded=!1,this.ready=!1,this.inited=!1,this.startMessage=void 0,this.stopMessage=void 0,this.destroyed=!1,t&&(pe=Date.now(),ue.report({Type:k.Info,Target:"liveConstructor"}))}loadAndSetDegign(){ze(),this.load()}load(){if(!this.loading){this.loading=!0,zt=new At({TWEEN:x,createScreenCanvas:Et.createScreenCanvas,designWidth:414,xlog:new Xt({reportFunc:s,namespace:"live",base:{name:"minigameLive"}}),quality:jt,gameWX:{onShow:Ut,getSystemInfoSync:Yt,onDeviceOrientationChange:$t},debug:!1}),es||this.initScreenCanvas();var t=[{name:hs,url:He.icons}];zt.load({mainTextureName:hs,list:t,timeout:2e4}).then((()=>{if(this.loaded=!0,ue.report({Type:k.Info,CostTime:Date.now()-pe,Target:"liveLoadSuccess"}),this.ready){var t;try{this.init()}catch(t){e=P(t),ue.report({Type:k.Error,CostTime:Date.now()-pe,Target:"liveRenderFail",Result:e})}null==ye||null===(t=ye.info)||void 0===t||t.call(ye,"[直播面板] resource load success")}var e})).catch((t=>{var e;!function(t){ue.report({Type:k.Error,CostTime:Date.now()-pe,Target:"liveLoadFail",Result:t})}(P(t)),null==ye||null===(e=ye.error)||void 0===e||e.call(ye,"[直播面板] resource load fail")}))}}init(){var t,e;(this.ready,this.inited,this.ready=!0,this.loaded)?this.inited||(this.inited=!0,this.initPixiJsCore(),this.app=new ts,e=this.app,is=e,ss&&as(ss),ue.report({Type:k.Info,CostTime:Date.now()-pe,Target:"liveRenderSuccess"}),null==ye||null===(t=ye.info)||void 0===t||t.call(ye,"[直播面板] liveRender init success")):this.load()}reload(){this.destroy(),setTimeout((()=>{this.destroyed=!1,this.load(),this.init()}),1e3)}destroy(t=!1){this.destroyed||(this.destroyed=!0,ue.report({Type:k.Info,CostTime:Date.now()-pe,Target:"liveDestroyStart"}),t&&ai(),this.stopMessage&&this.stopMessage(),this.app&&(this.app.destroy(),this.app=null),zt.destroy(),ii.destroy(),this.loading=!1,this.loaded=!1,this.ready=!1,this.inited=!1,ue.report({Type:k.Info,CostTime:Date.now()-pe,Target:"liveDestroySuccess"}))}initScreenCanvas(){var t;zt.canvas.screenCanvas||(zt.canvas.init(),zt.canvas.screenCanvas,null==ye||null===(t=ye.info)||void 0===t||t.call(ye,"[直播面板] screenCanvas create success"))}initPixiJsCore(){var t;this.initScreenCanvas(),zt.init({defaultTextStyle:Ve.commonStyle,defaultTextureName:hs,defaultTextureKey:"background/white.png"}),zt.touch.canDrag=!0,zt.touch.snapType=U.None,zt.canvas.position.set({x:We.position.x,y:We.position.y}),zt.canvas.resize({width:We.designSize.width,height:We.designSize.height,resetTouchArea:!0}),zt.canvas.zIndex="100",null==ye||null===(t=ye.info)||void 0===t||t.call(ye,"[直播面板] pixi render init success")}}ls.dumpGameLivePanelUI=t=>t&&t.isLibTest?(Object.keys(oi).forEach((t=>{oi[t].clickable=oi[t].check()})),oi):{},ls.innerUpdateMorePanel=as,Object.defineProperty(globalThis,"__minigameLiveSDK__",{get:()=>ls})})(),a.default})()}()}catch(t){console.error("catch sdkSubPackage: minigameLive error: ",t)}