try{(function(){let e="getCloudSDKGlobalVar",t;globalThis[e]?t=globalThis[e]:void 0!==globalThis.WeixinJSBridge&&globalThis.WeixinJSBridge[e]&&(t=globalThis.WeixinJSBridge[e]);var{WeixinJSBridge:r,wxConsole:n,Reporter:i,console:o,__appServiceSDK__:a,__wxConfig:s,Foundation:u,IS_APP:c}=t();(()=>{var e={426:e=>{function t(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=e.apply(r,n);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},668:(e,t,r)=>{"use strict";r.d(t,{V1:()=>q,V3:()=>$e,j:()=>he,m:()=>Q});var n=r(426),i=r.n(n),a=Object.create,s=Object.defineProperty,u=Object.getOwnPropertyDescriptor,c=Object.getOwnPropertyNames,l=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty,f=(e,t)=>()=>(e&&(t=e(e=0)),t),h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),p=(e,t)=>{for(var r in t)s(e,r,{get:t[r],enumerable:!0})},g=(e,t,r,n)=>{if(t&&"object"==typeof t||"function"==typeof t){var i=function(i){!d.call(e,i)&&i!==r&&s(e,i,{get:()=>t[i],enumerable:!(n=u(t,i))||n.enumerable})};for(var o of c(t))i(o)}return e},A=(e,t,r)=>(r=null!=e?a(l(e)):{},g(!t&&e&&e.__esModule?r:s(r,"default",{value:e,enumerable:!0}),e)),m=f((()=>{})),y=h((e=>{m();var t=[0,255,65535,16777215,4294967295];function r(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}function n(e,t,r,n){var i;for(i=0;i<n;i++)e[t+i]=e[t-r+i]}function i(e){this.array=e,this.pos=0}i.prototype.readUncompressedLength=function(){for(var e,t,r=0,n=0;n<32&&this.pos<this.array.length;){if(e=this.array[this.pos],this.pos+=1,(t=127&e)<<n>>>n!==t)return-1;if(r|=t<<n,e<128)return r;n+=7}return-1},i.prototype.uncompressToBuffer=function(e){for(var i,o,a,s,u=this.array,c=u.length,l=this.pos,d=0;l<u.length;)if(i=u[l],l+=1,0==(3&i)){if((o=1+(i>>>2))>60){if(l+3>=c)return!1;a=o-60,o=1+((o=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24))&t[a]),l+=a}if(l+o>c)return!1;r(u,l,e,d,o),l+=o,d+=o}else{switch(3&i){case 1:o=4+(i>>>2&7),s=u[l]+(i>>>5<<8),l+=1;break;case 2:if(l+1>=c)return!1;o=1+(i>>>2),s=u[l]+(u[l+1]<<8),l+=2;break;case 3:if(l+3>=c)return!1;o=1+(i>>>2),s=u[l]+(u[l+1]<<8)+(u[l+2]<<16)+(u[l+3]<<24),l+=4}if(0===s||s>d)return!1;n(e,d,s,o),d+=o}return!0},e.SnappyDecompressor=i})),v=h((e=>{m();var t=new Array(15);function r(e,t){return 506832829*e>>>t}function n(e,t){return e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24)}function i(e,t,r){return e[t]===e[r]&&e[t+1]===e[r+1]&&e[t+2]===e[r+2]&&e[t+3]===e[r+3]}function o(e,t,r,n,i){return r<=60?(n[i]=r-1<<2,i+=1):r<256?(n[i]=240,n[i+1]=r-1,i+=2):(n[i]=244,n[i+1]=r-1&255,n[i+2]=r-1>>>8,i+=3),function(e,t,r,n,i){var o;for(o=0;o<i;o++)r[n+o]=e[t+o]}(e,t,n,i,r),i+r}function a(e,t,r,n){return n<12&&r<2048?(e[t]=1+(n-4<<2)+(r>>>8<<5),e[t+1]=255&r,t+2):(e[t]=2+(n-1<<2),e[t+1]=255&r,e[t+2]=r>>>8,t+3)}function s(e,t,r,n){for(;n>=68;)t=a(e,t,r,64),n-=64;return n>64&&(t=a(e,t,r,60),n-=60),a(e,t,r,n)}function u(e,a,u,c,l){for(var d=1;1<<d<=u&&d<=14;)d+=1;var f=32-(d-=1);typeof t[d]>"u"&&(t[d]=new Uint16Array(1<<d));var h,p=t[d];for(h=0;h<p.length;h++)p[h]=0;var g,A,m,y,v,E,_,I,T,w,S=a+u,C=a,b=a,N=!0;if(u>=15)for(g=S-15,m=r(n(e,a+=1),f);N;){E=32,y=a;do{if(A=m,_=E>>>5,E+=1,y=(a=y)+_,a>g){N=!1;break}m=r(n(e,y),f),v=C+p[A],p[A]=a-C}while(!i(e,a,v));if(!N)break;l=o(e,b,a-b,c,l);do{for(I=a,T=4;a+T<S&&e[a+T]===e[v+T];)T+=1;if(a+=T,l=s(c,l,I-v,T),b=a,a>=g){N=!1;break}p[r(n(e,a-1),f)]=a-1-C,v=C+p[w=r(n(e,a),f)],p[w]=a-C}while(i(e,a,v));if(!N)break;m=r(n(e,a+=1),f)}return b<S&&(l=o(e,b,S-b,c,l)),l}function c(e){this.array=e}c.prototype.maxCompressedLength=function(){var e=this.array.length;return 32+e+Math.floor(e/6)},c.prototype.compressToBuffer=function(e){var t,r=this.array,n=r.length,i=0,o=0;for(o=function(e,t,r){do{t[r]=127&e,(e>>>=7)>0&&(t[r]+=128),r+=1}while(e>0);return r}(n,e,o);i<n;)o=u(r,i,t=Math.min(n-i,65536),e,o),i+=t;return o},e.SnappyCompressor=c})),E=h((e=>{function t(){return"object"==typeof process&&"object"==typeof process.versions&&typeof process.versions.node<"u"}function r(e){return e instanceof Uint8Array&&(!t()||!Buffer.isBuffer(e))}function n(e){return e instanceof ArrayBuffer}function i(e){return!!t()&&Buffer.isBuffer(e)}m();var o=y().SnappyDecompressor,a=v().SnappyCompressor,s="Argument compressed must be type of ArrayBuffer, Buffer, or Uint8Array";e.uncompress=function(e,t){if(!r(e)&&!n(e)&&!i(e))throw new TypeError(s);var a=!1,u=!1;r(e)?a=!0:n(e)&&(u=!0,e=new Uint8Array(e));var c,l,d=new o(e),f=d.readUncompressedLength();if(-1===f)throw new Error("Invalid Snappy bitstream");if(f>t)throw new Error(`The uncompressed length of ${f} is too big, expect at most ${t}`);if(a){if(c=new Uint8Array(f),!d.uncompressToBuffer(c))throw new Error("Invalid Snappy bitstream")}else if(u){if(c=new ArrayBuffer(f),l=new Uint8Array(c),!d.uncompressToBuffer(l))throw new Error("Invalid Snappy bitstream")}else if(c=Buffer.alloc(f),!d.uncompressToBuffer(c))throw new Error("Invalid Snappy bitstream");return c},e.compress=function(e){if(!r(e)&&!n(e)&&!i(e))throw new TypeError(s);var t=!1,o=!1;r(e)?t=!0:n(e)&&(o=!0,e=new Uint8Array(e));var u,c,l,d=new a(e),f=d.maxCompressedLength();if(t?(u=new Uint8Array(f),l=d.compressToBuffer(u)):o?(u=new ArrayBuffer(f),c=new Uint8Array(u),l=d.compressToBuffer(c)):(u=Buffer.alloc(f),l=d.compressToBuffer(u)),!u.slice){var h=new Uint8Array(Array.prototype.slice.call(u,0,l));if(t)return h;if(o)return h.buffer;throw new Error("Not implemented")}return u.slice(0,l)}})),_=h(((e,t)=>{m(),t.exports=function(e,t){for(var r=new Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,a){r[n]=function(e){if(o)if(o=!1,e)a(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,a(e))}}))}})),I=h((e=>{m();var t=e;t.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};var r,n=new Array(64),i=new Array(123);for(r=0;r<64;)i[n[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;t.encode=function(e,t,r){for(var i,o=null,a=[],s=0,u=0;t<r;){var c=e[t++];switch(u){case 0:a[s++]=n[c>>2],i=(3&c)<<4,u=1;break;case 1:a[s++]=n[i|c>>4],i=(15&c)<<2,u=2;break;case 2:a[s++]=n[i|c>>6],a[s++]=n[63&c],u=0}s>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,a)),s=0)}return u&&(a[s++]=n[i],a[s++]=61,1===u&&(a[s++]=61)),o?(s&&o.push(String.fromCharCode.apply(String,a.slice(0,s))),o.join("")):String.fromCharCode.apply(String,a.slice(0,s))};var o="invalid encoding";t.decode=function(e,t,r){for(var n,a=r,s=0,u=0;u<e.length;){var c=e.charCodeAt(u++);if(61===c&&s>1)break;if(void 0===(c=i[c]))throw Error(o);switch(s){case 0:n=c,s=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,s=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,s=3;break;case 3:t[r++]=(3&n)<<6|c,s=0}}if(1===s)throw Error(o);return r-a},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}})),T=h(((e,t)=>{function r(){this._listeners={}}m(),t.exports=r,r.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}})),w=h(((e,t)=>{function r(e){return typeof Float32Array<"u"?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function s(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?a:s,e.readFloatBE=n?s:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,a=8388607&n;return 255===o?a?NaN:i*(1/0):0===o?1401298464324817e-60*i*a:i*Math.pow(2,o-150)*(a+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,i),e.readFloatLE=r.bind(null,o),e.readFloatBE=r.bind(null,a)}(),typeof Float64Array<"u"?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function s(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?a:s,e.readDoubleBE=n?s:a}():function(){function t(e,t,r,n,i,o){var a=n<0?1:0;if(a&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((a<<31|2146435072)>>>0,i,o+r);else{var s;if(n<22250738585072014e-324)e((s=n/5e-324)>>>0,i,o+t),e((a<<31|s/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=n*Math.pow(2,-u))>>>0,i,o+t),e((a<<31|u+1023<<20|1048576*s&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),a=e(n,i+r),s=2*(a>>31)+1,u=a>>>20&2047,c=4294967296*(1048575&a)+o;return 2047===u?c?NaN:s*(1/0):0===u?5e-324*s*c:s*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,i,4,0),e.readDoubleLE=r.bind(null,o,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function n(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function i(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}m(),t.exports=r(r)})),S=h(((e,t)=>{function r(e){try{var t=eval("quire".replace(/^/,"re"))(e);if(t&&(t.length||Object.keys(t).length))return t}catch(e){}return null}m(),t.exports=r})),C=h((e=>{m();var t=e;t.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},t.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],a=0;t<r;)(n=e[t++])<128?o[a++]=n:n>191&&n<224?o[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(n>>10),o[a++]=56320+(1023&n)):o[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},t.write=function(e,t,r){for(var n,i,o=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}})),b=h(((e,t)=>{m(),t.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(o=e(n),a=0);var s=t.call(o,a,a+=r);return 7&a&&(a=1+(7|a)),s}}})),N=h(((e,t)=>{m(),t.exports=n;var r=O();function n(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=n.zero=new n(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=n.zeroHash="\0\0\0\0\0\0\0\0";n.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var r=e>>>0,o=(e-r)/4294967296>>>0;return t&&(o=~o>>>0,r=~r>>>0,++r>4294967295&&(r=0,++o>4294967295&&(o=0))),new n(r,o)},n.from=function(e){if("number"==typeof e)return n.fromNumber(e);if(r.isString(e)){if(!r.Long)return n.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new n(e.low>>>0,e.high>>>0):i},n.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},n.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;n.fromHash=function(e){return e===o?i:new n((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},n.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},n.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},n.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},n.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}})),O=h((e=>{m();var t=e;function n(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)(void 0===e[n[i]]||!r)&&(e[n[i]]=t[n[i]]);return e}function i(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&n(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:()=>e,set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}t.asPromise=_(),t.base64=I(),t.EventEmitter=T(),t.float=w(),t.inquire=S(),t.utf8=C(),t.pool=b(),t.LongBits=N(),t.isNode=Boolean(typeof r.g<"u"&&r.g&&r.g.process&&r.g.process.versions&&r.g.process.versions.node),t.global=t.isNode&&r.g||typeof window<"u"&&window||typeof self<"u"&&self||e,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"==typeof e},t.isset=t.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch{return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)},t.Array=typeof Uint8Array<"u"?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,r){var n=t.LongBits.fromHash(e);return t.Long?t.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=i,t.ProtocolError=i("ProtocolError"),t.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},t.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),R=h(((e,t)=>{m(),t.exports=l;var r,n=O(),i=n.LongBits,o=n.base64,a=n.utf8;function s(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function l(){this.len=0,this.head=new s(u,0,0),this.tail=this.head,this.states=null}var d=function(){return n.Buffer?function(){return(l.create=function(){return new r})()}:function(){return new l}};function f(e,t,r){t[r]=255&e}function h(e,t){this.len=e,this.next=void 0,this.val=t}function p(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function g(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}l.create=d(),l.alloc=function(e){return new n.Array(e)},n.Array!==Array&&(l.alloc=n.pool(l.alloc,n.Array.prototype.subarray)),l.prototype._push=function(e,t,r){return this.tail=this.tail.next=new s(e,t,r),this.len+=t,this},h.prototype=Object.create(s.prototype),h.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new h((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(p,10,i.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=i.from(e);return this._push(p,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(p,t.length(),t)},l.prototype.bool=function(e){return this._push(f,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=i.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(n.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(n.float.writeDoubleLE,8,e)};var A=n.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(f,1,0);if(n.isString(e)){var r=l.alloc(t=o.length(e));o.decode(e,r,0),e=r}return this.uint32(t)._push(A,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(f,1,0)},l.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new s(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new s(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},l._configure=function(e){r=e,l.create=d(),r._configure()}})),B=h(((e,t)=>{m(),t.exports=i;var r=R();(i.prototype=Object.create(r.prototype)).constructor=i;var n=O();function i(){r.call(this)}function o(e,t,r){e.length<40?n.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}i._configure=function(){i.alloc=n._Buffer_allocUnsafe,i.writeBytesBuffer=n.Buffer&&n.Buffer.prototype instanceof Uint8Array&&"set"===n.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},i.prototype.bytes=function(e){n.isString(e)&&(e=n._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=n.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()})),D=h(((e,t)=>{m(),t.exports=s;var r,n=O(),i=n.LongBits,o=n.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function s(e){this.buf=e,this.pos=0,this.len=e.length}var u,c=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new s(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new s(e);throw Error("illegal buffer")},l=function(){return n.Buffer?function(e){return(s.create=function(e){return n.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c};function d(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function h(){if(this.pos+8>this.len)throw a(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}s.create=l(),s.prototype._slice=n.Array.prototype.subarray||n.Array.prototype.slice,s.prototype.uint32=(u=4294967295,function(){if(u=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(u=(u|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(u=(u|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(u=(u|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return u;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return u}),s.prototype.int32=function(){return 0|this.uint32()},s.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},s.prototype.bool=function(){return 0!==this.uint32()},s.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return f(this.buf,this.pos+=4)},s.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|f(this.buf,this.pos+=4)},s.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=n.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},s.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=n.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},s.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},s.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},s.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},s.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},s._configure=function(e){r=e,s.create=l(),r._configure();var t=n.Long?"toLong":"toNumber";n.merge(s.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return h.call(this)[t](!0)},sfixed64:function(){return h.call(this)[t](!1)}})}})),L=h(((e,t)=>{m(),t.exports=i;var r=D();(i.prototype=Object.create(r.prototype)).constructor=i;var n=O();function i(e){r.call(this,e)}i._configure=function(){n.Buffer&&(i.prototype._slice=n.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()})),P=h(((e,t)=>{m(),t.exports=n;var r=O();function n(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(n.prototype=Object.create(r.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function e(t,n,i,o,a){if(!o)throw TypeError("request must be specified");var s=this;if(!a)return r.asPromise(e,s,t,n,i,o);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return s.emit("error",e,t),a(e);if(null!==r){if(!(r instanceof i))try{r=i[s.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return s.emit("error",e,t),a(e)}return s.emit("data",r,t),a(null,r)}s.end(!0)}))}catch(e){return s.emit("error",e,t),void setTimeout((function(){a(e)}),0)}else setTimeout((function(){a(Error("already ended"))}),0)},n.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}})),M=h((e=>{m(),e.Service=P()})),x=h(((e,t)=>{m(),t.exports={}})),U=h((e=>{m();var t=e;function r(){t.util._configure(),t.Writer._configure(t.BufferWriter),t.Reader._configure(t.BufferReader)}t.build="minimal",t.Writer=R(),t.BufferWriter=B(),t.Reader=D(),t.BufferReader=L(),t.util=O(),t.rpc=M(),t.roots=x(),t.configure=r,r()})),k=h(((e,t)=>{m(),t.exports=U()}));m();var q={};p(q,{decode:()=>He,decodeRequest:()=>Ge,decodeResponse:()=>We,decodeStdPrivResponse:()=>je,encode:()=>xe,encodeRequest:()=>Ue,encodeResponse:()=>ke,encodeStdPrivRequest:()=>qe}),m(),m(),m();var Q=(F=Q||{},F.pb="PB",F.json="JSON",F),F;function H(e){return"number"==typeof e}function G(e){return e instanceof Uint8Array}function W(e,t,r){var n=t?t.byteLength:r||65536;if(4095&n||n<=0)throw new Error("heap size must be a positive integer and a multiple of 4096");return t=t||new e(new ArrayBuffer(n))}function j(e,t,r,n,i){var o=e.length-t,a=o<i?o:i;return e.set(r.subarray(n,n+a),t),a}m(),m();var $=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"IllegalArgumentError"}}),e})(),Y=(()=>{function e(){var e=Error.apply(this,arguments);this.message=e.message,this.stack=e.stack}return e.prototype=Object.create(Error.prototype,{name:{value:"SecurityError"}}),e})(),J=(()=>{var e,t,r,n,i,o,a=!1;function s(r,n){var i=e[(t[r]+t[n])%255];return(0===r||0===n)&&(i=0),i}function u(){function u(r){var n,i,o;for(i=o=function(r){var n=e[255-t[r]];return 0===r&&(n=0),n}(r),n=0;n<4;n++)o^=i=255&(i<<1|i>>>7);return o^=99}a||function(){e=[],t=[];var r,n,i=1;for(r=0;r<255;r++)e[r]=i,n=128&i,i<<=1,i&=255,128===n&&(i^=27),i^=e[r],t[e[r]]=r;e[255]=e[0],t[0]=0,a=!0}(),r=[],n=[],i=[[],[],[],[]],o=[[],[],[],[]];for(var c=0;c<256;c++){var l=u(c);r[c]=l,n[l]=c,i[0][c]=s(2,l)<<24|l<<16|l<<8|s(3,l),o[0][l]=s(14,c)<<24|s(9,c)<<16|s(13,c)<<8|s(11,c);for(var d=1;d<4;d++)i[d][c]=i[d-1][c]>>>8|i[d-1][c]<<24,o[d][l]=o[d-1][l]>>>8|o[d-1][l]<<24}}var c=function(e,t){u();var a=new Uint32Array(t);a.set(r,512),a.set(n,768);for(var s=0;s<4;s++)a.set(i[s],4096+1024*s>>2),a.set(o[s],8192+1024*s>>2);var c=function(e,t,r){var n=0,i=0,o=0,a=0,s=0,u=0,c=0,l=0,d=0,f=0,h=0,p=0,g=0,A=0,m=0,y=0,v=0,E=new e.Uint32Array(r),_=new e.Uint8Array(r);function I(e,t,r,s,u,c,l,d){t|=0,s|=0,u|=0,c|=0,l|=0,d|=0;var f,h,p,g=0,A=0,m=0,y=0,v=0;for(f=1024|(r|=0),h=2048|r,p=3072|r,u^=E[(0|(e|=0))>>2],c^=E[(4|e)>>2],l^=E[(8|e)>>2],d^=E[(12|e)>>2],v=16;(0|v)<=s<<4;v=v+16|0)g=E[(r|u>>22&1020)>>2]^E[(f|c>>14&1020)>>2]^E[(h|l>>6&1020)>>2]^E[(p|d<<2&1020)>>2]^E[(e|v|0)>>2],A=E[(r|c>>22&1020)>>2]^E[(f|l>>14&1020)>>2]^E[(h|d>>6&1020)>>2]^E[(p|u<<2&1020)>>2]^E[(e|v|4)>>2],m=E[(r|l>>22&1020)>>2]^E[(f|d>>14&1020)>>2]^E[(h|u>>6&1020)>>2]^E[(p|c<<2&1020)>>2]^E[(e|v|8)>>2],y=E[(r|d>>22&1020)>>2]^E[(f|u>>14&1020)>>2]^E[(h|c>>6&1020)>>2]^E[(p|l<<2&1020)>>2]^E[(e|v|12)>>2],u=g,c=A,l=m,d=y;n=E[(t|u>>22&1020)>>2]<<24^E[(t|c>>14&1020)>>2]<<16^E[(t|l>>6&1020)>>2]<<8^E[(t|d<<2&1020)>>2]^E[(e|v|0)>>2],i=E[(t|c>>22&1020)>>2]<<24^E[(t|l>>14&1020)>>2]<<16^E[(t|d>>6&1020)>>2]<<8^E[(t|u<<2&1020)>>2]^E[(e|v|4)>>2],o=E[(t|l>>22&1020)>>2]<<24^E[(t|d>>14&1020)>>2]<<16^E[(t|u>>6&1020)>>2]<<8^E[(t|c<<2&1020)>>2]^E[(e|v|8)>>2],a=E[(t|d>>22&1020)>>2]<<24^E[(t|u>>14&1020)>>2]<<16^E[(t|c>>6&1020)>>2]<<8^E[(t|l<<2&1020)>>2]^E[(e|v|12)>>2]}function T(e,t,r,d){I(0,2048,4096,v,s^(e|=0),u^(t|=0),c^(r|=0),l^(d|=0)),s=n,u=i,c=o,l=a}var w=[,,T,function(e,t,r,d){var f;I(1024,3072,8192,v,e|=0,d|=0,r|=0,t|=0),f=i,i=a,a=f,n^=s,i^=u,o^=c,a^=l,s=e,u=t,c=r,l=d},,,,],S=[T];return{set_rounds:function(e){v=e|=0},set_state:function(e,t,r,s){n=e|=0,i=t|=0,o=r|=0,a=s|=0},set_iv:function(e,t,r,n){s=e|=0,u=t|=0,c=r|=0,l=n|=0},set_nonce:function(e,t,r,n){d=e|=0,f=t|=0,h=r|=0,p=n|=0},set_mask:function(e,t,r,n){g=e|=0,A=t|=0,m=r|=0,y=n|=0},set_counter:function(e,t,r,n){p=~y&p|y&(n|=0),h=~m&h|m&(r|=0),f=~A&f|A&(t|=0),d=~g&d|g&(e|=0)},get_state:function(e){return 15&(e|=0)?-1:(_[0|e]=n>>>24,_[1|e]=n>>>16&255,_[2|e]=n>>>8&255,_[3|e]=255&n,_[4|e]=i>>>24,_[5|e]=i>>>16&255,_[6|e]=i>>>8&255,_[7|e]=255&i,_[8|e]=o>>>24,_[9|e]=o>>>16&255,_[10|e]=o>>>8&255,_[11|e]=255&o,_[12|e]=a>>>24,_[13|e]=a>>>16&255,_[14|e]=a>>>8&255,_[15|e]=255&a,16)},get_iv:function(e){return 15&(e|=0)?-1:(_[0|e]=s>>>24,_[1|e]=s>>>16&255,_[2|e]=s>>>8&255,_[3|e]=255&s,_[4|e]=u>>>24,_[5|e]=u>>>16&255,_[6|e]=u>>>8&255,_[7|e]=255&u,_[8|e]=c>>>24,_[9|e]=c>>>16&255,_[10|e]=c>>>8&255,_[11|e]=255&c,_[12|e]=l>>>24,_[13|e]=l>>>16&255,_[14|e]=l>>>8&255,_[15|e]=255&l,16)},cipher:function(e,t,r){e|=0,r|=0;var s=0;if(15&(t|=0))return-1;for(;(0|r)>=16;)w[7&e](_[0|t]<<24|_[1|t]<<16|_[2|t]<<8|_[3|t],_[4|t]<<24|_[5|t]<<16|_[6|t]<<8|_[7|t],_[8|t]<<24|_[9|t]<<16|_[10|t]<<8|_[11|t],_[12|t]<<24|_[13|t]<<16|_[14|t]<<8|_[15|t]),_[0|t]=n>>>24,_[1|t]=n>>>16&255,_[2|t]=n>>>8&255,_[3|t]=255&n,_[4|t]=i>>>24,_[5|t]=i>>>16&255,_[6|t]=i>>>8&255,_[7|t]=255&i,_[8|t]=o>>>24,_[9|t]=o>>>16&255,_[10|t]=o>>>8&255,_[11|t]=255&o,_[12|t]=a>>>24,_[13|t]=a>>>16&255,_[14|t]=a>>>8&255,_[15|t]=255&a,s=s+16|0,t=t+16|0,r=r-16|0;return 0|s},mac:function(e,t,r){e|=0,r|=0;var n=0;if(15&(t|=0))return-1;for(;(0|r)>=16;)S[1&e](_[0|t]<<24|_[1|t]<<16|_[2|t]<<8|_[3|t],_[4|t]<<24|_[5|t]<<16|_[6|t]<<8|_[7|t],_[8|t]<<24|_[9|t]<<16|_[10|t]<<8|_[11|t],_[12|t]<<24|_[13|t]<<16|_[14|t]<<8|_[15|t]),n=n+16|0,t=t+16|0,r=r-16|0;return 0|n}}}({Uint8Array:Uint8Array,Uint32Array:Uint32Array},0,t);return c.set_key=function(e,t,n,i,s,u,l,d,f){var h=a.subarray(0,60),p=a.subarray(256,316);h.set([t,n,i,s,u,l,d,f]);for(var g=e,A=1;g<4*e+28;g++){var m=h[g-1];(g%e==0||8===e&&g%e==4)&&(m=r[m>>>24]<<24^r[m>>>16&255]<<16^r[m>>>8&255]<<8^r[255&m]),g%e==0&&(m=m<<8^m>>>24^A<<24,A=A<<1^(128&A?27:0)),h[g]=h[g-e]^m}for(var y=0;y<g;y+=4)for(var v=0;v<4;v++){m=h[g-(4+y)+(4-v)%4];p[y+v]=y<4||y>=g-4?m:o[0][r[m>>>24]]^o[1][r[m>>>16&255]]^o[2][r[m>>>8&255]]^o[3][r[255&m]]}c.set_rounds(e+5)},c};return c.ENC={CBC:2},c.DEC={CBC:3},c.MAC={CBC:0},c.HEAP_DATA=16384,c})(),K=new Uint8Array(1048576),z=J(null,K.buffer),X=class{constructor(e,t,r,n,i){this.nonce=null,this.counter=0,this.counterSize=0,this.heap=W(Uint8Array,n).subarray(J.HEAP_DATA),this.asm=i||J(null,this.heap.buffer),this.mode=null,this.key=null,this.AES_reset(e,t,r)}AES_set_key(e){if(void 0!==e){if(!G(e))throw new TypeError("unexpected key type");var t=e.length;if(16!==t&&24!==t&&32!==t)throw new $("illegal key size");var r=new DataView(e.buffer,e.byteOffset,e.byteLength);this.asm.set_key(t>>2,r.getUint32(0),r.getUint32(4),r.getUint32(8),r.getUint32(12),t>16?r.getUint32(16):0,t>16?r.getUint32(20):0,t>24?r.getUint32(24):0,t>24?r.getUint32(28):0),this.key=e}else if(!this.key)throw new Error("key is required")}AES_CTR_set_options(e,t,r){if(void 0!==r){if(r<8||r>48)throw new $("illegal counter size");this.counterSize=r;var n=Math.pow(2,r)-1;this.asm.set_mask(0,0,n/4294967296|0,0|n)}else this.counterSize=r=48,this.asm.set_mask(0,0,65535,4294967295);if(void 0===e)throw new Error("nonce is required");if(!G(e))throw new TypeError("unexpected nonce type");var i=e.length;if(!i||i>16)throw new $("illegal nonce size");this.nonce=e;var o=new DataView(new ArrayBuffer(16));if(new Uint8Array(o.buffer).set(e),this.asm.set_nonce(o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)),void 0!==t){if(!H(t))throw new TypeError("unexpected counter type");if(t<0||t>=Math.pow(2,r))throw new $("illegal counter value");this.counter=t,this.asm.set_counter(0,0,t/4294967296|0,0|t)}else this.counter=0}AES_set_iv(e){if(void 0!==e){if(!G(e))throw new TypeError("unexpected iv type");if(16!==e.length)throw new $("illegal iv size");var t=new DataView(e.buffer,e.byteOffset,e.byteLength);this.iv=e,this.asm.set_iv(t.getUint32(0),t.getUint32(4),t.getUint32(8),t.getUint32(12))}else this.iv=null,this.asm.set_iv(0,0,0,0)}AES_set_padding(e){this.padding=void 0===e||!!e}AES_reset(e,t,r){return this.result=null,this.pos=0,this.len=0,this.AES_set_key(e),this.AES_set_iv(t),this.AES_set_padding(r),this}AES_Encrypt_process(e){if(!G(e))throw new TypeError("data isn't of expected type");for(var t=this.asm,r=this.heap,n=J.ENC[this.mode],i=J.HEAP_DATA,o=this.pos,a=this.len,s=0,u=e.length||0,c=0,l=0,d=new Uint8Array(a+u&-16);u>0;)a+=l=j(r,o+a,e,s,u),s+=l,u-=l,(l=t.cipher(n,i+o,a))&&d.set(r.subarray(o,o+l),c),c+=l,l<a?(o+=l,a-=l):(o=0,a=0);return this.result=d,this.pos=o,this.len=a,this}AES_Encrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Encrypt_process(e).result).length);var n=this.asm,i=this.heap,o=J.ENC[this.mode],a=J.HEAP_DATA,s=this.pos,u=this.len,c=16-u%16,l=u;if(this.hasOwnProperty("padding")){if(this.padding){for(var d=0;d<c;++d)i[s+u+d]=c;l=u+=c}else if(u%16)throw new $("data length must be a multiple of the block size")}else u+=c;var f=new Uint8Array(r+l);return r&&f.set(t),u&&n.cipher(o,a+s,u),l&&f.set(i.subarray(s,s+l),r),this.result=f,this.pos=0,this.len=0,this}AES_Decrypt_process(e){if(!G(e))throw new TypeError("data isn't of expected type");var t=this.asm,r=this.heap,n=J.DEC[this.mode],i=J.HEAP_DATA,o=this.pos,a=this.len,s=0,u=e.length||0,c=0,l=a+u&-16,d=0,f=0;this.padding&&(l-=d=a+u-l||16);for(var h=new Uint8Array(l);u>0;)a+=f=j(r,o+a,e,s,u),s+=f,u-=f,(f=t.cipher(n,i+o,a-(u?0:d)))&&h.set(r.subarray(o,o+f),c),c+=f,f<a?(o+=f,a-=f):(o=0,a=0);return this.result=h,this.pos=o,this.len=a,this}AES_Decrypt_finish(e){var t=null,r=0;void 0!==e&&(r=(t=this.AES_Decrypt_process(e).result).length);var n=this.asm,i=this.heap,o=J.DEC[this.mode],a=J.HEAP_DATA,s=this.pos,u=this.len,c=u;if(u>0){if(u%16){if(this.hasOwnProperty("padding"))throw new $("data length must be a multiple of the block size");u+=16-u%16}if(n.cipher(o,a+s,u),this.hasOwnProperty("padding")&&this.padding){var l=i[s+c-1];if(l<1||l>16||l>c)throw new Y("bad padding");for(var d=0,f=l;f>1;f--)d|=l^i[s+c-f];if(d)throw new Y("bad padding");c-=l}}var h=new Uint8Array(r+c);return r>0&&h.set(t),c>0&&h.set(i.subarray(s,s+c),r),this.result=h,this.pos=0,this.len=0,this}},V=(()=>{class e extends X{constructor(e,t=null,r=!0,n,i){super(e,t,r,n,i),this.mode="CBC",this.BLOCK_SIZE=16}encrypt(e){return this.AES_Encrypt_finish(e)}decrypt(e){return this.AES_Decrypt_finish(e)}}return e.encrypt=ee,e.decrypt=te,e})(),Z;function ee(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new V(t,n,r,K,z).encrypt(e).result}function te(e,t,r,n){if(void 0===e)throw new SyntaxError("data required");if(void 0===t)throw new SyntaxError("key required");return new V(t,n,r,K,z).decrypt(e).result}function re(e){return new Promise(((t,r)=>{for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(256),a=0;a<n.length;a++)i[n.charCodeAt(a)]=a;var s=typeof s<"u"?s:{},u=Object.assign({},s);"object"==typeof process&&"object"==typeof process.versions&&process.versions.node,s.print||o.log.bind(o);var c=s.printErr||o.warn.bind(o);Object.assign(s,u),u=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&s.quit,s.wasmBinary&&s.wasmBinary,s.noExitRuntime,"object"!=typeof e&&y("[WACloudCrypto] no native wasm support detected");var l,d=!1;s.INITIAL_MEMORY;var f,h=[],p=[],g=[];var A=0,m=null;function y(t){s.onAbort&&s.onAbort(t),c(t="Aborted("+t+")"),d=!0,t+=". Build with -sASSERTIONS for more info.";var n=new e.RuntimeError(t);r(n)}var v={env:{STACKTOP:0}};function E(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"==typeof r?void 0===t.arg?I(r)():I(r)(t.arg):r(void 0===t.arg?null:t.arg)}else t(s)}}var _=[];function I(e){var t=_[e];return t||(e>=_.length&&(_.length=e+1),_[e]=t=f.get(e)),t}var T,w={};function S(e){function t(){T||(T=!0,s.calledRun=!0,!d&&(E(p),s.onRuntimeInitialized&&s.onRuntimeInitialized(),function(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)e=s.postRun.shift(),g.unshift(e);var e;E(g)}()))}A>0||(function(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)e=s.preRun.shift(),h.unshift(e);var e;E(h)}(),A>0)||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),t()}),1)):t())}if(function(){var r={a:w};function n(e,r){var n=e.exports;s.asm=n,l=s.asm.a,s.memory=l,function(e){s.HEAP8=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=new Int32Array(e),s.HEAPU8=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}(l.buffer),f=s.asm.g,function(e){p.unshift(e)}(s.asm.b),function(e){if(A--,s.monitorRunDependencies&&s.monitorRunDependencies(A),0==A&&m){var t=m;m=null,t()}}(),t(s)}function o(e){n(e.instance)}function a(t){return e.instantiate(function(e){var t,r,n,o,a,s=.75*e.length,u=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var l=new ArrayBuffer(s),d=new Uint8Array(l);for(t=0;t<u;t+=4)r=i[e.charCodeAt(t)],n=i[e.charCodeAt(t+1)],o=i[e.charCodeAt(t+2)],a=i[e.charCodeAt(t+3)],d[c++]=r<<2|n>>4,d[c++]=(15&n)<<4|o>>2,d[c++]=(3&o)<<6|63&a;return l}("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"),v).then((function(e){return e})).then(t,(function(e){c("[WACloudCrypto] failed to asynchronously prepare wasm: "+e),y(e)}))}if(A++,s.monitorRunDependencies&&s.monitorRunDependencies(A),s.instantiateWasm)try{return s.instantiateWasm(r,n)}catch(e){return c("[WACloudCrypto] Module.instantiateWasm callback failed with error: "+e),!1}a(o)}(),s.___wasm_call_ctors=function(){return(s.___wasm_call_ctors=s.asm.b).apply(null,arguments)},s._aes_setkey_enc=function(){return(s._aes_setkey_enc=s.asm.c).apply(null,arguments)},s._aes_setkey_dec=function(){return(s._aes_setkey_dec=s.asm.d).apply(null,arguments)},s._aes_crypt_cbc=function(){return(s._aes_crypt_cbc=s.asm.e).apply(null,arguments)},s._aes_crypt_ctr=function(){return(s._aes_crypt_ctr=s.asm.f).apply(null,arguments)},m=function e(){T||S(),T||(m=e)},s.run=S,s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();return s}))}function ne(e){return parseInt(e)===e}function ie(e){if(!ne(e.length))return!1;for(var t=0;t<e.length;t++)if(!ne(e[t])||e[t]<0||e[t]>255)return!1;return!0}function oe(e,t){if(e.buffer&&ArrayBuffer.isView(e))return t&&(e=e.slice?e.slice():Array.prototype.slice.call(e)),e;if(Array.isArray(e)){if(!ie(e))throw new Error("[WACloudCrypto] Array contains invalid value: "+e);return new Uint8Array(e)}if(ne(e.length)&&ie(e))return new Uint8Array(e);throw new Error("[WACloudCrypto] unsupported array-like object")}function ae(){var e=16384;return t=>(e+=t)-t}function se(e){return new Uint8Array(e)}function ue(e,t,r,n,i){(null!=n||null!=i)&&(e=e.slice?e.slice(n,i):Array.prototype.slice.call(e,n,i)),t.set(e,r)}function ce(e){var t=16-(e=oe(e,!0)).length%16,r=se(e.length+t);ue(e,r);for(var n=e.length;n<r.length;n++)r[n]=t;return r}function le(e){if((e=oe(e,!0)).length<16)throw new Error("[WACloudCrypto] PKCS#7 invalid length");var t=e[e.length-1];if(t>16)throw new Error("[WACloudCrypto] PKCS#7 padding byte out of range");for(var r=e.length-t,n=0;n<t;n++)if(e[r+n]!==t)throw new Error("[WACloudCrypto] PKCS#7 invalid padding byte");var i=se(r);return ue(e,i,0,0,r),i}function de(e){return fe.apply(this,arguments)}function fe(){return(fe=i()((function*(e){var t,r=yield re(e),n=ae(),i=r,o=new Uint8Array(i.memory.buffer),a=n(276),s=n(276),u=n(16),c=n(16),l=n(0);function d(e){var t=oe(e);o.set(t,l)}function f(e,r,n="CBC"){o.set(r,c),o.set(e,u),i._aes_setkey_enc(a,u,128),i._aes_setkey_dec(s,u,128),t=n}return{init:f,encrypt:(e,r,n)=>(f(r,n,"CBC"),d(e=ce(e)),"CBC"===t?i._aes_crypt_cbc(a,1,e.length,c,l,l):i._aes_crypt_ctr(a,e.length,c,l,l),o.subarray(l,l+e.length).slice()),decrypt:(e,r,n)=>(f(r,n,"CBC"),d(e),"CBC"===t?i._aes_crypt_cbc(s,0,e.length,c,l,l):i._aes_crypt_ctr(a,e.length,c,l,l),le(o.subarray(l,l+e.length).slice()))}}))).apply(this,arguments)}function he(e){if(!Z)return de(e).then((e=>{Z=e})).catch((()=>{}))}function pe(){return Z}function ge(e,t){var r=pe();return{encrypted:r?r.encrypt(t,e,e):V.encrypt(t,e,void 0,e),backend:r?"wasm":"js"}}function Ae(e){return ve(e).buffer}function me(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function ye(e){return null==e}function ve(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&e.charCodeAt(r)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}function Ee(e){for(var t=e.length;t--;)e[t]=Math.floor(256*Math.random());return e}function _e(e){var t=e.reduce(((e,t)=>e+t.length),0);if(!e.length)return null;var r=new Uint8Array(t),n=0;for(var i of e)r.set(i,n),n+=i.length;return r}function Ie(e){return Te(e)}m(),m(),m();var Te=function(){var e=new Array(128),t=String.fromCodePoint||String.fromCharCode,r=[];return function(n){var i,o,a=n.length;r.length=0;for(var s=0;s<a;)(o=n[s++])<=127?i=o:o<=223?i=(31&o)<<6|63&n[s++]:o<=239?i=(15&o)<<12|(63&n[s++])<<6|63&n[s++]:String.fromCodePoint?i=(7&o)<<18|(63&n[s++])<<12|(63&n[s++])<<6|63&n[s++]:(i=63,s+=3),r.push(e[i]||(e[i]=t(i)));return r.join("")}}(),we=A(E(),1);m();var Se=A(k(),1),Ce=Se.Reader,be=Se.Writer,Ne=Se.util,Oe=Se.roots.default||(Se.roots.default={}),Re=Oe.HTTPRequest=(()=>{function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.method="",e.prototype.header=Ne.emptyArray,e.prototype.body=Ne.newBuffer([]),e.prototype.callId="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=be.create()),null!=e.method&&Object.hasOwnProperty.call(e,"method")&&t.uint32(10).string(e.method),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)Oe.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.body&&Object.hasOwnProperty.call(e,"body")&&t.uint32(26).bytes(e.body),null!=e.callId&&Object.hasOwnProperty.call(e,"callId")&&t.uint32(34).string(e.callId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.HTTPRequest;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.method=e.string();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(Oe.HTTPHeader.decode(e,e.uint32()));break;case 3:n.body=e.bytes();break;case 4:n.callId=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.method&&e.hasOwnProperty("method")&&!Ne.isString(e.method))return"method: string expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=Oe.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.body&&e.hasOwnProperty("body")&&!(e.body&&"number"==typeof e.body.length||Ne.isString(e.body))?"body: buffer expected":null!=e.callId&&e.hasOwnProperty("callId")&&!Ne.isString(e.callId)?"callId: string expected":null},e.fromObject=function(e){if(e instanceof Oe.HTTPRequest)return e;var t=new Oe.HTTPRequest;if(null!=e.method&&(t.method=String(e.method)),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPRequest.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPRequest.header: object expected");t.header[r]=Oe.HTTPHeader.fromObject(e.header[r])}}return null!=e.body&&("string"==typeof e.body?Ne.base64.decode(e.body,t.body=Ne.newBuffer(Ne.base64.length(e.body)),0):e.body.length>=0&&(t.body=e.body)),null!=e.callId&&(t.callId=String(e.callId)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.method="",t.bytes===String?r.body="":(r.body=[],t.bytes!==Array&&(r.body=Ne.newBuffer(r.body))),r.callId=""),null!=e.method&&e.hasOwnProperty("method")&&(r.method=e.method),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=Oe.HTTPHeader.toObject(e.header[n],t)}return null!=e.body&&e.hasOwnProperty("body")&&(r.body=t.bytes===String?Ne.base64.encode(e.body,0,e.body.length):t.bytes===Array?Array.prototype.slice.call(e.body):e.body),null!=e.callId&&e.hasOwnProperty("callId")&&(r.callId=e.callId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/HTTPRequest"},e})(),Be=Oe.HTTPResponse=(()=>{function e(e){if(this.header=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.statusCode=0,e.prototype.header=Ne.emptyArray,e.prototype.bodyBuffer=Ne.newBuffer([]),e.prototype.bodyString="",e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=be.create()),null!=e.statusCode&&Object.hasOwnProperty.call(e,"statusCode")&&t.uint32(8).uint32(e.statusCode),null!=e.header&&e.header.length)for(var r=0;r<e.header.length;++r)Oe.HTTPHeader.encode(e.header[r],t.uint32(18).fork()).ldelim();return null!=e.bodyBuffer&&Object.hasOwnProperty.call(e,"bodyBuffer")&&t.uint32(26).bytes(e.bodyBuffer),null!=e.bodyString&&Object.hasOwnProperty.call(e,"bodyString")&&t.uint32(34).string(e.bodyString),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.HTTPResponse;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.statusCode=e.uint32();break;case 2:n.header&&n.header.length||(n.header=[]),n.header.push(Oe.HTTPHeader.decode(e,e.uint32()));break;case 3:n.bodyBuffer=e.bytes();break;case 4:n.bodyString=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.statusCode&&e.hasOwnProperty("statusCode")&&!Ne.isInteger(e.statusCode))return"statusCode: integer expected";if(null!=e.header&&e.hasOwnProperty("header")){if(!Array.isArray(e.header))return"header: array expected";for(var t=0;t<e.header.length;++t){var r=Oe.HTTPHeader.verify(e.header[t]);if(r)return"header."+r}}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&!(e.bodyBuffer&&"number"==typeof e.bodyBuffer.length||Ne.isString(e.bodyBuffer))?"bodyBuffer: buffer expected":null!=e.bodyString&&e.hasOwnProperty("bodyString")&&!Ne.isString(e.bodyString)?"bodyString: string expected":null},e.fromObject=function(e){if(e instanceof Oe.HTTPResponse)return e;var t=new Oe.HTTPResponse;if(null!=e.statusCode&&(t.statusCode=e.statusCode>>>0),e.header){if(!Array.isArray(e.header))throw TypeError(".HTTPResponse.header: array expected");t.header=[];for(var r=0;r<e.header.length;++r){if("object"!=typeof e.header[r])throw TypeError(".HTTPResponse.header: object expected");t.header[r]=Oe.HTTPHeader.fromObject(e.header[r])}}return null!=e.bodyBuffer&&("string"==typeof e.bodyBuffer?Ne.base64.decode(e.bodyBuffer,t.bodyBuffer=Ne.newBuffer(Ne.base64.length(e.bodyBuffer)),0):e.bodyBuffer.length>=0&&(t.bodyBuffer=e.bodyBuffer)),null!=e.bodyString&&(t.bodyString=String(e.bodyString)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.header=[]),t.defaults&&(r.statusCode=0,t.bytes===String?r.bodyBuffer="":(r.bodyBuffer=[],t.bytes!==Array&&(r.bodyBuffer=Ne.newBuffer(r.bodyBuffer))),r.bodyString=""),null!=e.statusCode&&e.hasOwnProperty("statusCode")&&(r.statusCode=e.statusCode),e.header&&e.header.length){r.header=[];for(var n=0;n<e.header.length;++n)r.header[n]=Oe.HTTPHeader.toObject(e.header[n],t)}return null!=e.bodyBuffer&&e.hasOwnProperty("bodyBuffer")&&(r.bodyBuffer=t.bytes===String?Ne.base64.encode(e.bodyBuffer,0,e.bodyBuffer.length):t.bytes===Array?Array.prototype.slice.call(e.bodyBuffer):e.bodyBuffer),null!=e.bodyString&&e.hasOwnProperty("bodyString")&&(r.bodyString=e.bodyString),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/HTTPResponse"},e})(),De=Oe.HTTPHeader=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.key="",e.prototype.value="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=be.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.HTTPHeader;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.key&&e.hasOwnProperty("key")&&!Ne.isString(e.key)?"key: string expected":null!=e.value&&e.hasOwnProperty("value")&&!Ne.isString(e.value)?"value: string expected":null},e.fromObject=function(e){if(e instanceof Oe.HTTPHeader)return e;var t=new Oe.HTTPHeader;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&(t.value=String(e.value)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.key="",r.value=""),null!=e.key&&e.hasOwnProperty("key")&&(r.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(r.value=e.value),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/HTTPHeader"},e})(),Le=Oe.QBaseApiData=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.qbaseApiName="",e.prototype.qbaseMeta=null,e.prototype.qbaseOptions=null,e.prototype.qbaseReq="",e.prototype.cliReqId="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=be.create()),null!=e.qbaseApiName&&Object.hasOwnProperty.call(e,"qbaseApiName")&&t.uint32(10).string(e.qbaseApiName),null!=e.qbaseMeta&&Object.hasOwnProperty.call(e,"qbaseMeta")&&Oe.QBaseApiData.QBaseMeta.encode(e.qbaseMeta,t.uint32(18).fork()).ldelim(),null!=e.qbaseOptions&&Object.hasOwnProperty.call(e,"qbaseOptions")&&Oe.QBaseApiData.QBaseOptions.encode(e.qbaseOptions,t.uint32(26).fork()).ldelim(),null!=e.qbaseReq&&Object.hasOwnProperty.call(e,"qbaseReq")&&t.uint32(34).string(e.qbaseReq),null!=e.cliReqId&&Object.hasOwnProperty.call(e,"cliReqId")&&t.uint32(42).string(e.cliReqId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.QBaseApiData;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.qbaseApiName=e.string();break;case 2:n.qbaseMeta=Oe.QBaseApiData.QBaseMeta.decode(e,e.uint32());break;case 3:n.qbaseOptions=Oe.QBaseApiData.QBaseOptions.decode(e,e.uint32());break;case 4:n.qbaseReq=e.string();break;case 5:n.cliReqId=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.qbaseApiName&&e.hasOwnProperty("qbaseApiName")&&!Ne.isString(e.qbaseApiName))return"qbaseApiName: string expected";if(null!=e.qbaseMeta&&e.hasOwnProperty("qbaseMeta")){var t=Oe.QBaseApiData.QBaseMeta.verify(e.qbaseMeta);if(t)return"qbaseMeta."+t}if(null!=e.qbaseOptions&&e.hasOwnProperty("qbaseOptions")){var r=Oe.QBaseApiData.QBaseOptions.verify(e.qbaseOptions);if(r)return"qbaseOptions."+r}return null!=e.qbaseReq&&e.hasOwnProperty("qbaseReq")&&!Ne.isString(e.qbaseReq)?"qbaseReq: string expected":null!=e.cliReqId&&e.hasOwnProperty("cliReqId")&&!Ne.isString(e.cliReqId)?"cliReqId: string expected":null},e.fromObject=function(e){if(e instanceof Oe.QBaseApiData)return e;var t=new Oe.QBaseApiData;if(null!=e.qbaseApiName&&(t.qbaseApiName=String(e.qbaseApiName)),null!=e.qbaseMeta){if("object"!=typeof e.qbaseMeta)throw TypeError(".QBaseApiData.qbaseMeta: object expected");t.qbaseMeta=Oe.QBaseApiData.QBaseMeta.fromObject(e.qbaseMeta)}if(null!=e.qbaseOptions){if("object"!=typeof e.qbaseOptions)throw TypeError(".QBaseApiData.qbaseOptions: object expected");t.qbaseOptions=Oe.QBaseApiData.QBaseOptions.fromObject(e.qbaseOptions)}return null!=e.qbaseReq&&(t.qbaseReq=String(e.qbaseReq)),null!=e.cliReqId&&(t.cliReqId=String(e.cliReqId)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.qbaseApiName="",r.qbaseMeta=null,r.qbaseOptions=null,r.qbaseReq="",r.cliReqId=""),null!=e.qbaseApiName&&e.hasOwnProperty("qbaseApiName")&&(r.qbaseApiName=e.qbaseApiName),null!=e.qbaseMeta&&e.hasOwnProperty("qbaseMeta")&&(r.qbaseMeta=Oe.QBaseApiData.QBaseMeta.toObject(e.qbaseMeta,t)),null!=e.qbaseOptions&&e.hasOwnProperty("qbaseOptions")&&(r.qbaseOptions=Oe.QBaseApiData.QBaseOptions.toObject(e.qbaseOptions,t)),null!=e.qbaseReq&&e.hasOwnProperty("qbaseReq")&&(r.qbaseReq=e.qbaseReq),null!=e.cliReqId&&e.hasOwnProperty("cliReqId")&&(r.cliReqId=e.cliReqId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/QBaseApiData"},e.QBaseMeta=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.firstLaunch=!1,e.prototype.sessionId="",e.prototype.sdkVersion="",e.prototype.filterUserInfo=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=be.create()),null!=e.firstLaunch&&Object.hasOwnProperty.call(e,"firstLaunch")&&t.uint32(8).bool(e.firstLaunch),null!=e.sessionId&&Object.hasOwnProperty.call(e,"sessionId")&&t.uint32(18).string(e.sessionId),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(26).string(e.sdkVersion),null!=e.filterUserInfo&&Object.hasOwnProperty.call(e,"filterUserInfo")&&t.uint32(32).bool(e.filterUserInfo),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.QBaseApiData.QBaseMeta;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.firstLaunch=e.bool();break;case 2:n.sessionId=e.string();break;case 3:n.sdkVersion=e.string();break;case 4:n.filterUserInfo=e.bool();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.firstLaunch&&e.hasOwnProperty("firstLaunch")&&"boolean"!=typeof e.firstLaunch?"firstLaunch: boolean expected":null!=e.sessionId&&e.hasOwnProperty("sessionId")&&!Ne.isString(e.sessionId)?"sessionId: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!Ne.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.filterUserInfo&&e.hasOwnProperty("filterUserInfo")&&"boolean"!=typeof e.filterUserInfo?"filterUserInfo: boolean expected":null},e.fromObject=function(e){if(e instanceof Oe.QBaseApiData.QBaseMeta)return e;var t=new Oe.QBaseApiData.QBaseMeta;return null!=e.firstLaunch&&(t.firstLaunch=Boolean(e.firstLaunch)),null!=e.sessionId&&(t.sessionId=String(e.sessionId)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.filterUserInfo&&(t.filterUserInfo=Boolean(e.filterUserInfo)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.firstLaunch=!1,r.sessionId="",r.sdkVersion="",r.filterUserInfo=!1),null!=e.firstLaunch&&e.hasOwnProperty("firstLaunch")&&(r.firstLaunch=e.firstLaunch),null!=e.sessionId&&e.hasOwnProperty("sessionId")&&(r.sessionId=e.sessionId),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(r.sdkVersion=e.sdkVersion),null!=e.filterUserInfo&&e.hasOwnProperty("filterUserInfo")&&(r.filterUserInfo=e.filterUserInfo),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/QBaseApiData.QBaseMeta"},e}(),e.QBaseOptions=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.env="",e.prototype.appid="",e.prototype.region="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=be.create()),null!=e.env&&Object.hasOwnProperty.call(e,"env")&&t.uint32(10).string(e.env),null!=e.appid&&Object.hasOwnProperty.call(e,"appid")&&t.uint32(18).string(e.appid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.QBaseApiData.QBaseOptions;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.env=e.string();break;case 2:n.appid=e.string();break;case 3:n.region=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.env&&e.hasOwnProperty("env")&&!Ne.isString(e.env)?"env: string expected":null!=e.appid&&e.hasOwnProperty("appid")&&!Ne.isString(e.appid)?"appid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!Ne.isString(e.region)?"region: string expected":null},e.fromObject=function(e){if(e instanceof Oe.QBaseApiData.QBaseOptions)return e;var t=new Oe.QBaseApiData.QBaseOptions;return null!=e.env&&(t.env=String(e.env)),null!=e.appid&&(t.appid=String(e.appid)),null!=e.region&&(t.region=String(e.region)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.env="",r.appid="",r.region=""),null!=e.env&&e.hasOwnProperty("env")&&(r.env=e.env),null!=e.appid&&e.hasOwnProperty("appid")&&(r.appid=e.appid),null!=e.region&&e.hasOwnProperty("region")&&(r.region=e.region),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/QBaseApiData.QBaseOptions"},e}(),e})(),Pe=Oe.V3Header=(()=>{function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.encryptionTimestamp=Ne.Long?Ne.Long.fromBits(0,0,!0):0,e.prototype.compression="",e.prototype.userTimeout=Ne.Long?Ne.Long.fromBits(0,0,!0):0,e.prototype.libBuildTs=Ne.Long?Ne.Long.fromBits(0,0,!0):0,e.prototype.appProtocol="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=be.create()),null!=e.encryptionTimestamp&&Object.hasOwnProperty.call(e,"encryptionTimestamp")&&t.uint32(8).uint64(e.encryptionTimestamp),null!=e.compression&&Object.hasOwnProperty.call(e,"compression")&&t.uint32(18).string(e.compression),null!=e.userTimeout&&Object.hasOwnProperty.call(e,"userTimeout")&&t.uint32(24).uint64(e.userTimeout),null!=e.libBuildTs&&Object.hasOwnProperty.call(e,"libBuildTs")&&t.uint32(32).uint64(e.libBuildTs),null!=e.appProtocol&&Object.hasOwnProperty.call(e,"appProtocol")&&t.uint32(42).string(e.appProtocol),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof Ce||(e=Ce.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Oe.V3Header;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.encryptionTimestamp=e.uint64();break;case 2:n.compression=e.string();break;case 3:n.userTimeout=e.uint64();break;case 4:n.libBuildTs=e.uint64();break;case 5:n.appProtocol=e.string();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof Ce||(e=new Ce(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null==e.encryptionTimestamp||!e.hasOwnProperty("encryptionTimestamp")||Ne.isInteger(e.encryptionTimestamp)||e.encryptionTimestamp&&Ne.isInteger(e.encryptionTimestamp.low)&&Ne.isInteger(e.encryptionTimestamp.high)?null!=e.compression&&e.hasOwnProperty("compression")&&!Ne.isString(e.compression)?"compression: string expected":null==e.userTimeout||!e.hasOwnProperty("userTimeout")||Ne.isInteger(e.userTimeout)||e.userTimeout&&Ne.isInteger(e.userTimeout.low)&&Ne.isInteger(e.userTimeout.high)?null==e.libBuildTs||!e.hasOwnProperty("libBuildTs")||Ne.isInteger(e.libBuildTs)||e.libBuildTs&&Ne.isInteger(e.libBuildTs.low)&&Ne.isInteger(e.libBuildTs.high)?null!=e.appProtocol&&e.hasOwnProperty("appProtocol")&&!Ne.isString(e.appProtocol)?"appProtocol: string expected":null:"libBuildTs: integer|Long expected":"userTimeout: integer|Long expected":"encryptionTimestamp: integer|Long expected"},e.fromObject=function(e){if(e instanceof Oe.V3Header)return e;var t=new Oe.V3Header;return null!=e.encryptionTimestamp&&(Ne.Long?(t.encryptionTimestamp=Ne.Long.fromValue(e.encryptionTimestamp)).unsigned=!0:"string"==typeof e.encryptionTimestamp?t.encryptionTimestamp=parseInt(e.encryptionTimestamp,10):"number"==typeof e.encryptionTimestamp?t.encryptionTimestamp=e.encryptionTimestamp:"object"==typeof e.encryptionTimestamp&&(t.encryptionTimestamp=new Ne.LongBits(e.encryptionTimestamp.low>>>0,e.encryptionTimestamp.high>>>0).toNumber(!0))),null!=e.compression&&(t.compression=String(e.compression)),null!=e.userTimeout&&(Ne.Long?(t.userTimeout=Ne.Long.fromValue(e.userTimeout)).unsigned=!0:"string"==typeof e.userTimeout?t.userTimeout=parseInt(e.userTimeout,10):"number"==typeof e.userTimeout?t.userTimeout=e.userTimeout:"object"==typeof e.userTimeout&&(t.userTimeout=new Ne.LongBits(e.userTimeout.low>>>0,e.userTimeout.high>>>0).toNumber(!0))),null!=e.libBuildTs&&(Ne.Long?(t.libBuildTs=Ne.Long.fromValue(e.libBuildTs)).unsigned=!0:"string"==typeof e.libBuildTs?t.libBuildTs=parseInt(e.libBuildTs,10):"number"==typeof e.libBuildTs?t.libBuildTs=e.libBuildTs:"object"==typeof e.libBuildTs&&(t.libBuildTs=new Ne.LongBits(e.libBuildTs.low>>>0,e.libBuildTs.high>>>0).toNumber(!0))),null!=e.appProtocol&&(t.appProtocol=String(e.appProtocol)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(Ne.Long){var n=new Ne.Long(0,0,!0);r.encryptionTimestamp=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.encryptionTimestamp=t.longs===String?"0":0;if(r.compression="",Ne.Long){var i=new Ne.Long(0,0,!0);r.userTimeout=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else r.userTimeout=t.longs===String?"0":0;if(Ne.Long){var o=new Ne.Long(0,0,!0);r.libBuildTs=t.longs===String?o.toString():t.longs===Number?o.toNumber():o}else r.libBuildTs=t.longs===String?"0":0;r.appProtocol=""}return null!=e.encryptionTimestamp&&e.hasOwnProperty("encryptionTimestamp")&&("number"==typeof e.encryptionTimestamp?r.encryptionTimestamp=t.longs===String?String(e.encryptionTimestamp):e.encryptionTimestamp:r.encryptionTimestamp=t.longs===String?Ne.Long.prototype.toString.call(e.encryptionTimestamp):t.longs===Number?new Ne.LongBits(e.encryptionTimestamp.low>>>0,e.encryptionTimestamp.high>>>0).toNumber(!0):e.encryptionTimestamp),null!=e.compression&&e.hasOwnProperty("compression")&&(r.compression=e.compression),null!=e.userTimeout&&e.hasOwnProperty("userTimeout")&&("number"==typeof e.userTimeout?r.userTimeout=t.longs===String?String(e.userTimeout):e.userTimeout:r.userTimeout=t.longs===String?Ne.Long.prototype.toString.call(e.userTimeout):t.longs===Number?new Ne.LongBits(e.userTimeout.low>>>0,e.userTimeout.high>>>0).toNumber(!0):e.userTimeout),null!=e.libBuildTs&&e.hasOwnProperty("libBuildTs")&&("number"==typeof e.libBuildTs?r.libBuildTs=t.longs===String?String(e.libBuildTs):e.libBuildTs:r.libBuildTs=t.longs===String?Ne.Long.prototype.toString.call(e.libBuildTs):t.longs===Number?new Ne.LongBits(e.libBuildTs.low>>>0,e.libBuildTs.high>>>0).toNumber(!0):e.libBuildTs),null!=e.appProtocol&&e.hasOwnProperty("appProtocol")&&(r.appProtocol=e.appProtocol),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,Se.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/V3Header"},e})();function Me(e,t,r){var n=Date.now();return(...i)=>{var o=t(...i),a=Date.now();return e[r]=a-n,o}}function xe(e,t,r){var n=Me(r,we.default.compress,"compress")(t);return{data:Me(r,ge,"encrypt")(e,n).encrypted}}function Ue(e,t,r,n,i,o){var a,s=Object.entries(t).filter((([e,t])=>!ye(e)&&!ye(t))).map((([e,t])=>({key:e.toString().toLowerCase(),value:t.toString()}))),u=me(n),c=!1;return"object"===u?a=JSON.stringify(n):"arraybuffer"!==u?a=n+"":(a=n,c=!0),{...xe(e,c?Me(o,Re.encode,"encodePb")({body:new Uint8Array(n),callId:i,header:s}).finish():new Uint8Array(Me(o,Ae,"stringToBuffer")(JSON.stringify({method:r,header:s,body:a,call_id:i}))),o),contentEncoding:c?"PB":"JSON"}}function ke(e,t,r,n,i){var o=n instanceof ArrayBuffer,a=Object.entries(t).filter((([e,t])=>e&&t)).map((([e,t])=>({key:e.toLowerCase(),value:t})));return{...xe(e,o?Be.encode({bodyBuffer:new Uint8Array(n),statusCode:r,header:a}).finish():Be.encode({bodyString:JSON.stringify(n),statusCode:r,header:a}).finish(),i),contentEncoding:o?"PB":"JSON"}}function qe(e,t,r){return{...xe(e,Le.encode(t).finish(),r)}}function Qe(e,t){var r=pe();return r?r.decrypt(t,e,e):V.decrypt(t,e,void 0,e)}m(),m(),m();var Fe=A(E(),1);function He(e,t,r){var n=Qe(e,t);return{data:r?Fe.default.uncompress(n):n}}function Ge(e,t,r,n){var i,{data:o}=He(e,t,r);if("PB"===n)i=Re.decode(o);else{var a=Ie(o);i=JSON.parse(a)}return i}function We(e,t,r,n){var i,{data:o}=He(e,t,r);if("PB"===n)i=Be.decode(o);else{var a=Ie(o);i=JSON.parse(a)}return{statusCode:i.statusCode,body:i.bodyString||i.bodyBuffer,header:i.header.reduce(((e,t)=>(t.key&&t.value&&(e[t.key]=e[t.key]?e[t.key]+","+t.value:t.value),e)),{})}}function je(e,t,r){var{data:n}=He(e,t,r),i=Ie(n);return{data:JSON.parse(i)}}var $e={};function Ye(e,t){var r=pe(),n=new Uint8Array(16);return Ee(n),{iv:n,encrypted:r?r.encrypt(t,e,n):V.encrypt(t,e,void 0,n)}}p($e,{decode:()=>it,decodeRequest:()=>ot,decodeResponse:()=>at,encode:()=>Ve,encodeRequest:()=>Ze,encodeResponse:()=>et}),m(),m(),m(),m();var Je="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Ke=(e=21)=>{for(var t="",r=e;r--;)t+=Je[64*Math.random()|0];return t},ze=A(E(),1);function Xe(e,t,r){return t=+t,e[r>>>=0]=t>>>8,e[r+1]=255&t,r+2}function Ve(e,t,r="JSON",n={}){var i={appProtocol:`1/${r}`,compression:"snappy",encryptionTimestamp:Date.now(),libBuildTs:1676961691476},o=Ye(e,Pe.encode(i).finish()),a=o.iv.length+o.encrypted.length,s=new Uint8Array(2);Xe(s,a,0);var u=Me(n,ze.default.compress,"compress")(t),c=Me(n,Ye,"encrypt")(e,u);return{data:_e([s,o.iv,o.encrypted,c.iv,c.encrypted]),__v3__header:i}}function Ze(e,t,r,n,i={}){var o,a=me(n),s=Object.entries(t).filter((([e,t])=>!ye(e)&&!ye(t))).map((([e,t])=>({key:e.toString().toLowerCase(),value:t.toString()}))),u=`${Date.now()}-${Ke(8)}`,c=!1;return"object"===a?o=JSON.stringify(n):"arraybuffer"!==a?o=n+"":(o=n,c=!0),{...Ve(e,c?Me(i,Re.encode,"encodePb")({body:o,callId:u,header:s,method:r}).finish():new Uint8Array(Me(i,Ae,"stringToBuffer")(JSON.stringify({body:o,call_id:u,header:s,method:r}))),c?"PB":"JSON",i),callId:u,stats:i}}function et(e,t,r,n){var i,o=me(n),a=Object.entries(t).filter((([e,t])=>e&&t)).map((([e,t])=>({key:e.toString().toLowerCase(),value:t.toString()}))),s=!1;return"object"===o?i=JSON.stringify(n):"arraybuffer"!==o?i=n+"":(i=n,s=!0),"object"===o?i=JSON.stringify(n):"arraybuffer"!==o?i=n+"":(i=n,s=!0),Ve(e,s?Be.encode({bodyBuffer:i,statusCode:r,header:a}).finish():Be.encode({bodyString:JSON.stringify(n),statusCode:r,header:a}).finish(),"PB")}function tt(e,t){var r=pe(),n=t.subarray(0,16),i=t.subarray(16);return r?r.decrypt(i,e,n):V.decrypt(i,e,void 0,n)}m(),m();var rt=A(E(),1);function nt(e,t){return e[t>>>=0]<<8|e[t+1]}function it(e,t,r={}){var n=nt(t,0),i=tt(e,t.slice(2,n+2)),o=Pe.decode(i),a="snappy"===o.compression,s=Me(r,tt,"decrypt")(e,t.slice(n+2));return{data:a?Me(r,rt.default.uncompress,"uncompress")(s):s,__v3__header:o}}function ot(e,t,r={}){var n,{data:i,__v3__header:o}=it(e,t,r),a=!1,s=o.appProtocol.split("/")[1];return s&&(a="PB"===s),n=a?Re.decode(i):Me(r,(e=>JSON.parse(Ie(e))),"decodeJson")(i),{...n,__v3__header:o,stats:r}}function at(e,t,r={}){var n,{data:i,__v3__header:o}=it(e,t,r),a=!1,s=o.appProtocol.split("/")[1];return s&&(a="PB"===s),{statusCode:(n=a?Me(r,Be.decode,"decodePb")(i):Me(r,(e=>JSON.parse(Ie(e))),"decodeJson")(i)).statusCode,body:n.bodyString||n.bodyBuffer,header:n.header.reduce(((e,t)=>(t.key&&t.value&&(e[t.key]=e[t.key]?e[t.key]+","+t.value:t.value),e)),{}),__v3__header:o}}},683:(e,t,r)=>{var n=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,s=!1;function u(){s=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0,r=e.length;t<r;++t)n[t]=e[t],i[e.charCodeAt(t)]=t;i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63}function c(e,t,r){for(var i,o,a=[],s=t;s<r;s+=3)i=(e[s]<<16)+(e[s+1]<<8)+e[s+2],a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}function l(e){var t;s||u();for(var r=e.length,i=r%3,o="",a=[],l=16383,d=0,f=r-i;d<f;d+=l)a.push(c(e,d,d+l>f?f:d+l));return 1===i?(t=e[r-1],o+=n[t>>2],o+=n[t<<4&63],o+="=="):2===i&&(t=(e[r-2]<<8)+e[r-1],o+=n[t>>10],o+=n[t>>4&63],o+=n[t<<2&63],o+="="),a.push(o),a.join("")}function d(e,t,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,d=r?i-1:0,f=r?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+d],d+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=c}return(h?-1:1)*a*Math.pow(2,o-n)}function f(e,t,r,n,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,d=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,p=n?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+d>=1?f/u:f*Math.pow(2,1-d))*u>=2&&(a++,u/=2),a+d>=l?(s=0,a=l):a+d>=1?(s=(t*u-1)*Math.pow(2,i),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[r+h]=255&s,h+=p,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;e[r+h]=255&a,h+=p,a/=256,c-=8);e[r+h-p]|=128*g}var h={}.toString,p=Array.isArray||function(e){return"[object Array]"==h.call(e)};y.TYPED_ARRAY_SUPPORT=void 0===r.g.TYPED_ARRAY_SUPPORT||r.g.TYPED_ARRAY_SUPPORT;var g=A();function A(){return y.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function m(e,t){if(A()<t)throw new RangeError("Invalid typed array length");return y.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=y.prototype:(null===e&&(e=new y(t)),e.length=t),e}function y(e,t,r){if(!(y.TYPED_ARRAY_SUPPORT||this instanceof y))return new y(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return _(this,e)}return v(this,e,t,r)}function v(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);y.TYPED_ARRAY_SUPPORT?(e=t).__proto__=y.prototype:e=I(e,t);return e}(e,t,r,n):"string"==typeof t?function(e,t,r){"string"==typeof r&&""!==r||(r="utf8");if(!y.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|S(t,r);e=m(e,n);var i=e.write(t,r);i!==n&&(e=e.slice(0,i));return e}(e,t,r):function(e,t){if(w(t)){var r=0|T(t.length);return 0===(e=m(e,r)).length||t.copy(e,0,0,r),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?m(e,0):I(e,t);if("Buffer"===t.type&&p(t.data))return I(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function E(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function _(e,t){if(E(t),e=m(e,t<0?0:0|T(t)),!y.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function I(e,t){var r=t.length<0?0:0|T(t.length);e=m(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function T(e){if(e>=A())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+A().toString(16)+" bytes");return 0|e}function w(e){return!(null==e||!e._isBuffer)}function S(e,t){if(w(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return V(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Z(e).length;default:if(n)return V(e).length;t=(""+t).toLowerCase(),n=!0}}function C(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return F(this,t,r);case"utf8":case"utf-8":return U(this,t,r);case"ascii":return q(this,t,r);case"latin1":case"binary":return Q(this,t,r);case"base64":return x(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return H(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function b(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function N(e,t,r,n,i){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(i)return-1;r=e.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof t&&(t=y.from(t,n)),w(t))return 0===t.length?-1:O(e,t,r,n,i);if("number"==typeof t)return t&=255,y.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):O(e,[t],r,n,i);throw new TypeError("val must be string, number or Buffer")}function O(e,t,r,n,i){var o,a=1,s=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;a=2,s/=2,u/=2,r/=2}function c(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(o=r;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*a}else-1!==l&&(o-=o-l),l=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var d=!0,f=0;f<u;f++)if(c(e,o+f)!==c(t,f)){d=!1;break}if(d)return o}return-1}function R(e,t,r,n){r=Number(r)||0;var i=e.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[r+a]=s}return a}function B(e,t,r,n){return ee(V(t,e.length-r),e,r,n)}function D(e,t,r,n){return ee(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function L(e,t,r,n){return D(e,t,r,n)}function P(e,t,r,n){return ee(Z(t),e,r,n)}function M(e,t,r,n){return ee(function(e,t){for(var r,n,i,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=(r=e.charCodeAt(a))>>8,i=r%256,o.push(i),o.push(n);return o}(t,e.length-r),e,r,n)}function x(e,t,r){return 0===t&&r===e.length?l(e):l(e.slice(t,r))}function U(e,t,r){r=Math.min(e.length,r);for(var n=[],i=t;i<r;){var o,a,s,u,c=e[i],l=null,d=c>239?4:c>223?3:c>191?2:1;if(i+d<=r)switch(d){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[i+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(u=(15&c)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,d=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=d}return function(e){var t=e.length;if(t<=k)return String.fromCharCode.apply(String,e);var r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=k));return r}(n)}y.poolSize=8192,y._augment=function(e){return e.__proto__=y.prototype,e},y.from=function(e,t,r){return v(null,e,t,r)},y.TYPED_ARRAY_SUPPORT&&(y.prototype.__proto__=Uint8Array.prototype,y.__proto__=Uint8Array),y.alloc=function(e,t,r){return function(e,t,r,n){return E(t),t<=0?m(e,t):void 0!==r?"string"==typeof n?m(e,t).fill(r,n):m(e,t).fill(r):m(e,t)}(null,e,t,r)},y.allocUnsafe=function(e){return _(null,e)},y.allocUnsafeSlow=function(e){return _(null,e)},y.isBuffer=te,y.compare=function(e,t){if(!w(e)||!w(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,i=0,o=Math.min(r,n);i<o;++i)if(e[i]!==t[i]){r=e[i],n=t[i];break}return r<n?-1:n<r?1:0},y.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},y.concat=function(e,t){if(!p(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return y.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=y.allocUnsafe(t),i=0;for(r=0;r<e.length;++r){var o=e[r];if(!w(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},y.byteLength=S,y.prototype._isBuffer=!0,y.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)b(this,t,t+1);return this},y.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)b(this,t,t+3),b(this,t+1,t+2);return this},y.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)b(this,t,t+7),b(this,t+1,t+6),b(this,t+2,t+5),b(this,t+3,t+4);return this},y.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?U(this,0,e):C.apply(this,arguments)},y.prototype.equals=function(e){if(!w(e))throw new TypeError("Argument must be a Buffer");return this===e||0===y.compare(this,e)},y.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},y.prototype.compare=function(e,t,r,n,i){if(!w(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),t<0||r>e.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&t>=r)return 0;if(n>=i)return-1;if(t>=r)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(n,i),c=e.slice(t,r),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},y.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},y.prototype.indexOf=function(e,t,r){return N(this,e,t,r,!0)},y.prototype.lastIndexOf=function(e,t,r){return N(this,e,t,r,!1)},y.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-t;if((void 0===r||r>i)&&(r=i),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return R(this,e,t,r);case"utf8":case"utf-8":return B(this,e,t,r);case"ascii":return D(this,e,t,r);case"latin1":case"binary":return L(this,e,t,r);case"base64":return P(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var k=4096;function q(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(127&e[i]);return n}function Q(e,t,r){var n="";r=Math.min(e.length,r);for(var i=t;i<r;++i)n+=String.fromCharCode(e[i]);return n}function F(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=t;o<r;++o)i+=X(e[o]);return i}function H(e,t,r){for(var n=e.slice(t,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function G(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function W(e,t,r,n,i,o){if(!w(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function j(e,t,r,n){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-r,2);i<o;++i)e[r+i]=(t&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function $(e,t,r,n){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-r,4);i<o;++i)e[r+i]=t>>>8*(n?i:3-i)&255}function Y(e,t,r,n,i,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function J(e,t,r,n,i){return i||Y(e,0,r,4),f(e,t,r,n,23,4),r+4}function K(e,t,r,n,i){return i||Y(e,0,r,8),f(e,t,r,n,52,8),r+8}y.prototype.slice=function(e,t){var r,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e),y.TYPED_ARRAY_SUPPORT)(r=this.subarray(e,t)).__proto__=y.prototype;else{var i=t-e;r=new y(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+e]}return r},y.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||G(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n},y.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||G(e,t,this.length);for(var n=this[e+--t],i=1;t>0&&(i*=256);)n+=this[e+--t]*i;return n},y.prototype.readUInt8=function(e,t){return t||G(e,1,this.length),this[e]},y.prototype.readUInt16LE=function(e,t){return t||G(e,2,this.length),this[e]|this[e+1]<<8},y.prototype.readUInt16BE=function(e,t){return t||G(e,2,this.length),this[e]<<8|this[e+1]},y.prototype.readUInt32LE=function(e,t){return t||G(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},y.prototype.readUInt32BE=function(e,t){return t||G(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},y.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||G(e,t,this.length);for(var n=this[e],i=1,o=0;++o<t&&(i*=256);)n+=this[e+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*t)),n},y.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||G(e,t,this.length);for(var n=t,i=1,o=this[e+--n];n>0&&(i*=256);)o+=this[e+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},y.prototype.readInt8=function(e,t){return t||G(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},y.prototype.readInt16LE=function(e,t){t||G(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},y.prototype.readInt16BE=function(e,t){t||G(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},y.prototype.readInt32LE=function(e,t){return t||G(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},y.prototype.readInt32BE=function(e,t){return t||G(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},y.prototype.readFloatLE=function(e,t){return t||G(e,4,this.length),d(this,e,!0,23,4)},y.prototype.readFloatBE=function(e,t){return t||G(e,4,this.length),d(this,e,!1,23,4)},y.prototype.readDoubleLE=function(e,t){return t||G(e,8,this.length),d(this,e,!0,52,8)},y.prototype.readDoubleBE=function(e,t){return t||G(e,8,this.length),d(this,e,!1,52,8)},y.prototype.writeUIntLE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||W(this,e,t,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[t]=255&e;++o<r&&(i*=256);)this[t+o]=e/i&255;return t+r},y.prototype.writeUIntBE=function(e,t,r,n){(e=+e,t|=0,r|=0,n)||W(this,e,t,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+r},y.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,1,255,0),y.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},y.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,2,65535,0),y.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},y.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,2,65535,0),y.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},y.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,4,4294967295,0),y.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):$(this,e,t,!0),t+4},y.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,4,4294967295,0),y.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):$(this,e,t,!1),t+4},y.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);W(this,e,t,r,i-1,-i)}var o=0,a=1,s=0;for(this[t]=255&e;++o<r&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},y.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var i=Math.pow(2,8*r-1);W(this,e,t,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+r},y.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,1,127,-128),y.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},y.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,2,32767,-32768),y.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):j(this,e,t,!0),t+2},y.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,2,32767,-32768),y.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):j(this,e,t,!1),t+2},y.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,4,2147483647,-2147483648),y.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):$(this,e,t,!0),t+4},y.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||W(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),y.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):$(this,e,t,!1),t+4},y.prototype.writeFloatLE=function(e,t,r){return J(this,e,t,!0,r)},y.prototype.writeFloatBE=function(e,t,r){return J(this,e,t,!1,r)},y.prototype.writeDoubleLE=function(e,t,r){return K(this,e,t,!0,r)},y.prototype.writeDoubleBE=function(e,t,r){return K(this,e,t,!1,r)},y.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var i,o=n-r;if(this===e&&r<t&&t<n)for(i=o-1;i>=0;--i)e[i+t]=this[i+r];else if(o<1e3||!y.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+o),t);return o},y.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!y.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var o;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(o=t;o<r;++o)this[o]=e;else{var a=w(e)?e:V(new y(e,n).toString()),s=a.length;for(o=0;o<r-t;++o)this[o+t]=a[o%s]}return this};var z=/[^+\/0-9A-Za-z-_]/g;function X(e){return e<16?"0"+e.toString(16):e.toString(16)}function V(e,t){var r;t=t||1/0;for(var n=e.length,i=null,o=[],a=0;a<n;++a){if((r=e.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(t-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Z(e){return function(e){var t,r,n,o,c,l;s||u();var d=e.length;if(d%4>0)throw new Error("Invalid string. Length must be a multiple of 4");c="="===e[d-2]?2:"="===e[d-1]?1:0,l=new a(3*d/4-c),n=c>0?d-4:d;var f=0;for(t=0,r=0;t<n;t+=4,r+=3)o=i[e.charCodeAt(t)]<<18|i[e.charCodeAt(t+1)]<<12|i[e.charCodeAt(t+2)]<<6|i[e.charCodeAt(t+3)],l[f++]=o>>16&255,l[f++]=o>>8&255,l[f++]=255&o;return 2===c?(o=i[e.charCodeAt(t)]<<2|i[e.charCodeAt(t+1)]>>4,l[f++]=255&o):1===c&&(o=i[e.charCodeAt(t)]<<10|i[e.charCodeAt(t+1)]<<4|i[e.charCodeAt(t+2)]>>2,l[f++]=o>>8&255,l[f++]=255&o),l}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(z,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function ee(e,t,r,n){for(var i=0;i<n&&!(i+r>=t.length||i>=e.length);++i)t[i+r]=e[i];return i}function te(e){return null!=e&&(!!e._isBuffer||re(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&re(e.slice(0,0))}(e))}function re(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}var ne=Object.freeze({INSPECT_MAX_BYTES:50,kMaxLength:g,Buffer:y,SlowBuffer:function(e){return+e!=e&&(e=0),y.alloc(+e)},isBuffer:te});Map;var ie=function(){function e(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0}),e.isLong=t;var r={},n={};function i(e,t){var i,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=n[e])?o:(i=a(e,(0|e)<0?-1:0,!0),s&&(n[e]=i),i):(s=-128<=(e|=0)&&e<128)&&(o=r[e])?o:(i=a(e,e<0?-1:0,!1),s&&(r[e]=i),i)}function o(e,t){if(isNaN(e))return t?g:p;if(t){if(e<0)return g;if(e>=d)return E}else{if(e<=-f)return _;if(e+1>=f)return v}return e<0?o(-e,t).neg():a(e%l|0,e/l|0,t)}function a(t,r,n){return new e(t,r,n)}e.fromInt=i,e.fromNumber=o,e.fromBits=a;var s=Math.pow;function u(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return p;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return u(e.substring(1),t,r).neg();for(var i=o(s(r,8)),a=p,c=0;c<e.length;c+=8){var l=Math.min(8,e.length-c),d=parseInt(e.substring(c,c+l),r);if(l<8){var f=o(s(r,l));a=a.mul(f).add(o(d))}else a=(a=a.mul(i)).add(o(d))}return a.unsigned=t,a}function c(e,t){return"number"==typeof e?o(e,t):"string"==typeof e?u(e,t):a(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}e.fromString=u,e.fromValue=c;var l=4294967296,d=l*l,f=d/2,h=i(1<<24),p=i(0);e.ZERO=p;var g=i(0,!0);e.UZERO=g;var A=i(1);e.ONE=A;var m=i(1,!0);e.UONE=m;var y=i(-1);e.NEG_ONE=y;var v=a(-1,2147483647,!1);e.MAX_VALUE=v;var E=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=E;var _=a(0,-2147483648,!1);e.MIN_VALUE=_;var I=e.prototype;return I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=o(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=o(s(e,6),this.unsigned),a=this,u="";;){var c=a.div(i),l=(a.sub(c.mul(i)).toInt()>>>0).toString(e);if((a=c).isZero())return l+u;for(;l.length<6;)l="0"+l;u=""+l+u}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1==(1&this.low)},I.isEven=function(){return 0==(1&this.low)},I.equals=function(e){return t(e)||(e=c(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(t(e)||(e=c(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(A)},I.neg=I.negate,I.add=function(e){t(e)||(e=c(e));var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,u=65535&e.high,l=e.low>>>16,d=0,f=0,h=0,p=0;return h+=(p+=o+(65535&e.low))>>>16,f+=(h+=i+l)>>>16,d+=(f+=n+u)>>>16,d+=r+s,a((h&=65535)<<16|(p&=65535),(d&=65535)<<16|(f&=65535),this.unsigned)},I.subtract=function(e){return t(e)||(e=c(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return p;if(t(e)||(e=c(e)),e.isZero())return p;if(this.eq(_))return e.isOdd()?_:p;if(e.eq(_))return this.isOdd()?_:p;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(h)&&e.lt(h))return o(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,n=65535&this.high,i=this.low>>>16,s=65535&this.low,u=e.high>>>16,l=65535&e.high,d=e.low>>>16,f=65535&e.low,g=0,A=0,m=0,y=0;return m+=(y+=s*f)>>>16,A+=(m+=i*f)>>>16,m&=65535,A+=(m+=s*d)>>>16,g+=(A+=n*f)>>>16,A&=65535,g+=(A+=i*d)>>>16,A&=65535,g+=(A+=s*l)>>>16,g+=r*f+n*d+i*l+s*u,a((m&=65535)<<16|(y&=65535),(g&=65535)<<16|(A&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(t(e)||(e=c(e)),e.isZero())throw Error("division by zero");var r,n,i;if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return m;i=g}else{if(this.eq(_))return e.eq(A)||e.eq(y)?_:e.eq(_)?A:(r=this.shr(1).div(e).shl(1)).eq(p)?e.isNegative()?A:y:(n=this.sub(e.mul(r)),i=r.add(n.div(e)));if(e.eq(_))return this.unsigned?g:p;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=p}for(n=this;n.gte(e);){r=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),u=a<=48?1:s(2,a-48),l=o(r),d=l.mul(e);d.isNegative()||d.gt(n);)d=(l=o(r-=u,this.unsigned)).mul(e);l.isZero()&&(l=A),i=i.add(l),n=n.sub(d)}return i},I.div=I.divide,I.modulo=function(e){return t(e)||(e=c(e)),this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return a(~this.low,~this.high,this.unsigned)},I.and=function(e){return t(e)||(e=c(e)),a(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return t(e)||(e=c(e)),a(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return t(e)||(e=c(e)),a(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):a(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?a(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):a(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0===(e&=63))return this;var r=this.high;return e<32?a(this.low>>>e|r<<32-e,r>>>e,this.unsigned):a(32===e?r:r>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},e.fromBytes=function(t,r,n){return n?e.fromBytesLE(t,r):e.fromBytesBE(t,r)},e.fromBytesLE=function(t,r){return new e(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)},e.fromBytesBE=function(t,r){return new e(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)},e.prototype.toExtendedJSON=function(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}},e.fromExtendedJSON=function(t,r){var n=e.fromString(t.$numberLong);return r&&r.relaxed?n.toNumber():n},Object.defineProperty(e.prototype,"_bsontype",{value:"Long"}),e}();function oe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t,r){return t&&ae(e.prototype,t),r&&ae(e,r),e}var ue=function(){function e(t){oe(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:{$numberDouble:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseFloat(t.$numberDouble):new e(parseFloat(t.$numberDouble))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Double"}),e}();function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function le(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}function fe(e,t){return fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},fe(e,t)}var he=function(e){function t(e,r){var n;return oe(this,t),n=ie.isLong(e)?le(this,de(t).call(this,e.low,e.high,!0)):le(this,de(t).call(this,e,r,!0)),le(n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&fe(e,t)}(t,e),se(t,[{key:"toJSON",value:function(){return{$timestamp:this.toString()}}},{key:"toExtendedJSON",value:function(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}}],[{key:"fromInt",value:function(e){return new t(ie.fromInt(e,!0))}},{key:"fromNumber",value:function(e){return new t(ie.fromNumber(e,!0))}},{key:"fromBits",value:function(e,r){return new t(e,r)}},{key:"fromString",value:function(e,r){return new t(ie.fromString(e,r,!0))}},{key:"fromExtendedJSON",value:function(e){return new t(e.$timestamp.i,e.$timestamp.t)}}]),Object.defineProperty(t.prototype,"_bsontype",{value:"Timestamp"}),t.MAX_VALUE=t.MAX_UNSIGNED_VALUE,t}(ie),pe={};function ge(e){for(var t=new Uint8Array(e),r=0;r<e;++r)t[r]=Math.floor(256*Math.random());return t}var Ae={normalizedFunctionString:function(e){return e.toString().replace("function(","function (")},randomBytes:function(){var e=ge;if("undefined"!=typeof window&&window.crypto&&window.crypto.getRandomValues)e=function(e){return window.crypto.getRandomValues(new Uint8Array(e))};else{try{e=pe.randomBytes}catch(e){}null==e&&(e=ge)}return e}()};new Date;var me=function(){function e(e,t){var r={seen:[],stylize:ve};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),we(t)?r.showHidden=t:t&&Me(r,t),Ne(r.showHidden)&&(r.showHidden=!1),Ne(r.depth)&&(r.depth=2),Ne(r.colors)&&(r.colors=!1),Ne(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=ye),Ee(r,e,r.depth)}return e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e}();function ye(e,t){var r=me.styles[t];return r?"["+me.colors[r][0]+"m"+e+"["+me.colors[r][1]+"m":e}function ve(e,t){return e}function Ee(e,t,r){if(e.customInspect&&t&&Le(t.inspect)&&t.inspect!==me&&(!t.constructor||t.constructor.prototype!==t)){var n=t.inspect(r,e);return be(n)||(n=Ee(e,n,r)),n}var i=function(e,t){if(Ne(t))return e.stylize("undefined","undefined");if(be(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}if(Ce(t))return e.stylize(""+t,"number");if(we(t))return e.stylize(""+t,"boolean");if(Se(t))return e.stylize("null","null")}(e,t);if(i)return i;var o=Object.keys(t),a=function(e){var t={};return e.forEach((function(e,r){t[e]=!0})),t}(o);if(e.showHidden&&(o=Object.getOwnPropertyNames(t)),De(t)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return _e(t);if(0===o.length){if(Le(t)){var s=t.name?": "+t.name:"";return e.stylize("[Function"+s+"]","special")}if(Oe(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Be(t))return e.stylize(Date.prototype.toString.call(t),"date");if(De(t))return _e(t)}var u,c="",l=!1,d=["{","}"];(Te(t)&&(l=!0,d=["[","]"]),Le(t))&&(c=" [Function"+(t.name?": "+t.name:"")+"]");return Oe(t)&&(c=" "+RegExp.prototype.toString.call(t)),Be(t)&&(c=" "+Date.prototype.toUTCString.call(t)),De(t)&&(c=" "+_e(t)),0!==o.length||l&&0!=t.length?r<0?Oe(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),u=l?function(e,t,r,n,i){for(var o=[],a=0,s=t.length;a<s;++a)xe(t,String(a))?o.push(Ie(e,t,r,n,String(a),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(Ie(e,t,r,n,i,!0))})),o}(e,t,r,a,o):o.map((function(n){return Ie(e,t,r,a,n,l)})),e.seen.pop(),function(e,t,r){var n=e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(n>60)return r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1];return r[0]+t+" "+e.join(", ")+" "+r[1]}(u,c,d)):d[0]+c+d[1]}function _e(e){return"["+Error.prototype.toString.call(e)+"]"}function Ie(e,t,r,n,i,o){var a,s,u;if((u=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?s=u.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):u.set&&(s=e.stylize("[Setter]","special")),xe(n,i)||(a="["+i+"]"),s||(e.seen.indexOf(u.value)<0?(s=Se(r)?Ee(e,u.value,null):Ee(e,u.value,r-1)).indexOf("\n")>-1&&(s=o?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),Ne(a)){if(o&&i.match(/^\d+$/))return s;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+s}function Te(e){return Array.isArray(e)}function we(e){return"boolean"==typeof e}function Se(e){return null===e}function Ce(e){return"number"==typeof e}function be(e){return"string"==typeof e}function Ne(e){return void 0===e}function Oe(e){return Re(e)&&"[object RegExp]"===Pe(e)}function Re(e){return"object"===ce(e)&&null!==e}function Be(e){return Re(e)&&"[object Date]"===Pe(e)}function De(e){return Re(e)&&("[object Error]"===Pe(e)||e instanceof Error)}function Le(e){return"function"==typeof e}function Pe(e){return Object.prototype.toString.call(e)}function Me(e,t){if(!t||!Re(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}function xe(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Ue=me,ke=function e(t,n){if(Ne(r.g.process))return function(){return e(t,n).apply(this,arguments)};var i=!1;return function(){return i||(o.error(n),i=!0),t.apply(this,arguments)}},qe=(()=>ne.Buffer)(),Qe=ke,Fe=(0,Ae.randomBytes)(5),He=new RegExp("^[0-9a-fA-F]{24}$"),Ge=function(){var e=!1;try{qe&&qe.from&&(e=!0)}catch(t){e=!1}return e}(),We=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<=15?"0":"")+t.toString(16);return e}(),je=function(){for(var e=[],t=0;t<10;)e[48+t]=t++;for(;t<16;)e[55+t]=e[87+t]=t++;return e}(),$e=qe;var Ye=function(){function e(t){if(oe(this,e),t instanceof e)return t;if(null==t||"number"==typeof t)return this.id=e.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var r=e.isValid(t);if(!r&&null!=t)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(r&&"string"==typeof t&&24===t.length&&Ge)return new e(qe.from(t,"hex"));if(r&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return e.createFromHexString(t.toHexString());throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))}return se(e,[{key:"toHexString",value:function(){if(e.cacheHexString&&this.__id)return this.__id;var t,r,n,i="";if(!this.id||!this.id.length)throw new TypeError("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof $e)return i=this.id.toString("hex"),e.cacheHexString&&(this.__id=i),i;for(var o=0;o<this.id.length;o++){var a=We[this.id.charCodeAt(o)];if("string"!=typeof a)throw t=this.id,n=void 0,n=t[r=o],new TypeError('ObjectId string "'.concat(t,'" contains invalid character "').concat(n,'" with character code (').concat(t.charCodeAt(r),"). All character codes for a non-hex string must be less than 256."));i+=a}return e.cacheHexString&&(this.__id=i),i}},{key:"toString",value:function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()}},{key:"toJSON",value:function(){return this.toHexString()}},{key:"equals",value:function(t){return t instanceof e?this.toString()===t.toString():"string"==typeof t&&e.isValid(t)&&12===t.length&&this.id instanceof $e?t===this.id.toString("binary"):"string"==typeof t&&e.isValid(t)&&24===t.length?t.toLowerCase()===this.toHexString():"string"==typeof t&&e.isValid(t)&&12===t.length?t===this.id:!(null==t||!(t instanceof e||t.toHexString))&&t.toHexString()===this.toHexString()}},{key:"getTimestamp",value:function(){var e=new Date,t=this.id.readUInt32BE(0);return e.setTime(1e3*Math.floor(t)),e}},{key:"toExtendedJSON",value:function(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}}],[{key:"getInc",value:function(){return e.index=(e.index+1)%16777215}},{key:"generate",value:function(t){"number"!=typeof t&&(t=~~(Date.now()/1e3));var r=e.getInc(),n=qe.alloc(12);return n[3]=255&t,n[2]=t>>8&255,n[1]=t>>16&255,n[0]=t>>24&255,n[4]=Fe[0],n[5]=Fe[1],n[6]=Fe[2],n[7]=Fe[3],n[8]=Fe[4],n[11]=255&r,n[10]=r>>8&255,n[9]=r>>16&255,n}},{key:"createPk",value:function(){return new e}},{key:"createFromTime",value:function(t){var r=qe.from([0,0,0,0,0,0,0,0,0,0,0,0]);return r[3]=255&t,r[2]=t>>8&255,r[1]=t>>16&255,r[0]=t>>24&255,new e(r)}},{key:"createFromHexString",value:function(t){if(void 0===t||null!=t&&24!==t.length)throw new TypeError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(Ge)return new e(qe.from(t,"hex"));for(var r=new $e(12),n=0,i=0;i<24;)r[n++]=je[t.charCodeAt(i++)]<<4|je[t.charCodeAt(i++)];return new e(r)}},{key:"isValid",value:function(t){return null!=t&&("number"==typeof t||("string"==typeof t?12===t.length||24===t.length&&He.test(t):t instanceof e||(t instanceof $e&&12===t.length||!!t.toHexString&&(12===t.id.length||24===t.id.length&&He.test(t.id)))))}},{key:"fromExtendedJSON",value:function(t){return new e(t.$oid)}}]),e.get_inc=Qe((function(){return e.getInc()}),"Please use the static `ObjectId.getInc()` instead"),e.prototype.get_inc=Qe((function(){return e.getInc()}),"Please use the static `ObjectId.getInc()` instead"),e.prototype.getInc=Qe((function(){return e.getInc()}),"Please use the static `ObjectId.getInc()` instead"),e.prototype.generate=Qe((function(t){return e.generate(t)}),"Please use the static `ObjectId.generate(time)` instead"),Object.defineProperty(e.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.prototype[Ue.custom||"inspect"]=e.prototype.toString,e.index=~~(16777215*Math.random()),Object.defineProperty(e.prototype,"_bsontype",{value:"ObjectID"}),e}(),Je=Ye;var Ke=function(){function e(t,r){oe(this,e),this.pattern=t||"",this.options=r?r.split("").sort().join(""):"";for(var n=0;n<this.options.length;n++)if("i"!==this.options[n]&&"m"!==this.options[n]&&"x"!==this.options[n]&&"l"!==this.options[n]&&"s"!==this.options[n]&&"u"!==this.options[n])throw new Error("The regular expression option [".concat(this.options[n],"] is not supported"))}return se(e,[{key:"toExtendedJSON",value:function(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}}],[{key:"parseOptions",value:function(e){return e?e.split("").sort().join(""):""}},{key:"fromExtendedJSON",value:function(t){return t.$regex?"BSONRegExp"===t.$regex._bsontype?t:new e(t.$regex,e.parseOptions(t.$options)):new e(t.$regularExpression.pattern,e.parseOptions(t.$regularExpression.options))}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"BSONRegExp"}),e}(),ze=function(){function e(t){oe(this,e),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toString",value:function(){return this.value}},{key:"inspect",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(){return{$symbol:this.value}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$symbol)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Symbol"}),e}(),Xe=function(){function e(t){oe(this,e),t instanceof Number&&(t=t.valueOf()),this.value=t}return se(e,[{key:"valueOf",value:function(){return this.value}},{key:"toJSON",value:function(){return this.value}},{key:"toExtendedJSON",value:function(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}}],[{key:"fromExtendedJSON",value:function(t,r){return r&&r.relaxed?parseInt(t.$numberInt,10):new e(t.$numberInt)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Int32"}),e}(),Ve=function(){function e(t,r){oe(this,e),this.code=t,this.scope=r}return se(e,[{key:"toJSON",value:function(){return{scope:this.scope,code:this.code}}},{key:"toExtendedJSON",value:function(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}}],[{key:"fromExtendedJSON",value:function(t){return new e(t.$code,t.$scope)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"Code"}),e}(),Ze=Ve,et=(()=>ne.Buffer)(),tt=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,rt=/^(\+|-)?(Infinity|inf)$/i,nt=/^(\+|-)?NaN$/i,it=6111,ot=-6176,at=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),st=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ut=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),ct=/^([-+])?(\d+)?$/;function lt(e){return!isNaN(parseInt(e,10))}function dt(e){var t=ie.fromNumber(1e9),r=ie.fromNumber(0);if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:r};for(var n=0;n<=3;n++)r=(r=r.shiftLeft(32)).add(new ie(e.parts[n],0)),e.parts[n]=r.div(t).low,r=r.modulo(t);return{quotient:e,rem:r}}function ft(e,t){throw new TypeError('"'.concat(e,'" is not a valid Decimal128 string - ').concat(t))}var ht=function(){function e(e){this.bytes=e}e.fromString=function(t){var r,n=!1,i=!1,o=!1,a=0,s=0,u=0,c=0,l=0,d=[0],f=0,h=0,p=0,g=0,A=0,m=0,y=[0,0],v=[0,0],E=0;if(t.length>=7e3)throw new TypeError(t+" not a valid Decimal128 string");var _=t.match(tt),I=t.match(rt),T=t.match(nt);if(!_&&!I&&!T||0===t.length)throw new TypeError(t+" not a valid Decimal128 string");if(_){var w=_[2],S=_[4],C=_[5],b=_[6];S&&void 0===b&&ft(t,"missing exponent power"),S&&void 0===w&&ft(t,"missing exponent base"),void 0===S&&(C||b)&&ft(t,"missing e before exponent")}if("+"!==t[E]&&"-"!==t[E]||(n="-"===t[E++]),!lt(t[E])&&"."!==t[E]){if("i"===t[E]||"I"===t[E])return new e(et.from(n?st:ut));if("N"===t[E])return new e(et.from(at))}for(;lt(t[E])||"."===t[E];)"."!==t[E]?(f<34&&("0"!==t[E]||o)&&(o||(l=s),o=!0,d[h++]=parseInt(t[E],10),f+=1),o&&(u+=1),i&&(c+=1),s+=1,E+=1):(i&&ft(t,"contains multiple periods"),i=!0,E+=1);if(i&&!s)throw new TypeError(t+" not a valid Decimal128 string");if("e"===t[E]||"E"===t[E]){var N=t.substr(++E).match(ct);if(!N||!N[2])return new e(et.from(at));A=parseInt(N[0],10),E+=N[0].length}if(t[E])return new e(et.from(at));if(p=0,f){if(g=f-1,1!==(a=u))for(;"0"===t[l+a-1];)a-=1}else p=0,g=0,d[0]=0,u=1,f=1,a=0;for(A<=c&&c-A>16384?A=ot:A-=c;A>it;){if((g+=1)-p>34){if(d.join("").match(/^0+$/)){A=it;break}ft(t,"overflow")}A-=1}for(;A<ot||f<u;){if(0===g&&a<f){A=ot,a=0;break}if(f<u?u-=1:g-=1,A<it)A+=1;else{if(d.join("").match(/^0+$/)){A=it;break}ft(t,"overflow")}}if(g-p+1<a){var O=s;i&&(l+=1,O+=1),n&&(l+=1,O+=1);var R=parseInt(t[l+g+1],10),B=0;if(R>=5&&(B=1,5===R))for(B=d[g]%2==1,m=l+g+2;m<O;m++)if(parseInt(t[m],10)){B=1;break}if(B)for(var D=g;D>=0;D--)if(++d[D]>9&&(d[D]=0,0===D)){if(!(A<it))return new e(et.from(n?st:ut));A+=1,d[D]=1}}if(y=ie.fromNumber(0),v=ie.fromNumber(0),0===a)y=ie.fromNumber(0),v=ie.fromNumber(0);else if(g-p<17){var L=p;for(v=ie.fromNumber(d[L++]),y=new ie(0,0);L<=g;L++)v=(v=v.multiply(ie.fromNumber(10))).add(ie.fromNumber(d[L]))}else{var P=p;for(y=ie.fromNumber(d[P++]);P<=g-17;P++)y=(y=y.multiply(ie.fromNumber(10))).add(ie.fromNumber(d[P]));for(v=ie.fromNumber(d[P++]);P<=g;P++)v=(v=v.multiply(ie.fromNumber(10))).add(ie.fromNumber(d[P]))}var M,x,U,k,q=function(e,t){if(!e&&!t)return{high:ie.fromNumber(0),low:ie.fromNumber(0)};var r=e.shiftRightUnsigned(32),n=new ie(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new ie(t.getLowBits(),0),a=r.multiply(i),s=r.multiply(o),u=n.multiply(i),c=n.multiply(o);return a=a.add(s.shiftRightUnsigned(32)),s=new ie(s.getLowBits(),0).add(u).add(c.shiftRightUnsigned(32)),{high:a=a.add(s.shiftRightUnsigned(32)),low:c=s.shiftLeft(32).add(new ie(c.getLowBits(),0))}}(y,ie.fromString("100000000000000000"));q.low=q.low.add(v),M=q.low,x=v,U=M.high>>>0,k=x.high>>>0,(U<k||U===k&&M.low>>>0<x.low>>>0)&&(q.high=q.high.add(ie.fromNumber(1))),r=A+6176;var Q={low:ie.fromNumber(0),high:ie.fromNumber(0)};q.high.shiftRightUnsigned(49).and(ie.fromNumber(1)).equals(ie.fromNumber(1))?(Q.high=Q.high.or(ie.fromNumber(3).shiftLeft(61)),Q.high=Q.high.or(ie.fromNumber(r).and(ie.fromNumber(16383).shiftLeft(47))),Q.high=Q.high.or(q.high.and(ie.fromNumber(0x7fffffffffff)))):(Q.high=Q.high.or(ie.fromNumber(16383&r).shiftLeft(49)),Q.high=Q.high.or(q.high.and(ie.fromNumber(562949953421311)))),Q.low=q.low,n&&(Q.high=Q.high.or(ie.fromString("9223372036854775808")));var F=et.alloc(16);return E=0,F[E++]=255&Q.low.low,F[E++]=Q.low.low>>8&255,F[E++]=Q.low.low>>16&255,F[E++]=Q.low.low>>24&255,F[E++]=255&Q.low.high,F[E++]=Q.low.high>>8&255,F[E++]=Q.low.high>>16&255,F[E++]=Q.low.high>>24&255,F[E++]=255&Q.high.low,F[E++]=Q.high.low>>8&255,F[E++]=Q.high.low>>16&255,F[E++]=Q.high.low>>24&255,F[E++]=255&Q.high.high,F[E++]=Q.high.high>>8&255,F[E++]=Q.high.high>>16&255,F[E++]=Q.high.high>>24&255,new e(F)};return e.prototype.toString=function(){for(var e,t,r,n,i,o,a=0,s=new Array(36),u=0;u<s.length;u++)s[u]=0;var c,l,d,f,h,p=0,g=!1,A={parts:new Array(4)},m=[];p=0;var y=this.bytes;if(n=y[p++]|y[p++]<<8|y[p++]<<16|y[p++]<<24,r=y[p++]|y[p++]<<8|y[p++]<<16|y[p++]<<24,t=y[p++]|y[p++]<<8|y[p++]<<16|y[p++]<<24,e=y[p++]|y[p++]<<8|y[p++]<<16|y[p++]<<24,p=0,{low:new ie(n,r),high:new ie(t,e)}.high.lessThan(ie.ZERO)&&m.push("-"),(i=e>>26&31)>>3==3){if(30===i)return m.join("")+"Infinity";if(31===i)return"NaN";o=e>>15&16383,d=8+(e>>14&1)}else d=e>>14&7,o=e>>17&16383;if(c=o-6176,A.parts[0]=(16383&e)+((15&d)<<14),A.parts[1]=t,A.parts[2]=r,A.parts[3]=n,0===A.parts[0]&&0===A.parts[1]&&0===A.parts[2]&&0===A.parts[3])g=!0;else for(h=3;h>=0;h--){var v=0,E=dt(A);if(A=E.quotient,v=E.rem.low)for(f=8;f>=0;f--)s[9*h+f]=v%10,v=Math.floor(v/10)}if(g)a=1,s[p]=0;else for(a=36;!s[p];)a-=1,p+=1;if((l=a-1+c)>=34||l<=-7||c>0){if(a>34)return m.push(0),c>0?m.push("E+"+c):c<0&&m.push("E"+c),m.join("");m.push(s[p++]),(a-=1)&&m.push(".");for(var _=0;_<a;_++)m.push(s[p++]);m.push("E"),l>0?m.push("+"+l):m.push(l)}else if(c>=0)for(var I=0;I<a;I++)m.push(s[p++]);else{var T=a+c;if(T>0)for(var w=0;w<T;w++)m.push(s[p++]);else m.push("0");for(m.push(".");T++<0;)m.push("0");for(var S=0;S<a-Math.max(T-1,0);S++)m.push(s[p++])}return m.join("")},e.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.prototype.toExtendedJSON=function(){return{$numberDecimal:this.toString()}},e.fromExtendedJSON=function(t){return e.fromString(t.$numberDecimal)},Object.defineProperty(e.prototype,"_bsontype",{value:"Decimal128"}),e}(),pt=ht,gt=function(){function e(){oe(this,e)}return se(e,[{key:"toExtendedJSON",value:function(){return{$minKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MinKey"}),e}(),At=function(){function e(){oe(this,e)}return se(e,[{key:"toExtendedJSON",value:function(){return{$maxKey:1}}}],[{key:"fromExtendedJSON",value:function(){return new e}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"MaxKey"}),e}(),mt=function(){function e(t,r,n,i){oe(this,e);var o=t.split(".");2===o.length&&(n=o.shift(),t=o.shift()),this.collection=t,this.oid=r,this.db=n,this.fields=i||{}}return se(e,[{key:"toJSON",value:function(){var e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}},{key:"toExtendedJSON",value:function(e){e=e||{};var t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}}],[{key:"fromExtendedJSON",value:function(t){var r=Object.assign({},t);return["$ref","$id","$db"].forEach((function(e){return delete r[e]})),new e(t.$ref,t.$id,t.$db,r)}}]),Object.defineProperty(e.prototype,"_bsontype",{value:"DBRef"}),Object.defineProperty(e.prototype,"namespace",{get:function(){return this.collection},set:function(e){this.collection=e},configurable:!1}),e}(),yt=(()=>ne.Buffer)(),vt=function(){function e(r,n){if(oe(this,e),!(null==r||"string"==typeof r||yt.isBuffer(r)||r instanceof Uint8Array||Array.isArray(r)))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");if(this.sub_type=null==n?t:n,this.position=0,null==r||r instanceof Number)void 0!==yt?this.buffer=yt.alloc(e.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE)):this.buffer=new Array(e.BUFFER_SIZE);else{if("string"==typeof r)if(void 0!==yt)this.buffer=yt.from(r);else{if("undefined"==typeof Uint8Array&&!Array.isArray(r))throw new TypeError("only String, Buffer, Uint8Array or Array accepted");this.buffer=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(r)}else this.buffer=r;this.position=r.length}}se(e,[{key:"put",value:function(t){if(null!=t.length&&"number"!=typeof t&&1!==t.length)throw new TypeError("only accepts single character String, Uint8Array or Array");if("number"!=typeof t&&t<0||t>255)throw new TypeError("only accepts number in a valid unsigned byte range 0-255");var n=null;if(n="string"==typeof t?t.charCodeAt(0):null!=t.length?t[0]:t,this.buffer.length>this.position)this.buffer[this.position++]=n;else if(void 0!==yt&&yt.isBuffer(this.buffer)){var i=yt.alloc(e.BUFFER_SIZE+this.buffer.length);this.buffer.copy(i,0,0,this.buffer.length),this.buffer=i,this.buffer[this.position++]=n}else{var o=null;o=r(this.buffer)?new Uint8Array(new ArrayBuffer(e.BUFFER_SIZE+this.buffer.length)):new Array(e.BUFFER_SIZE+this.buffer.length);for(var a=0;a<this.buffer.length;a++)o[a]=this.buffer[a];this.buffer=o,this.buffer[this.position++]=n}}},{key:"write",value:function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==yt&&yt.isBuffer(this.buffer))n=yt.alloc(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if(r(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var i=0;i<this.position;i++)n[i]=this.buffer[i]}this.buffer=n}if(void 0!==yt&&yt.isBuffer(e)&&yt.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==yt&&"string"==typeof e&&yt.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if(r(e)||Array.isArray(e)&&"string"!=typeof e){for(var o=0;o<e.length;o++)this.buffer[t++]=e[o];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(var a=0;a<e.length;a++)this.buffer[t++]=e.charCodeAt(a);this.position=t>this.position?t:this.position}}},{key:"read",value:function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var r="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),n=0;n<t;n++)r[n]=this.buffer[e++];return r}},{key:"value",value:function(e){if((e=null!=e&&e)&&void 0!==yt&&yt.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==yt&&yt.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t=r(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return function(e,t,r){for(var n="",i=t;i<r;i++)n+=String.fromCharCode(e[i]);return n}(this.buffer,0,this.position)}},{key:"length",value:function(){return this.position}},{key:"toJSON",value:function(){return null!=this.buffer?this.buffer.toString("base64"):""}},{key:"toString",value:function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""}},{key:"toExtendedJSON",value:function(e){e=e||{};var t=yt.isBuffer(this.buffer)?this.buffer.toString("base64"):yt.from(this.buffer).toString("base64"),r=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===r.length?"0"+r:r}:{$binary:{base64:t,subType:1===r.length?"0"+r:r}}}}],[{key:"fromExtendedJSON",value:function(t,r){var n,i;return(r=r||{}).legacy?(i=t.$type?parseInt(t.$type,16):0,n=yt.from(t.$binary,"base64")):(i=t.$binary.subType?parseInt(t.$binary.subType,16):0,n=yt.from(t.$binary.base64,"base64")),new e(n,i)}}]);var t=0;function r(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}return e.BUFFER_SIZE=256,e.SUBTYPE_DEFAULT=0,e.SUBTYPE_FUNCTION=1,e.SUBTYPE_BYTE_ARRAY=2,e.SUBTYPE_UUID_OLD=3,e.SUBTYPE_UUID=4,e.SUBTYPE_MD5=5,e.SUBTYPE_USER_DEFINED=128,Object.defineProperty(e.prototype,"_bsontype",{value:"Binary"}),e}(),Et=vt,_t=(Math.pow(2,63),Math.pow(2,63),{$oid:Je,$binary:Et,$symbol:ze,$numberInt:Xe,$numberDecimal:pt,$numberDouble:ue,$numberLong:ie,$minKey:gt,$maxKey:At,$regex:Ke,$regularExpression:Ke,$timestamp:he});function It(e,t,r,n){if("number"==typeof r){if(n.relaxed||n.legacy)return r;if(Math.floor(r)===r){if(r>=St&&r<=wt)return new Xe(r);if(r>=bt&&r<=Ct)return new ie.fromNumber(r)}return new ue(r)}if(null==r||"object"!==ce(r))return r;if(r.$undefined)return null;for(var i=Object.keys(r).filter((function(e){return e.startsWith("$")&&null!=r[e]})),o=0;o<i.length;o++){var a=_t[i[o]];if(a)return a.fromExtendedJSON(r,n)}if(null!=r.$date){var s=r.$date,u=new Date;return n.legacy?"number"==typeof s?u.setTime(s):"string"==typeof s&&u.setTime(Date.parse(s)):"string"==typeof s?u.setTime(Date.parse(s)):ie.isLong(s)?u.setTime(s.toNumber()):"number"==typeof s&&n.relaxed&&u.setTime(s),u}if(null!=r.$code){var c=Object.assign({},r);return r.$scope&&(c.$scope=It(e,null,r.$scope)),Ze.fromExtendedJSON(r)}if(null!=r.$ref||null!=r.$dbPointer){var l=r.$ref?r:r.$dbPointer;if(l instanceof mt)return l;var d=Object.keys(l).filter((function(e){return e.startsWith("$")})),f=!0;if(d.forEach((function(e){-1===["$ref","$id","$db"].indexOf(e)&&(f=!1)})),f)return mt.fromExtendedJSON(l)}return r}function Tt(e,t){var r=this;return"boolean"==typeof(t=Object.assign({},{relaxed:!0,legacy:!1},t)).relaxed&&(t.strict=!t.relaxed),"boolean"==typeof t.strict&&(t.relaxed=!t.strict),JSON.parse(e,(function(e,n){return It(r,0,n,t)}))}var wt=2147483647,St=-2147483648,Ct=0x8000000000000000,bt=-0x8000000000000000;function Nt(e,t,r,n){null!=r&&"object"===ce(r)&&(n=r,r=0),null==t||"object"!==ce(t)||Array.isArray(t)||(n=t,t=null,r=0),n=Object.assign({},{relaxed:!0,legacy:!1},n);var i=Array.isArray(e)?Ot(e,n):Lt(e,n);return JSON.stringify(i,t,r)}function Ot(e,t){return e.map((function(e){return Bt(e,t)}))}function Rt(e){var t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}function Bt(e,t){if(Array.isArray(e))return Ot(e,t);if(void 0===e)return null;if(e instanceof Date){var r=e.getTime(),n=r>-1&&r<2534023188e5;return t.legacy?t.relaxed&&n?{$date:e.getTime()}:{$date:Rt(e)}:t.relaxed&&n?{$date:Rt(e)}:{$date:{$numberLong:e.getTime().toString()}}}if("number"==typeof e&&!t.relaxed){if(Math.floor(e)===e){var i=e>=bt&&e<=Ct;if(e>=St&&e<=wt)return{$numberInt:e.toString()};if(i)return{$numberLong:e.toString()}}return{$numberDouble:e.toString()}}if(e instanceof RegExp){var o=e.flags;return void 0===o&&(o=e.toString().match(/[gimuy]*$/)[0]),new Ke(e.source,o).toExtendedJSON(t)}return null!=e&&"object"===ce(e)?Lt(e,t):e}var Dt={Binary:function(e){return new Et(e.value(),e.subtype)},Code:function(e){return new Ze(e.code,e.scope)},DBRef:function(e){return new mt(e.collection||e.namespace,e.oid,e.db,e.fields)},Decimal128:function(e){return new pt(e.bytes)},Double:function(e){return new ue(e.value)},Int32:function(e){return new Xe(e.value)},Long:function(e){return ie.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_)},MaxKey:function(){return new At},MinKey:function(){return new gt},ObjectID:function(e){return new Je(e)},ObjectId:function(e){return new Je(e)},BSONRegExp:function(e){return new Ke(e.pattern,e.options)},Symbol:function(e){return new ze(e.value)},Timestamp:function(e){return he.fromBits(e.low,e.high)}};function Lt(e,t){if(null==e||"object"!==ce(e))throw new Error("not an object instance");var r=e._bsontype;if(void 0===r){var n={};for(var i in e)n[i]=Bt(e[i],t);return n}if("string"==typeof r){var o=e;if("function"!=typeof o.toExtendedJSON){var a=Dt[r];if(!a)throw new TypeError("Unrecognized or invalid _bsontype: "+r);o=a(o)}return"Code"===r&&o.scope?o=new Ze(o.code,Bt(o.scope,t)):"DBRef"===r&&o.oid&&(o=new mt(o.collection,Bt(o.oid,t),o.db,o.fields)),o.toExtendedJSON(t)}throw new Error("_bsontype must be a string, but was: "+ce(r))}var Pt={parse:Tt,deserialize:function(e,t){return t=t||{},Tt(JSON.stringify(e),t)},serialize:function(e,t){return t=t||{},JSON.parse(Nt(e,t))},stringify:Nt};t.EJSON=Pt}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var l={};(()=>{"use strict";var e={};r.r(e),r.d(e,{getServiceMarketAPI:()=>Zr});var t={};r.r(t),r.d(t,{GeoLineString:()=>lo,GeoMultiLineString:()=>ho,GeoMultiPoint:()=>uo,GeoMultiPolygon:()=>mo,GeoPoint:()=>ao,GeoPolygon:()=>go,LineString:()=>co,MultiLineString:()=>fo,MultiPoint:()=>so,MultiPolygon:()=>Ao,Point:()=>oo,Polygon:()=>po,__safe_props__:()=>yo});var l={};r.r(l),r.d(l,{AggregateOperatorMap:()=>Ts,AggregateSerializer:()=>Rs,Decoder:()=>Hs,OperatorMap:()=>Is,ProjectionSerializer:()=>Fs,QuerySerializer:()=>Ds,UpdateSerializer:()=>ks,aggregateOperatorToString:()=>Os,decodeInternalDataType:()=>Wo,encode:()=>Ls,encodeInternalDataType:()=>Go,extractQueryOptions:()=>jo,flattenObject:()=>Qo,flattenQueryObject:()=>qo,getProjectionDefinition:()=>Yo,isConversionRequired:()=>Ho,mergeConditionAfterEncode:()=>Fo,operatorToString:()=>Ns});var d={};r.r(d),r.d(d,{DefaultCloud:()=>ku,InstanceCloud:()=>qu,getCloudAPI:()=>Uu,getCloudInstance:()=>xu});var f=r(426),h=r.n(f);function p(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}const g=function e(t,r){if(t===r)return t;for(var n of Object.keys(r)){var i=p(r,n),o=p(t,n),a=void 0;"object"==typeof i?e(a=o||{},i):a=i,t[n]=a}return t};var A=e=>Object.prototype.toString.call(e).slice(8,-1).toLowerCase(),m=e=>"object"===A(e),y=e=>"string"===A(e),v=e=>"number"===A(e),E=e=>"function"==typeof e,_=e=>Array.isArray(e),I=e=>"date"===A(e),T=e=>"regexp"===A(e),w=e=>e&&"symbol"===A(e._internalType),S={"-1":"",UNKNOWN_ERROR:-1,"-401001":"api permission denied",SDK_API_PERMISSION_DENIED:-401001,"-401002":"api parameter error",SDK_API_PARAMETER_ERROR:-401002,"-401003":"api parameter type error",SDK_API_PARAMETER_TYPE_ERROR:-401003,"-402001":"circular reference detected",SDK_DATABASE_CIRCULAR_REFERENCE:-402001,"-402002":"realtime listener init watch fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:-402002,"-402003":"realtime listener reconnect ws fail",SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL:-402003,"-402004":"realtime listener rebuild watch fail",SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL:-402004,"-402005":"realtime listener close watch fail",SDK_DATABASE_REALTIME_LISTENER_CLOSE_WATCH_FAIL:-402005,"-402006":"realtime listener receive server error msg",SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG:-402006,"-402007":"realtime listener receive invalid server data",SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA:-402007,"-402008":"realtime listener websocket connection error",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_ERROR:-402008,"-402009":"realtime listener websocket connection closed",SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED:-402009,"-402010":"realtime listener check last fail",SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL:-402010,"-402011":"realtime listener unexpected fatal error",SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR:-402011,"-402012":"realtime listener init ws fail",SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL:-402012,"-403001":"max upload file size exceeded",SDK_STORAGE_EXCEED_MAX_UPLOAD_SIZE:-403001,"-403002":"internal server error: empty upload url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL:-403002,"-403003":"internal server error: empty download url",SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL:-403003,"-404001":"empty call result",SDK_FUNCTIONS_EMPTY_CALL_RESULT:-404001,"-404002":"empty event id",SDK_FUNCTIONS_EMPTY_EVENT_ID:-404002,"-404003":"empty poll url",SDK_FUNCTIONS_EMPTY_POLL_URL:-404003,"-404004":"empty poll result json",SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON:-404004,"-404005":"exceed max poll retry",SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY:-404005,"-404006":"empty poll result base resp",SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP:-404006,"-404007":"poll result base resp ret abnormal",SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-404007,"-404008":"poll result status code error",SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR:-404008,"-404009":"poll error",SDK_FUNCTIONS_POLL_ERROR:-404009,"-404010":"result expired",SDK_FUNCTIONS_POLL_RESULT_EXPIRED:-404010,"-404011":"cloud function execution error",SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR:-404011,"-404012":"polling exceed max timeout retry",SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY:-404012,"-404013":"polling exceed max system error retry",SDK_FUNCTIONS_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-404013,"-405001":"empty call result",SDK_CONTAINER_EMPTY_CALL_RESULT:-405001,"-405002":"empty event id",SDK_CONTAINER_EMPTY_EVENT_ID:-405002,"-405003":"empty poll url",SDK_CONTAINER_EMPTY_POLL_URL:-405003,"-405004":"empty poll result json",SDK_CONTAINER_EMPTY_POLL_RESULT_JSON:-405004,"-405005":"exceed max poll retry",SDK_CONTAINER_EXCEED_MAX_POLL_RETRY:-405005,"-405006":"empty poll result base resp",SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP:-405006,"-405007":"poll result base resp ret abnormal",SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL:-405007,"-405008":"poll result status code error",SDK_CONTAINER_POLL_RESULT_STATUS_CODE_ERROR:-405008,"-405009":"poll error",SDK_CONTAINER_POLL_ERROR:-405009,"-405010":"result expired",SDK_CONTAINER_POLL_RESULT_EXPIRED:-405010,"-405012":"polling exceed max timeout retry",SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY:-405012,"-405013":"polling exceed max system error retry",SDK_CONTAINER_EXCEED_MAX_SYSTEM_ERROR_POLL_RETRY:-405013,"-405014":"cannot download result (cdn)",SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL:-405014,"-601001":"system error",WX_SYSTEM_ERROR:-601001,"-601002":"system args error",WX_SYSTEM_ARGS_ERROR:-601002,"-601003":"system network error",WX_SYSTEM_NETWORK_ERROR:-601003,"-601004":"api permission denied",WX_API_PERMISSION_DENIED:-601004,"-601005":"invalid cloudID",WX_INVALID_CLOUDID:-601005,"-601006":"cloudID expired",WX_CLOUDID_EXPIRED:-601006,"-601007":"cloudID and calling user does not match",WX_CLOUDID_USER_NOT_MATCH:-601007,"-601008":"server-side request timedout",WX_SERVER_REQUEST_TIMEOUT:-601008,"-601009":"missing mobile phone",WX_MISSING_MOBILE_PHONE:-601009,"-601010":"no write permission",WX_NO_WRITE_PERMISSION:-601010,"-601011":"no privilege permission",WX_NO_PRIVILEGE_PERMISSION:-601011,"-601012":"unauthorized env",WX_UNAUTHORIZED_ENV:-601012,"-601013":"no multiend permission",WX_NO_MULTIEND_PERMISSION:-601013,"-601015":"access denied (cloudfunction cloudbase_auth returns empty errCode)",WX_CLOUDBASE_AUTH_RETURN_EMPTY_ERRCODE:-601015,"-601016":"missing env auth info",WX_MISSING_ENV_AUTH_INFO:-601016,"-601017":"access denied (cloudbase_auth returns non-zero errCode)",WX_CLOUDBASE_AUTH_RETURN_NON_ZERO_ERRCODE:-601017,"-602018":"unauthorized API",WX_UNAUTHORIZED_API:-601018,"-602001":"database query result size exceed limit (1MB)",WX_DATABASE_QUERY_SIZE_EXCEED_LIMIT:-602001,"-604001":"cloudfunction result size exceed limit (1MB)",WX_CLOUDFUNCTION_RESULT_SIZE_EXCEED_LIMIT:-604001,"-501001":"resource system error",TCB_RESOURCE_SYSTEM_ERROR:-501001,"-501002":"resource server timeout",TCB_RESOURCE_SERVER_TIMEOUT:-501002,"-501003":"exceed request limit",TCB_EXCEED_REQUEST_LIMIT:-501003,"-501004":"exceed concurrent request limit",TCB_EXCEED_CONCURRENT_REQUEST_LIMIT:-501004,"-501005":"invalid env",TCB_INVALID_ENV:-501005,"-501006":"invalid common parameters",TCB_INVALID_COMMON_PARAM:-501006,"-501007":"invalid parameters",TCB_INVALID_PARAM:-501007,"-501008":"invalid request source",TCB_INVALID_REQUEST_SOURCE:-501008,"-501009":"resource not initialized",TCB_RESOURCE_NOT_INITIALIZED:-501009,"-501010":"tencentcloud key signature verification fail",TCB_KEY_SIGNATURE_VERIFICATION_FAIL:-501010,"-501011":"invalid env status",TCB_INVALID_ENV_STATUS:-501011,"-501012":"invalid api name",TCB_INVALID_API_NAME:-501012,"-501013":"request data size exceeds limit (5M)",TCB_REQ_DATA_EXCEED_LIMIT_5M:-501013,"-501014":"upload file size exceeds limit (5M)",TCB_UPLOAD_FILE_SIZE_EXCEED_LIMIT_5M:-501014,"-501023":"permission denied",TCB_PERMISSION_DENIED:-501023,"-502001":"database request fail",TCB_DB_REQUEST_FAIL:-502001,"-502002":"database invalid command",TCB_DB_INVALID_COMMAND:-502002,"-502003":"database permission denied",TCB_DB_PERMISSION_DENIED:-502003,"-502004":"database exceed collection limit",TCB_DB_EXCEED_COLLECTION_LIMIT:-502004,"-502005":"database collection not exists",TCB_DB_COLLECTION_NOT_EXISTS:-502005,"-503001":"storage request fail",TCB_STORAGE_REQUEST_FAIL:-503001,"-503002":"storage permission denied",TCB_STORAGE_PERMISSION_DENIED:-503002,"-503003":"storage file not exists",TCB_STORAGE_FILE_NOT_EXISTS:-503003,"-503004":"storage invalid sign parameter",TCB_STORAGE_INVALID_SIGN_PARAM:-503004,"-504001":"functions request fail",TCB_FUNCTIONS_REQUEST_FAIL:-504001,"-504002":"functions execute fail",TCB_FUNCTIONS_EXEC_FAIL:-504002};class C extends Error{constructor(e){super(e.errMsg),this.errCode=-1,this.errMsg=void 0,this.requestID=void 0,Object.defineProperties(this,{message:{get(){return`errCode: ${this.errCode} ${S[this.errCode]||""} | errMsg: `+this.errMsg},set(e){this.errMsg=e}}}),this.errCode=e.errCode||-1,this.errMsg=e.errMsg}get message(){return`errCode: ${this.errCode} | errMsg: `+this.errMsg}set message(e){this.errMsg=e}}function b(e){return e&&e instanceof Error&&y(e.errMsg)}function N(e,t){return O(e,t)}function O(e,t){if(e){if(b(e))return e;var r,n=`${t}:fail `;if(e instanceof Error)e.message=`${n}${e.message}`,e.stack=e.stack?e.stack.slice(0,7)+n+e.stack.slice(7):e.stack,(r=e).errCode=-1;else if("string"==typeof e)(r=new Error(`${n}${e}`)).errCode=-1;else{var i=e.errMsg||"";(r=new Error(`${t}:fail ${e.errCode} ${S[e.errCode]||""}. ${i}`)).errCode=e.errCode||-1}return r.errMsg=r.message+"",r}var o=new Error(`${t}:fail`);return o.errCode=-1,o.errMsg=o.message+"",o}class R extends Error{constructor(e,t){super(e),this.type="timeout",this.payload=void 0,this.generic=!0,this.payload=t}}var B=e=>"timeout"===e.type;class D extends Error{constructor(e,t){super(e),this.type="cancelled",this.payload=void 0,this.generic=!0,this.payload=t}}var L,P=e=>"cancelled"===e.type,M={fake:!0,surroundThirdByTryCatch:(e,t)=>function(...r){return Q((()=>{try{return e.apply(e,r)}catch(r){throw o.error(JSON.stringify(r)+`; ${t}\n`+r.stack),o.error(e.toString()),r}}),t)},reportIDKey:(...e)=>{},reportIDKeyDirectly:(...e)=>{},reportKeyValue:(...e)=>{}},x=!1,U=10;function k(){try{return x?i:U<=0?L:(U--,i.surroundThirdByTryCatch,x=!0,L=i)}catch(e){return L=M}}const q={surroundThirdByTryCatch:(e,t)=>k().surroundThirdByTryCatch(e,t),reportIDKey:e=>k().reportIDKey(e),reportIDKeyDirectly:e=>k().reportIDKeyDirectly(e),reportKeyValue:e=>k().reportKeyValue(e)};function Q(e,t=""){try{return e()}catch(e){if(b(e))return e.errMsg+=t,e;var r=(e?e.toString():"")+t;return new C({errMsg:r})}}function F(e,t=""){return function(...r){return Q((()=>e.apply(e,r)),t)}}function H(e){var t=e.param;t&&(t.success&&E(t.success)&&(t.success=q.surroundThirdByTryCatch(t.success,`at api ${e.apiName} success callback function`)),t.fail&&E(t.fail)&&(t.fail=q.surroundThirdByTryCatch(t.fail,`at api ${e.apiName} fail callback function`)),t.complete&&E(t.complete)&&(t.complete=q.surroundThirdByTryCatch(t.complete,`at api ${e.apiName} complete callback function`)))}function G(e,t,r){t.complete&&E(t.complete)&&F(t.complete,`at api ${e} complete callback function;`)(r)}function W(e,t,r){!function(e,t,r){t.success&&E(t.success)&&F(t.success,`at api ${e} success callback function;`)(r)}(e,t,r),G(e,t,r)}function j(e,t,r){!function(e,t,r){t.fail&&E(t.fail)&&F(t.fail,`at api ${e} fail callback function;`)(r)}(e,t,r),G(e,t,r)}function $(e){return e&&(e.success||e.fail||e.complete)}function Y(e,t,r="parameter",n=C){var i=function(e,t,r="parameter"){var n=function e(t,r,n){var i=A(t),o=A(r);if("string"===o)return i!==r?`${n} should be ${r} instead of ${i};`:"";if(i!==o)return`${n} should be ${o} instead of ${i}; `;var a="";switch(i){case"object":for(var s in r)a+=e(t[s],r[s],`${n}.${s}`);break;case"array":for(var u=0;u<r.length;u++)a+=e(t[u],r[u],`${n}[${u}]`)}return a}(e,t,r);return{passed:!n,reason:n}}(e,t,r);if(!i.passed)throw new n({errCode:S.SDK_API_PARAMETER_TYPE_ERROR,errMsg:i.reason})}function J(e,t,r,n=C){if(null==e)throw new n({errCode:S.SDK_API_PARAMETER_ERROR,errMsg:`parameter ${t} of function ${r} must be provided`})}function K({name:e,input:t,max:r,maxWording:n="",ErrorClass:i=C}){if(t.length>r)throw new i({errCode:S.SDK_API_PARAMETER_ERROR,errMsg:`${e} size must be less than ${n||r}`})}function z({target:e,name:t,ErrorClass:r=C}){if(0===Object.keys(e).length)throw new r({errCode:S.SDK_API_PARAMETER_ERROR,errMsg:`${t} must not be empty`})}function X(e,t=!1){if(t)return function(e){switch(A(e)){case"object":return{...e};case"array":return e.slice();case"number":return e instanceof Number?new Number(e):e;case"string":return e instanceof String?new String(e):e;case"boolean":return e instanceof Boolean?new Boolean(e):e;case"date":return new e.constructor(+e);case"map":return new Map(e);case"set":return new Set(e);default:return e}}(e);if((e=>{if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t})(e))return{...e};switch(A(e)){case"object":default:return e;case"array":return e.slice()}}var V,Z=new WeakMap,ee=[];function te(){var e,t=null!==(e=V)&&void 0!==e?e:void 0!==a?a:void 0;return t?ee.reduce(((e,t)=>t(e)),t):t}var re=e=>{if(!e)return te();var t=Z.get(e);return t&&t||te()};const ne=(e,t)=>{var r=null,n=!1,i=()=>{r?n=!0:(e(),r=setTimeout((()=>{clearTimeout(r),r=null,n&&(n=!1,i())}),t))};return i};function ie(e){if(void 0===e||!e.timestamp||!e.expires_in)return 0;var t=Date.now()-e.timestamp,r=.8*e.expires_in,n=Math.min(e.timestamp,Date.now())+1e3*r;return t>1e3*r?Date.now()+1e3*r:n}var oe,ae=void 0!==n?n:void 0,se=(e=0)=>new Promise((t=>setTimeout(t,e))),ue=!1,ce=[],le=()=>new Promise(((e,t)=>{if(oe)e(oe);else{0;try{re().wx.getNetworkType({success:t=>{oe={networkType:t.networkType,isConnected:"none"!==t.networkType},e(oe),ue||(re().wx.onNetworkStatusChange((e=>{if(oe.networkType=e.networkType,oe.isConnected=e.isConnected,e.isConnected&&ce.length)for(;ce.length;)try{ce.shift()()}catch(e){}})),ue=!0)},fail:t})}catch(e){t(e)}}}));var de,fe=!1,he=new Set;function pe(e){try{re().wx.onAppShow&&(fe||((t=re().wx).onAppShow&&t.onAppHide&&(t.onAppShow((()=>{for(var e of("visible",he))try{e("show")}catch(e){}})),t.onAppHide((()=>{for(var e of("hidden",he))try{e("hide")}catch(e){}}))),fe=!0),he.size>50&&he.clear(),he.add(e))}catch(e){}var t}function ge(e){he.delete(e)}function Ae(){if(de)return de;var e=re().wx;return de=e.getSystemInfoSync()}var me,ye=!1,ve=void 0;function Ee(e=500,t={}){if(re().private_getBackgroundFetchData&&!t.pluginId){if(ve)return ve;if(me)return me.then((()=>ve));if(!ye){ye=!0;var r=Date.now(),n=jt();return me=Promise.race([se(e).then((()=>({error:"bg fetch timeout"}))),new Promise(((e,t)=>{re().private_getBackgroundFetchData({fetchType:0,success:t=>{try{t||e({error:"empty"}),(ve=JSON.parse(t.fetchedData)).expiresTs=ie(ve),e(ve),Yt({apiName:"private_getBackgroundFetchData",apiStartTime:r,apiEndTime:Date.now(),warmStartTime:n})}catch(t){e({error:t})}},fail:t=>{e({error:t})}})}))]),ve?(null==ae||ae.log("private_getBackgroundFetchData (cloud) (sync)",JSON.stringify(ve)),ve):me.then((e=>(me=void 0,null==ae||ae.log("private_getBackgroundFetchData (cloud)",JSON.stringify(e)),e.error?void 0:e)))}}}function _e(e){try{return JSON.parse(e)}catch(t){return e}}function Ie(e){return encodeURIComponent(function(e){try{return decodeURIComponent(e)}catch(t){return e}}(e))}var Te="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function we(e){for(var t="",r=new Uint8Array(e),n=r.byteLength,i=0;i<n;i++)t+=String.fromCharCode(r[i]);return function(e){for(var t,r,n=String(e),i="",o=0,a=Te;n.charAt(0|o)||(a="=",o%1);i+=a.charAt(63&t>>8-o%1*8)){if((r=n.charCodeAt(o+=3/4))>255)throw new Error('"btoa" failed');t=t<<8|r}return i}(t)}function Se(e){for(var t=function(e){var t=String(e).replace(/=+$/,""),r="";if(t.length%4==1)throw new Error('"atob" failed');for(var n,i,o=0,a=0;i=t.charAt(a++);~i&&(n=o%4?64*n+i:i,o++%4)?r+=String.fromCharCode(255&n>>(-2*o&6)):0)i=Te.indexOf(i);return r}(e),r=t.length,n=new Uint8Array(r),i=0;i<r;i++)n[i]=t.charCodeAt(i);return n.buffer}function Ce(e){return Be(new Uint8Array(e))}function be(e){return function(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t.push(n):n<2048?t.push(192|n>>6,128|63&n):n<55296||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(r++,n=65536+((1023&n)<<10|1023&e.charCodeAt(r)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return new Uint8Array(t)}(e).buffer}var Ne,Oe,Re,Be=(Ne=new Array(128),Oe=String.fromCodePoint||String.fromCharCode,Re=[],function(e){var t,r,n=e.length;Re.length=0;for(var i=0;i<n;)(r=e[i++])<=127?t=r:r<=223?t=(31&r)<<6|63&e[i++]:r<=239?t=(15&r)<<12|(63&e[i++])<<6|63&e[i++]:String.fromCodePoint?t=(7&r)<<18|(63&e[i++])<<12|(63&e[i++])<<6|63&e[i++]:(t=63,i+=3),Re.push(Ne[t]||(Ne[t]=Oe(t)));return Re.join("")});function De(e,{method:t,headers:r,body:n}){return new Promise(((i,o)=>{re()._requestSkipCheckDomain({url:e,method:t,header:r,data:n,success:i,fail:o})}))}var Le=r(668),Pe=ae,Me=new Set(["tcbapi_init","tcbapi_get_service_info"]);var xe=new class{constructor(){this._running=0,this._onIdleCallbacks=[],this._idleTriggerTimer=void 0}get running(){return this._running}incrementRunning(e=1){this._running+=e,this._idleTriggerTimer&&clearTimeout(this._idleTriggerTimer)}decrementRunning(e=1){this._running-=e,this._running<0&&(this._running=0),this._running<=0&&this._onIdleCallbacks.length&&(this._idleTriggerTimer=setTimeout((()=>{if(this._idleTriggerTimer=null,this._onIdleCallbacks.length){var e=this._onIdleCallbacks.shift();e&&e()}}),50))}onceIdle(e){this._running>0?this._onIdleCallbacks.push(e):e()}};function Ue(e,t={}){if(t.fireOnIdle&&xe.running>0)return new Promise(((r,n)=>{xe.onceIdle(h()((function*(){try{var i=yield Ue(e,t);r(i)}catch(e){n(e)}})))}));if(t.onFire)try{t.onFire()}catch(e){}return new Promise(((r,n)=>{var i,o,a,s,u,c,l,d;(xe.incrementRunning(),null!==(i=e.cloud)&&void 0!==i&&i.plugins)&&(d=`https://${e.cloud.plugins.reduce(((e,t)=>t.getMetadata(e)),{}).host||"servicewechat.com"}/wxa-qbase/jsoperatewxdata`,e=e.cloud.plugins.reduce(((t,r)=>r.beforeTunnelRequest(e)),e)||e);re((e.cloud||t.cloud||{}).identifiers).invokeOperateWXData({appid:(null===(o=e.cloud)||void 0===o||null===(a=o.instanceOptions)||void 0===a?void 0:a.resourceAppid)||(null===(s=e.cloud)||void 0===s?void 0:s.config.appid),accessToken:null===(u=e.cloud)||void 0===u||null===(c=u.authStorage)||void 0===c?void 0:c.getItem("access_token"),webRequest:null===(l=e.cloud)||void 0===l?void 0:l.webRequest,url:d,apiName:e.apiName||"qbase_commapi",reqData:e.data,requestInQueue:!1,success:i=>{var o;i=(null===(o=e.cloud)||void 0===o?void 0:o.plugins.reduce(((e,t)=>t.afterTunnelRequest(e)),i))||i;var a={...i,data:i.data};if(i.data)try{var s=i.data;if(s.baseresponse&&0!==s.baseresponse.errcode){var u=new C({errCode:s.baseresponse.errcode,errMsg:s.baseresponse.errmsg});return void n(u)}a={...i,data:s}}catch(e){var c=new C({errMsg:e&&e.toString()});return void n(c)}else if(t&&t.requireDataNotEmpty){var l=new C({errCode:i.errCode,errMsg:`error empty internal server response, ${i.errMsg}`});return void n(l)}r(a)},fail:e=>{if(e&&e.errMsg)if(e.errMsg.includes("invalid scope")){var t="invalid scope 没有权限，请先开通云服务";(e=new Error(t)).errMsg=t,e.operateWXDataFail=!0}else{var r=e.errMsg.replace(/^operateWXData:fail /,"");(e=new Error(r)).errMsg=r,e.operateWXDataFail=!0}n(e)},complete:function(){e.complete&&e.complete.apply(null,arguments),xe.decrementRunning()}})}))}function ke(e){var{cloud:t}=e;return function(){var e=h()((function*(e){var r=t.isInstance?{...t.instanceOptions,appid:t.instanceOptions.resourceAppid,env:t.instanceOptions.resourceEnv}:{identityless:"sdk"===t.runtimeInfo.platform||void 0,appid:"sdk"===t.runtimeInfo.platform?t.config.appid:void 0,env:e.env||("sdk"===t.runtimeInfo.platform?t.config.env:void 0)},n={qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:r,qbase_meta:t.getMetaData(),cli_req_id:`${+new Date}_${Math.random()}`};if(e.stdpriv&&!Me.has(e.apiName)&&"windows"!==Ae().platform){var i=yield function(e,t){return qe.apply(this,arguments)}(t,n).catch((e=>{if(e&&(-9999===e.errCode||-9998===e.errCode))return Ue({apiName:"qbase_commapi",data:n,cloud:t}).then((t=>({...t,channelType:-9998===e.errCode?0:2})));throw e}));return i}return Ue({apiName:"qbase_commapi",data:n,cloud:t})}));return function(t){return e.apply(this,arguments)}}()}function qe(){return qe=h()((function*(e,t){var r=e.serviceEndpoint.getEndpointSync("container");if(null==r||!r.cloudServiceUrl)throw{errCode:-9998,errMsg:"cloudServiceUrl not found"};null==Pe||Pe.info("cloud stdpriv begin",t);var n=re(e.identifiers),i={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":r.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-LIB-BUILD-TS":1678888746406,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"JSON","Content-Type":"application/octet-stream","X-WX-REQUEST-CONTENT-ENCODING":"PB"},o=new Uint8Array(Se(r.key)),{data:a}=Le.V1.encodeStdPrivRequest(o,{cliReqId:t.cli_req_id,qbaseApiName:t.qbase_api_name,qbaseMeta:{filterUserInfo:t.qbase_meta.filter_user_info,sdkVersion:t.qbase_meta.sdk_version,sessionId:t.qbase_meta.session_id},qbaseOptions:{env:t.qbase_options.env},qbaseReq:t.qbase_req}),s=St({rdm:e.getConfig().rdm});return new Promise(((e,t)=>{n._requestSkipCheckDomain({url:s.url,method:"POST",header:i,data:a.buffer,dataType:"arraybuffer",responseType:"arraybuffer",enableHttp2:!0,success:r=>{try{for(var n in null==Pe||Pe.info("res",r),r.header)if("x-nws-log-uuid"===n.toLowerCase()&&(null==Pe||Pe.log(`[cloud.callContainer] x-nws-log-uuid ${r.header[n]}`)),"x-wx-system-error"===n.toLowerCase()){var i=Number(r.header[n]);return 85104===i&&s.invalidate(),void t(new Error(`wx system error. code: ${i}`))}if(200===r.statusCode){var a=r.data,u=!1;for(var c in r.header)"x-wx-compression"===c.toLowerCase()&&"snappy"===r.header[c]&&(u=!0);var l=Le.V1.decodeStdPrivResponse(o,new Uint8Array(a),u);e({errCode:0,errMsg:"",data:l,profile:r.profile,channelType:1})}else t({errCode:-9999,errMsg:"system conn status not 200"})}catch(e){t(new Error(`error while processing internal response ${e}`))}},fail:e=>{t({...e,errCode:-9999,errMsg:e.errMsg})}})}))})),qe.apply(this,arguments)}const Qe=Ue;const Fe=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const He="object"==typeof r.g&&r.g&&r.g.Object===Object&&r.g;var Ge="object"==typeof self&&self&&self.Object===Object&&self;const We=He||Ge||Function("return this")();const je=function(){return We.Date.now()};var $e=/\s/;const Ye=function(e){for(var t=e.length;t--&&$e.test(e.charAt(t)););return t};var Je=/^\s+/;const Ke=function(e){return e?e.slice(0,Ye(e)+1).replace(Je,""):e};const ze=We.Symbol;var Xe=Object.prototype,Ve=Xe.hasOwnProperty,Ze=Xe.toString,et=ze?ze.toStringTag:void 0;const tt=function(e){var t=Ve.call(e,et),r=e[et];try{e[et]=void 0;var n=!0}catch(e){}var i=Ze.call(e);return n&&(t?e[et]=r:delete e[et]),i};var rt=Object.prototype.toString;const nt=function(e){return rt.call(e)};var it=ze?ze.toStringTag:void 0;const ot=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":it&&it in Object(e)?tt(e):nt(e)};const at=function(e){return null!=e&&"object"==typeof e};const st=function(e){return"symbol"==typeof e||at(e)&&"[object Symbol]"==ot(e)};var ut=/^[-+]0x[0-9a-f]+$/i,ct=/^0b[01]+$/i,lt=/^0o[0-7]+$/i,dt=parseInt;const ft=function(e){if("number"==typeof e)return e;if(st(e))return NaN;if(Fe(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Fe(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Ke(e);var r=ct.test(e);return r||lt.test(e)?dt(e.slice(2),r?2:8):ut.test(e)?NaN:+e};var ht=Math.max,pt=Math.min;const gt=function(e,t,r){var n,i,o,a,s,u,c=0,l=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){var r=n,o=i;return n=i=void 0,c=t,a=e.apply(o,r)}function p(e){return c=e,s=setTimeout(A,t),l?h(e):a}function g(e){var r=e-u;return void 0===u||r>=t||r<0||d&&e-c>=o}function A(){var e=je();if(g(e))return m(e);s=setTimeout(A,function(e){var r=t-(e-u);return d?pt(r,o-(e-c)):r}(e))}function m(e){return s=void 0,f&&n?h(e):(n=i=void 0,a)}function y(){var e=je(),r=g(e);if(n=arguments,i=this,u=e,r){if(void 0===s)return p(u);if(d)return clearTimeout(s),s=setTimeout(A,t),h(u)}return void 0===s&&(s=setTimeout(A,t)),a}return t=ft(t)||0,Fe(r)&&(l=!!r.leading,o=(d="maxWait"in r)?ht(ft(r.maxWait)||0,t):o,f="trailing"in r?!!r.trailing:f),y.cancel=function(){void 0!==s&&clearTimeout(s),c=0,n=u=i=s=void 0},y.flush=function(){return void 0===s?a:m(je())},y};var At=()=>{};class mt{constructor(e,t,r){this.refreshToken=e,this.proactiveRefreshTimer=t,this.onRefreshedToken=r,this.state="init",this.currentToken=void 0,this.currentSession=void 0,this.currentTask=void 0,this.refreshHandler=void 0}transition(e,t){switch(At(`[gateway:token] transition ${this.state} -> ${e}`,t),this.state){case"init":"refreshing"===e?(this.state="refreshing",this.currentTask=t.task):At(`[gateway:token] invalid transition ${this.state} -> ${e}`);break;case"normal":"refreshing"===e?(this.state="refreshing",Object.defineProperty(this.currentToken,"__invalidated",{value:!0}),this.currentToken=void 0,this.currentTask=t.task):"normal"===e?t.token&&this.currentToken&&t.token.timestamp>this.currentToken.timestamp&&(this.currentToken=t.token,this.currentTask=void 0):At(`[gateway:token] invalid transition ${this.state} -> ${e}`);break;case"refreshing":"normal"===e?(this.state="normal",this.currentToken=t.token,this.currentTask=void 0):At(`[gateway:token] invalid transition ${this.state} -> ${e}`)}}getTokenSync(){if(this.currentToken)return this.currentToken.exp<Date.now()?void this.invalidate(this.currentToken):this.currentToken}getToken(){var e=this;return h()((function*(){return e.currentToken?e.currentToken.exp<Date.now()?e.invalidate(e.currentToken):e.currentToken:e.invalidate()}))()}updateSession(e){var t=this;return h()((function*(){var r=new Promise((t=>"string"==typeof e?t(e):e?e.then(t):t(e)));return t.currentSession=yield r,t.invalidate()}))()}invalidate(e,t){var r=this;return h()((function*(){var n;if("refreshing"===r.state&&r.currentTask)return r.currentTask;if(null!=e&&e.__invalidated&&"normal"===r.state&&r.currentToken)return At("[gateway:token] already invalidated token returning latest not refreshing"),r.currentToken;r.refreshHandler&&clearTimeout(r.refreshHandler);var i=r.currentSession,o=new Promise(((t,n)=>{r.refreshToken(i).then((n=>{var i=0,o=0;"iat"in n?(i=1e3*n.iat,o=n.exp-n.iat):(i=n.timestamp,o=n.expires_in);var a=ie({timestamp:i,expires_in:o}),s={...n,exp:a,timestamp:i,invalidate:()=>r.invalidate(e)};r.transition("normal",{token:s});var u=s.exp-Date.now();r.refreshHandler=r.proactiveRefreshTimer?setTimeout((()=>{r.invalidate(void 0,!0)}),r.proactiveRefreshTimer(u)):void 0,t(s)})).catch(n)}));t||r.transition("refreshing",{task:o});var a=yield o;return null===(n=r.onRefreshedToken)||void 0===n||n.call(r,a),a}))()}}var yt=/https:\/\/servicewechat\.com/,vt={},Et="servicewechat.com",_t=!1,It=`${Math.random()}_${Date.now()}`;void 0!==u&&u.onLoad((()=>{It=`${Math.random()}_${Date.now()}`}));var Tt={};class wt{constructor(e){this.identifiers=e,this._tunnelRequest=void 0,this._meta=void 0,this.containerTokenManager=new mt(this.refreshContainerServiceEndpoint.bind(this),(e=>e),(e=>this.processServiceEndpoint(e))),Tt.container=this.containerTokenManager}setMetaData(e){this._meta=e}setTunnelRequest(e){this._tunnelRequest=e}getEndpointSync(e){if("container"===e){var t=this.containerTokenManager.getTokenSync();if(null!=t&&t.url)return t}}getEndpoint(e){var t=this;return h()((function*(){return"container"===e?t.containerTokenManager.getToken():null}))()}processServiceEndpoint(e){return h()((function*(){Kt(e,"1"),Et=e.domain||"servicewechat.com",function(){Ot.apply(this,arguments)}(),Bt()}))()}refreshContainerServiceEndpoint(){var e=this;return h()((function*(){if(clearTimeout(vt.container),re().private_getBackgroundFetchData&&!_t){_t=!0;var t,r,n=Ee(500,e.identifiers);if(n&&!n.url_info&&(n=yield n),n&&n.expiresTs>Date.now()&&n.url_info)return{url:null!==(t=n.url_info)&&void 0!==t&&t.cloudrun_url?`${n.url_info.cloudrun_url}?token=${n.token}`:`https://${n.domain}/wxa-qbase/container_service?token=${n.token}`,cloudServiceUrl:null!==(r=n.url_info)&&void 0!==r&&r.cloudbase_url?`${n.url_info.cloudbase_url}?token=${n.token}`:void 0,domain:n.domain||"servicewechat.com",token:n.token,http:!0,key:n.key,timestamp:n.timestamp,expires_in:n.expires_in,exp:n.expires_in}}for(var i=[],o=0;o<3;o++)try{var a,s,u=Date.now(),c=Ae(),l=(e._tunnelRequest?yield e._tunnelRequest({apiName:"tcbapi_get_service_info",serializedReqData:JSON.stringify({client_random:It,system:c.system,wx_app_version:c.version})}):yield Qe({apiName:"qbase_commapi",data:{qbase_api_name:"tcbapi_get_service_info",qbase_req:JSON.stringify({client_random:It,system:c.system,wx_app_version:c.version}),qbase_options:{},qbase_meta:e._meta,cli_req_id:`${+new Date}_${Math.random()}`}})).data;if(Date.now()-u>1e3*l.expires_in){i.push(`result already expired (startTs ${u} resultTs ${Date.now()})`);continue}var d=l.domain||"servicewechat.com";return{url:null!==(a=l.url_info)&&void 0!==a&&a.cloudrun_url?`${l.url_info.cloudrun_url}?token=${l.token}`:`https://${d}/wxa-qbase/container_service?token=${l.token}`,cloudServiceUrl:null!==(s=l.url_info)&&void 0!==s&&s.cloudbase_url?`${l.url_info.cloudbase_url}?token=${l.token}`:void 0,domain:d,token:l.token,http:l.http,key:l.key,timestamp:l.timestamp,ip:l.ip,vip:l.vip,expires_in:l.expires_in,exp:l.expires_in}}catch(e){i.push(e+"")}throw new Error(`get container service endpoints errors: ${i.join("\n")}`)}))()}invalidateToken(e,t){"container"===e&&this.containerTokenManager.invalidate(t)}static invalidateService(e,t){var r;null===(r=Tt[e])||void 0===r||r.invalidate(t)}}function St(e){var t,r=null===(t=Tt.container)||void 0===t?void 0:t.getTokenSync();if(null!=r&&r.cloudServiceUrl)return e.rdm&&(r.cloudServiceUrl=r.cloudServiceUrl.replace(yt,"https://wxardm.weixin.qq.com")),r}var Ct=!1,bt=!1,Nt=0;function Ot(){return(Ot=h()((function*(){if(!Ct){Ct=!0;var e=()=>{Ct&&setTimeout(h()((function*(){yield Dt(),e()})),2e4)};if(e(),!bt){var t;bt=!0;var r=re();null!==(t=r.wx)&&void 0!==t&&t.onAppHide&&r.wx.onAppHide((()=>{Ct=!1}))}return Dt()}}))).apply(this,arguments)}var Rt=0,Bt=()=>{Rt=Date.now()},Dt=gt((()=>new Promise((e=>{if(!(Date.now()-Rt<3e4)){var t=Date.now(),r=!/^\d+/.test(Et);re()._requestSkipCheckDomain({url:`${r?"https":"http"}://${Et}/wxa-qbase/keepalive`,header:r?{}:{host:"servicewechat.com"},method:"GET",dataType:"text",enableHttp2:r,success:()=>{e(),Nt++%4==0&&Xt(22990,1,["privateHttpKeepAlive",Et,t,Date.now(),Date.now()-t].join(","))},fail:()=>{e()}})}})))),Lt=s;const Pt=Lt;var Mt=()=>"devtools"===Lt.platform,xt=!1,Ut=[],kt=Date.now(),qt=Date.now(),Qt="unknown";Pt.onReady((()=>{kt=Date.now(),qt=Date.now()}));var Ft,Ht,Gt,Wt,jt=()=>qt,$t=()=>{for(var e of Ut)try{e()}catch(e){0}Ut=[]},Yt=e=>{setTimeout((()=>{try{var t;if(!(e=>!(e.tunnelStartTime&&e.tunnelEndTime&&e.tunnelEndTime<e.tunnelStartTime||!(e.apiStartTime&&e.apiEndTime&&e.apiEndTime>e.apiStartTime)))(e))return;if(!xt&&Ut.length<100)return void Ut.push(Yt.bind(null,e));var r=e.apiEndTime-e.apiStartTime,n=e.tunnelEndTime?e.tunnelEndTime-e.tunnelStartTime:0,i=[0,e.apiName,r,n,(e.pollStartTime&&e.pollEndTime&&e.pollEndTime>e.pollStartTime?e.pollEndTime-e.pollStartTime:0)||0,Qt,e.tunnelTimeNoCSNetCost?r-e.tunnelTimeNoCSNetCost:0,e.tunnelTimeNoCSNetCost?n-e.tunnelTimeNoCSNetCost:0,e.funcExecTime?e.funcExecTime:0,null!==(t=e.channelType)&&void 0!==t?t:0,e.funcName||"",e.apiStartTime-kt,void 0!==e.warmStartTime?e.apiStartTime-e.warmStartTime:0];q.fake?Xt(16588,6,i.join(",")):q.reportKeyValue({key:"CloudReport",value:i.join(","),force:!0})}catch(e){}}))},Jt=(e,t,r,n)=>{q.reportIDKeyDirectly({id:e,key:t,force:r,immediately:n})},Kt=(e,t)=>(Ft=e,Ht=t),zt=[],Xt=(e,t,r)=>{zt.push({log_id:e,version:t,user_log_list:r}),Ft&&Vt()},Vt=ne((()=>{re()._requestSkipCheckDomain({url:`https://servicewechat.com/wxa-qbase/report?token=${Ft.token}&v=${Ht}`,method:"POST",header:{},enableHttp2:!0,dataType:"json",data:JSON.stringify({report_info_list:zt}),success:e=>{for(var t in e.header)"x-wx-system-error"===t.toLocaleLowerCase()&&"85104"===e.header[t]&&Ft.invalidate()}}),zt=[],Dt()}),3e4),Zt=(e,t)=>{var r=E(e);function n(...n){if(t.samplePicker&&!t.samplePicker.next())return r?e.apply(this,n):e;var o=Date.now(),a=!0;try{var s,u;if(null!==(s=t.condition)&&void 0!==s&&s.emptyKey&&t.timing[t.startKey])return r?e.apply(this,n):e;if(r){var c=e.apply(this,n);if("promise"!==A(c))return a=!1,c;u=c}else u=e;return u.then((()=>i(o))).catch((()=>i(o))),u}catch(e){throw a=!1,e}finally{a||i(o)}}function i(e){t.timing[t.startKey]=e,t.timing[t.endKey]=Date.now(),t.autoReport&&Yt({...t.timing,apiName:t.autoReport})}return r?n:n()},er=(Gt=10,Wt=!0,function*(){for(var e=()=>parseInt(Math.round(2*Math.random()*Gt),10),t=Wt?0:e();;)t>0?(t--,yield!1):(t=e(),yield!0)})();function tr(e){if(e&&!isNaN(e))return e>6e4?6e4:e<0?0:e}function rr(e,t,r){t.stats.apiEndTime=Date.now(),Yt({...t.context,apiEndTime:t.stats.apiEndTime,apiName:e});var n=Boolean(t.stats.profile),i=t.stats.profile||{},o=t.stats.serverEndTs-t.stats.serverStartTs,a=t.stats.httpRequest?t.stats.httpRequest<=6e4?t.stats.httpRequest:6e4:void 0,s=t.stats.apiEndTime,u=s-t.context.apiStartTime;u>9e4&&(u=9e4);var c=t.path||"";c=c.split("?")[0].replace(/\/\d+\//g,"/*/").replace(/\/\d+$/g,"/*"),Xt(22601,14,[t.stats.callid,t.context.apiStartTime,s,t.stats.serverStartTs,t.stats.serverEndTs,t.stats.requestBodyBytes,t.stats.responseBodyBytes,t.stats.getServiceEndpoint,t.stats.queryDNS,t.stats.compress,t.stats.loadAsmcrypto,t.stats.encrypt,a,t.stats.decrypt,t.stats.uncompress,t.stats.decodePb,t.stats.decodeBody,t.stats.ip,i.redirectStart,n?i.redirectEnd-i.redirectStart:void 0,i.fetchStart,i.domainLookupStart,n?i.domainLookUpEnd-i.domainLookUpStart:void 0,i.connectStart,n?i.connectEnd-i.connectStart:void 0,i.SSLconnectionStart,n?i.SSLconnectionEnd-i.SSLconnectionStart:void 0,i.requestStart,n?i.requestEnd-i.requestStart:void 0,i.responseStart,n?i.responseEnd-i.responseStart:void 0,i.rtt,i.estimate_nettype,tr(i.httpRttEstimate),tr(i.transportRttEstimate),tr(i.downstreamThroughputKbpsEstimate),i.throughputKbps,i.peerIP,i.port,n?i.socketReused?1:0:void 0,i.sendBytesCount,i.receivedBytedCount,i.protocol,Ae().system,u,o>0?o:0,a?u-a:void 0,c,Ae().platform,t.stats.requestStartTs,1678888746406,t.stats.ecdnId,t.stats.ecdnEdgeTiming,t.stats.domain,t.stats.stringToBuffer,t.stats.encodePb,t.stats.tsBeforeCallContainerImpl,t.stats.tsCallContainerImplStart,t.stats.decodeJson,`SDK:${r}`,n?i.requestStart-t.stats.requestStartTs:void 0,n?t.stats.requestSuccessTs-i.requestEnd:void 0,t.stats.responseProcessEndTs?s-t.stats.responseProcessEndTs:void 0,t.stats.upstreamCost,t.stats.meshStartTs,t.stats.meshEndTs].join(","))}function nr(e){return`${e}:ok`}function ir(e,t){return JSON.stringify(e,((e,r)=>t&&t.has(r)?t.get(r):"arraybuffer"===A(r)?{type:"Buffer",data:[...new Uint8Array(r)]}:r))}function or(e){return ar(JSON.parse(e))}function ar(e){switch(A(e)){case"object":return sr(e);case"array":return e.map(ar);default:return e}}function sr(e){var t=e,r=ur(t);if(t!==r)return r;for(var n in t){var i=t[n];switch(A(i)){case"object":var o=ur(i);t[n]=o!==i?o:sr(t[n]);break;case"array":var a=ar(i);a!==i&&(t[n]=a);break;default:continue}}return t}function ur(e){for(var t in e)if("type"===t)if("Buffer"===e.type)if(_(e.data)&&v(e.data[0]))try{return new Uint8Array(e.data).buffer}catch(t){return e}return e}var cr=Symbol.for("CLOUD_ID"),lr=Symbol("CDN");function dr(e){var t=[];for(var r in e)m(e[r])&&e[r]._internalType===cr&&t.push({key:r,cloudID:e[r].cloudID});return t}var fr=2e4,hr=e=>{var t=new Date;return`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()} ${e}`},pr=e=>e.join("->");function gr(e){return function(){var t=h()((function*(t){var r={...t.data},n=dr(r).map((e=>({key_name:e.key,cloud_id:e.cloudID})));if(n.length)for(var i of n)delete r[i.key_name];var o=ir(r,yield t.cdnMapPromise);K({input:o,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:e.appConfig.maxReqDataSize/1024+" KB"});var a=`${+new Date}-${Math.random()}`;t.context.tunnelStartTime=+new Date;var{result:s,requestID:u}=yield function(e,t,r,n){return c.apply(this,arguments)}(t,o,n,a);return t.context.tunnelEndTime=+new Date,{errMsg:nr(Tr),result:s,requestID:u};function c(){return c=h()((function*(t,r,n,i){return new Promise(((o,a)=>{var s=[hr("start")],{resolve:u,reject:c}=f(s,o,a);l({param:t,functionName:t.name,data:r,cloudIDList:n,callID:i,action:_r.CALL,scene:Ir.INITIATE_CALL,tryCount:e.appConfig.maxPollRetry||20,systemErrorRetry:2,timeoutErrorRetry:2,trace:s,resolve:u,reject:c})}))})),c.apply(this,arguments)}function l(e){return d.apply(this,arguments)}function d(){return d=h()((function*(r){var{functionName:i,data:o,callID:a,action:s,scene:u,tryCount:c,trace:d,systemErrorRetry:f,timeoutErrorRetry:p,resolve:g,reject:A}=r,m=s===_r.CALL&&Mt()?t.localDebugNoTimeout:void 0,y=ir({function_name:i,data:s===_r.CALL?o:void 0,action:s,scene:u,call_id:a,cloudid_list:s===_r.CALL?n:[],local_debug_no_timeout:m}),v=!1,E=!1,_=()=>{clearTimeout(T),E=!0},I=+new Date,T=m?void 0:setTimeout(h()((function*(){var t=e.appConfig.clientPollTimeout||fr;if(!(+new Date-I>t&&(yield se(),E))){if(!Mt()&&+new Date-I>e.appConfig.maxStartRetryGap)return d.push(hr("timeout, exceed max retry gap")),A(O({errCode:S.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:`timeout for retry, cannot retry fetching the result anymore (callId: ${a}) (trace: ${pr(d)})`},Tr));v=!0,r.timeoutErrorRetry>0?(d.push(hr("timeout, retry")),l({...r,scene:Ir.TIMEOUT_RETRY,tryCount:c-1,timeoutErrorRetry:p-1})):(d.push(hr("timeout, abort")),A(O({errCode:S.SDK_FUNCTIONS_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:`(callId: ${a}) (trace: ${pr(d)})`},Tr)))}})),e.appConfig.clientPollTimeout||fr);e.request({...t.config,apiName:"tcbapi_slowcallfunction_v2",serviceName:e.name,serializedReqData:y,env:t.config&&t.config.env||e.env,stdpriv:!0}).then((function(e){try{if(v)return;_(),(e=>{var r,n=e.data;n&&n.baseresponse&&n.baseresponse.stat&&(n.baseresponse.stat.qbase_cost_time&&(t.context.tunnelTimeNoCSNetCost+=n.baseresponse.stat.qbase_cost_time),n.baseresponse.stat.func_exec_cost_time&&(t.context.funcExecTime=n.baseresponse.stat.func_exec_cost_time)),t.context.channelType=null!==(r=e.channelType)&&void 0!==r?r:0,e.profile&&(null==ae||ae.log("callFunction profile",e.profile))})(e);var n=e.data;if(!n)return d.push(hr("empty resp")),A(O({errCode:S.SDK_FUNCTIONS_EMPTY_CALL_RESULT},Tr));if(!n.baseresponse||0!==n.baseresponse.errcode)return n.baseresponse?0!==n.baseresponse.errcode?A(O({errCode:S.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:`polling base_resp.errcode ${n.baseresponse.errcode} errmsg ${n.baseresponse.errmsg} (callId: ${a})`},Tr)):A(O({errCode:S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:`polling base_resp ${JSON.stringify(n.baseresponse)} (callId: ${a})`},Tr)):A(O({errCode:S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP},Tr));if(0!==n.status){if(1===n.status){if(0!==n.service_errcode){if(n.service_errcode===S.TCB_FUNCTIONS_EXEC_FAIL){var i=n.service_errmsg||"";try{for(var o=i.split("\n"),s=[],u=0;u<o.length;u++)o[u].startsWith("Error: ")&&s.push([o[u],u]);if(s.length%2==1){var f=s[Math.floor(s.length/2)][1];i=o.slice(f).join("\n")}}catch(e){}var h=O({errCode:S.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:`云函数执行错误\n云端堆栈信息(error stack)(${n.func_request_id?`requestId ${n.func_request_id}, `:""}callid ${a}):\n${i}`},Tr);return h.stack=`Error: ${h.message}`,h.requestID=n.func_request_id,A(h)}var p=O({errCode:S.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:`\n云函数调用失败(${n.func_request_id?`requestId ${n.func_request_id}, `:""}callid ${a}):\n${n.service_errcode} ${n.service_errmsg}`},Tr);return p.stack=`Error: ${p.message}`,p.requestID=n.func_request_id,A(p)}var m=n.data;try{m=or(m)}catch(e){try{m=JSON.parse(m)}catch(e){}}return g({result:m,requestID:n.func_request_id})}return d.push(hr("poll result expired")),A(O({errCode:S.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:`timeout for result fetching, result cannot be fetched anymore (callId: ${a}) (trace: ${pr(d)})`},Tr))}if(!(c>=0))return d.push(hr("too many polls, abort")),A(O({errCode:S.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:`(callId: ${a}) (trace: ${pr(d)})`},Tr));d.push(hr("normal poll")),l({...r,action:_r.POLL,scene:Ir.NORMAL_POLL_RETRY,tryCount:c-1})}catch(e){A(O({errCode:S.SDK_FUNCTIONS_POLL_ERROR,errMsg:`polling catch error: ${e} (callId: ${a})`},Tr))}})).catch((e=>{v||(_(),e&&e.operateWXDataFail&&f>0?(d.push(hr(`system error (${e}), retry`)),l({...r,scene:Ir.SYSTEM_ERROR_RETRY,tryCount:c-1,systemErrorRetry:f-1})):(d.push(hr(`system error (${e}), abort`)),A(O(`${e} (callId: ${a}) (trace: ${pr(d)})`,Tr))))}))})),d.apply(this,arguments)}function f(e,t,r){var n=t=>{e.push(hr(`app ${t}`))};pe(n);return{resolve:e=>{ge(n),t(e)},reject:e=>{ge(n),r(e)}}}}));return function(e){return t.apply(this,arguments)}}()}function Ar(e){var t=new WeakMap,r=[];if(e&&(JSON.stringify(e,((e,n)=>n&&n._internalType===lr?void r.push(new Promise(((e,r)=>{var i={appType:301,fileType:20303,fileKey:`file_${Math.random()}`},o=n;if("object"===A(o.target)){if(!o.target.filePath)throw new Error("filePath must be provided");i.filePath=o.target.filePath}else i.fileData=o.target;e(mr(i).then((e=>{t.set(n,e.fileUrl)})))}))):n)),r.length))return Promise.all(r).then((()=>t))}function mr(e){return new Promise(((t,r)=>{var n={...e,appType:e.appType||301,fileType:e.fileType||20303,fileKey:e.fileKey||`file_${Math.random()}`};re().uploadToCommonCDN({...n,success:t,fail:r})}))}var yr=e=>({...e,errMsg:void 0}),vr=e=>{try{Mt()&&"undefined"!=typeof __global&&__global.networkLog&&__global.networkLog({...e,domain:"cloud",method:"POST",realMethod:e.method,timestampMs:e.timestampMs||+new Date,callFramesIgnoreLength:e.hasOwnProperty("callFramesIgnoreLength")?e.callFramesIgnoreLength:1})}catch(e){}},Er=(e,t)=>{try{if(Mt()&&"undefined"!=typeof __global&&__global.networkLog){var r=t(),n=`${Math.random()}-${+new Date}`,i=r.console||!1,o=r.resultGetter||yr;vr({reqId:n,type:"requestWillBeSent",url:r.url,headers:r.headers||{},body:r.reqBody,console:i,callFramesIgnoreLength:2,timestampMs:r.timestampMs,method:r.method}),e.then(function(){var e=h()((function*(e){try{yield((e=0)=>new Promise((t=>setTimeout(t,e))))(),vr({reqId:n,type:"loadingFinished",body:JSON.stringify(o(e),null,2),console:i,callFramesIgnoreLength:2,timestampMs:Date.now()})}catch(e){}}));return function(t){return e.apply(this,arguments)}}()).catch((e=>{try{vr({reqId:n,type:"loadingFailed",errorCode:e&&e.errCode||-1,errorMsg:m(e)?e.errMsg||JSON.stringify(e):e.toString(),console:i,callFramesIgnoreLength:2,timestampMs:Date.now()})}catch(e){}}))}}catch(e){0}},_r=function(e){return e[e.CALL=1]="CALL",e[e.POLL=2]="POLL",e}({}),Ir=function(e){return e[e.INITIATE_CALL=1]="INITIATE_CALL",e[e.NORMAL_POLL_RETRY=2]="NORMAL_POLL_RETRY",e[e.SYSTEM_ERROR_RETRY=3]="SYSTEM_ERROR_RETRY",e[e.TIMEOUT_RETRY=4]="TIMEOUT_RETRY",e}({}),Tr="cloud.callFunction",wr="cloud.callFunction_real_v2";function Sr(e){var t,r,n;function i(){return t||(t=function(e){return function(){var t=h()((function*(t){var r={...t.data},n=dr(r).map((e=>({key_name:e.key,cloud_id:e.cloudID})));if(n.length)for(var i of n)delete r[i.key_name];var o=ir(r,yield t.cdnMapPromise);K({input:o,max:e.appConfig.maxReqDataSize,name:"callFunction data",maxWording:e.appConfig.maxReqDataSize/1024+" KB"});var a=ir({function_name:t.name,data:o,cloudid_list:n});t.context.tunnelStartTime=+new Date;var s=yield e.request({...t.config,apiName:"tcbapi_slowcallfunction",serviceName:e.name,serializedReqData:a,env:t.config&&t.config.env||e.env});t.context.tunnelEndTime=+new Date;var u=s.data;if(!u)throw N({errCode:S.SDK_FUNCTIONS_EMPTY_CALL_RESULT,errMsg:S[S.SDK_FUNCTIONS_EMPTY_CALL_RESULT]},Tr);if(u.event_id,!u.poll_url)throw N({errCode:S.SDK_FUNCTIONS_EMPTY_POLL_URL,errMsg:S[S.SDK_FUNCTIONS_EMPTY_POLL_URL]},Tr);u.poll_url.indexOf("?")>-1?u.poll_url+="&devtools_ignore=true&skip_domain_check=true":u.poll_url+="?devtools_ignore=true&skip_domain_check=true",t.context.pollStartTime=+new Date;var{result:c,requestID:l}=yield function(e){return d.apply(this,arguments)}(u.poll_url);return t.context.pollEndTime=+new Date,{errMsg:nr(Tr),result:c,requestID:l};function d(){return(d=h()((function*(t){return new Promise(((r,n)=>{f(t,e.appConfig.maxPollRetry||50,r,n)}))}))).apply(this,arguments)}function f(e,t,r,n){return p.apply(this,arguments)}function p(){return p=h()((function*(t,r,n,i){re(e.identifiers)._requestSkipCheckDomain({url:t,success:e=>{try{if(200!==e.statusCode)return i(N({errCode:S.SDK_FUNCTIONS_POLL_RESULT_STATUS_CODE_ERROR,errMsg:`polling status code ${e.statusCode}`},Tr));var o=e.data;if(!o)return i(N({errCode:S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON,errMsg:S[S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_JSON]},Tr));if(o.base_resp&&0===o.base_resp.ret){if(0!==o.status){if(1===o.status){if(0!==o.service_errcode){var a=N({errCode:S.SDK_FUNCTIONS_CLOUD_FUNCTION_EXECUTION_ERROR,errMsg:`requestID ${o.func_req_id}, cloud function service error code ${o.service_errcode||"unknown"}, error message ${o.service_errmsg||"unknown"}`},Tr);return a.requestID=o.func_req_id,i(a)}var s=o.content;try{s=or(s)}catch(e){try{s=JSON.parse(s)}catch(e){}}return n({result:s,requestID:o.func_req_id})}return i(N({errCode:S.SDK_FUNCTIONS_POLL_RESULT_EXPIRED,errMsg:"timeout for result fetching"},Tr))}if(!(r>=0))return i(N({errCode:S.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY,errMsg:S[S.SDK_FUNCTIONS_EXCEED_MAX_POLL_RETRY]},Tr));f(t,r-1,n,i)}else{if(!o.base_resp)return i(N({errCode:S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP,errMsg:S[S.SDK_FUNCTIONS_EMPTY_POLL_RESULT_BASE_RESP]},Tr));if(0!==o.base_resp.ret)return i(N({errCode:S.SDK_FUNCTIONS_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:`polling base_resp.ret ${o.base_resp.ret}`},Tr))}}catch(e){i(N({errCode:S.SDK_FUNCTIONS_POLL_ERROR,errMsg:`polling catch error: ${e}`},Tr))}},fail:e=>{i(N(e,Tr))}})})),p.apply(this,arguments)}}));return function(e){return t.apply(this,arguments)}}()}(e)),t}function o(){return r||(r=gr(e)),r}function s(){return n||(n=function(e){return function(){var t=h()((function*(t){var r,n={function_name:t.name,data:ir(t.data),cloudid_list:[]},i=ir(n),o=yield e.serviceEndpoint.getEndpoint("container"),s=new Uint8Array(a.wx.base64ToArrayBuffer(o.key)),u={"X-WX-EV":3,"Content-Type":"application/octet-stream"},c=Le.V3.encodeRequest(s,{"X-WX-CALLID":`${+new Date}-${Math.random()}`,"X-WX-CLOUDFUNCTION-NAME":t.name,"X-WX-CLOUDFUNCTION-ENV":(null===(r=t.config)||void 0===r?void 0:r.env)||e.env||""},"POST",i),l=yield new Promise(((e,t)=>re()._requestSkipCheckDomain({url:o.cloudServiceUrl,method:"POST",header:u,data:c.data.buffer,dataType:"arraybuffer",responseType:"arraybuffer",enableHttp2:!0,success:e,fail:t}))),d=Le.V3.decodeResponse(s,new Uint8Array(l.data)).body;if(d)try{d=JSON.parse(d)}catch(e){}return{errMsg:nr(Tr),result:d}}));return function(e){return t.apply(this,arguments)}}()}(e)),n}return function(e){var t=+new Date;Y(e,"object");var r=X(e);return r.data||(r.data={}),r.context={tunnelTimeNoCSNetCost:0,funcName:e.name,apiStartTime:t,warmStartTime:jt()},$(r)?function(e){H({apiName:Tr,param:e}),c(e).then((t=>{W(Tr,e,t)})).catch((t=>{j(Tr,e,t)}))}(r):c(r)};function u(e){Y(e,{name:"string"}),e.data&&Y(e.data,"object"),e.config&&e.config.env&&Y(e.config.env,"string")}function c(e){return l.apply(this,arguments)}function l(){return(l=h()((function*(t){try{var r;if(u(t),t.cdnMapPromise=Ar(t.data),r="sdk"===e.runtime.platform&&e.plugins.length?s()(t):a()?i()(t):o()(t),Mt()){var n=Date.now();Er(r,(()=>{var r;return{url:`wx.cloud.callFunction.${t.name}`,headers:{Env:e.isInstance?e.env:(null===(r=t.config)||void 0===r?void 0:r.env)||e.env},reqBody:ir(t.data),timestampMs:n,console:e.debug}}))}return yield r}catch(e){throw N(e,Tr)}finally{Yt({...t.context,apiEndTime:+new Date,apiName:a()?Tr:wr})}function a(){return 1===t.version}}))).apply(this,arguments)}}function Cr(e){return{callFunction:Sr(e)}}var br="functions";function Nr(e){e.registerService(function(e){var t={name:br,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,serviceEndpoint:e.serviceEndpoint,runtime:e.runtimeInfo,plugins:e.plugins,get debug(){return e.debug},get env(){return e.getEnvForService(br)},appConfig:{get maxReqDataSize(){return e.appConfig.call_function_max_req_data_size},get maxPollRetry(){return e.appConfig.call_function_poll_max_retry},get maxStartRetryGap(){return e.appConfig.call_function_valid_start_retry_gap},get clientPollTimeout(){return e.appConfig.call_function_client_poll_timeout}}};return{name:br,context:t,getAPIs:Cr.bind(null,t)}}(e))}var Or=Symbol("CDN");class Rr{constructor(e){this.symbol=Or,this.options=void 0,this.options=e}}function Br(e,t){return new Promise(((r,n)=>{(t||re()).uploadToCommonCDN({...e,success:r,fail:n})}))}function Dr(e,t){return new Promise(((r,n)=>{(t||re()).invokeOperateWXData({...e,success:r,fail:n})}))}var Lr=function(){var e=h()((function*(e){try{if(!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");var t=new WeakMap,r=[];e.data&&JSON.stringify(e.data,((n,i)=>i&&i.symbol===Or?void r.push(new Promise(((r,n)=>{var o,a={appType:301,fileType:20303,fileKey:`file_${Math.random()}`},s=i;if("Object"===(o=s.options,Object.prototype.toString.call(o).slice(8,-1))){if(!s.options.filePath)throw new Error("filePath must be provided");a.filePath=s.options.filePath}else a.fileData=s.options;r(Br(a,e.sdk).then((e=>{t.set(i,e.fileUrl)})))}))):i)),yield Promise.all(r);var n,i,o,a=JSON.stringify(e.data,((e,r)=>r&&r.symbol===Or&&t.has(r)?t.get(r):r)),{data:s}=yield Dr({apiName:"webapi_servicemarket_jsapi_comm",reqData:{service_id:e.service,api_name:e.api,data:a,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:`${Math.random()}_${Date.now()}`,version:1}},e.sdk);try{var u=s;if(n=u.request_id,0===u.errcode)i=JSON.parse(u.data);else{var c=`invokeService:fail ${u.errcode} ${u.errmsg} (requestId: ${n})`;(o=new Error(c)).errCode=u.errcode,o.errMsg=c,o.requestId=n}}catch(f){var l=`invokeService:fail inner protocol parse failed (requestId: ${n||"empty"})`;(o=new Error(l)).errCode=-1,o.errMsg=l,o.requestId=n}if(o)throw o;return{errMsg:"invokeService:ok",data:i,requestId:n}}catch(e){var d="invokeService:fail ";if(e&&e.errMsg&&e.err_code){d+=e.errMsg;var f=new Error(d+`(err_code ${e.err_code})`);throw f.errCode=e.err_code,f}throw e&&e.errMsg&&e.errCode?e:new Error(`invokeService:fail ${e}`)}}));return function(t){return e.apply(this,arguments)}}(),Pr=function(e){return e[e.CALL=1]="CALL",e[e.POLL=2]="POLL",e[e.PreResp=3]="PreResp",e[e.FinalResp=4]="FinalResp",e}({}),Mr=function(e){return e[e.None=0]="None",e[e.SysErr=1]="SysErr",e[e.Timeout=2]="Timeout",e}({}),xr=function(e){return e[e.Sync=0]="Sync",e[e.LongAsync=2]="LongAsync",e}({}),Ur={SM_EXCEED_MAX_TIMEOUT_POLL_RETRY:100,SM_EMPTY_CALL_RESULT:101,SM_EXCEED_MAX_POLL_RETRY:102,SM_PROVIDER_EXECUTION_ERROR:103,SM_POLL_RESULT_EXPIRED:104,SM_EMPTY_POLL_RESULT_BASE_RESP:105,SM_POLL_RESULT_BASE_RESP_RET_ABNORMAL:106,SM_UNKNOWN_SCENE:107,SM_SYSTEM_ERROR:108},kr="exceed max timeout retry",qr="empty call result",Qr="exceed max poll retry",Fr="invokeService",Hr=2e4,Gr=e=>{var t=new Date;return`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()} ${e}`},Wr=e=>e.join("->"),jr=function(){var e=h()((function*(e){try{if(!e.service||!e.api)throw new Error("field 'service' and 'api' must be provided");var t=new WeakMap,r=[];e.data&&JSON.stringify(e.data,((n,i)=>i&&i.symbol===Or?void r.push(new Promise(((r,n)=>{var o,a={appType:301,fileType:20303,fileKey:`file_${Math.random()}`},s=i;if("Object"===(o=s.options,Object.prototype.toString.call(o).slice(8,-1))){if(!s.options.filePath)throw new Error("filePath must be provided");a.filePath=s.options.filePath}else a.fileData=s.options;r(Br(a,e.sdk).then((e=>{t.set(i,e.fileUrl)})))}))):i)),yield Promise.all(r);var n=JSON.stringify(e.data,((e,r)=>r&&r.symbol===Or&&t.has(r)?t.get(r):r)),i=`${Math.random()}_${Date.now()}`;if(e.async){var o={service_id:e.service,api_name:e.api,data:n,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:`${Math.random()}_${Date.now()}`,version:2,call_id:i,scene:Pr.CALL,retry_reason:Mr.None,req_type:xr.LongAsync},a=(yield Dr({apiName:"webapi_servicemarket_jsapi_comm",reqData:o},e.sdk)).data;if(a.scene===Pr.FinalResp&&0===a.errcode)return{errMsg:"invokeService:ok",requestId:a.request_id};var s=N({errCode:Ur.SM_SYSTEM_ERROR,errMsg:`requestID ${a.request_id}, error message ${a.errmsg||"unknown"} (callid ${i})`},Fr);throw s.requestID=a.request_id,s}var{result:u,requestID:c}=yield function(e,t,r){return f.apply(this,arguments)}(e,n,i);return{errMsg:"invokeService:ok",data:u,requestId:c}}catch(e){var l="invokeService:fail ";if(e&&e.errMsg&&e.err_code){l+=e.errMsg;var d=new Error(l+`(err_code ${e.err_code})`);throw d.errCode=e.err_code,d}throw e&&e.errMsg&&e.errCode?e:new Error(`invokeService:fail ${e}`)}function f(){return f=h()((function*(e,t,r){return new Promise(((n,i)=>{var o=[Gr("start")],{resolve:a,reject:s}=A(o,n,i);p({param:e,data:t,callID:r,scene:Pr.CALL,retryReason:Mr.None,tryCount:50,systemErrorRetry:2,timeoutErrorRetry:2,trace:o,resolve:a,reject:s})}))})),f.apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return g=h()((function*(t){var{param:r,data:n,callID:i,scene:o,retryReason:a,tryCount:s,trace:u,systemErrorRetry:c,timeoutErrorRetry:l,resolve:d,reject:f}=t,g={service_id:r.service,api_name:r.api,data:o===Pr.CALL?n:void 0,consume_type:e.consumeType,consume_appid:e.consumeAppid,client_msg_id:`${Math.random()}_${Date.now()}`,version:2,call_id:i,scene:o,retry_reason:a},A=!1,m=!1,y=()=>{clearTimeout(E),m=!0},v=+new Date,E=setTimeout(h()((function*(){if(!(+new Date-v>2e4&&(yield se(),m))){if(!Mt()&&+new Date-v>60)return u.push(Gr("timeout, exceed max retry gap")),f(N({errCode:Ur.SM_POLL_RESULT_EXPIRED,errMsg:`timeout for retry, cannot retry fetching the result anymore (callId: ${i}) (trace: ${Wr(u)})`},Fr));A=!0,t.timeoutErrorRetry>0?(u.push(Gr("timeout, retry")),p({...t,scene:o,retryReason:Mr.Timeout,tryCount:s-1,timeoutErrorRetry:l-1})):(u.push(Gr("timeout, abort")),f(N({errCode:Ur.SM_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:`${kr} (callId: ${i}) (trace: ${Wr(u)})`},Fr)))}})),Hr);try{var _=yield Dr({apiName:"webapi_servicemarket_jsapi_comm",reqData:g},e.sdk);try{if(A)return;y();var I=_.data;if(!I&&_.rawData)try{I=JSON.parse(_.rawData)}catch(e){}if(!I)return u.push(Gr("empty resp")),f(N({errCode:Ur.SM_EMPTY_CALL_RESULT,errMsg:qr},Fr));if(I.scene!==Pr.PreResp){if(I.scene===Pr.FinalResp){if(0!==I.errcode){var T=N({errCode:Ur.SM_PROVIDER_EXECUTION_ERROR,errMsg:`requestID ${I.request_id}, error message ${I.provider_errmsg||"unknown"} (callid ${i})`},Fr);return T.requestID=I.request_id,f(T)}var w=I.data;try{w=JSON.parse(w)}catch(e){}return d({result:w,requestID:I.request_id})}return u.push(Gr("unexpected scene")),f(N({errCode:Ur.SM_UNKNOWN_SCENE,errMsg:`unknown scene ${I.scene} (callId: ${i}) (trace: ${Wr(u)})`},Fr))}if(!(s>=0))return u.push(Gr("too many polls, abort")),f(N({errCode:Ur.SM_EXCEED_MAX_POLL_RETRY,errMsg:`${Qr} (callId: ${i}) (trace: ${Wr(u)})`},Fr));u.push(Gr("normal poll")),p({...t,scene:Pr.POLL,retryReason:Mr.None,tryCount:s-1})}catch(e){f(N({errCode:Ur.SM_POLL_ERROR,errMsg:`polling catch error: ${e} (callId: ${i})`},Fr))}}catch(e){if(A)return;y();var S=e instanceof Error?e:JSON.stringify(e);e&&e.operateWXDataFail&&c>0?(u.push(Gr(`system error (${S}), retry`)),p({...t,scene:o,retryReason:Mr.SysErr,tryCount:s-1,systemErrorRetry:c-1})):(u.push(Gr(`system error (${S}), abort`)),f(N(`${S} (callId: ${i}) (trace: ${Wr(u)})`,Fr)))}})),g.apply(this,arguments)}function A(e,t,r){var n=t=>{e.push(Gr(`app ${t}`))};pe(n);return{resolve:e=>{ge(n),t(e)},reject:e=>{ge(n),r(e)}}}}));return function(t){return e.apply(this,arguments)}}();function $r(e){return Yr.apply(this,arguments)}function Yr(){return(Yr=h()((function*(e){var t=(yield Dr({apiName:"webapi_servicemarket_jsapi_retrieve",reqData:{request_id:e.requestId}},e.sdk)).data;if(0===t.errcode)return t.provider_errmsg?{errCode:0,errMsg:"getAsyncResult:fail provider execution error",status:t.status,providerErrMsg:t.provider_errmsg,requestId:t.request_id}:{errCode:0,errMsg:"getAsyncResult:ok",data:JSON.parse(t.data),status:t.status,requestId:t.request_id};var r=new Error(`getAsyncResult:fail requestID ${t.request_id}, error message ${t.errmsg||"unknown"}`);throw r.errCode=t.errcode,r.errMsg=t.errmsg,r}))).apply(this,arguments)}var Jr,Kr="invokeService",zr="getAsyncResult",Xr=e=>{(Mt()&&!e.async?Lr(e):jr(e)).then((t=>{W(Kr,e,t)})).catch((t=>{j(Kr,e,t)}))},Vr=e=>{$r(e).then((t=>{W(zr,e,t)})).catch((t=>{j(zr,e,t)}))};function Zr(e={}){var{sdk:t}=e;return{invokeService:e=>(e=>$(e)?Xr(e):Mt()&&!e.async?Lr(e):jr(e))({...e,sdk:t}),getAsyncResult:e=>(e=>$(e)?Vr(e):$r(e))({...e,sdk:t}),CDN:Rr}}function en(){if(!Jr){var e=re();if(!e.private_getUserAgent)return Jr;e.private_getUserAgent((e=>{Jr=e}))}return Jr}function tn(e){e.path||(e.path=""),e.method||(e.method="GET"),e.header||(e.header={}),e.dataType||(e.dataType="json"),e.responseType||(e.responseType="text");var t="";for(var r in e.header)"content-type"===r.toLowerCase()&&e.header&&(t=e.header[r]);if(t||(t="application/json",e.header["content-type"]="application/json"),e.header["User-Agent"]=en()||"",/get/i.test(e.method||"")&&e.data&&m(e.data)){var n="";for(var i in e.data)n+=`${n.length?"&":""}${Ie(i)}=${Ie(e.data[i])}`;e.path.includes("?")?e.path+=`${e.path.endsWith("&")?"":n?"&":""}${n}`:e.path+=`${e.path.endsWith("?")?"":n?"?":""}${n}`,e.data=void 0}else if(/post|put|patch|delete/i.test(e.method||"")&&e.data)if(t.includes("application/json")){var o=A(e.data);e.shouldSerialize="string"!==o}else if(t.includes("application/x-www-form-urlencoded")&&m(e.data)){var a="";for(var s in e.data)a+=`${a.length?"&":""}${encodeURIComponent(s)}=${encodeURIComponent(e.data[s])}`;e.data=a}}function rn(e){return e>=300&&e<=399}class nn extends Error{constructor(e,t){super(e),this.code=void 0,this.code=t}}var on=new WeakMap;var an="cloud.callContainer";function sn(e){return function(){var r=h()((function*(r){var n=e.serviceEndpoint.getEndpointSync("container"),i=new WeakMap;if(r.cdnMapPromise||!n){var a=yield Promise.all([r.cdnMapPromise,un(e.serviceEndpoint.getEndpoint("container"),r.stats,"getServiceEndpoint")]);a[0]&&(i=a[0]),n=a[1]}else r.stats.getServiceEndpoint=0;if(r.shouldSerialize&&(r.data=ir(r.data,i)),n.http){var s=function(t,r){return new Promise(((n,i)=>{var a,s;r.stats.tsCallContainerImplStart=Date.now();var u=re(e.identifiers),c={"X-WX-ENCRYPTION-VERSION":2,"X-WX-ENCRYPTION-TIMESTAMP":t.timestamp+"","X-WX-COMPRESSION":"snappy","X-WX-USER-TIMEOUT":r.timeout||"","X-WX-LIB-BUILD-TS":1678888746406,"X-WX-RESPONSE-CONTENT-ACCEPT-ENCODING":"PB, JSON","Content-Type":"application/octet-stream"},l=`${Math.random()}_${Date.now()}`,d={...r.header,"X-WX-ENV":e.isInstance?e.env:(null===(a=r.config)||void 0===a?void 0:a.env)||e.env,"X-WX-CALL-ID":l};e.appid&&(d["X-WX-RESOURCE-APPID"]=e.appid),r.service&&(d["X-WX-SERVICE"]=r.service);var f=r.stats;f.callid=l;var h=Date.now();if("GET"===(null===(s=r.method)||void 0===s?void 0:s.toUpperCase())&&r.data&&m(r.data)){var p=[];for(var g in r.data)p.push(`${g}=${r.data[g]}`);r.path+=`${r.path.includes("?")?r.path.endsWith("&")?"":"&":"?"}${p.join("&")}`,r.data=void 0}d["X-WX-CONTAINER-PATH"]=r.path;var A=new Uint8Array(Se(t.key)),{data:y,contentEncoding:v}=Le.V1.encodeRequest(A,d,r.method||"GET",r.data,l,f);c["X-WX-REQUEST-CONTENT-ENCODING"]=v,f.encrypt=Date.now()-h,h=Date.now();var E=!0,_=E?t.url:`http://${t.vip}/wxa-qbase/container_service?token=${t.token}`;r.rdm?_=`https://wxardm.weixin.qq.com/wxa-qbase/container_service?token=${t.token}`:r.ecdn&&(_=`https://cloudbase.servicewechat.com/wxa-qbase/container_service?token=${t.token}`),r.verbose&&o.log(`[cloud.callContainer] url ${_}`),E&&t.domain&&(r.stats.domain=t.domain),f.requestBodyBytes=y.byteLength,f.requestStartTs=Date.now(),r._fallback?i({errCode:-9999,errMsg:`${an}:fail emulated fallback`}):u._requestSkipCheckDomain({url:_,method:"POST",header:c,data:y.buffer,dataType:"arraybuffer",responseType:"arraybuffer",timeout:r.timeout,enableHttp2:E,success:e=>{try{for(var a in e.header)if("x-nws-log-uuid"===a.toLowerCase()&&(r.verbose&&o.log(`[cloud.callContainer] x-nws-log-uuid ${e.header[a]}`),r.stats.ecdnId=e.header[a]),"x-edge-timing"===a.toLowerCase()&&(r.stats.ecdnEdgeTiming=e.header[a]),"x-wx-system-error"===a.toLowerCase()){var s=Number(e.header[a]);return 85104===s&&t.invalidate(),void i({errCode:s,errMsg:`${an}:fail system error. code: ${s}`})}if(r.verbose&&o.warn("res",e),f.profile=e.profile,f.httpRequest=Date.now()-h,200===e.statusCode){var u=e.data;f.responseBodyBytes=u.byteLength,h=Date.now();var c=!1,d=Le.m.pb;for(var p in e.header)if("x-wx-compression"===p.toLowerCase()&&"snappy"===e.header[p]&&(h=Date.now(),c=!0),"x-wx-response-content-encoding"===p.toLowerCase()&&"json"===e.header[p].toLowerCase()&&(d=Le.m.json),"x-wx-server-timing"===p.toLowerCase()){var g=(e.header[p]||"").split(",");g.length>=2&&(f.serverStartTs=Number(g[0]),f.serverEndTs=Number(g[1]))}var m,y=Le.V1.decodeResponse(A,new Uint8Array(u),c,d);h=Date.now();var v=y.body;if(!rn(y.statusCode))if("json"===r.dataType)m=_e("string"==typeof v?v:Ce(v.buffer));else m="text"===r.responseType?"string"==typeof v?v:Ce(v.buffer):"arraybuffer"===r.responseType?"string"==typeof v?be(v):v.buffer:v;f.decodeBody=Date.now()-h,f.responseProcessEndTs=Date.now(),n({statusCode:y.statusCode,header:y.header,data:m,stats:f,callID:l,errMsg:`${an}:ok`})}else i({errCode:-9999,errMsg:`${an}:fail [call_id ${l}] system conn status not 200`})}catch(e){i({errCode:-1,errMsg:`${an}:fail [call_id ${l}] error while processing internal response ${e}`})}},fail:e=>{i({...e,errCode:-9999,errMsg:e.errMsg.replace(/^request/,an)})}})}))}(n,r);return s.then(Dt).catch(Dt),s}return function(e,r){return t.apply(this,arguments)}(n.url,r)}));return function(e){return r.apply(this,arguments)}}();function t(){return t=h()((function*(t,r){return new Promise(((n,i)=>{var o,a=re(e.identifiers),s={...r.header,"X-WX-ENV":e.isInstance?e.env:(null===(o=r.config)||void 0===o?void 0:o.env)||e.env,"X-WX-SERVICE":r.service,"X-WX-CONTAINER-PATH":r.path,"X-WX-CALL-ID":`${Math.random()}_${Date.now()}`,"X-WX-USER-TIMEOUT":r.timeout};e.appid&&(s["X-WX-RESOURCE-APPID"]=e.appid),a._requestSkipCheckDomain({url:t,method:r.method,header:s,data:r.data,dataType:r.dataType,responseType:r.responseType,timeout:r.timeout,success:e=>{n({...e,errMsg:`${an}:ok`})},fail:e=>{i({...e,errMsg:e.errMsg.replace(/^request/,an)})}})}))})),t.apply(this,arguments)}}function un(e,t,r){var n=Date.now();return e.then((()=>t[r]=Date.now()-n)).catch((()=>t[r]=Date.now()-n)),e}var cn=function(e){return e[e.CALL=1]="CALL",e[e.POLL=2]="POLL",e}({}),ln=function(e){return e[e.None=0]="None",e[e.Error=1]="Error",e[e.Timeout=2]="Timeout",e}({}),dn=function(e){return e[e.RAW=0]="RAW",e[e.BASE64=1]="BASE64",e[e.CDN_URL=2]="CDN_URL",e}({}),fn=e=>{var t=new Date;return`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()} ${e}`},hn=e=>e.join("->"),pn=2e4,gn=1e5,An="cloud.callContainer";function mn(e){return function(){var t=h()((function*(t){var r,n;if(t.shouldSerialize){var i=yield t.cdnMapPromise;t.data=ir(t.data,i)}var o=dn.RAW,a=(null===(r=t.method)||void 0===r?void 0:r.toUpperCase())||"GET";if(t.data&&/^(POST|PUT|PATCH|DELETE)$/.test(a)){var s=A(t.data);if("object"===s)t.data=JSON.stringify(t.data);else{if("arraybuffer"!==s&&"string"!==s)throw new Error(`input data type is not supported: ${s}`);var u=!1;if("string"===s)u=t.data.length>gn;else if(t.data.byteLength>gn)u=!0;else{var c=we(t.data);c.length>gn?u=!0:(t.data=c,o=dn.BASE64)}if(u)throw new Error("input data size too large (> 100KB)")}}else if("GET"===a&&t.data&&m(t.data)){var l=[];for(var d in t.data)l.push(`${d}=${t.data[d]}`);t.path+=`${t.path.includes("?")?t.path.endsWith("&")?"":"&":"?"}${l.join("&")}`,t.data=void 0}else t.data=void 0;var f=`${+new Date}-${Math.random()}`;for(var p in t.stats.callid=f,t.header={...t.header,"X-WX-ENV":e.isInstance?e.env:(null===(n=t.config)||void 0===n?void 0:n.env)||e.env,"X-WX-CONTAINER-PATH":t.path},t.service&&(t.header["X-WX-SERVICE"]=t.service),t.header)null!==t.header[p]&&void 0!==t.header[p]&&(t.header[p]+="");t.context.tunnelStartTime=+new Date;var{result:g}=yield function(e,t,r,n){return y.apply(this,arguments)}(t,t.data,o,f);return t.context.tunnelEndTime=+new Date,{...g,errMsg:nr(An),callID:f};function y(){return y=h()((function*(t,r,n,i){var o,a=!1;t.hasOwnProperty("timeout")&&(o=new Promise(((e,r)=>{setTimeout((()=>{a=!0,r(`timeout (options.timeout == ${t.timeout})`)}),t.timeout)})));var s=new Promise(((s,u)=>{var c=[fn("start")],{resolve:l,reject:d}=_(c,s,u);v({param:t,data:r,dataType:n,callID:i,action:cn.CALL,retryType:ln.None,tryCount:e.appConfig.maxPollRetry||20,systemErrorRetry:2,timeoutErrorRetry:2,userTimeout:{get reached(){return!!o&&a}},trace:c,resolve:l,reject:d})}));return o?Promise.race([s,o]):s})),y.apply(this,arguments)}function v(e){return E.apply(this,arguments)}function E(){return E=h()((function*(r){var{data:n,dataType:i,callID:o,action:a,retryType:s,tryCount:u,trace:c,systemErrorRetry:l,timeoutErrorRetry:d,userTimeout:f,resolve:p,reject:g}=r,A=[];for(var m in t.header)A.push({k:m,v:t.header[m]});var y=ir(a===cn.CALL?{method:t.method||"GET",headers:A,data:a===cn.CALL?n:void 0,data_type:i,action:a,retryType:s,call_id:o,user_timeout:t.timeout}:{call_id:o,action:a,retryType:s}),E=!1,_=!1,I=()=>{clearTimeout(w),_=!0},T=+new Date,w=setTimeout(h()((function*(){var t=e.appConfig.clientPollTimeout||pn;if(!(+new Date-T>t&&(yield se(),_)||f.reached)){if(!Mt()&&+new Date-T>e.appConfig.maxStartRetryGap)return c.push(fn("timeout, exceed max retry gap")),g(O({errCode:S.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:`timeout for retry, cannot retry fetching the result anymore (callId: ${o}) (trace: ${hn(c)})`},An));E=!0,r.timeoutErrorRetry>0?(c.push(fn("timeout, retry")),v({...r,retryType:ln.Timeout,tryCount:u-1,timeoutErrorRetry:d-1})):(c.push(fn("timeout, abort")),g(O({errCode:S.SDK_CONTAINER_EXCEED_MAX_TIMEOUT_POLL_RETRY,errMsg:`(callId: ${o}) (trace: ${hn(c)})`},An)))}})),e.appConfig.clientPollTimeout||pn),C=e=>{var r=e.data;r&&r.baseresponse&&r.baseresponse.stat&&r.baseresponse.stat.qbase_cost_time&&(t.context.tunnelTimeNoCSNetCost+=r.baseresponse.stat.qbase_cost_time)};function b(){return b=h()((function*(n){try{if(E||f.reached)return;I(),C(n);var i=n.data;if(!i)return c.push(fn("empty resp")),g(O({errCode:S.SDK_CONTAINER_EMPTY_CALL_RESULT},An));if(!i.baseresponse||0!==i.baseresponse.errcode)return i.baseresponse?0!==i.baseresponse.errcode?g(O({errCode:S.SDK_CONTAINER_POLL_RESULT_BASE_RESP_RET_ABNORMAL,errMsg:`polling base_resp.errcode ${i.baseresponse.errcode} errmsg ${i.baseresponse.errmsg} (callId: ${o})`},An)):g(O({errCode:S.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP,errMsg:`polling base_resp ${JSON.stringify(i.baseresponse)} (callId: ${o})`},An)):g(O({errCode:S.SDK_CONTAINER_EMPTY_POLL_RESULT_BASE_RESP},An));if(0!==i.status){if(1===i.status){var a;if(i.data_type===dn.BASE64)a=Se(i.data),"json"===t.dataType?a=_e(Ce(a)):"arraybuffer"!==t.responseType&&(a=Ce(a));else if(i.data_type===dn.CDN_URL)try{var s=re(e.identifiers),l=yield new Promise(((e,r)=>{s._requestSkipCheckDomain({url:i.data,dataType:t.dataType,responseType:t.responseType,success:t=>{200!==t.statusCode?r(`download response status code ${t.statusCode}`):e(t)},fail:e=>{r(e)}})}));a=l.data}catch(e){return g(O({errCode:S.SDK_CONTAINER_DOWNLOAD_RESULT_FROM_CDN_FAIL,errMsg:`error: ${e} \n (callId: ${o}) (trace: ${hn(c)})`},An))}else a=i.data,"arraybuffer"===t.responseType?a=be(a):"json"===t.dataType&&(a=_e(a));return p({result:{data:a,statusCode:i.http_code,header:i.headers.reduce(((e,t)=>{var r=e[t.k+""];return e[t.k+""]=r?r+","+t.v:t.v+"",e}),{})}})}return c.push(fn("poll result expired")),g(O({errCode:S.SDK_CONTAINER_POLL_RESULT_EXPIRED,errMsg:`timeout for result fetching, result cannot be fetched anymore (callId: ${o}) (trace: ${hn(c)})`},An))}if(!(u>=0))return c.push(fn("too many polls, abort")),g(O({errCode:S.SDK_CONTAINER_EXCEED_MAX_POLL_RETRY,errMsg:`(callId: ${o}) (trace: ${hn(c)})`},An));c.push(fn("normal poll")),v({...r,action:cn.POLL,retryType:ln.None,tryCount:u-1})}catch(e){g(O({errCode:S.SDK_CONTAINER_POLL_ERROR,errMsg:`polling catch error: ${e} (callId: ${o})`},An))}})),b.apply(this,arguments)}f.reached||e.request({...t.config,apiName:"tcbapi_call_container",serviceName:e.name,serializedReqData:y,env:t.config&&t.config.env||e.env}).then((function(e){return b.apply(this,arguments)})).catch((e=>{E||f.reached||(I(),e&&e.operateWXDataFail&&l>0?(c.push(fn(`system error (${e}), retry`)),v({...r,retryType:ln.Error,tryCount:u-1,systemErrorRetry:l-1})):(c.push(fn(`system error (${e}), abort`)),g(O(`${e} (callId: ${o}) (trace: ${hn(c)})`,An))))}))})),E.apply(this,arguments)}function _(e,t,r){var n=t=>{e.push(fn(`app ${t}`))};pe(n);return{resolve:e=>{ge(n),t(e)},reject:e=>{ge(n),r(e)}}}}));return function(e){return t.apply(this,arguments)}}()}var yn="cloud.callContainer";function vn(e){return function(){var r=h()((function*(r){var n=e.serviceEndpoint.getEndpointSync("container"),i=new WeakMap;if(r.cdnMapPromise||!n){var a=yield Promise.all([r.cdnMapPromise,En(e.serviceEndpoint.getEndpoint("container"),r.stats,"getServiceEndpoint")]);a[0]&&(i=a[0]),n=a[1]}else r.stats.getServiceEndpoint=0;return r.shouldSerialize&&(r.data=ir(r.data,i)),n.http?function(t,r){return new Promise(((n,i)=>{var a;r.stats.tsCallContainerImplStart=Date.now();var s=re(e.identifiers),u={"X-WX-EV":3,"Content-Type":"application/octet-stream"},c=`${Math.random()}_${Date.now()}`,l={...r.header,"X-WX-ENV":e.isInstance?e.env:(null===(a=r.config)||void 0===a?void 0:a.env)||e.env,"X-WX-SERVICE":r.service,"X-WX-CONTAINER-PATH":r.path,"X-WX-CALL-ID":c};e.appid&&(l["X-WX-RESOURCE-APPID"]=e.appid);var d=r.stats;d.callid=c;var f=Date.now(),h=new Uint8Array(s.wx.base64ToArrayBuffer(t.key)),{data:p}=Le.V3.encodeRequest(h,l,r.method||"GET",r.data);d.encrypt=Date.now()-f,f=Date.now();var g=!0,A=t.url;r.rdm?A=`https://wxardm.weixin.qq.com/wxa-qbase/container_service?token=${t.token}`:r.ecdn&&(A=`https://cloudbase.servicewechat.com/wxa-qbase/container_service?token=${t.token}`),r.verbose&&o.log(`[cloud.callContainer] url ${A}`),g&&t.domain&&(r.stats.domain=t.domain),d.requestBodyBytes=p.byteLength,d.requestStartTs=Date.now(),s._requestSkipCheckDomain({url:A,method:"POST",header:u,data:p.buffer,dataType:"arraybuffer",responseType:"arraybuffer",timeout:r.timeout,enableHttp2:g,success:e=>{try{for(var t in e.header)if("x-nws-log-uuid"===t.toLowerCase()&&(r.verbose&&o.log(`[cloud.callContainer] x-nws-log-uuid ${e.header[t]}`),r.stats.ecdnId=e.header[t]),"x-edge-timing"===t.toLowerCase()&&(r.stats.ecdnEdgeTiming=e.header[t]),"x-wx-system-error"===t.toLowerCase()){var a=Number(e.header[t]);return void i({errCode:a,errMsg:`${yn}:fail system error. code: ${a}`})}if(d.profile=e.profile,d.httpRequest=Date.now()-f,200===e.statusCode){var s=e.data;d.responseBodyBytes=s.byteLength,f=Date.now();var u,l=Le.V3.decodeResponse(h,new Uint8Array(s));for(var p in d.decrypt=Date.now()-f,e.header)if("x-wx-server-timing"===p.toLowerCase()){var g=(e.header[p]||"").split(",");g.length>=2&&(d.serverStartTs=Number(g[0]),d.serverEndTs=Number(g[1]))}f=Date.now();var A=l.body;if("json"===r.dataType)u=_e("string"==typeof A?A:Ce(A.buffer));else u="text"===r.responseType?"string"==typeof A?A:Ce(A.buffer):"arraybuffer"===r.responseType?"string"==typeof A?be(A):A.buffer:A;d.decodeBody=Date.now()-f,d.responseProcessEndTs=Date.now(),n({statusCode:l.statusCode,header:l.header,data:u,stats:d,callID:c,errMsg:`${yn}:ok`})}else{var m=-1;for(var y in e.header)"x-wx-system-error"===y.toLowerCase()&&(m=Number(e.header[y]));i({errCode:m,errMsg:`${yn}:fail system error, status ${e.statusCode}. code: ${m}`})}}catch(e){i({errCode:-1,errMsg:`${yn}:fail error while processing internal response ${e}`})}},fail:e=>{i({...e,errMsg:e.errMsg.replace(/^request/,yn)})}})}))}(n,r):function(e,r){return t.apply(this,arguments)}(n.url,r)}));return function(e){return r.apply(this,arguments)}}();function t(){return t=h()((function*(t,r){return new Promise(((n,i)=>{var o,a=re(e.identifiers),s={...r.header,"X-WX-ENV":e.isInstance?e.env:(null===(o=r.config)||void 0===o?void 0:o.env)||e.env,"X-WX-SERVICE":r.service,"X-WX-CONTAINER-PATH":r.path,"X-WX-CALL-ID":`${Math.random()}_${Date.now()}`,"X-WX-USER-TIMEOUT":r.timeout};e.appid&&(s["X-WX-RESOURCE-APPID"]=e.appid),a._requestSkipCheckDomain({url:t,method:r.method,header:s,data:r.data,dataType:r.dataType,responseType:r.responseType,timeout:r.timeout,success:e=>{n({...e,errMsg:`${yn}:ok`})},fail:e=>{i({...e,errMsg:e.errMsg.replace(/^request/,yn)})}})}))})),t.apply(this,arguments)}}function En(e,t,r){var n=Date.now();return e.then((()=>t[r]=Date.now()-n)).catch((()=>t[r]=Date.now()-n)),e}var _n="cloud.callContainer",In=0,Tn=1,wn=2,Sn=!0,Cn=0,bn=new WeakMap;function Nn(e){var t=[void 0,sn(e),mn(e),vn(e)];function r(e){return t[e]}return function(e){var t=+new Date;Y(e,"object");var r=X(e);return r.data||(r.data={}),r.dataType||(r.dataType="json"),r.context={tunnelTimeNoCSNetCost:0,apiStartTime:t,warmStartTime:jt()},r.stats={apiStartTime:t},$(r)?function(e){H({apiName:_n,param:e}),i(e).then((t=>{W(_n,e,t)})).catch((t=>{j(_n,e,t)}))}(r):i(r)};function n(t){var r;if(t.service,e.isInstance){if(!e.env)throw new Error("envId must be provided")}else if(null!==(r=t.config)&&void 0!==r&&r.env)Y(t.config.env,"string");else if(!e.env)throw new Error("envId must be provided")}function i(e){return o.apply(this,arguments)}function o(){return o=h()((function*(t){var r=!1;try{Cn++,n(t),tn(t),t.cdnMapPromise=t.shouldSerialize?Ar(t.data):void 0;var i=Date.now();r=Sn?(Sn=!1,yield a(t)):u(t),t.stats.tsBeforeCallContainerImpl=Date.now();var o,s=X(t),h=t.data,p=c(t,r),g=t.service||t.header["X-WX-SERVICE"];o=g?`wx.cloud.callContainer.${g}${t.path}`:`wx.cloud.callContainer${t.path}`,Er(p,(()=>{var r;return{url:o,method:t.method,headers:{Env:e.isInstance?e.env:(null===(r=t.config)||void 0===r?void 0:r.env)||e.env,...t.header},reqBody:ir(h),timestampMs:i,console:e.debug}}));var A=d(s,f(s,p)),m=yield A;return l(t,r),Bt(),m}catch(e){throw N(e,_n)}finally{0===--Cn&&(0,Le.j)(re()._WebAssembly)}})),o.apply(this,arguments)}function a(e){return s.apply(this,arguments)}function s(){return(s=h()((function*(t){if(!Boolean(e.serviceEndpoint.getEndpointSync("container"))){var r=new Promise((e=>setTimeout(e,50))),n=e.serviceEndpoint.getEndpoint("container");yield Promise.race([r,n])}return u(t)}))).apply(this,arguments)}function u(t){return"windows"!==Ae().platform&&(1===t.apiVersion||2!==t.apiVersion&&Boolean(e.serviceEndpoint.getEndpointSync("container")))}function c(e,t){var n,i;if(t=null!==(n=t)&&void 0!==n?n:u(e)){var o={...e,stats:{...e.stats}};i=r(1)(e).catch((e=>{if(-9999===(null==e?void 0:e.errCode))return r(2)(o);throw e}))}else i=r(2)(e);return i}function l(e,t){rr(_n,e,t?"v1":"im")}function d(t,r){var n;if(e.identifiers.pluginId)return r;var i=re(e.identifiers);if(!i.isUsedCache())return r;var o,a,s,u=(o=r,a={abort:()=>{},promise:Promise.resolve()},s=new Promise(((e,t)=>{a.abort=t})),a.promise=Promise.race([o,s]),a),c=i.reportCallContainer,l=i.privateCacheManager,d=i.cacheManager,f=Date.now(),{data:h,method:p}=t,g=`https://wx.cloud.callContainer/${(null===(n=t.config)||void 0===n?void 0:n.env)||e.env}`,A=t.service;if(!A)for(var m in t.header)"X-WX-SERVICE"===m.toUpperCase()&&(A=t.header[m]);g+=A?`/${A}${t.path}`:t.path;var y=(e,t,n)=>{var i=l.emit("request",{url:g,data:h,method:p,request:()=>new Promise(((e,t)=>{r.then(e).catch(t)}))});if(i.length){var o=i.find((e=>e&&"function"==typeof e.then));o&&o.then(e).catch(t).finally((()=>{u.abort()}))}else n&&t(n)};return new Promise(((e,t)=>{var n=t=>{c({isSuccess:!0,costTime:Date.now()-f,extra1:g}),e(t)},i=e=>{c({isSuccess:!1,costTime:Date.now()-f,extra1:g}),t(e)},o=e=>{l.checkNeedStore(g,h,p,e),n(e)};d.state===wn?r.then((e=>{o(e)})).catch((e=>{y(n,i,e)})):d.state===Tn?y(n,i):d.state===In&&r.then((e=>{o(e)})).catch((e=>{i(e)}))}))}function f(t,r){var n;if(!(null===(n=t.followRedirect)||void 0===n||n))return r;return function t(n,i){return new Promise(((o,a)=>{i.then((i=>{var s;if(rn(i.statusCode)){var u=null!==(s=bn.get(r))&&void 0!==s?s:0;if(u>=6)a("reach the max redirect count");else{bn.set(r,u+1);var l="";for(var d in i.header)"location"===d.toLowerCase()&&(l=i.header[d]);if(l)if(l.startsWith("/")){var f=X(n);n.path=l,t(f,c(n)).then(o).catch(a)}else{re(e.identifiers).request({url:l,method:n.method,header:n.header,data:n.data,dataType:n.dataType,responseType:n.responseType,timeout:n.timeout,success:e=>{o({...e,errMsg:`${_n}:ok`})},fail:e=>{a(e.errMsg.replace(/^request/,_n))}})}else o(i)}}else o(i)})).catch(a)}))}(t,r)}}var On="cloud.connectContainer";function Rn(e){return function(e){var t=X(e);return t.timing={apiStartTime:+new Date},$(t)?function(e){var t=r(e);t.then((t=>{W(On,e,t)})).catch((t=>{j(On,e,t)}))}(t):r(t)};function t(e){e.config&&e.config.env&&Y(e.config.env,"string")}function r(e){return n.apply(this,arguments)}function n(){return(n=h()((function*(e){try{return t(e),yield i(e)}catch(e){throw e}finally{Yt({...e.timing,apiEndTime:+new Date,apiName:On})}}))).apply(this,arguments)}function i(e){return o.apply(this,arguments)}function o(){return(o=h()((function*(t){var r={service_name:t.service},n=JSON.stringify(r);t.timing.tunnelStartTime=+new Date;var i=yield e.request({...t.config,apiName:"tcbapi_get_websocket_info",serviceName:e.name,serializedReqData:n,env:t.config&&t.config.env||e.env});t.timing.tunnelEndTime=+new Date;var o=i.data,{success:a,complete:s,...u}=t,c=re(e.identifiers)._socketSkipCheckDomainFactory().connectSocket({...u,url:`wss://${o.host}${t.path||""}`,header:{...u.header,"content-type":"application/json","x-wx-token":o.token},perMessageDeflate:!0});return{errMsg:nr(On),socketTask:c}}))).apply(this,arguments)}}function Bn(e){return{callContainer:Nn(e),connectContainer:Rn(e)}}var Dn="container";function Ln(e){e.registerService(function(e){var t={name:Dn,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,serviceEndpoint:e.serviceEndpoint,get debug(){return e.debug},get appid(){return e.isInstance?e.instanceOptions.resourceAppid:void 0},get env(){return e.getEnvForService(Dn)},appConfig:{get maxPollRetry(){return e.appConfig.call_container_poll_max_retry},get clientPollTimeout(){return e.appConfig.call_container_client_poll_timeout},get maxStartRetryGap(){return e.appConfig.call_container_valid_start_retry_gap}}};return{name:Dn,context:t,getAPIs:Bn.bind(null,t)}}(e))}const Pn={};var Mn={env:"",platform:""},xn=()=>Mn;if(void 0!==s)Mn.env="miniprogram",Mn.platform=s.platform,s.host&&"SAAASDK"===s.host.env&&(Mn.platform="sdk");else if(Mn.env="web",window)if(window.__wxjs_environment&&"miniprogram"===window.__wxjs_environment)Mn.platform="miniprogram";else{var Un=window.navigator.userAgent.toLowerCase();/MicroMessenger/i.test(Un)&&(Mn.platform="wxweb")}var kn="cloud.uploadFile";function qn(e){return function(e){if($(e=X(e)))return function(e){var r={aborted:!1},n=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),i={apiStartTime:+new Date};return t({...e,context:r,timing:i,uploadTaskAgent:n}).then((t=>{W(kn,e,t)})).catch((t=>{j(kn,e,t)})),n}(e);var r={apiStartTime:+new Date};return t({...e,timing:r})};function t(e){return new Promise(function(){var t=h()((function*(t,n){try{if(function(e){Y(e,{cloudPath:"string"}),"miniprogram"===xn().env?Y(e,{filePath:"string"}):J(e,"file","uploadFile")}(e),e.context&&(e.context.abort=function(){n(N({errMsg:"abort"},kn))},e.context.aborted))return n(N({errMsg:"abort"},kn));var i=yield function(e){return r.apply(this,arguments)}(e);t(i)}catch(e){n(N(e,kn))}finally{Yt({...e.timing,apiEndTime:+new Date,apiName:"cloud.uploadFile_v2"})}}));return function(e,r){return t.apply(this,arguments)}}())}function r(){return r=h()((function*(t){var r=re(e.identifiers),i=yield n(t);return new Promise(((e,n)=>{if(t.context&&t.context.aborted)return n(N({errMsg:"abort"},kn));var o,a;if("web"===xn().env){var s=new FormData;s.append("key",t.cloudPath),s.append("signature",i.authorization),s.append("x-cos-security-token",i.token),s.append("x-cos-meta-fileid",i.cos_file_id),s.append("file",t.file),o={url:i.url,timeout:t.timeout,filePath:"",header:t.header,name:"",formData:s}}else o={url:i.url,timeout:t.timeout,filePath:t.filePath,header:t.header,name:"file",formData:{key:t.cloudPath,signature:i.authorization,"x-cos-security-token":i.token,"x-cos-meta-fileid":i.cos_file_id}};(a=r._uploadFileSkipCheckDomain({...o,success:t=>{try{if(t.statusCode>=200&&t.statusCode<300)e({errMsg:nr(kn),fileID:i.file_id,statusCode:t.statusCode});else{var r=new C({errMsg:`status ${t.statusCode}, error: ${t.data};`});n(r)}}catch(r){var o=new C({errMsg:`Error : ${t.data};`});n(o)}},fail:e=>{n(e)}}))&&(a.onProgressUpdate((function(){t.uploadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&E(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r._uploadFileSkipCheckDomain,arguments)})),t.context&&(t.context.abort=a.abort.bind(a)))}))})),r.apply(this,arguments)}function n(e){return i.apply(this,arguments)}function i(){return(i=h()((function*(t){var r=JSON.stringify({path:t.cloudPath}),n=+new Date,i=(yield e.request({apiName:"tcbapi_cos_uploadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})).data;if(t.timing&&(t.timing.tunnelStartTime=n,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=i.baseresponse.stat.qbase_cost_time),!i.url)throw new C({errCode:S.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL,errMsg:S[S.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_UPLOAD_URL]});return i}))).apply(this,arguments)}}var Qn="cloud.downloadFile";function Fn(e){return function(e){if($(e=X(e)))return function(e){var r={aborted:!1},n=function(e){return{onProgressUpdate:function(t){e.onProgressUpdateUserHandler=t},abort:function(){e.abort&&e.abort(),e.aborted=!0}}}(r),i={apiStartTime:+new Date};return t({...e,context:r,timing:i,downloadTaskAgent:n}).then((t=>{W(Qn,e,t)})).catch((t=>{j(Qn,e,t)})),n}(e);var r={apiStartTime:+new Date};return t({...e,timing:r})};function t(e){return r.apply(this,arguments)}function r(){return r=h()((function*(e){return new Promise(function(){var t=h()((function*(t,r){try{if(n(e),e.context&&(e.context.abort=function(){r(N({errMsg:"abort"},Qn))},e.context.aborted))return r(N({errMsg:"abort"},Qn));t(yield i(e))}catch(e){r(N(e,Qn))}finally{Yt({...e.timing,apiEndTime:+new Date,apiName:Qn})}}));return function(e,r){return t.apply(this,arguments)}}())})),r.apply(this,arguments)}function n(e){Y(e,{fileID:"string"}),e.config&&e.config.env&&Y(e.config.env,"string")}function i(e){return o.apply(this,arguments)}function o(){return o=h()((function*(t){var r=re(e.identifiers),n=yield a(t);return new Promise(((e,i)=>{if(t.context&&t.context.aborted)return i(N({errMsg:"abort"},Qn));var o=r._downloadFileSkipCheckDomain({url:n,header:t.header,timeout:t.timeout,success:t=>{e(t)},fail:e=>{i(e)}});o&&(o.onProgressUpdate((function(){t.downloadTaskAgent&&t.context&&t.context.onProgressUpdateUserHandler&&E(t.context.onProgressUpdateUserHandler)&&t.context.onProgressUpdateUserHandler.apply(r._downloadFileSkipCheckDomain,arguments)})),t.context&&(t.context.abort=o.abort.bind(o)))}))})),o.apply(this,arguments)}function a(e){return s.apply(this,arguments)}function s(){return(s=h()((function*(t){var r=JSON.stringify({fileid:t.fileID}),n=+new Date,i=(yield e.request({apiName:"tcbapi_downloadfile",serviceName:e.name,serializedReqData:r,env:t.config&&t.config.env||e.env})).data;if(t.timing&&(t.timing.tunnelStartTime=n,t.timing.tunnelEndTime=+new Date,t.timing.tunnelTimeNoCSNetCost=i.baseresponse.stat.qbase_cost_time),!i.download_url)throw new C({errCode:S.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL,errMsg:S[S.SDK_STORAGE_INTERNAL_SERVER_ERROR_EMPTY_DOWNLOAD_URL]});return i.download_url.indexOf("?")>-1?i.download_url+="&skip_domain_check=true":i.download_url+="?skip_domain_check=true",i.download_url}))).apply(this,arguments)}}var Hn="cloud.getTempFileURL";function Gn(e){return function(e){var t=X(e);return t.timing={apiStartTime:+new Date},$(t)?function(e){var t=r(e);t.then((t=>{W(Hn,e,t)})).catch((t=>{j(Hn,e,t)}))}(t):r(t)};function t(t){if(Y(t,{fileList:"array"}),t.config&&t.config.env&&Y(t.config.env,"string"),e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new C({errCode:S.SDK_API_PARAMETER_ERROR,errMsg:`parameter.fileList exceed max length ${e.appConfig.getTempFileURLMaxReq}`})}function r(e){return n.apply(this,arguments)}function n(){return(n=h()((function*(e){try{return t(e),e.fileList.length?yield i(e):{errMsg:nr(Hn),fileList:[]}}catch(e){throw N(e,Hn)}finally{Yt({...e.timing,apiEndTime:+new Date,apiName:Hn})}}))).apply(this,arguments)}function i(e){return o.apply(this,arguments)}function o(){return(o=h()((function*(t){var r={file_list:t.fileList.map((e=>y(e)?{fileid:e}:{fileid:e.fileID,max_age:e.maxAge}))},n=JSON.stringify(r);t.timing.tunnelStartTime=+new Date;var i=yield e.request({apiName:"tcbapi_gettempfileurl",serviceName:e.name,serializedReqData:n,env:t.config&&t.config.env||e.env});t.timing.tunnelEndTime=+new Date;var o=i.data;return t.timing.tunnelTimeNoCSNetCost=o.baseresponse.stat.qbase_cost_time,{errMsg:nr(Hn),fileList:o.download_list.map((e=>({fileID:e.fileid,tempFileURL:e.download_url,maxAge:e.max_age,status:e.status,errMsg:e.errmsg})))}}))).apply(this,arguments)}}var Wn="cloud.deleteFile";function jn(e){return function(e){var t=X(e);return t.timing={apiStartTime:+new Date},$(t)?function(e){var t=r(e);t.then((t=>{W(Wn,e,t)})).catch((t=>{j(Wn,e,t)}))}(t):r(t)};function t(t){Y(t,{fileList:"array"}),t.config&&t.config.env&&Y(t.config.env,"string");for(var r=0,n=t.fileList.length;r<n;r++)Y(t.fileList[r],"string",`parameter.fileList[${r}]`);if(e.appConfig.getTempFileURLMaxReq&&t.fileList.length>e.appConfig.getTempFileURLMaxReq)throw new C({errCode:S.SDK_API_PARAMETER_ERROR,errMsg:`parameter.fileList exceed max length ${e.appConfig.getTempFileURLMaxReq}`})}function r(e){return n.apply(this,arguments)}function n(){return(n=h()((function*(e){try{return t(e),e.fileList.length?yield i(e):{errMsg:nr(Wn),fileList:[]}}catch(e){throw N(e,Wn)}finally{Yt({...e.timing,apiEndTime:+new Date,apiName:Wn})}}))).apply(this,arguments)}function i(e){return o.apply(this,arguments)}function o(){return(o=h()((function*(t){var r={fileid_list:t.fileList},n=JSON.stringify(r);t.timing.tunnelStartTime=+new Date;var i=yield e.request({apiName:"tcbapi_deletefile",serviceName:e.name,serializedReqData:n,env:t.config&&t.config.env||e.env});t.timing.tunnelEndTime=+new Date;var o=i.data;return t.timing.tunnelTimeNoCSNetCost=o.baseresponse.stat.qbase_cost_time,{errMsg:nr(Wn),fileList:o.delete_list.map((e=>({fileID:e.fileid,status:e.status,errMsg:e.errmsg})))}}))).apply(this,arguments)}}function $n(e){return{uploadFile:qn(e),downloadFile:Fn(e),getTempFileURL:Gn(e),deleteFile:jn(e)}}var Yn="storage";function Jn(e){e.registerService(function(e){var t={name:Yn,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get env(){return e.getEnvForService(Yn)},get debug(){return e.debug},appConfig:{get uploadMaxFileSize(){return e.appConfig.upload_max_file_size},get getTempFileURLMaxReq(){return e.appConfig.get_temp_file_url_max_requests}}};return{name:Yn,context:t,getAPIs:$n.bind(null,t)}}(e))}var Kn=Symbol.for("UNSET_FIELD_NAME"),zn=Symbol.for("AGGREGATE"),Xn=Symbol.for("AGGREGATE_PIPELINE"),Vn=Symbol.for("AGGREGATE_PIPELINE_STAGE"),Zn=Symbol.for("UPDATE_COMMAND"),ei=Symbol.for("QUERY_COMMAND"),ti=Symbol.for("LOGIC_COMMAND"),ri=Symbol.for("AGGREGATE_COMMAND"),ni=Symbol.for("PROJECT_COMMAND"),ii=Symbol.for("GEO_POINT"),oi=Symbol.for("GEO_LINESTRING"),ai=Symbol.for("GEO_POLYGON"),si=Symbol.for("GEO_MULTIPOINT"),ui=Symbol.for("GEO_MULTILINESTRING"),ci=Symbol.for("GEO_MULTIPOLYGON"),li=Symbol.for("SERVER_DATE"),di=Symbol.for("REGEXP"),fi=function(e){return e.AND="and",e.OR="or",e.NOT="not",e.NOR="nor",e}({}),hi=[fi.AND,fi.OR,fi.NOT,fi.NOR],pi=new Set(hi);class gi{constructor(e,t,r){this.fieldName=void 0,this.operator=void 0,this.operands=void 0,this._internalType=ti,this.__safe_props__=void 0,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||Kn}_setFieldName(e){var t=this.operands.map((t=>t===fi.AND||t===fi.OR?t._setFieldName(e):t));return new gi(this.operator,t,e)}and(...e){J(arguments[0],"expressions","and");var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.AND,[this,...t],this.fieldName)}or(...e){J(arguments[0],"expressions","or");var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.OR,[this,...t],this.fieldName)}nor(...e){J(arguments[0],"expressions","nor");var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.NOR,[this,...t],this.fieldName)}not(e){return J(e,"expression","not"),new gi(fi.NOT,[e],this.fieldName)}toJSON(){}}function Ai(e){return e&&e instanceof gi&&e._internalType===ti}var mi=function(e){return e.EQ="eq",e.NEQ="neq",e.GT="gt",e.GTE="gte",e.LT="lt",e.LTE="lte",e.IN="in",e.NIN="nin",e.GEO_NEAR="geoNear",e.GEO_WITHIN="geoWithin",e.GEO_INTERSECTS="geoIntersects",e.EXISTS="exists",e.MOD="mod",e.ALL="all",e.ELEM_MATCH="elemMatch",e.SIZE="size",e.EXPR="expr",e}({}),yi=[mi.EQ,mi.NEQ,mi.GT,mi.GTE,mi.LT,mi.LTE,mi.IN,mi.NIN,mi.GEO_NEAR,mi.GEO_WITHIN,mi.GEO_INTERSECTS,mi.EXISTS,mi.MOD,mi.ALL,mi.ELEM_MATCH,mi.SIZE],vi=new Set(yi);new Set([...vi,...pi]);class Ei extends gi{constructor(e,t,r){super(e,t,r),this.operator=void 0,this.__safe_props__=void 0,this.operator=e,this._internalType=ei}_setFieldName(e){return new Ei(this.operator,this.operands,e)}eq(e){var t=new Ei(mi.EQ,[e],this.fieldName);return this.and(t)}neq(e){var t=new Ei(mi.NEQ,[e],this.fieldName);return this.and(t)}gt(e){var t=new Ei(mi.GT,[e],this.fieldName);return this.and(t)}gte(e){var t=new Ei(mi.GTE,[e],this.fieldName);return this.and(t)}lt(e){var t=new Ei(mi.LT,[e],this.fieldName);return this.and(t)}lte(e){var t=new Ei(mi.LTE,[e],this.fieldName);return this.and(t)}in(e){Y(e,"array");var t=new Ei(mi.IN,e,this.fieldName);return this.and(t)}nin(e){Y(e,"array");var t=new Ei(mi.NIN,e,this.fieldName);return this.and(t)}geoNear(e){var t=new Ei(mi.GEO_NEAR,[e],this.fieldName);return this.and(t)}geoWithin(e){var t=new Ei(mi.GEO_WITHIN,[e],this.fieldName);return this.and(t)}geoIntersects(e){var t=new Ei(mi.GEO_INTERSECTS,[e],this.fieldName);return this.and(t)}exists(e){var t=new Ei(mi.EXISTS,[e],this.fieldName);return this.and(t)}mod(e,t){var r=new Ei(mi.MOD,[e,t],this.fieldName);return this.and(r)}all(e){var t=new Ei(mi.ALL,e,this.fieldName);return this.and(t)}elemMatch(e){var t=new Ei(mi.ELEM_MATCH,[e],this.fieldName);return this.and(t)}size(e){var t=new Ei(mi.SIZE,[e],this.fieldName);return this.and(t)}}function _i(e){return e&&e instanceof Ei&&e._internalType===ei}var Ii=function(e){return e.SET="set",e.REMOVE="remove",e.INC="inc",e.MUL="mul",e.MIN="min",e.MAX="max",e.RENAME="rename",e.BIT="bit",e.PUSH="push",e.POP="pop",e.SHIFT="shift",e.UNSHIFT="unshift",e.ADD_TO_SET="addToSet",e.PULL="pull",e.PULL_ALL="pullAll",e}({});new Set([Ii.SET,Ii.REMOVE,Ii.INC,Ii.MUL,Ii.MIN,Ii.MAX,Ii.RENAME,Ii.BIT,Ii.PUSH,Ii.POP,Ii.SHIFT,Ii.UNSHIFT,Ii.ADD_TO_SET,Ii.PULL,Ii.PULL_ALL]);class Ti{constructor(e,t,r){this.fieldName=void 0,this.operator=void 0,this.operands=void 0,this._internalType=Zn,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||Kn}_setFieldName(e){return new Ti(this.operator,this.operands,e)}toJSON(){}}function wi(e){return e&&e instanceof Ti&&e._internalType===Zn}var Si=function(e){return e.ABS="abs",e.ADD="add",e.ADDTOSET="addToSet",e.ALLELEMENTSTRUE="allElementsTrue",e.AND="and",e.ANYELEMENTTRUE="anyElementTrue",e.ARRAYELEMAT="arrayElemAt",e.ARRAYTOOBJECT="arrayToObject",e.AVG="avg",e.CEIL="ceil",e.CMP="cmp",e.CONCAT="concat",e.CONCATARRAYS="concatArrays",e.COND="cond",e.CONVERT="convert",e.DATEFROMPARTS="dateFromParts",e.DATETOPARTS="dateToParts",e.DATEFROMSTRING="dateFromString",e.DATETOSTRING="dateToString",e.DAYOFMONTH="dayOfMonth",e.DAYOFWEEK="dayOfWeek",e.DAYOFYEAR="dayOfYear",e.DIVIDE="divide",e.EQ="eq",e.EXP="exp",e.FILTER="filter",e.FIRST="first",e.FLOOR="floor",e.GT="gt",e.GTE="gte",e.HOUR="hour",e.IFNULL="ifNull",e.IN="in",e.INDEXOFARRAY="indexOfArray",e.INDEXOFBYTES="indexOfBytes",e.INDEXOFCP="indexOfCP",e.ISARRAY="isArray",e.ISODAYOFWEEK="isoDayOfWeek",e.ISOWEEK="isoWeek",e.ISOWEEKYEAR="isoWeekYear",e.LAST="last",e.LET="let",e.LITERAL="literal",e.LN="ln",e.LOG="log",e.LOG10="log10",e.LT="lt",e.LTE="lte",e.LTRIM="ltrim",e.MAP="map",e.MAX="max",e.MERGEOBJECTS="mergeObjects",e.META="meta",e.MIN="min",e.MILLISECOND="millisecond",e.MINUTE="minute",e.MOD="mod",e.MONTH="month",e.MULTIPLY="multiply",e.NEQ="ne",e.NOT="not",e.OBJECTTOARRAY="objectToArray",e.OR="or",e.POW="pow",e.PUSH="push",e.RANGE="range",e.REDUCE="reduce",e.REVERSEARRAY="reverseArray",e.RTRIM="rtrim",e.SECOND="second",e.SETDIFFERENCE="setDifference",e.SETEQUALS="setEquals",e.SETINTERSECTION="setIntersection",e.SETISSUBSET="setIsSubset",e.SETUNION="setUnion",e.SIZE="size",e.SLICE="slice",e.SPLIT="split",e.SQRT="sqrt",e.STDDEVPOP="stdDevPop",e.STDDEVSAMP="stdDevSamp",e.STRCASECMP="strcasecmp",e.STRLENBYTES="strLenBytes",e.STRLENCP="strLenCP",e.SUBSTR="substr",e.SUBSTRBYTES="substrBytes",e.SUBSTRCP="substrCP",e.SUBTRACT="subtract",e.SUM="sum",e.SWITCH="switch",e.TOBOOL="toBool",e.TODATE="toDate",e.TODECIMAL="toDecimal",e.TODOUBLE="toDouble",e.TOINT="toInt",e.TOLONG="toLong",e.TOOBJECTID="toObjectId",e.TOSTRING="toString",e.TOLOWER="toLower",e.TOUPPER="toUpper",e.TRIM="trim",e.TRUNC="trunc",e.TYPE="type",e.WEEK="week",e.YEAR="year",e.ZIP="zip",e}({});Si.ABS,Si.ADD,Si.ADDTOSET,Si.ALLELEMENTSTRUE,Si.AND,Si.ANYELEMENTTRUE,Si.ARRAYELEMAT,Si.ARRAYTOOBJECT,Si.AVG,Si.CEIL,Si.CMP,Si.CONCAT,Si.CONCATARRAYS,Si.COND,Si.CONVERT,Si.DATEFROMPARTS,Si.DATETOPARTS,Si.DATEFROMSTRING,Si.DATETOSTRING,Si.DAYOFMONTH,Si.DAYOFWEEK,Si.DAYOFYEAR,Si.DIVIDE,Si.EQ,Si.EXP,Si.FILTER,Si.FIRST,Si.FLOOR,Si.GT,Si.GTE,Si.HOUR,Si.IFNULL,Si.IN,Si.INDEXOFARRAY,Si.INDEXOFBYTES,Si.INDEXOFCP,Si.ISARRAY,Si.ISODAYOFWEEK,Si.ISOWEEK,Si.ISOWEEKYEAR,Si.LAST,Si.LET,Si.LITERAL,Si.LN,Si.LOG,Si.LOG10,Si.LT,Si.LTE,Si.LTRIM,Si.MAP,Si.MAX,Si.MERGEOBJECTS,Si.META,Si.MIN,Si.MILLISECOND,Si.MINUTE,Si.MOD,Si.MONTH,Si.MULTIPLY,Si.NEQ,Si.NOT,Si.OBJECTTOARRAY,Si.OR,Si.POW,Si.PUSH,Si.RANGE,Si.REDUCE,Si.REVERSEARRAY,Si.RTRIM,Si.SECOND,Si.SETDIFFERENCE,Si.SETEQUALS,Si.SETINTERSECTION,Si.SETISSUBSET,Si.SETUNION,Si.SIZE,Si.SLICE,Si.SPLIT,Si.SQRT,Si.STDDEVPOP,Si.STDDEVSAMP,Si.STRCASECMP,Si.STRLENBYTES,Si.STRLENCP,Si.SUBSTR,Si.SUBSTRBYTES,Si.SUBSTRCP,Si.SUBTRACT,Si.SUM,Si.SWITCH,Si.TOBOOL,Si.TODATE,Si.TODECIMAL,Si.TODOUBLE,Si.TOINT,Si.TOLONG,Si.TOOBJECTID,Si.TOSTRING,Si.TOLOWER,Si.TOUPPER,Si.TRIM,Si.TRUNC,Si.TYPE,Si.WEEK,Si.YEAR,Si.ZIP;class Ci{constructor(e,t,r){this.fieldName=void 0,this.operator=void 0,this.operands=void 0,this._internalType=ri,this.__safe_props__=void 0,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.operator=e,this.operands=t,this.fieldName=r||Kn}_setFieldName(e){return new Ci(this.operator,this.operands,e)}}function bi(e){return e&&e instanceof Ci&&e._internalType===ri}var Ni=function(e){return e.SLICE="slice",e}({});new Set([Ni.SLICE]);class Oi{constructor(e,t,r){this.fieldName=void 0,this.operator=void 0,this.operands=void 0,this.__safe_props__=void 0,this._internalType=ni,this.operator=e,this.operands=t,this.fieldName=r||Kn}_setFieldName(e){return new Oi(this.operator,this.operands,e)}}function Ri(e){return e&&e instanceof Oi&&e._internalType===ni}var Bi=function(e){return e[e.WHERE=0]="WHERE",e[e.DOC=1]="DOC",e}({}),Di=function(e){return e[e.STRING=1]="STRING",e[e.NUMBER=2]="NUMBER",e}({}),Li=function(e){return e[e.ASC=0]="ASC",e[e.DESC=1]="DESC",e}({});function Pi(e){return Mi.apply(this,arguments)}function Mi(){return(Mi=h()((function*(e){var{env:t,collectionName:r,data:n,instanceContext:i,timing:o}=e,a=JSON.stringify(n);K({input:a,max:i.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:`${(i.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)} KB`});var s={collection_name:r,data:a},u=JSON.stringify(s);o.tunnelStartTime=+new Date;var c=yield i.serviceContext.request({apiName:"tcbapi_db_adddocument",serviceName:i.serviceContext.name,serializedReqData:u,requireDataNotEmpty:!0,env:t||i.serviceContext.env});o.tunnelEndTime=+new Date;var l=c.data;return o.tunnelTimeNoCSNetCost=l.baseresponse.stat.qbase_cost_time,{_id:l._id_type===Di.NUMBER?l._id_number:l._id}}))).apply(this,arguments)}function xi(e){return Ui.apply(this,arguments)}function Ui(){return Ui=h()((function*(e){var{collectionName:t,query:n,options:i,instanceContext:o,timing:a,env:s}=e,u=Mt()?e.explain:void 0,c=i&&i.multi,l=JSON.stringify({collection_name:t,query:JSON.stringify(n),multi:c,query_type:c?Bi.WHERE:Bi.DOC,explain:u});a.tunnelStartTime=+new Date;var d=yield o.serviceContext.request({apiName:"tcbapi_db_deletedocument",serviceName:o.serviceContext.name,serializedReqData:l,requireDataNotEmpty:!0,env:s||o.serviceContext.env});if(a.tunnelEndTime=+new Date,u){var{EJSON:f}=r(683);return f.deserialize(d.data)}var h=d.data;return a.tunnelTimeNoCSNetCost=h.baseresponse.stat.qbase_cost_time,{removed:h.deleted}})),Ui.apply(this,arguments)}function ki(e){return qi.apply(this,arguments)}function qi(){return qi=h()((function*(e){var{env:t,collectionName:n,query:i,options:o={},instanceContext:a,timing:s,queryType:u}=e,c=Mt()?e.explain:void 0,l={collection_name:n,query:JSON.stringify(i),query_type:u,explain:c};o.offset&&(l.offset=o.offset),o.limit&&(l.limit=o.limit),o.order&&(l.order=o.order),o.projection&&(l.projection=JSON.stringify(o.projection));var d=JSON.stringify(l);s.tunnelStartTime=+new Date;var f=yield a.serviceContext.request({apiName:"tcbapi_db_querydocument",serviceName:a.serviceContext.name,serializedReqData:d,requireDataNotEmpty:!0,env:t||a.serviceContext.env});if(s.tunnelEndTime=+new Date,c){var{EJSON:h}=r(683);return h.deserialize(f.data)}var p=f.data;s.tunnelTimeNoCSNetCost=p.baseresponse.stat.qbase_cost_time;var g=p.data_list?JSON.parse(p.data_list):[];return{list:g=a.engine.Decoder.decode(g),offset:p.offset,limit:p.limit,total:p.total}})),qi.apply(this,arguments)}function Qi(e){return Fi.apply(this,arguments)}function Fi(){return Fi=h()((function*(e){var{env:t,collectionName:n,query:i,data:o,options:a={},instanceContext:s,timing:u,queryType:c}=e,l=Mt()?e.explain:void 0,d=JSON.stringify(o);K({input:d,max:s.serviceContext.appConfig.docSizeLimit,name:"update expression",maxWording:`${(s.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)} KB`});var f={collection_name:n,query:JSON.stringify(i),data:d,query_type:c,explain:l};f.multi=!1!==a.multi,f.merge=!1!==a.merge,a.upsert&&(f.upsert=a.upsert);var h=JSON.stringify(f);u.tunnelStartTime=+new Date;var p=yield s.serviceContext.request({apiName:"tcbapi_db_updatedocument",serviceName:s.serviceContext.name,serializedReqData:h,requireDataNotEmpty:!0,env:t||s.serviceContext.env});if(u.tunnelEndTime=+new Date,l){var{EJSON:g}=r(683);return g.deserialize(p.data)}var A=p.data;return u.tunnelTimeNoCSNetCost=A.baseresponse.stat.qbase_cost_time,{updated:A.updated}})),Fi.apply(this,arguments)}function Hi(e){return Gi.apply(this,arguments)}function Gi(){return(Gi=h()((function*(e){var{env:t,collectionName:r,_id:n,data:i,options:o={},instanceContext:a,timing:s}=e,u=JSON.stringify(i);K({input:u,max:a.serviceContext.appConfig.docSizeLimit,name:"record",maxWording:`${(a.serviceContext.appConfig.docSizeLimit/1024).toFixed(0)} KB`});var c=v(n),l={collection_name:r,_id_type:c?Di.NUMBER:Di.STRING,data:u};c?l._id_number=n:l._id=n;var d=JSON.stringify(l);s.tunnelStartTime=+new Date;var f=yield a.serviceContext.request({apiName:"tcbapi_db_setdocument",serviceName:a.serviceContext.name,serializedReqData:d,requireDataNotEmpty:!0,env:t||a.serviceContext.env});s.tunnelEndTime=+new Date;var h=f.data;return s.tunnelTimeNoCSNetCost=h.baseresponse.stat.qbase_cost_time,{_id:h._id_type===Di.NUMBER?h._id_number:h._id,updated:h._id?0:1,created:h._id?1:0}}))).apply(this,arguments)}function Wi(e){return ji.apply(this,arguments)}function ji(){return ji=h()((function*(e){var{env:t,collectionName:n,query:i,instanceContext:o,timing:a}=e,s=Mt()?e.explain:void 0,u={collection_name:n,query:JSON.stringify(i),query_type:Bi.WHERE,explain:s},c=JSON.stringify(u);a.tunnelStartTime=+new Date;var l=yield o.serviceContext.request({apiName:"tcbapi_db_countdocument",serviceName:o.serviceContext.name,serializedReqData:c,requireDataNotEmpty:!0,env:t||o.serviceContext.env});if(a.tunnelEndTime=+new Date,s){var{EJSON:d}=r(683);return d.deserialize(l.data)}var f=l.data;return a.tunnelTimeNoCSNetCost=f.baseresponse.stat.qbase_cost_time,{total:f.total}})),ji.apply(this,arguments)}function $i(e){return Yi.apply(this,arguments)}function Yi(){return(Yi=h()((function*(e){var{env:t,collectionName:n,stages:i,instanceContext:o,timing:a}=e,s=Mt()?e.explain:void 0,u={collection_name:n,stages:i.map((e=>{for(var t in e)return{stage_key:t,stage_value:JSON.stringify(e[t])};throw new Error(`empty encoded stage (${JSON.stringify(e)})`)})),explain:s},c=JSON.stringify(u);a.tunnelStartTime=+new Date;var l=yield o.serviceContext.request({apiName:"tcbapi_db_aggregate",serviceName:o.serviceContext.name,serializedReqData:c,requireDataNotEmpty:!0,env:t||o.serviceContext.env});if(a.tunnelEndTime=+new Date,s){var{EJSON:d}=r(683);return d.deserialize(l.data)}var f=l.data;a.tunnelTimeNoCSNetCost=f.baseresponse.stat.qbase_cost_time;var{EJSON:h}=r(683);return{list:JSON.parse(f.list).map((e=>h.parse(e)))}}))).apply(this,arguments)}function Ji(){return(Ji=h()((function*(e,t){var r=(yield e.request({apiName:"tcbapi_db_get_realtime_connection",env:t||e.env,serviceName:e.name,serializedReqData:JSON.stringify({}),requireDataNotEmpty:!0})).data;return{envId:r.env_id,secretVersion:r.secret_version,signStr:r.sign_str,wsUrl:r.ws_url}}))).apply(this,arguments)}var Ki=e=>{class t extends Xi{constructor(e,t){super(t),this.collection=void 0,this._internalType=zn,this.collection=e}pushStage(e,r){return new t(this.collection,[...this._stages,new zi(e,r)])}end(t={}){var r="collection.aggregate",n={apiStartTime:+new Date},i=()=>$i({env:e.database.config.env,collectionName:this.collection.collectionName,stages:e.engine.AggregateSerializer.encodeStages(this._stages),instanceContext:e,timing:n,explain:t.explain});var o=$(t),a=new Promise(function(){var e=h()((function*(e,o){try{var a=yield i();if(t.explain&&Mt())return e(a);e({list:a.list,errMsg:nr(r)})}catch(e){o(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}}return t};class zi{constructor(e,t){this.stage=void 0,this.val=void 0,this._internalType=Vn,this.stage=e,this.val=t}}class Xi{constructor(e){this._stages=void 0,this._internalType=Xn,this.__safe_props__=void 0,this._stages=e}pushStage(e,t){return new Xi([...this._stages,new zi(e,t)])}addFields(e){return this.pushStage("addFields",e)}bucket(e){return this.pushStage("bucket",e)}bucketAuto(e){return this.pushStage("bucketAuto",e)}collStats(e){return this.pushStage("collStats",e)}count(e){return this.pushStage("count",e)}facet(e){return this.pushStage("facet",e)}geoNear(e){return this.pushStage("geoNear",e)}graphLookup(e){return this.pushStage("graphLookup",e)}group(e){return this.pushStage("group",e)}indexStats(){return this.pushStage("indexStats",{})}limit(e){return this.pushStage("limit",e)}lookup(e){return this.pushStage("lookup",e)}match(e){return this.pushStage("match",e)}out(e){return this.pushStage("out",e)}project(e){return this.pushStage("project",e)}redact(e){return this.pushStage("redact",e)}replaceRoot(e){return this.pushStage("replaceRoot",e)}sample(e){return this.pushStage("sample",e)}skip(e){return this.pushStage("skip",e)}sort(e){return this.pushStage("sort",e)}sortByCount(e){return this.pushStage("sortByCount",e)}unwind(e){return this.pushStage("unwind",e)}end(){}}class Vi extends Xi{constructor(e,t=!1){super(e),this._sealed=void 0,this._sealed=t}pushStage(e,t){if(this._sealed)throw new Error("pushing new stage is not allowed after calling 'done()'");return new Vi([...this._stages,new zi(e,t)])}done(){return new Vi(this._stages,!0)}}var Zi=e=>e&&e._internalType===Xn,eo=e=>e&&e._internalType===Vn,to=new Set(["each","position","slice","sort"]),ro={eq:e=>new Ei(mi.EQ,[e]),neq:e=>new Ei(mi.NEQ,[e]),lt:e=>new Ei(mi.LT,[e]),lte:e=>new Ei(mi.LTE,[e]),gt:e=>new Ei(mi.GT,[e]),gte:e=>new Ei(mi.GTE,[e]),in:e=>new Ei(mi.IN,e),nin:e=>new Ei(mi.NIN,e),geoNear:e=>new Ei(mi.GEO_NEAR,[e]),geoWithin:e=>new Ei(mi.GEO_WITHIN,[e]),geoIntersects:e=>new Ei(mi.GEO_INTERSECTS,[e]),and(...e){var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.AND,t)},or(...e){var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.OR,t)},nor(...e){var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new gi(fi.NOR,t)},not:e=>new gi(fi.NOT,[e]),exists:e=>new Ei(mi.EXISTS,[e]),mod:(e,t)=>new Ei(mi.MOD,[e,t]),all:e=>new Ei(mi.ALL,e),elemMatch:e=>new Ei(mi.ELEM_MATCH,[e]),size:e=>new Ei(mi.SIZE,[e]),expr:e=>new Ei(mi.EXPR,[e]),set:e=>new Ti(Ii.SET,[e]),remove:()=>new Ti(Ii.REMOVE,[]),inc:e=>new Ti(Ii.INC,[e]),mul:e=>new Ti(Ii.MUL,[e]),min:e=>new Ti(Ii.MIN,[e]),max:e=>new Ti(Ii.MAX,[e]),rename:e=>new Ti(Ii.RENAME,[e]),bit:e=>new Ti(Ii.BIT,[e]),push(e){var t={};if(_(e))t.each=e;else if(m(e)&&_(e.each)){var r=Object.keys(e);if(1===r.length)t=e;else{var n=!1;for(var i of r)if(!to.has(i)){n=!0;break}t=n?[e]:e}}else t.each=[e];return new Ti(Ii.PUSH,[t])},pop:()=>new Ti(Ii.POP,[]),shift:()=>new Ti(Ii.SHIFT,[]),unshift(...e){var t=_(arguments[0])?arguments[0]:Array.from(arguments);return new Ti(Ii.UNSHIFT,t)},addToSet:e=>new Ti(Ii.ADD_TO_SET,[e]),pull:e=>new Ti(Ii.PULL,[e]),pullAll:e=>new Ti(Ii.PULL_ALL,[e]),project:{slice:e=>new Oi(Ni.SLICE,[e])},aggregate:{pipeline:()=>new Vi([]),abs:e=>new Ci(Si.ABS,[e]),add:e=>new Ci(Si.ADD,[e]),addToSet:e=>new Ci(Si.ADDTOSET,[e]),allElementsTrue:e=>new Ci(Si.ALLELEMENTSTRUE,[e]),and:e=>new Ci(Si.AND,[e]),anyElementTrue:e=>new Ci(Si.ANYELEMENTTRUE,[e]),arrayElemAt:e=>new Ci(Si.ARRAYELEMAT,[e]),arrayToObject:e=>new Ci(Si.ARRAYTOOBJECT,[e]),avg:e=>new Ci(Si.AVG,[e]),ceil:e=>new Ci(Si.CEIL,[e]),cmp:e=>new Ci(Si.CMP,[e]),concat:e=>new Ci(Si.CONCAT,[e]),concatArrays:e=>new Ci(Si.CONCATARRAYS,[e]),cond:e=>new Ci(Si.COND,[e]),convert:e=>new Ci(Si.CONVERT,[e]),dateFromParts:e=>new Ci(Si.DATEFROMPARTS,[e]),dateToParts:e=>new Ci(Si.DATETOPARTS,[e]),dateFromString:e=>new Ci(Si.DATEFROMSTRING,[e]),dateToString:e=>new Ci(Si.DATETOSTRING,[e]),dayOfMonth:e=>new Ci(Si.DAYOFMONTH,[e]),dayOfWeek:e=>new Ci(Si.DAYOFWEEK,[e]),dayOfYear:e=>new Ci(Si.DAYOFYEAR,[e]),divide:e=>new Ci(Si.DIVIDE,[e]),eq:e=>new Ci(Si.EQ,[e]),exp:e=>new Ci(Si.EXP,[e]),filter:e=>new Ci(Si.FILTER,[e]),first:e=>new Ci(Si.FIRST,[e]),floor:e=>new Ci(Si.FLOOR,[e]),gt:e=>new Ci(Si.GT,[e]),gte:e=>new Ci(Si.GTE,[e]),hour:e=>new Ci(Si.HOUR,[e]),ifNull:e=>new Ci(Si.IFNULL,[e]),in:e=>new Ci(Si.IN,[e]),indexOfArray:e=>new Ci(Si.INDEXOFARRAY,[e]),indexOfBytes:e=>new Ci(Si.INDEXOFBYTES,[e]),indexOfCP:e=>new Ci(Si.INDEXOFCP,[e]),isArray:e=>new Ci(Si.ISARRAY,[e]),isoDayOfWeek:e=>new Ci(Si.ISODAYOFWEEK,[e]),isoWeek:e=>new Ci(Si.ISOWEEK,[e]),isoWeekYear:e=>new Ci(Si.ISOWEEKYEAR,[e]),last:e=>new Ci(Si.LAST,[e]),let:e=>new Ci(Si.LET,[e]),literal:e=>new Ci(Si.LITERAL,[e]),ln:e=>new Ci(Si.LN,[e]),log:e=>new Ci(Si.LOG,[e]),log10:e=>new Ci(Si.LOG10,[e]),lt:e=>new Ci(Si.LT,[e]),lte:e=>new Ci(Si.LTE,[e]),ltrim:e=>new Ci(Si.LTRIM,[e]),map:e=>new Ci(Si.MAP,[e]),max:e=>new Ci(Si.MAX,[e]),mergeObjects:e=>new Ci(Si.MERGEOBJECTS,[e]),meta:e=>new Ci(Si.META,[e]),min:e=>new Ci(Si.MIN,[e]),millisecond:e=>new Ci(Si.MILLISECOND,[e]),minute:e=>new Ci(Si.MINUTE,[e]),mod:e=>new Ci(Si.MOD,[e]),month:e=>new Ci(Si.MONTH,[e]),multiply:e=>new Ci(Si.MULTIPLY,[e]),neq:e=>new Ci(Si.NEQ,[e]),not:e=>new Ci(Si.NOT,[e]),objectToArray:e=>new Ci(Si.OBJECTTOARRAY,[e]),or:e=>new Ci(Si.OR,[e]),pow:e=>new Ci(Si.POW,[e]),push:e=>new Ci(Si.PUSH,[e]),range:e=>new Ci(Si.RANGE,[e]),reduce:e=>new Ci(Si.REDUCE,[e]),reverseArray:e=>new Ci(Si.REVERSEARRAY,[e]),rtrim:e=>new Ci(Si.RTRIM,[e]),second:e=>new Ci(Si.SECOND,[e]),setDifference:e=>new Ci(Si.SETDIFFERENCE,[e]),setEquals:e=>new Ci(Si.SETEQUALS,[e]),setIntersection:e=>new Ci(Si.SETINTERSECTION,[e]),setIsSubset:e=>new Ci(Si.SETISSUBSET,[e]),setUnion:e=>new Ci(Si.SETUNION,[e]),size:e=>new Ci(Si.SIZE,[e]),slice:e=>new Ci(Si.SLICE,[e]),split:e=>new Ci(Si.SPLIT,[e]),sqrt:e=>new Ci(Si.SQRT,[e]),stdDevPop:e=>new Ci(Si.STDDEVPOP,[e]),stdDevSamp:e=>new Ci(Si.STDDEVSAMP,[e]),strcasecmp:e=>new Ci(Si.STRCASECMP,[e]),strLenBytes:e=>new Ci(Si.STRLENBYTES,[e]),strLenCP:e=>new Ci(Si.STRLENCP,[e]),substr:e=>new Ci(Si.SUBSTR,[e]),substrBytes:e=>new Ci(Si.SUBSTRBYTES,[e]),substrCP:e=>new Ci(Si.SUBSTRCP,[e]),subtract:e=>new Ci(Si.SUBTRACT,[e]),sum:e=>new Ci(Si.SUM,[e]),switch:e=>new Ci(Si.SWITCH,[e]),toBool:e=>new Ci(Si.TOBOOL,[e]),toDate:e=>new Ci(Si.TODATE,[e]),toDecimal:e=>new Ci(Si.TODECIMAL,[e]),toDouble:e=>new Ci(Si.TODOUBLE,[e]),toInt:e=>new Ci(Si.TOINT,[e]),toLong:e=>new Ci(Si.TOLONG,[e]),toObjectId:e=>new Ci(Si.TOOBJECTID,[e]),toString:e=>new Ci(Si.TOSTRING,[e]),toLower:e=>new Ci(Si.TOLOWER,[e]),toUpper:e=>new Ci(Si.TOUPPER,[e]),trim:e=>new Ci(Si.TRIM,[e]),trunc:e=>new Ci(Si.TRUNC,[e]),type:e=>new Ci(Si.TYPE,[e]),week:e=>new Ci(Si.WEEK,[e]),year:e=>new Ci(Si.YEAR,[e]),zip:e=>new Ci(Si.ZIP,[e])}};function no(e){return new io(e)}class io{constructor(e={offset:0}){this.options=void 0,Y(e,"object","serverDate.options"),this.options=e}get _internalType(){return li}toJSON(){return{$date:this.options}}}function oo(e,t){return So(e)?vo(e):new ao(e,t)}class ao{constructor(e,t){this.longitude=void 0,this.latitude=void 0,this._internalType=ii,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}});var r=e,n=t;Object.defineProperties(this,{longitude:{enumerable:!0,configurable:!1,get:()=>r,set(e){if(Y(e,"number","longitude"),e>180||e<-180)throw new C({errMsg:"longitude should be a number ranges from -180 to 180"})}},latitude:{enumerable:!0,configurable:!1,get:()=>n,set(e){if(Y(e,"number","latitude"),e>90||e<-90)throw new C({errMsg:"latitude should be a number ranges from -90 to 90"})}}}),this.longitude=r,this.latitude=n}toJSON(){return{type:"Point",coordinates:[(e=this).longitude,e.latitude]};var e}toString(){return JSON.stringify(this.toJSON())}}function so(e){return Co(e)?Eo(e):new uo(e)}class uo{constructor(e){this.points=void 0,this._internalType=si,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}toJSON(){return{type:"MultiPoint",coordinates:this.points.map((e=>[e.longitude,e.latitude]))}}toString(){return JSON.stringify(this.toJSON())}}function co(e){return bo(e)?_o(e):new lo(e)}class lo{constructor(e){this.points=void 0,this._internalType=oi,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.points=e}toJSON(){return{type:"LineString",coordinates:this.points.map((e=>[e.longitude,e.latitude]))}}toString(){return JSON.stringify(this.toJSON())}}function fo(e){return No(e)?Io(e):new ho(e)}class ho{constructor(e){this.lines=void 0,this._internalType=ui,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}toJSON(){return{type:"MultiLineString",coordinates:this.lines.map((e=>e.points.map((e=>[e.longitude,e.latitude]))))}}toString(){return JSON.stringify(this.toJSON())}}function po(e){return Oo(e)?To(e):new go(e)}class go{constructor(e){this.lines=void 0,this._internalType=ai,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.lines=e}toJSON(){return{type:"Polygon",coordinates:this.lines.map((e=>e.points.map((e=>[e.longitude,e.latitude]))))}}toString(){return JSON.stringify(this.toJSON())}}function Ao(e){return Ro(e)?wo(e):new mo(e)}class mo{constructor(e){this.polygons=void 0,this._internalType=ci,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}}),this.polygons=e}toJSON(){return{type:"MultiPolygon",coordinates:this.polygons.map((e=>e.lines.map((e=>e.points.map((e=>[e.longitude,e.latitude]))))))}}toString(){return JSON.stringify(this.toJSON())}}var yo=undefined;function vo(e){return oo(e.coordinates[0],e.coordinates[1])}function Eo(e){return so(e.coordinates.map((e=>oo(e[0],e[1]))))}function _o(e){return co(e.coordinates.map((e=>oo(e[0],e[1]))))}function Io(e){return fo(e.coordinates.map((e=>co(e.map((e=>oo(e[0],e[1])))))))}function To(e){return po(e.coordinates.map((e=>co(e.map((e=>oo(e[0],e[1])))))))}function wo(e){return Ao(e.coordinates.map((e=>po(e.map((e=>co(e.map((e=>oo(e[0],e[1]))))))))))}function So(e){return m(e)&&Bo(e.coordinates)}function Co(e){return m(e)&&Do(e.coordinates)}function bo(e){return m(e)&&Lo(e.coordinates)}function No(e){return m(e)&&Po(e.coordinates)}function Oo(e){return m(e)&&Mo(e.coordinates)}function Ro(e){return m(e)&&(t=e.coordinates,_(t)&&t.every(Mo));var t}function Bo(e){return _(e)&&v(e[0])&&v(e[1])}function Do(e){return _(e)&&e.every(Bo)}function Lo(e){return Do(e)}function Po(e){return _(e)&&e.every(Lo)}function Mo(e){return Po(e)}function xo(e){return Uo(e,[e])}function Uo(e,t){if(!w(e)){if(I(e))return{$date:+e};if(T(e))return{$regex:e.source,$options:e.flags};if(_(e))return e.map((e=>{if(t.indexOf(e)>-1)throw new C({errCode:S.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});return Uo(e,[...t,e])}));if(m(e)){var r={...e};for(var n in r){if(t.indexOf(r[n])>-1)throw new C({errCode:S.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});r[n]=Uo(r[n],[...t,r[n]])}return r}return e}switch(e._internalType){case ii:case si:case oi:case ui:case ai:case ci:return e.toJSON();case li:return{$date:e.options};case di:return{$regex:e.regexp,$options:e.options};default:return e.toJSON?e.toJSON():e}}function ko(e,t,r,n){var i={...e};for(var o in e)if(!/^\$/.test(o)){var a=e[o];if(a&&m(a)&&!t(a)){if(n.indexOf(a)>-1)throw new C({errCode:S.SDK_DATABASE_CIRCULAR_REFERENCE,errMsg:"Cannot convert circular structure to JSON"});var s=ko(a,t,[...r,o],[...n,a]);i[o]=s;var u=!1;for(var c in s)/^\$/.test(c)?u=!0:(i[`${o}.${c}`]=s[c],delete i[o][c]);u||delete i[o]}}return i}function qo(e){return ko(e,Ho,[],[e])}function Qo(e){return ko(e,(e=>!1),[],[e])}function Fo(e,t,r){for(var n in t[r]||delete e[r],t)e[n]?_(e[n])?e[n].push(t[n]):m(e[n])?m(t[n])?Object.assign(e[n],t[n]):(o.warn(`unmergable condition, query is object but condition is ${A(t)}, can only overwrite`,t,r),e[n]=t[n]):(o.warn(`to-merge query is of type ${A(e)}, can only overwrite`,e,t,r),e[n]=t[n]):e[n]=t[n]}function Ho(e){return w(e)||I(e)||T(e)}function Go(e){return xo(e)}function Wo(e){return function(e){var t={...e};for(var r in t)switch(r){case"$date":switch(A(t[r])){case"number":return new Date(t[r]);case"object":return no(t[r])}break;case"type":switch(t.coordinates,t.type){case"Point":if(So(t))return vo(t);break;case"MultiPoint":if(Co(t))return Eo(t);break;case"LineString":if(bo(t))return _o(t);break;case"MultiLineString":if(No(t))return Io(t);break;case"Polygon":if(Oo(t))return To(t);break;case"MultiPolygon":if(Ro(t))return wo(t)}}return e}(e)}function jo(e,t){return{limit:e._query.limit,offset:e._query.offset,order:$o(e._query.order||[]),projection:t.engine.ProjectionSerializer.encode(e._field)}}function $o(e){return e.map((e=>({field:e.fieldPath,direction:e.order===fs.DESC?Li.DESC:Li.ASC})))}function Yo(e){var t=Qo(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:delete t[r];return t}var Jo=function(e){return e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e}({}),Ko=function(e){return e.CONNECTION_START="connectionStart",e.CONNECTION_SUCCESS="connectionSuccess",e.CONNECTION_FAIL="connectionFail",e.DISCONNECT="disconnect",e}({}),zo={[Jo.DISCONNECTED]:{transitions:[{accept:Ko.CONNECTION_START,to:Jo.CONNECTING}]},[Jo.CONNECTING]:{transitions:[{accept:Ko.CONNECTION_SUCCESS,to:Jo.CONNECTED},{accept:Ko.CONNECTION_FAIL,to:Jo.DISCONNECTED},{accept:Ko.DISCONNECT,to:Jo.DISCONNECTED}]},[Jo.CONNECTED]:{transitions:[{accept:Ko.DISCONNECT,to:Jo.DISCONNECTED},{accept:Ko.CONNECTION_FAIL,to:Jo.DISCONNECTED}]}};var Xo,Vo,Zo=(Xo=e=>e.replace(/\[(\d+)\]/g,".[$1]").split(".").map((e=>/^\[(\d+)\]$/.test(e)?parseInt(e.substring(1,e.length-1)):e)),Vo=new Map,function(e){return Vo.has(e)||Vo.set(e,Xo(e)),Vo.get(e)});function ea(e,t,r){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var n=Zo(t),i=e,o=0;o<n.length-1;++o){var a=n[o];i[a]||(i[a]="string"==typeof n[o+1]?{}:[]),i=i[a]}return i[n[n.length-1]]=r,e}e[t]=r}}function ta(e,t){if(e){if(!Object.prototype.hasOwnProperty.call(e,t)){for(var r=Zo(t),n=e,i=0;i<r.length-1;++i){var o=r[i];if(!n[o])return;n=n[o]}return delete n[r[r.length-1]],e}delete e[t]}}var ra=function(e){return e.UNINIT="UNINIT",e.CLOSED="CLOSED",e.INIT_LOGGING_IN="INIT_LOGGING_IN",e.INIT_LOGGED_IN="INIT_LOGGED_IN",e.INIT_LOGIN_FAIL="INIT_LOGIN_FAIL",e.INIT_WATCH_PENDING="INIT_WATCH_PENDING",e.INIT_WATCH_FAIL="INIT_WATCH_FAIL",e.INIT_WATCH_SUCCESS="INIT_WATCH_SUCCESS",e.PAUSED="PAUSED",e.ABNORMAL_WATCH_STATUS="ABNORMAL_WATCH_STATUS",e.REBUILD_LOGGING_IN="REBUILD_LOGGING_IN",e.REBUILD_LOGGED_IN="REBUILD_LOGGED_IN",e.REBUILD_LOGIN_FAIL="REBUILD_LOGIN_FAIL",e.REBUILD_WATCH_PENDING="REBUILD_WATCH_PENDING",e.REBUILD_WATCH_FAIL="REBUILD_WATCH_FAIL",e.REBUILD_WATCH_SUCCESS="REBUILD_WATCH_SUCCESS",e}({}),na=function(e){return e.CLOSE="close",e.LOGIN_START="loginStart",e.LOGIN_FAIL="loginFail",e.LOGIN_SUCCESS="loginSuccess",e.INIT_WATCH_START="initWatchStart",e.INIT_WATCH_FAIL="initWatchFail",e.INIT_WATCH_SUCCESS="initWatchSuccess",e.WS_DISCONNECTED="wsDisconnected",e.WS_CONNECTED="wsConnected",e.REBUILD_WATCH_START="rebuildWatchStart",e.REBUILD_WATCH_FAIL="rebuildWatchFail",e.REBUILD_WATCH_SUCCESS="rebuildWatchSuccess",e.NEED_REBUILD_WATCH="needRebuildWatch",e}({}),ia={accept:na.CLOSE,to:ra.CLOSED},oa={accept:na.WS_DISCONNECTED,to:ra.CLOSED},aa={accept:na.WS_DISCONNECTED,to:ra.PAUSED},sa={[ra.UNINIT]:{transitions:[{accept:na.LOGIN_START,to:ra.INIT_LOGGING_IN},oa,ia]},[ra.CLOSED]:{transitions:[ia]},[ra.INIT_LOGGING_IN]:{transitions:[{accept:na.LOGIN_FAIL,to:ra.INIT_LOGIN_FAIL},{accept:na.LOGIN_SUCCESS,to:ra.INIT_LOGGED_IN},oa,ia]},[ra.INIT_LOGIN_FAIL]:{transitions:[{accept:na.LOGIN_START,to:ra.INIT_LOGGING_IN},oa,ia]},[ra.INIT_LOGGED_IN]:{transitions:[{accept:na.INIT_WATCH_START,to:ra.INIT_WATCH_PENDING},oa,ia]},[ra.INIT_WATCH_PENDING]:{transitions:[{accept:na.INIT_WATCH_FAIL,to:ra.INIT_WATCH_FAIL},{accept:na.INIT_WATCH_SUCCESS,to:ra.INIT_WATCH_SUCCESS},oa,ia]},[ra.INIT_WATCH_FAIL]:{transitions:[{accept:na.LOGIN_START,to:ra.INIT_LOGGING_IN},oa,ia]},[ra.INIT_WATCH_SUCCESS]:{transitions:[{accept:na.WS_DISCONNECTED,to:ra.PAUSED},{accept:na.NEED_REBUILD_WATCH,to:ra.ABNORMAL_WATCH_STATUS},aa,ia]},[ra.PAUSED]:{transitions:[{accept:na.LOGIN_START,to:ra.REBUILD_LOGGING_IN},aa,ia]},[ra.ABNORMAL_WATCH_STATUS]:{transitions:[{accept:na.LOGIN_START,to:ra.REBUILD_LOGGING_IN},aa,ia]},[ra.REBUILD_LOGGING_IN]:{transitions:[{accept:na.LOGIN_FAIL,to:ra.REBUILD_LOGIN_FAIL},{accept:na.LOGIN_SUCCESS,to:ra.REBUILD_LOGGED_IN},aa,ia]},[ra.REBUILD_LOGIN_FAIL]:{transitions:[{accept:na.LOGIN_START,to:ra.REBUILD_LOGGING_IN},aa,ia]},[ra.REBUILD_LOGGED_IN]:{transitions:[{accept:na.REBUILD_WATCH_START,to:ra.REBUILD_WATCH_PENDING},aa,ia]},[ra.REBUILD_WATCH_PENDING]:{transitions:[{accept:na.REBUILD_WATCH_FAIL,to:ra.REBUILD_WATCH_FAIL},{accept:na.REBUILD_WATCH_SUCCESS,to:ra.REBUILD_WATCH_SUCCESS},aa,ia]},[ra.REBUILD_WATCH_FAIL]:{transitions:[{accept:na.LOGIN_START,to:ra.REBUILD_LOGGING_IN},aa,ia]},[ra.REBUILD_WATCH_SUCCESS]:{transitions:[{accept:na.NEED_REBUILD_WATCH,to:ra.ABNORMAL_WATCH_STATUS},aa,ia]}};class ua{constructor(e){for(var t in this.currentState=void 0,this.states=void 0,this.listeners=new Set,this.history=void 0,this.currentState=e.initialState,this.states=new Map,e.states)this.states.set(t,{name:t,transitions:new Map(e.states[t].transitions.map((({accept:e,to:t})=>[e,t])))});this.history={options:{enable:!1,limit:100},transitions:[]},e.history&&("boolean"==typeof e.history?e.history&&(this.history.options.enable=!0):Boolean(e.history.enable)&&(void 0===e.history.limit||null===e.history.limit?this.history.options={enable:!0,limit:100}:e.history.limit>0&&(this.history.options={enable:!0,limit:e.history.limit}))),this.history.options.enable&&this.history.transitions.push({state:this.currentState})}transition(e,t){if(t&&(t instanceof Set?!t.has(this.currentState):t!==this.currentState))throw new ca(`current state (${this.currentState}) != expected from state (${t instanceof Set?JSON.stringify([...t]):t})`,"unexpectedFromState");var r="string"==typeof e?{type:e}:e,n=this.states.get(this.currentState),i=n.transitions.get(r.type);if(!i)throw new ca(`current state (${this.currentState}) does not accept "${r.type}"`,"unexpectedInput");this.currentState=i,this.history.options.enable&&(this.history.transitions.push({event:r.type,state:this.currentState}),this.history.transitions.length>this.history.options.limit&&(this.history.transitions.length===this.history.options.limit+1?this.history.transitions.shift():this.history.transitions.splice(0,this.history.transitions.length-this.history.options.limit))),this.listeners.forEach((e=>{try{e({event:r,from:n.name,to:this.currentState})}catch(e){o.error("FSM listener exec error: ",e)}}))}canAccept(e){return this.states.get(this.currentState).transitions.has(e)}subscribe(e){this.listeners.add(e)}unsubscribe(e){this.listeners.delete(e)}getHistoryRepresentation(e){return this.history.options.enable?`states: ${(e.limit?this.history.transitions.slice(-e.limit):this.history.transitions).map((({state:e,event:t})=>`${t?`-(${t})->`:""}${e}`)).join("")}`:""}}class ca extends Error{constructor(e,t,r){super(e),this.type="transition",this.subtype=void 0,this.payload=void 0,this.generic=!0,this.subtype=t,this.payload=r}}function la(e=""){return`${e?`${e}_`:""}${+new Date}_${Math.random()}`}var da=1128,fa=1,ha=2,pa=3,ga=4,Aa=5,ma=6,ya=7,va=8,Ea=9,_a=10,Ia=11,Ta=12,wa=13,Sa=14,Ca=15,ba=16,Na=17,Oa=18,Ra=30,Ba=31,Da=32,La=33,Pa=34,Ma=35,xa=36,Ua=37,ka=38,qa=39,Qa=40,Fa=50,Ha=51,Ga=52,Wa=53,ja=54,$a=55,Ya=56,Ja=57,Ka=58,za=59,Xa=60;class Va{constructor(e){this.close=void 0,this.onChange=void 0,this.onError=void 0,this.close=e.close,this.onChange=e.onChange,this.onError=e.onError,e.debug&&Object.defineProperty(this,"virtualClient",{get:()=>e.virtualClient})}}class Za{constructor(e){this.id=void 0,this.docChanges=void 0,this.docs=void 0,this.type=void 0,this.EJSON=void 0,this.requestId=void 0,this.watchId=void 0;var{id:t,docChanges:r,docs:n,type:i,EJSON:o,requestId:a,watchId:s}=e;Object.defineProperties(this,{id:{value:t,writable:!1,enumerable:!0},docChanges:{value:r,writable:!1,enumerable:!0},docs:{value:n,writable:!1,enumerable:!0},type:{value:i,writable:!1,enumerable:!0}}),this.requestId=a,this.watchId=s}}class es extends Error{constructor(e){super(`Watch Error ${JSON.stringify(e.msgData)} (requestid: ${e.requestId})`),this.isRealtimeErrorMessageError=!0,this.payload=void 0,this.payload=e}}var ts=e=>e&&e.isRealtimeErrorMessageError,rs=new Set([ra.REBUILD_LOGGING_IN,ra.INIT_LOGGING_IN]),ns=e=>{0};class is{constructor(e){var t=this;this.watchId=void 0,this._parentFSM=void 0,this._fsm=void 0,this.envId=void 0,this.collectionName=void 0,this.query=void 0,this.limit=void 0,this.orderBy=void 0,this.queryType=void 0,this.send=void 0,this.login=void 0,this.isWSConnected=void 0,this.getWaitExpectedTimeoutLength=void 0,this.getEJSON=void 0,this.getServiceContext=void 0,this.onWatchStart=void 0,this.onWatchClose=void 0,this.timing=void 0,this.closeWatchInvoked=!1,this.userOnErrorInvoked=!1,this.debug=void 0,this.wsclient=void 0,this.listener=void 0,this._availableRetries=void 0,this._ackTimeoutId=void 0,this._loginInvalidated=!1,this._errors=[],this._parentFSMListener=void 0,this._FSMListener=void 0,this._wsDisconnectionTS=void 0,this.sessionInfo=void 0,this._waitExpectedTimeoutId=void 0,this._snapshotHistory=[],this._login=function(){var e=h()((function*(e){t._fsm.transition(na.LOGIN_START);try{var r=yield t.login(t.envId,e||t._loginInvalidated,t.timing);t.envId||(t.envId=r.envId),t._fsm.transition(na.LOGIN_SUCCESS,rs),t._loginInvalidated=!1}catch(e){t._errors.push(e),t._loginInvalidated=!0;try{t._fsm.transition(na.LOGIN_FAIL,rs)}catch(e){o.warn("[realtime]",e)}}}));return function(t){return e.apply(this,arguments)}}(),this.initWatch=h()((function*(){var e=Date.now(),r=la();try{t._fsm.transition(na.INIT_WATCH_START,ra.INIT_LOGGED_IN);var n=t.envId,i={watchId:t.watchId,requestId:r,msgType:"INIT_WATCH",msgData:{envId:n,collName:t.collectionName,query:t.query,limit:t.limit,orderBy:t.orderBy,queryType:t.queryType}},o=yield t.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:1e4});t.assertAsyncTaskStatus();var{events:a,currEvent:s}=o.msgData;if(t.sessionInfo={queryID:o.msgData.queryID,currentEventId:s-1,currentDocs:[],currentEventTS:Date.now()},a.length>0){for(var u of a)u.ID=s;t.handleServerEvents(o)}else{t.sessionInfo.currentEventId=s;var c=new Za({id:s,docChanges:[],docs:[],type:"init",EJSON:t.getEJSON(),requestId:o.requestId,watchId:t.watchId});q.surroundThirdByTryCatch((()=>t.listener.onChange(c)))(),t.scheduleSendACK(),t.debug&&t._snapshotHistory.push(c)}t.onWatchStart(t,t.sessionInfo.queryID),t._availableRetries.INIT_WATCH=2,t._wsDisconnectionTS=void 0,Jt(da,Aa,!0),Yt({apiName:"_realtime.initWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),t._fsm.transition(na.INIT_WATCH_SUCCESS)}catch(n){Yt({apiName:"_realtime.initWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),t.handleWatchEstablishmentError(n,{operationName:"INIT_WATCH",requestId:r})}})),this.rebuildWatch=h()((function*(){var e=Date.now(),r=la();try{t._fsm.transition(na.REBUILD_WATCH_START,ra.REBUILD_LOGGED_IN);var n=t.envId;if(!t.sessionInfo)throw new Error("can not rebuildWatch without a successful initWatch (lack of sessionInfo)");if(t._wsDisconnectionTS&&Date.now()-t._wsDisconnectionTS>.9*t.getServiceContext().appConfig.realtimeQueryEventCacheTimeout)throw new R("query event cache timeout, ws has been disconnected for too long, PLEASE RECONNECT manually",{subtype:"queryEventCacheClientTimeout",retryable:!1});var i={watchId:t.watchId,requestId:r,msgType:"REBUILD_WATCH",msgData:{envId:n,collName:t.collectionName,queryID:t.sessionInfo.queryID,eventID:t.sessionInfo.currentEventId}},o=yield t.send({msg:i,waitResponse:!0,skipOnMessage:!0,timeout:1e4});t.assertAsyncTaskStatus(),yield t.handleServerEvents(o),t._availableRetries.REBUILD_WATCH=2,t._wsDisconnectionTS=void 0,Jt(da,ya,!0),Yt({apiName:"_realtime.rebuildWatch(success)",apiStartTime:e,apiEndTime:Date.now()}),t._fsm.transition(na.REBUILD_WATCH_SUCCESS)}catch(n){Yt({apiName:"_realtime.rebuildWatch(fail)",apiStartTime:e,apiEndTime:Date.now()}),t.handleWatchEstablishmentError(n,{operationName:"REBUILD_WATCH",requestId:r})}})),this.handleWatchEstablishmentError=function(){var e=h()((function*(e,r){var n="INIT_WATCH"===r.operationName,i=i=>{var o=`${i||e} (${n?"initWatch":"rebuildWatch"} requestId ${r.requestId})`;if(t.closeWithError(new C({errCode:n?S.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL:S.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:o})),Jt(da,n?ma:va,!0),!ts(e)){if(B(e)){switch(e.payload.subtype){case"totalConnectionTimeout":Jt(da,n?ja:$a,!0);break;case"queryEventCacheClientTimeout":n||Jt(da,Ya,!0)}return}return P(e)?void Jt(da,n?Ja:Ka,!0):void Jt(da,n?za:Xa,!0)}switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":Jt(da,n?Fa:Ha,!0);break;default:Jt(da,n?Ga:Wa,!0)}};t._errors.push(e),t.handleCommonError(e,{onSignError:()=>{t._loginInvalidated=!0,t._fsm.transition(t.initialized?na.REBUILD_WATCH_FAIL:na.INIT_WATCH_FAIL)},onTimeoutError:e=>{e.payload&&!e.payload.retryable?i(e):t._fsm.transition(t.initialized?na.REBUILD_WATCH_FAIL:na.INIT_WATCH_FAIL)},onNotRetryableError:i,onCancelledError:e=>{t._fsm.transition(t.initialized?na.REBUILD_WATCH_FAIL:na.INIT_WATCH_FAIL)},onUnknownError:()=>{t._fsm.transition(t.initialized?na.REBUILD_WATCH_FAIL:na.INIT_WATCH_FAIL)}})}));return function(t,r){return e.apply(this,arguments)}}(),this.closeWatch=h()((function*(){t.closeWatchInvoked=!0;var e=t.sessionInfo?t.sessionInfo.queryID:"";if(t._fsm.currentState!==ra.CLOSED)try{t._fsm.transition(na.CLOSE),yield t.sendCloseWatch()}catch(e){o.warn(`[realtime] non-fatal error while closing watch: ${e}`)}finally{t.sessionInfo=void 0,t.onWatchClose(t,e),t._cleanup()}})),this.sendCloseWatch=h()((function*(){var e={watchId:t.watchId,requestId:la(),msgType:"CLOSE_WATCH",msgData:null};yield t.send({msg:e})})),this.scheduleSendACK=()=>{this.clearACKSchedule(),this._ackTimeoutId=setTimeout((()=>{this._waitExpectedTimeoutId?this.scheduleSendACK():this.sendACK()}),1e4)},this.clearACKSchedule=()=>{this._ackTimeoutId&&clearTimeout(this._ackTimeoutId)},this.sendACK=h()((function*(){try{if(t._fsm.currentState!==ra.INIT_WATCH_SUCCESS&&t._fsm.currentState!==ra.REBUILD_WATCH_SUCCESS)return void t.scheduleSendACK();if(!t.sessionInfo)return void o.warn("[realtime listener] can not send ack without a successful initWatch (lack of sessionInfo)");var e={watchId:t.watchId,requestId:la(),msgType:"CHECK_LAST",msgData:{queryID:t.sessionInfo.queryID,eventID:t.sessionInfo.currentEventId}};yield t.send({msg:e}),t.scheduleSendACK()}catch(e){if(ts(e)){var r=e.payload;switch(r.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return t._loginInvalidated=!0,void(t._fsm.currentState!==ra.INIT_WATCH_SUCCESS&&t._fsm.currentState!==ra.REBUILD_WATCH_SUCCESS||t._fsm.transition(na.NEED_REBUILD_WATCH));case"QUERYID_INVALID_ERROR":case"SYS_ERR":case"INVALIID_ENV":case"COLLECTION_PERMISSION_DENIED":return void t.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:r.msgData.code}))}}t._availableRetries.CHECK_LAST&&t._availableRetries.CHECK_LAST>0?(t._availableRetries.CHECK_LAST--,t.scheduleSendACK()):t.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_CHECK_LAST_FAIL,errMsg:e}))}})),this.handleCommonError=(e,t)=>{if(ts(e)){switch(e.payload.msgData.code){case"CHECK_LOGIN_FAILED":case"SIGN_EXPIRED_ERROR":case"SIGN_INVALID_ERROR":case"SIGN_PARAM_INVALID":return void t.onSignError(e);default:return void t.onNotRetryableError(e)}}else{if(B(e))return void t.onTimeoutError(e);if(P(e))return void t.onCancelledError(e)}t.onUnknownError(e)},this.watchId=`watchid_${+new Date}_${Math.random()}`,this._parentFSM=e.parentFSM,this.envId=e.envId,this.collectionName=e.collectionName,this.query=e.query,this.limit=e.limit,this.orderBy=e.orderBy,this.queryType=e.queryType,this.send=e.send,this.login=e.login,this.isWSConnected=e.isWSConnected,this.getWaitExpectedTimeoutLength=e.getWaitExpectedTimeoutLength,this.getEJSON=e.getEJSON,this.getServiceContext=e.getServiceContext,this.onWatchStart=e.onWatchStart,this.onWatchClose=e.onWatchClose,this.timing=e.timing,this.debug=e.debug,this._availableRetries={INIT_WATCH:2,REBUILD_WATCH:2,CHECK_LAST:2},this._fsm=new ua({initialState:ra.UNINIT,states:sa,history:!0}),this._subscribeParentFSMEvents(),this._subscribeFSMEvents(),this.listener=new Va({close:this.closeWatch,onChange:e.onChange,onError:e.onError,debug:this.debug,virtualClient:this}),this._parentFSM.currentState===Jo.CONNECTED&&this._login(),e.debug&&(this.wsclient=e.wsclient)}get initialized(){return Boolean(this.sessionInfo)}_cleanup(){this._parentFSM.unsubscribe(this._parentFSMListener)}_subscribeParentFSMEvents(){this._parentFSMListener=e=>{var{event:t,from:r,to:n}=e;if(this._fsm.currentState!==ra.CLOSED)if(t.type===Ko.DISCONNECT||t.type===Ko.CONNECTION_FAIL)switch(this._fsm.currentState){case ra.UNINIT:case ra.INIT_LOGGING_IN:case ra.INIT_LOGIN_FAIL:case ra.INIT_LOGGED_IN:case ra.INIT_WATCH_PENDING:case ra.INIT_WATCH_FAIL:this.closeWithError(t.error||new Error("websocket connection fail"),!1);break;default:t.type===Ko.DISCONNECT?(this._wsDisconnectionTS||(this._wsDisconnectionTS=Date.now()),this._fsm.transition(na.WS_DISCONNECTED)):this.closeWithError(t.error||new Error("websocket connection fail"),!1)}else if(t.type===Ko.CONNECTION_SUCCESS)switch(this._fsm.currentState){case ra.UNINIT:case ra.PAUSED:this._login();break;case ra.CLOSED:break;default:o.warn(`[realtime] current state should not be ${this._fsm.currentState} (parent event ${t})`)}},this._parentFSM.subscribe(this._parentFSMListener)}_subscribeFSMEvents(){this._FSMListener=e=>{var{event:t,from:r,to:n}=e;switch(t.type){case na.WS_CONNECTED:this._login().catch(ns);break;case na.LOGIN_SUCCESS:r===ra.INIT_LOGGING_IN?this.initWatch().catch(ns):r===ra.REBUILD_LOGGING_IN?this.rebuildWatch().catch(ns):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`unexpected state: event ${t.type} from ${r}`}));break;case na.LOGIN_FAIL:r===ra.INIT_LOGGING_IN?this.useRetryTicket("INIT_WATCH")?this._login().catch(ns):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:`login fail ${this._errors[this._errors.length-1]}`})):r===ra.REBUILD_LOGGING_IN?this.useRetryTicket("REBUILD_WATCH")?this._login().catch(ns):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:`login fail ${this._errors[this._errors.length-1]}`})):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`unexpected state: event ${t.type} from ${r}`}));break;case na.INIT_WATCH_SUCCESS:this._availableRetries.INIT_WATCH=2,this._errors=[];break;case na.INIT_WATCH_FAIL:this.useRetryTicket("INIT_WATCH")?this._login().catch(ns):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_INIT_WATCH_FAIL,errMsg:`init watch fail ${this._errors[this._errors.length-1]}`}));break;case na.REBUILD_WATCH_SUCCESS:this._availableRetries.REBUILD_WATCH=2,this._errors=[];break;case na.REBUILD_WATCH_FAIL:this.useRetryTicket("REBUILD_WATCH")?this._login().catch(ns):this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_REBUILD_WATCH_FAIL,errMsg:`init watch fail ${this._errors[this._errors.length-1]}`}));break;case na.NEED_REBUILD_WATCH:this._login().catch(ns)}},this._fsm.subscribe(this._FSMListener)}useRetryTicket(e){return!!(this._availableRetries[e]&&this._availableRetries[e]>0)&&(this._availableRetries[e]--,!0)}assertAsyncTaskStatus(){if(this.closeWatchInvoked)throw new D("closeWatch",{subtype:"closeWatch"});switch(this._fsm.currentState){case ra.PAUSED:throw new D("pause",{subtype:"pause"});case ra.CLOSED:throw new D("close",{subtype:"close"})}}handleServerEvents(e){var t=this;return h()((function*(){try{t.scheduleSendACK(),yield t._handleServerEvents(e),t._postHandleServerEventsValidityCheck(e)}catch(e){throw Jt(da,La,!0),e}}))()}_handleServerEvents(e){var t=this;return h()((function*(){var{requestId:r}=e,{events:n}=e.msgData;if(n.length&&t.sessionInfo){var i,a=t.sessionInfo;try{i=n.map(os)}catch(e){return void t.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_RECEIVE_INVALID_SERVER_DATA,errMsg:e}))}for(var s=[...a.currentDocs],u=!1,c=function*(){var n=i[l];if(a.currentEventId>=n.id)return!i[l-1]||n.id>i[l-1].id?Jt(da,Pa,!0):(o.error(`[realtime listener] server non-fatal error: events out of order (the latter event's id is smaller than that of the former) (requestId ${r})`),Jt(da,Ma,!0)),"continue";if(a.currentEventId===n.id-1){switch(n.dataType){case"update":if(!n.doc)switch(n.queueType){case"update":case"dequeue":var c=s.find((e=>e._id===n.docId));if(c){var f=JSON.parse(JSON.stringify(c));if(n.updatedFields)for(var h in n.updatedFields)ea(f,h,n.updatedFields[h]);if(n.removedFields)for(var p of n.removedFields)ta(f,p);n.doc=f}else o.error("[realtime listener] internal non-fatal server error: unexpected update dataType event where no doc is associated."),Jt(da,xa,!0);break;case"enqueue":var g=new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`HandleServerEvents: full doc is not provided with dataType="update" and queueType="enqueue" (requestId ${e.requestId})`});throw t.closeWithError(g),g}break;case"limit":if(!n.doc&&"dequeue"===n.queueType){var A=s.find((e=>e._id===n.docId));A?n.doc=A:o.error("[realtime listener] internal non-fatal server error: unexpected limit dataType dequeue queueType event where no doc is associated.")}break;case"replace":if(!n.doc){var m=new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`HandleServerEvents: full doc is not provided with dataType="replace" (requestId ${e.requestId})`});throw t.closeWithError(m),m}break;case"remove":var y=s.find((e=>e._id===n.docId));y?n.doc=y:(o.error("[realtime listener] internal non-fatal server error: unexpected remove event where no doc is associated."),Jt(da,Ua,!0))}switch(n.queueType){case"init":u?s.push(n.doc):(u=!0,s=[n.doc]);break;case"enqueue":s.push(n.doc);break;case"dequeue":var v=s.findIndex((e=>e._id===n.docId));v>-1?s.splice(v,1):(o.error("[realtime listener] internal non-fatal server error: unexpected dequeue event where no doc is associated."),Jt(da,ka,!0));break;case"update":var E=s.findIndex((e=>e._id===n.docId));E>-1?s[E]=n.doc:(o.error("[realtime listener] internal non-fatal server error: unexpected queueType update event where no doc is associated."),Jt(da,qa,!0))}if(l===d-1||i[l+1]&&i[l+1].id!==n.id){var _=[...s],I=i.slice(0,l+1).filter((e=>e.id===n.id));t.sessionInfo.currentEventId=n.id,t.sessionInfo.currentDocs=s,t.sessionInfo.currentEventTS=Date.now();var T=new Za({id:n.id,type:"init"===I[0].queueType?"init":void 0,docChanges:t.getEJSON().deserialize(I),docs:t.getEJSON().deserialize(_),EJSON:t.getEJSON(),requestId:r,watchId:t.watchId});q.surroundThirdByTryCatch((()=>t.listener.onChange(T)))(),t.debug&&t._snapshotHistory.push(T)}}else Jt(da,Qa,!0),t._fsm.transition(na.NEED_REBUILD_WATCH)},l=0,d=i.length;l<d;l++)yield*c()}}))()}_postHandleServerEventsValidityCheck(e){this.sessionInfo?(this.sessionInfo.expectEventId&&this.sessionInfo.currentEventId>=this.sessionInfo.expectEventId&&this.clearWaitExpectedEvent(),this.sessionInfo.currentEventId<e.msgData.currEvent&&o.warn(`[realtime listener] internal non-fatal error: client eventId ${this.sessionInfo.currentEventId} does not match with server event id after server event handling ${e.msgData.currEvent} (requestId ${e.requestId})`)):o.error(`[realtime listener] internal non-fatal error: sessionInfo lost after server event handling, this should never occur. (requestId ${e.requestId})`)}clearWaitExpectedEvent(){this._waitExpectedTimeoutId&&(clearTimeout(this._waitExpectedTimeoutId),this._waitExpectedTimeoutId=void 0)}onMessage(e){switch(this._fsm.currentState){case ra.INIT_WATCH_SUCCESS:case ra.REBUILD_WATCH_SUCCESS:break;case ra.PAUSED:if("ERROR"!==e.msgType)return;break;default:return void o.warn(`[realtime listener] internal non-fatal error: unexpected message received while state is ${this._fsm.currentState}`)}if(this.sessionInfo)switch(this.scheduleSendACK(),e.msgType){case"NEXT_EVENT":0,this.handleServerEvents(e);break;case"CHECK_EVENT":this.sessionInfo.currentEventId<e.msgData.currEvent&&(this.sessionInfo.expectEventId=e.msgData.currEvent,this.clearWaitExpectedEvent(),this._waitExpectedTimeoutId=setTimeout((()=>{this._fsm.transition(na.NEED_REBUILD_WATCH)}),this.getWaitExpectedTimeoutLength()));break;case"ERROR":this.closeWithError(new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_SERVER_ERROR_MSG,errMsg:`${e.msgData.code} - ${e.msgData.message}`}))}else o.warn("[realtime listener] internal non-fatal error: sessionInfo not found while message is received.")}closeWithError(e,t=!0){if(this._fsm.currentState!==ra.CLOSED&&this._fsm.transition(na.CLOSE),!this.userOnErrorInvoked){var r=this._fsm.getHistoryRepresentation({limit:20});b(e)?(e.errMsg+=`\nhistory ${r}`,e.history=r):e&&((e=new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_UNEXPECTED_FATAL_ERROR,errMsg:`${e} \nhistory ${r}`})).history=r),this.clearACKSchedule(),q.surroundThirdByTryCatch((()=>this.listener.onError(e)))(),this.userOnErrorInvoked=!0,this.onWatchClose(this,this.sessionInfo&&this.sessionInfo.queryID||""),t&&this.sendCloseWatch().catch(ns),this.sessionInfo=void 0}}}function os(e){var t={id:e.ID,dataType:e.DataType,queueType:e.QueueType,docId:e.DocID,doc:e.Doc&&"{}"!==e.Doc?JSON.parse(e.Doc):void 0};return"update"===e.DataType&&(e.UpdatedFields&&(t.updatedFields=JSON.parse(e.UpdatedFields)),(e.removedFields||e.RemovedFields)&&(t.removedFields=e.removedFields?JSON.parse(e.removedFields):JSON.parse(e.RemovedFields))),t}var as={1e3:{code:1e3,name:"Normal Closure",description:"Normal closure; the connection successfully completed whatever purpose for which it was created."},1001:{code:1001,name:"Going Away",description:"The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection."},1002:{code:1002,name:"Protocol Error",description:"The endpoint is terminating the connection due to a protocol error."},1003:{code:1003,name:"Unsupported Data",description:"The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data)."},1005:{code:1005,name:"No Status Received",description:"Indicates that no status code was provided even though one was expected."},1006:{code:1006,name:"Abnormal Closure",description:"Used to indicate that a connection was closed abnormally (that is, with no close frame being sent) when a status code is expected."},1007:{code:1007,name:"Invalid frame payload data",description:"The endpoint is terminating the connection because a message was received that contained inconsistent data (e.g., non-UTF-8 data within a text message)."},1008:{code:1008,name:"Policy Violation",description:"The endpoint is terminating the connection because it received a message that violates its policy. This is a generic status code, used when codes 1003 and 1009 are not suitable."},1009:{code:1009,name:"Message too big",description:"The endpoint is terminating the connection because a data frame was received that is too large."},1010:{code:1010,name:"Missing Extension",description:"The client is terminating the connection because it expected the server to negotiate one or more extension, but the server didn't."},1011:{code:1011,name:"Internal Error",description:"The server is terminating the connection because it encountered an unexpected condition that prevented it from fulfilling the request."},1012:{code:1012,name:"Service Restart",description:"The server is terminating the connection because it is restarting."},1013:{code:1013,name:"Try Again Later",description:"The server is terminating the connection due to a temporary condition, e.g. it is overloaded and is casting off some of its clients."},1014:{code:1014,name:"Bad Gateway",description:"The server was acting as a gateway or proxy and received an invalid response from the upstream server. This is similar to 502 HTTP Status Code."},1015:{code:1015,name:"TLS Handshake",description:"Indicates that the connection was closed due to a failure to perform a TLS handshake (e.g., the server certificate can't be verified)."},3e3:{code:3e3,name:"Reconnect WebSocket",description:"The client is terminating the connection because it wants to reconnect"},3001:{code:3001,name:"No Realtime Listeners",description:"The client is terminating the connection because no more realtime listeners exist"},3002:{code:3002,name:"Heartbeat Ping Error",description:"The client is terminating the connection due to its failure in sending heartbeat messages"},3003:{code:3003,name:"Heartbeat Pong Timeout Error",description:"The client is terminating the connection because no heartbeat response is received from the server"},3004:{code:3004,name:"Client Reconnect on Server Upgrade",description:"The client is terminating the connection in response to server upgrade"},3050:{code:3050,name:"Server Close Unauthenticated Idle Connection",description:"The server is terminating the connection because the connection is idle and not authenticated"},3051:{code:3051,name:"Server Upgrade",description:"The server is terminating the connection because it is upgrading"},3052:{code:3052,name:"Server Requires Authentication",description:"The server is terminating the connection because it has not received authentication message as the connection's first message"}},ss=function(e){return e[e.NormalClosure=1e3]="NormalClosure",e[e.GoingAway=1001]="GoingAway",e[e.ProtocolError=1002]="ProtocolError",e[e.UnsupportedData=1003]="UnsupportedData",e[e.NoStatusReceived=1005]="NoStatusReceived",e[e.AbnormalClosure=1006]="AbnormalClosure",e[e.InvalidFramePayloadData=1007]="InvalidFramePayloadData",e[e.PolicyViolation=1008]="PolicyViolation",e[e.MessageTooBig=1009]="MessageTooBig",e[e.MissingExtension=1010]="MissingExtension",e[e.InternalError=1011]="InternalError",e[e.ServiceRestart=1012]="ServiceRestart",e[e.TryAgainLater=1013]="TryAgainLater",e[e.BadGateway=1014]="BadGateway",e[e.TLSHandshake=1015]="TLSHandshake",e[e.ReconnectWebSocket=3e3]="ReconnectWebSocket",e[e.NoRealtimeListeners=3001]="NoRealtimeListeners",e[e.HeartbeatPingError=3002]="HeartbeatPingError",e[e.HeartbeatPongTimeoutError=3003]="HeartbeatPongTimeoutError",e[e.ReconnectOnServerUpgrade=3004]="ReconnectOnServerUpgrade",e[e.UnauthenticatedIdleConnection=3050]="UnauthenticatedIdleConnection",e[e.ServerUpgrade=3051]="ServerUpgrade",e[e.AuthenticationRequired=3052]="AuthenticationRequired",e}({}),us=(e,t)=>{var r=as[e],n=r?`${r.name}, code ${e}, reason ${t||r.description}`:`code ${e}`;return new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_WEBSOCKET_CONNECTION_CLOSED,errMsg:n})},cs=1;class ls{constructor(e){var t=this;this._fsm=void 0,this._virtualWSClient=new Set,this._queryIdClientMap=new Map,this._watchIdClientMap=new Map,this._totalConnectionTimeoutId=void 0,this._serviceContext=void 0,this._ws=void 0,this._lastPingSendTS=void 0,this._pingFailed=0,this._pongMissed=0,this._pingTimeoutId=void 0,this._pongTimeoutId=void 0,this._logins=new Map,this._signatures=new Map,this._wsResponseWait=new Map,this._rttObserved=[],this._closedWatches=new Set,this._EJSON=void 0,this._defaultEnvId=void 0,this._connectionEnvId=void 0,this._retryLock=!1,this.initWebSocketConnection=function(){var e=h()((function*(e,r=t._maxReconnect){var n;if(t._EJSON||(n=function(){return ds.apply(this,arguments)}().then((e=>t._EJSON=e))),t._fsm.currentState===Jo.DISCONNECTED){t._fsm.transition(Ko.CONNECTION_START),t._logins=new Map,t._wsResponseWait=new Map;var i=!1,o=[],a=!1;if(!t._totalConnectionTimeoutId&&t._totalConnectionTimeout&&t._totalConnectionTimeout!==1/0){var s=t._totalConnectionTimeout;t._totalConnectionTimeoutId=setTimeout((()=>{a=!0,e&&t._retryLock&&(t._retryLock=!1),t._totalConnectionTimeoutId=void 0;var r=new R(`reconnect timeout (reach totalConnectionTimeout ${s}s)`,{subtype:"totalConnectionTimeout",retryable:!1});Jt(da,Na,!0),t._fsm.transition({type:Ko.CONNECTION_FAIL,error:r})}),1e3*s)}if(e){if(t._retryLock)return void 0;0,t._retryLock=!0}for(var u=function*(){try{if(!(yield le()).isConnected){if(!e)return t._fsm.transition({type:Ko.CONNECTION_FAIL,error:new Error("network offline")}),{v:void 0};if(yield new Promise((e=>{oe&&oe.isConnected?e():ce.push(e)})),0===t._virtualWSClient.size)return t.clearTotalReconnectTimeout(),{v:void 0};Mt()&&(yield se(100))}if(a)return{v:void 0};0;var r=yield t.getSignature(t._connectionEnvId);if(a)return{v:void 0};0;var s=Date.now();return yield new Promise(((e,n)=>{t._ws=re(t._context.identifiers)._socketSkipCheckDomainFactory().connectSocket({url:r.wsUrl,header:{"content-type":"application/json"},perMessageDeflate:!0,success:e,fail:n})})),a?{v:void 0}:(Yt({apiName:"_realtime.connectSocket",apiStartTime:s,apiEndTime:Date.now()}),yield t.initWebSocketEvent(),a||n&&(yield n,a)?{v:void 0}:(i=!0,"break"))}catch(e){if(o.unshift(e),e.errCode===S.TCB_PERMISSION_DENIED)return"break";var{isConnected:u}=yield le();if(a)return{v:void 0};if(u&&(yield se(t._reconnectInterval),a))return{v:void 0};if(Mt()&&(yield se(0),a))return{v:void 0}}},c=t._maxReconnect;c>=0;c--){var l=yield*u();if("break"===l)break;if("object"==typeof l)return l.v}if(e&&t._retryLock&&(t._retryLock=!1),i)return t.clearTotalReconnectTimeout(),Jt(da,e?pa:fa,!0),void t._fsm.transition(Ko.CONNECTION_SUCCESS);t.clearTotalReconnectTimeout(),Jt(da,e?ga:ha,!0),e?t._fsm.transition({type:Ko.CONNECTION_FAIL,error:new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_RECONNECT_WS_FAIL,errMsg:`errors of each retry (latest to oldest): ${JSON.stringify(o.map((e=>e+"")))}`})}):t._fsm.transition({type:Ko.CONNECTION_FAIL,error:new C({errCode:S.SDK_DATABASE_REALTIME_LISTENER_INIT_WS_FAIL,errMsg:`errors of each retry (latest to oldest): ${JSON.stringify(o.map((e=>e+"")))}`})})}}));return function(t){return e.apply(this,arguments)}}(),this.initWebSocketEvent=()=>new Promise(((e,t)=>{if(!this._ws)throw new Error("can not initWebSocketEvent, ws not exists");var r=!1;this._ws.onOpen((t=>{this._context.debug&&o.warn("[realtime] ws event: open",t),r=!0,e()}));var n=null;this._ws.onError((e=>{n=e,this._logins=new Map,r?(this._context.debug&&o.error("[realtime] ws event: error",e),this.clearHeartbeat(),Jt(da,_a,!0)):(this._context.debug&&o.error("[realtime] ws open failed with ws event: error",e),t(e),Jt(da,Ea,!0))})),this._ws.onClose((e=>{this._logins=new Map,this.clearHeartbeat();var t=n||us(e.code);switch(e.code){case ss.ReconnectOnServerUpgrade:case ss.ReconnectWebSocket:case ss.NoRealtimeListeners:this._fsm.transition({type:Ko.DISCONNECT,error:t});break;case ss.HeartbeatPingError:case ss.HeartbeatPongTimeoutError:case ss.NormalClosure:case ss.AbnormalClosure:this._maxReconnect>0?(this._fsm.transition({type:Ko.DISCONNECT,error:t}),this.initWebSocketConnection(!0)):this._fsm.transition({type:Ko.CONNECTION_FAIL,error:t}),e.code===ss.HeartbeatPingError?Jt(da,Ta,!0):e.code===ss.HeartbeatPongTimeoutError?Jt(da,wa,!0):Jt(da,Sa,!0);break;case ss.UnauthenticatedIdleConnection:this._fsm.transition({type:Ko.CONNECTION_FAIL,error:us(e.code,e.reason)}),Jt(da,Ca,!0);break;case ss.ServerUpgrade:this._fsm.transition({type:Ko.DISCONNECT,error:t}),this.initWebSocketConnection(!0),Jt(da,Oa,!0);break;default:this._maxReconnect>0?(this._fsm.transition({type:Ko.DISCONNECT,error:t}),this.initWebSocketConnection(!0)):this._fsm.transition({type:Ko.CONNECTION_FAIL,error:us(e.code,e.reason)}),Jt(da,ba,!0)}Jt(da,Ia,!0)}));var i={timing:{},startKey:"apiStartTime",endKey:"apiEndTime",samplePicker:er,autoReport:"_realtime.onSocketMessage"};this._ws.onMessage(Zt(this.onSocketMessage,i)),this.heartbeat()})),this.isWSConnected=()=>Boolean(this._ws&&this._ws.readyState===cs),this.onSocketMessage=e=>{var t,r=e.data;this.heartbeat();try{t=JSON.parse(r)}catch(e){throw new Error(`[realtime] onMessage parse res.data error: ${e}`)}this._context.debug&&o.log(`[realtime] onMessage ${t.msgType} (${(new Date).toLocaleString()})`,t);var n=this._wsResponseWait.get(t.requestId);if(n){try{"ERROR"===t.msgType?n.reject(new es(t)):n.resolve(t)}catch(e){this._context.debug&&o.error("ws onMessage responseWaitSpec.resolve(msg) errored:",e)}finally{this._wsResponseWait.delete(t.requestId)}if(n.skipOnMessage)return}if("PONG"!==t.msgType){var i=t.watchId&&this._watchIdClientMap.get(t.watchId);if(i)i.onMessage(t);else switch(t.watchId?this._closedWatches.has(t.watchId)?Jt(da,Ra,!0):Jt(da,Ba,!0):Jt(da,Da,!0),t.msgType){case"INIT_EVENT":case"NEXT_EVENT":case"CHECK_EVENT":(i=this._queryIdClientMap.get(t.msgData.queryID))&&i.onMessage(t)}}else if(this._lastPingSendTS){var a=Date.now()-this._lastPingSendTS;if(a>1e4)return void(this._context.debug&&o.warn(`[realtime] untrusted rtt observed: ${a}`));this._rttObserved.length>=3&&this._rttObserved.splice(0,this._rttObserved.length-3+1),this._rttObserved.push(a)}},this.login=function(){var e=h()((function*(e,r,n){if(e=e||t._context.env||t._defaultEnvId,!r)if(e){var i=t._logins.get(e);if(i){if(i.loggedIn&&i.loginResult)return i.loginResult;if(i.loggingInPromise)return i.loggingInPromise}}else{var o=t._logins.get("");if(o&&o.loggingInPromise)return o.loggingInPromise}var a=new Promise(function(){var i=h()((function*(i,o){try{var a=yield n?Zt(t.getSignature(e,r),{timing:n,startKey:"tunnelStartTime",endKey:"tunnelEndTime",condition:{emptyKey:!0}}):t.getSignature(e,r),s=(()=>{var e,t,r=re().wx;if(r&&r.version){e=r.version.version,t=r.version.updateTime;var n=r.version.updateTime.match(/^(\d+)\.(\d+)\.(\d+)/);return{version:e,updateTime:t,updateDateInDashes:n?`${n[1]}-${n[2]}-${n[3]}`:"unknown"}}return{version:"unknown",updateTime:"unknown",updateDateInDashes:"unknown"}})(),u={watchId:void 0,requestId:la(),msgType:"LOGIN",msgData:{envId:a.envId,signStr:a.signStr,secretVersion:a.secretVersion,referrer:"mp",sdkVersion:s.version,dataVersion:s.updateDateInDashes}},c=yield t.send({msg:u,waitResponse:!0,skipOnMessage:!0,timeout:5e3});c.msgData.code?o(new Error(`${c.msgData.code} ${c.msgData.message}`)):i({envId:a.envId})}catch(e){o(e)}}));return function(e,t){return i.apply(this,arguments)}}()),s=e&&t._logins.get(e),u=Date.now();s?(s.loggedIn=!1,s.loggingInPromise=a,s.loginStartTS=u):(s={loggedIn:!1,loggingInPromise:a,loginStartTS:u},t._logins.set(e||"",s));try{var c=yield a,l=t._logins.get(e||"");if(l&&l===s&&l.loginStartTS===u)return s.loggedIn=!0,s.loggingInPromise=void 0,s.loginStartTS=void 0,s.loginResult=c,c;if(l){if(l.loggedIn&&l.loginResult)return l.loginResult;if(l.loggingInPromise)return l.loggingInPromise;throw new Error("ws unexpected login info")}throw new Error("ws login info reset")}catch(e){throw s.loggedIn=!1,s.loggingInPromise=void 0,s.loginStartTS=void 0,s.loginResult=void 0,e}}));return function(t,r,n){return e.apply(this,arguments)}}(),this.getSignature=function(){var e=h()((function*(e,r){if(e=e||t._context.env||t._defaultEnvId,!r&&e&&t._signatures.has(e)){var n=t._signatures.get(e);if(Date.now()<n.expireTS)return n}else 0;var i=Date.now()+6e4,o=yield function(e,t){return Ji.apply(this,arguments)}(t._context,e);if(Date.now()-i>6e4)return t.getSignature(e,r);var a={...o,expireTS:i};return t._signatures.set(a.envId,a),e||(t._defaultEnvId=a.envId),a}));return function(t,r){return e.apply(this,arguments)}}(),this.getWaitExpectedTimeoutLength=()=>this._rttObserved.length?this._rttObserved.reduce(((e,t)=>e+t))/this._rttObserved.length*1.5:5e3,this.ping=h()((function*(){var e={watchId:void 0,requestId:la(),msgType:"PING",msgData:null};yield t.send({msg:e}),t._context.debug&&o.log("ping sent")})),this.send=e=>new Promise(function(){var r=h()((function*(r,n){if(t._fsm.currentState!==Jo.CONNECTED)return n(new Error("websocket not connected"));var i,a=!1,s=!1,u=e=>{a=!0,i&&clearTimeout(i),r(e)},c=e=>{s=!0,i&&clearTimeout(i),n(e)};e.timeout&&(i=setTimeout(h()((function*(){a&&s||(yield se(0),a&&s||c(new R("wsclient.send timedout")))})),e.timeout));try{if(t._context.debug&&o.log(`[realtime] ws send ${e.msg.msgType} (${(new Date).toLocaleString()}): `,e),!t._ws)return void c(new Error("invalid state: ws connection not exists, can not send message"));if(t._ws.readyState!==cs)return void c(new Error(`ws readyState invalid: ${t._ws.readyState}, can not send message`));e.waitResponse&&t._wsResponseWait.set(e.msg.requestId,{resolve:u,reject:c,skipOnMessage:e.skipOnMessage}),t._ws.send({data:JSON.stringify(e.msg),success:t=>{e.waitResponse||u(t)},fail:r=>{c(r),e.waitResponse&&t._wsResponseWait.delete(e.msg.requestId)}})}catch(e){c(e)}}));return function(e,t){return r.apply(this,arguments)}}()),this.onWatchStart=(e,t)=>{this._queryIdClientMap.set(t,e)},this.onWatchClose=(e,t)=>{t&&this._queryIdClientMap.delete(t),this._watchIdClientMap.delete(e.watchId),this._virtualWSClient.delete(e),this._closedWatches.add(e.watchId),this._virtualWSClient.size||this.close(ss.NoRealtimeListeners)},this.getEJSON=()=>this._EJSON,this._fsm=new ua({initialState:Jo.DISCONNECTED,states:zo}),this._serviceContext=e.serviceContext}get _context(){return this._serviceContext}get _maxReconnect(){return this._context.appConfig.realtimeMaxReconnect}get _reconnectInterval(){return this._context.appConfig.realtimeReconnectInterval}get _totalConnectionTimeout(){return this._context.appConfig.realtimeTotalConnectionTimeout}heartbeat(e){var t=this;this.clearHeartbeat(),this._pingTimeoutId=setTimeout(h()((function*(){try{if(!t._ws||t._ws.readyState!==cs)return;t._lastPingSendTS=Date.now(),yield t.ping(),t._pingFailed=0,t._pongTimeoutId=setTimeout((()=>{t._context.debug&&o.error("pong timed out"),t._pongMissed<2?(t._pongMissed++,t.heartbeat(!0)):t.close(ss.HeartbeatPongTimeoutError)}),t._context.appConfig.realtimePongWaitTimeout)}catch(e){t._pingFailed<2?(t._pingFailed++,t.heartbeat()):t.close(ss.HeartbeatPingError)}})),e?0:this._context.appConfig.realtimePingInterval)}clearHeartbeat(){this._pingTimeoutId&&clearTimeout(this._pingTimeoutId),this._pongTimeoutId&&clearTimeout(this._pongTimeoutId)}clearTotalReconnectTimeout(){this._totalConnectionTimeoutId&&clearTimeout(this._totalConnectionTimeoutId)}close(e){this.clearHeartbeat(),this._ws&&(this._ws.close({code:e,reason:as[e].name}),this._ws=void 0)}watch(e){var t={apiStartTime:Date.now()},r=!1,n=()=>{Yt({...t,apiName:e.reportAPIName})},i=e.onChange,o=e.onError;this._fsm.currentState===Jo.DISCONNECTED&&(this._connectionEnvId=e.envId,this.initWebSocketConnection(!1));var a=new is({...e,parentFSM:this._fsm,send:this.send,login:this.login,isWSConnected:this.isWSConnected,getWaitExpectedTimeoutLength:this.getWaitExpectedTimeoutLength,getEJSON:this.getEJSON,getServiceContext:()=>this._context,onWatchStart:this.onWatchStart,onWatchClose:this.onWatchClose,timing:t,debug:this._context.debug,wsclient:this,onChange:u,onError:c});this._virtualWSClient.add(a),this._watchIdClientMap.set(a.watchId,a);var s=a.listener;return s;function u(...e){r||(r=!0,t.apiEndTime=Date.now(),n()),l(),q.surroundThirdByTryCatch((()=>s.onChange.apply(this,e)))()}function c(...e){r||(r=!0,t.apiEndTime=Date.now(),n()),l(),q.surroundThirdByTryCatch((()=>s.onError.apply(this,e)))()}function l(){s.onChange===u&&(s.onChange=i),s.onError===c&&(s.onError=o)}}}function ds(){return(ds=h()((function*(){var e=Date.now(),t=r(683);return Yt({apiName:"_realtime.importBSON",apiStartTime:e,apiEndTime:Date.now()}),t.EJSON}))).apply(this,arguments)}var fs=function(e){return e.ASC="asc",e.DESC="desc",e}({}),hs=e=>{class t{constructor(t,n){if(this.collectionName=void 0,this._query=void 0,this._field=void 0,this.__safe_props__=void 0,this.watch=t=>(Y(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new ls({serviceContext:e.serviceContext})),e.serviceContext.ws.watch({...t,envId:e.database.config.env||e.serviceContext.env,collectionName:this.collectionName,query:JSON.stringify(e.engine.QuerySerializer.encode(this._query.where||{})),limit:this._query.limit,orderBy:this._query.order?this._query.order.reduce(((e,t)=>(e[t.fieldPath]=t.order,e)),{}):void 0,queryType:Bi.WHERE,reportAPIName:"cloud.db.collection.watch"})),!t)throw new C({errCode:S.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"collectionName must be provided"});this.collectionName=t,this._query=new r(n),Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field=n&&n.field||{}}field(e){return J(e,"object","field"),new t(this.collectionName,{...this._query.getProperties(),field:e})}where(e){return J(e,"condition","where"),this._query.where?new t(this.collectionName,{...this._query.getProperties(),where:ro.and(this._query.where,e)}):new t(this.collectionName,{...this._query.getProperties(),where:e})}orderBy(e,r){return J(e,"fieldPath","orderBy"),J(r,"order","orderBy"),new t(this.collectionName,{...this._query.getProperties(),order:[...this._query.order||[],{fieldPath:e,order:r}]})}limit(e){return J(e,"max","limit"),new t(this.collectionName,{...this._query.getProperties(),limit:e})}skip(e){return J(e,"offset","skip"),new t(this.collectionName,{...this._query.getProperties(),offset:e})}get(t){var r="collection.get",n={apiStartTime:+new Date},i=()=>ki({env:e.database.config.env,collectionName:this.collectionName,query:e.engine.QuerySerializer.encode(this._query.where||{}),queryType:Bi.WHERE,options:jo(this,e),instanceContext:e,timing:n,explain:null==t?void 0:t.explain});var o=$(t),a=new Promise(function(){var e=h()((function*(e,o){try{var a=yield i();if(null!=t&&t.explain&&Mt())return void e(a);e({data:a.list,errMsg:nr(r)})}catch(e){o(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}update(t){var r="collection.update",n={apiStartTime:+new Date},i=()=>{if(J(t,"options","update"),Y(t,{data:"object"}),!this._query.where)throw new C({errCode:-1,errMsg:"query condition must be provided"})},o=()=>Qi({env:e.database.config.env,collectionName:this.collectionName,query:e.engine.QuerySerializer.encode(this._query.where||{}),data:e.engine.UpdateSerializer.encode(t.data),queryType:Bi.WHERE,options:{multi:!1!==t.multi,merge:!0},instanceContext:e,timing:n,explain:t.explain});var a=$(t),s=new Promise(function(){var e=h()((function*(e,a){try{i();var s=yield o();if(null!=t&&t.explain&&Mt())return e(s);e({stats:{updated:s.updated},errMsg:nr(r)})}catch(e){a(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!a)return s;s.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}remove(t){var r="collection.remove",n={apiStartTime:+new Date},i=()=>{if(!this._query.where||0===Object.keys(this._query.where).length)throw new C({errCode:-1,errMsg:"query condition must be provided and not be empty"})},o=()=>xi({env:e.database.config.env,collectionName:this.collectionName,query:e.engine.QuerySerializer.encode(this._query.where||{}),queryType:Bi.WHERE,options:{multi:!0},instanceContext:e,timing:n,explain:null==t?void 0:t.explain});var a=$(t),s=new Promise(function(){var e=h()((function*(e,a){try{i();var s=yield o();if(null!=t&&t.explain&&Mt())return e(s);e({stats:{removed:s.removed||0},errMsg:nr(r)})}catch(e){a(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!a)return s;s.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}count(t){var r="collection.count",n={apiStartTime:+new Date},i=()=>Wi({env:e.database.config.env,collectionName:this.collectionName,query:e.engine.QuerySerializer.encode(this._query.where||{}),queryType:Bi.WHERE,instanceContext:e,timing:n,explain:null==t?void 0:t.explain});var o=$(t),a=new Promise(function(){var e=h()((function*(e,o){try{var a=yield i();if(null!=t&&t.explain&&Mt())return e(a);e({total:a.total,errMsg:nr(r)})}catch(e){o(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}toJSON(){}}class r{constructor(e){this.where=void 0,this.offset=void 0,this.limit=void 0,this.order=void 0,this.field=void 0,this.where=e&&e.where,this.offset=e&&e.offset,this.limit=e&&e.limit,this.order=e&&e.order,this.field=e&&e.field}getProperties(){return{where:this.where,offset:this.offset,limit:this.limit,order:this.order,field:this.field}}}return t},ps="document.get",gs="document.update",As="document.set",ms="document.remove",ys=e=>class{constructor(t,r){if(this._id=void 0,this.collection=void 0,this._field=void 0,this.__safe_props__=void 0,this.watch=t=>(Y(t,{onChange:"function",onError:"function"}),e.serviceContext.ws||(e.serviceContext.ws=new ls({serviceContext:e.serviceContext})),e.serviceContext.ws.watch({...t,envId:e.database.config.env||e.serviceContext.env,collectionName:this.collection.collectionName,query:JSON.stringify({_id:this._id}),queryType:Bi.DOC,reportAPIName:"cloud.db.document.watch"})),this.collection=t,this._id=r,null==r)throw new C({errCode:S.SDK_API_PARAMETER_TYPE_ERROR,errMsg:"docId must not be null or undefined"});Object.defineProperties(this,{_field:{enumerable:!1,configurable:!1,writable:!0}}),this._field={}}field(e){return J(e,"object","field"),Y(e,"object","field"),this._field=e,this}get(t){var r=this,n={apiStartTime:+new Date},i=()=>ki({env:e.database.config.env,collectionName:this.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:this._id}),options:{projection:e.engine.ProjectionSerializer.encode(this._field)},queryType:Bi.DOC,instanceContext:e,timing:n});var o=$(t),a=new Promise(function(){var e=h()((function*(e,t){try{var o=r._id,a=yield i();if(!a.list||!a.list.length)throw new Error(`cannot find document with _id ${o}, please make sure that the document exists and you have the corresponding access permission`);e({data:a.list[0],errMsg:nr(ps)})}catch(e){t(N(e,ps))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${ps}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(ps,t,e)})).catch((e=>{j(ps,t,e)}))}set(t){var r={apiStartTime:+new Date},n=()=>Hi({env:e.database.config.env,collectionName:this.collection.collectionName,_id:this._id,data:e.engine.encodeInternalDataType(t.data),options:{},instanceContext:e,timing:r});var i=$(t),o=new Promise(function(){var e=h()((function*(e,i){try{Y(t,{data:"object"}),z({name:"options.data",target:t.data});var o=yield n();e({_id:o._id,errMsg:nr(As),stats:{updated:o.updated,created:o.created}})}catch(e){i(N(e,As))}finally{Yt({...r,apiEndTime:+new Date,apiName:`cloud.db.${As}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!i)return o;o.then((e=>{W(As,t,e)})).catch((e=>{j(As,t,e)}))}update(t){var r={apiStartTime:+new Date},n=()=>Qi({env:e.database.config.env,collectionName:this.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:this._id}),data:e.engine.UpdateSerializer.encode(t.data),queryType:Bi.DOC,options:{multi:!1,merge:!1},instanceContext:e,timing:r});var i=$(t),o=new Promise(function(){var e=h()((function*(e,i){try{Y(t,{data:"object"}),z({name:"options.data",target:t.data}),e({stats:{updated:(yield n()).updated},errMsg:nr(gs)})}catch(e){i(N(e,gs))}finally{Yt({...r,apiEndTime:+new Date,apiName:`cloud.db.${gs}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!i)return o;o.then((e=>{W(gs,t,e)})).catch((e=>{j(gs,t,e)}))}remove(t){var r=this,n={apiStartTime:+new Date},i=()=>xi({env:e.database.config.env,collectionName:this.collection.collectionName,query:e.engine.QuerySerializer.encode({_id:this._id}),queryType:Bi.DOC,options:{},instanceContext:e,timing:n});var o=$(t),a=new Promise(function(){var e=h()((function*(e,t){try{var o=r._id,a=yield i();if(0===a.removed)throw new Error(`cannot remove document with _id ${o}, please make sure that the document exists and you have the corresponding Write permission`);e({stats:{removed:a.removed||0},errMsg:nr(ms)})}catch(e){t(N(e,ms))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${ms}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(ms,t,e)})).catch((e=>{j(ms,t,e)}))}toJSON(){}},vs=e=>{var t=hs(e),r=ys(e),n=Ki(e);return class extends t{constructor(e){super(e),this.collectionName=void 0,this.__safe_props__=void 0,this.collectionName=e}doc(e){if(null==e)throw N({errCode:-1,errMsg:"docId must not be empty"},"collection.doc");return new r(this,e)}add(t){var r="collection.add",n={apiStartTime:+new Date},i=()=>Pi({env:e.database.config.env,collectionName:this.collectionName,data:e.engine.encodeInternalDataType(t.data),instanceContext:e,timing:n});var o=$(t),a=new Promise(function(){var e=h()((function*(e,o){try{Y(t,{data:"object"}),e({_id:(yield i())._id,errMsg:nr(r)})}catch(e){o(N(e,r))}finally{Yt({...n,apiEndTime:+new Date,apiName:`cloud.db.${r}`})}}));return function(t,r){return e.apply(this,arguments)}}());if(!o)return a;a.then((e=>{W(r,t,e)})).catch((e=>{j(r,t,e)}))}aggregate(){return new n(this,[])}}},Es=function(e){return new _s(e)};class _s{constructor(e){this.regexp=void 0,this.options=void 0,Y(e,{regexp:"string"},"RegExp options"),e.options&&Y(e.options,"string"),this.regexp=e.regexp,this.options=e.options||""}get _internalType(){return di}toJSON(){return{$regex:this.regexp,$options:this.options}}}var Is={},Ts={};for(var ws in mi)Is[mi[ws]]=`$${mi[ws]}`;for(var Ss in fi)Is[fi[Ss]]=`$${fi[Ss]}`;for(var Cs in Ii)Is[Ii[Cs]]=`$${Ii[Cs]}`;for(var bs in Si)"toString"!==Si[bs]&&(Ts[Si[bs]]=`$${Si[bs]}`);function Ns(e){return Is[e]||`$${e.toLowerCase()}`}function Os(e){return Ts[e]||`$${e.toLowerCase()}`}Is[mi.NEQ]="$ne",Is[Ii.REMOVE]="$unset",Is[Ii.SHIFT]="$pop",Is[Ii.UNSHIFT]="$push",Is[mi.GEO_NEAR]="$nearSphere",Is[mi.GEO_WITHIN]="$geoWithin",Is[mi.GEO_INTERSECTS]="$geoIntersects";class Rs{static encodeStages(e){return(new Bs).encodeStages(e)}static encode(e){return(new Bs).encodeAny(e)}}class Bs{encodeStages(e){return e.map((e=>this.encodePipelineStage(e)))}encodeAny(e){return Ho(e)?Zi(e)?this.encodePipeline(e):eo(e)?this.encodePipelineStage(e):bi(e)?this.encodeAggregateCommand(e):Go(e):m(e)?this.encodeObject(e):_(e)?e.map((e=>this.encodeAny(e))):e}encodeObject(e){var t={};for(var r in e)t[r]=this.encodeAny(e[r]);return t}encodePipeline(e){return e._stages.map((e=>this.encodeAny(e)))}encodePipelineStage(e){var t=`$${e.stage}`;return"match"===e.stage?{[t]:Ds.encode(e.val)}:{[t]:this.encodeAny(e.val)}}encodeAggregateCommand(e){return{[Os(e.operator)]:this.encodeAny(e.operands[0])}}}class Ds{constructor(){}static encode(e){return Ls(e)}}var Ls=e=>Ai(e)?Ms(e):_i(e)?xs(e):Zi(e)||bi(e)||eo(e)?Rs.encode(e):m(e)?Ps(e):Go(e),Ps=e=>{var t=qo(e),r=[],n={[fi.OR]:0,[fi.NOR]:0,[fi.AND]:0,[fi.NOT]:0},i=function(e){var i=t[e];if(Ai(i))switch(i.operator){case fi.OR:case fi.NOR:case fi.AND:n[i.operator]++,r.push({[Ns(i.operator)]:i.operands.map((t=>Ls({[e]:t})))});break;case fi.NOT:var o=i.operands[0];if(Ai(o))switch(o.operator){case fi.AND:n[fi.OR]++,r.push(Ms(new gi(fi.OR,o.operands.map((t=>({[e]:new gi(fi.NOT,[t])}))))));break;case fi.OR:n[fi.NOR]++,r.push(Ms(new gi(fi.NOR,o.operands.map((t=>({[e]:t}))))));break;case fi.NOR:n[fi.OR]++,r.push(Ms(new gi(fi.OR,o.operands.map((t=>({[e]:t}))))));break;case fi.NOT:r.push(Ls({[e]:o.operands[0]}))}else r.push({[e]:Ms(i)})}else _i(i)?r.push({[e]:xs(i)}):r.push({[e]:Go(i)})};for(var o in t)i(o);return Us(r)},Ms=e=>{switch(e.operator){case fi.AND:if(e.operands.every((e=>_i(e)))){var t={};for(var r of e.operands)Object.assign(t,xs(r));return t}return{[Ns(e.operator)]:e.operands.map(Ls)};case fi.OR:case fi.NOR:return{[Ns(e.operator)]:e.operands.map(Ls)};case fi.NOT:var n=Ns(e.operator),i=e.operands[0];return{[n]:Ls(i)};default:return{[Ns(e.operator)]:e.operands.map(Ls)}}},xs=e=>{var t=Ns(e.operator);switch(e.operator){case mi.EQ:case mi.NEQ:case mi.LT:case mi.LTE:case mi.GT:case mi.GTE:case mi.EXISTS:case mi.SIZE:return{[t]:Go(e.operands[0])};case mi.IN:case mi.NIN:case mi.MOD:return{[t]:Go(e.operands)};case mi.ALL:return{[t]:e.operands.map(Ls)};case mi.ELEM_MATCH:case mi.EXPR:return{[t]:Ls(e.operands[0])};case mi.GEO_NEAR:return{[t]:{$geometry:Go(e.operands[0].geometry),$maxDistance:e.operands[0].maxDistance,$minDistance:e.operands[0].minDistance}};case mi.GEO_WITHIN:var r={};return e.operands[0].geometry&&(r.$geometry=Go(e.operands[0].geometry)),e.operands[0].centerSphere&&(r.$centerSphere=Go(e.operands[0].centerSphere)),{[t]:r};case mi.GEO_INTERSECTS:return{[t]:{$geometry:Go(e.operands[0].geometry)}};default:return{[t]:e.operands.length>1?e.operands.map(Ls):Ls(e.operands[0])}}},Us=e=>{var t={$and:0,$or:0,$nor:0};for(var r of e)r.$and&&t.$and++,r.$or&&t.$or++,r.$nor&&t.$nor++;var n=t.$and>1||t.$or>1||t.$nor>1,i=!1,o={};for(var a of e)for(var s in a){var u=a[s];n?i?o.$and.push(a):"$and"===s||"$or"===s||"$nor"===s?(i=!0,o.$and=[a]):o[s]=u:o[s]=u}return o};class ks{constructor(){}static encode(e){return qs(e)}}var qs=e=>Qs(e),Qs=e=>{var t=qo(e),r={};for(var n in t){var i=t[n];if(wi(i)){var o=Ns(i.operator);switch(r[o]||(r[o]={}),i.operator){case Ii.SET:case Ii.INC:case Ii.MUL:case Ii.MIN:case Ii.MAX:case Ii.RENAME:case Ii.BIT:r[o][n]=Go(i.operands[0]);break;case Ii.REMOVE:r[o][n]="";break;case Ii.PUSH:var a=void 0;a=1===i.operands.length&&m(i.operands[0])?{$each:i.operands[0].each.map(Go),$position:i.operands[0].position,$slice:i.operands[0].slice,$sort:i.operands[0].sort}:{$each:i.operands.map(Go)},r[o][n]=a;break;case Ii.UNSHIFT:var s={$each:i.operands.map(Go),$position:0};r[o][n]=s;break;case Ii.POP:r[o][n]=1;break;case Ii.SHIFT:r[o][n]=-1;break;case Ii.ADD_TO_SET:r[o][n]=m(i.operands[0])&&i.operands[0].each?{$each:i.operands[0].each}:i.operands[0];break;case Ii.PULL:r[o][n]=Ds.encode(i.operands[0]);break;case Ii.PULL_ALL:default:r[o][n]=Go(i.operands[0])}}else r.$set||(r.$set={}),r.$set[n]=Go(i)}return r};class Fs{constructor(){}static encode(e){return(new Fs).encodeProjection(e)}encodeProjection(e){return Ri(e)?this.encodeProjectionCommand(e):"object"===A(e)?this.encodeProjectionObject(e):e}encodeProjectionCommand(e){var t=Ns(e.operator);return e.operator,Ni.SLICE,{[t]:e.operands[0]}}encodeProjectionObject(e){var t=qo(e);for(var r in t)!0===t[r]||1===t[r]?t[r]=1:!1===t[r]||0===t[r]?t[r]=0:Ri(t[r])?t[r]=this.encodeProjectionCommand(t[r]):delete t[r];return t}}class Hs{constructor(){}static decode(e){return(new Hs).decodeData(e)}decodeData(e){switch(A(e)){case"object":return this.decodeObject(e);case"array":return e.map((e=>{if(m(e)){var t=Wo(e);return t!==e?t:this.decodeObject(e)}return e}));default:return e}}decodeObject(e){var t={...e};for(var r in t){var n=t[r];switch(A(n)){case"object":var i=Wo(n);t[r]=i!==n?i:this.decodeObject(t[r]);break;case"array":var o=this.decodeData(n);o!==n&&(t[r]=o);break;default:continue}}return t}}const Gs=function(e,t){return new(js(e.identifiers||{}))({context:e,config:t})};function Ws(e){return e.debug}var js=e=>{var r,n;return class{constructor(i){this.identifiers=void 0,this.config=void 0,this.command=void 0,this.Geo=void 0,this.serverDate=void 0,this.RegExp=void 0,this.__safe_props__=void 0;var{config:o,context:a}=i;this.identifiers=e,this.config=o||{},n=vs(r={database:this,serviceContext:a,engine:l}),o&&o.env&&Y(o.env,"string"),this.command=ro,this.Geo=t,this.serverDate=no,this.RegExp=Es,o&&o.hasOwnProperty("debug")&&Object.defineProperties(this,{debug:{value:!0},QuerySerializer:{enumerable:!1,configurable:!1,get(){return Ws((e=r).database)?e.engine.QuerySerializer:void 0;var e},set(){}},UpdateSerializer:{enumerable:!1,configurable:!1,get(){return Ws((e=r).database)?e.engine.UpdateSerializer:void 0;var e},set(){}},ProjectionSerializer:{enumerable:!1,configurable:!1,get(){return Ws((e=r).database)?e.engine.ProjectionSerializer:void 0;var e},set(){}},AggregateSerializer:{enumerable:!1,configurable:!1,get(){return Ws((e=r).database)?e.engine.AggregateSerializer:void 0;var e},set(){}},Decoder:{enumerable:!1,configurable:!1,get(){return Ws((e=r).database)?e.engine.Decoder:void 0;var e},set(){}}})}collection(e){return new n(e)}toJSON(){}}};function $s(e){return{database:Gs.bind(null,e)}}var Ys="database";function Js(e){e.registerService(function(e){var t={name:Ys,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get env(){return e.getEnvForService(Ys)},appConfig:{get docSizeLimit(){return e.appConfig.db_doc_size_limit},get realtimePingInterval(){return e.appConfig.db_realtime_ping_interval},get realtimePongWaitTimeout(){return e.appConfig.db_realtime_pong_wait_timeout},get realtimeMaxReconnect(){return e.config.database.realtime.maxReconnect},get realtimeReconnectInterval(){return e.config.database.realtime.reconnectInterval},get realtimeTotalConnectionTimeout(){return e.config.database.realtime.totalConnectionTimeout},get realtimeQueryEventCacheTimeout(){return e.appConfig.db_realtime_query_event_cache_timeout}}};return{name:Ys,context:t,getAPIs:$s.bind(null,t)}}(e))}function Ks(e){class t{constructor(e){this.cloudID=void 0,this._internalType=cr,this.cloudID=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}toJSON(){return this.cloudID}toString(){return this.cloudID}}return function(e){return new t(e)}}function zs(e){class t{constructor(e){this.target=void 0,this._internalType=lr,this.target=e,Object.defineProperties(this,{_internalType:{enumerable:!1,configurable:!1}})}toString(){return JSON.stringify({target:this.target})}}return function(e){return new t(e)}}function Xs(e){return{CloudID:Ks(),CDN:zs()}}var Vs="utils";function Zs(e){e.registerService(function(e){var t={name:Vs,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug}};return{name:Vs,context:t,getAPIs:Xs.bind(null,t)}}(e))}class eu{constructor(){}}var tu="gateway.call";class ru extends Error{constructor(e,t){super(e),this.code=void 0,this.code=t}}function nu(e){return t=>{var r=new iu(t),n=t.domain?t.domain:`${t.id||t.appid}.preview.wxcloudrun.com`,i={name:"gateway-plugin",host:n,getMetadata:e=>({...e,host:n}),beforeRequest:e=>e,afterRequest:e=>e,beforeTunnelRequest:e=>e,afterTunnelRequest:e=>e,context:e,refreshTunnelInfo:"miniprogram"===xn().env?h()((function*(){var t=Ae();return(yield e.request({apiName:"tcbapi_get_service_info",serializedReqData:JSON.stringify({system:t.system,wx_app_version:t.version,scene:3})})).data})):void 0};return cu.set(r,i),r.tokenManager.invalidate(),r.exportAPI}}class iu extends eu{constructor(e){super(),this.options=e,this.session=void 0,this.tokenManager=new mt(this.refreshToken.bind(this),(e=>Math.max(3e4,e)),(e=>Kt(e,"3"))),this.exportAPI=void 0,this.exportAPI={refresh:this.tokenManager.updateSession.bind(this.tokenManager),call:this.call.bind(this)}}refreshToken(e){this.session=e;var t=cu.get(this);return new Promise(((r,n)=>{t.refreshTunnelInfo?t.refreshTunnelInfo().then((e=>r(e))).catch((e=>n(e))):re()._requestSkipCheckDomain({url:`https://${t.host}/__wx__/auth?devtools_ignore=true`,method:"post",header:{"x-wx-accept-encryption":3,"x-wx-encryption-timestamp":Date.now(),"x-wx-lib-build-ts":1678888746406},data:JSON.stringify({session:e,fingerprint:"",timestamp:Date.now(),nonce:Math.random()}),success:({data:e})=>r(e),fail:e=>{n(e)}})}))}call(e){var t=this;return h()((function*(){var r,n,i=Date.now();e.stats={apiStartTime:i},e.context={apiStartTime:i};var o=yield t.tokenManager.getToken();e.stats.getServiceEndpoint=Date.now()-i;var s=new Uint8Array(null===(r=(n=a.wx).base64ToArrayBuffer)||void 0===r?void 0:r.call(n,o.key));tn(e);var u=cu.get(t),c=u.host;e.stats.domain=c;var l=Le.V3.encodeRequest(s,{...e.header,"X-WX-TARGET-SERVICE":"HTTP","X-WX-HTTP-HOST":c,"X-WX-HTTP-PATH":e.path},e.method||"GET",e.data,e.stats);e.stats.requestStartTs=Date.now(),e.stats.callid=l.callId;var d=new Promise(((r,n)=>{try{re()._requestSkipCheckDomain({url:`https://${c}/__wx__/call?token=${o.token}&devtools_ignore=true`,method:"POST",header:{"X-WX-EV":3,"Content-Type":"application/octet-stream"},data:l.data.buffer,dataType:"arraybuffer",responseType:"arraybuffer",enableHttp2:!0,enableQuic:!0,timeout:e.timeout,success:i=>{if(e.stats||(e.stats={}),e.stats.requestSuccessTs=Date.now(),e.stats.profile=i.profile,e.stats.httpRequest=Date.now()-e.stats.requestStartTs,i.statusCode&&200!==i.statusCode){var a=ou(i.data);n(new ru(`${tu}: fail invalid status code ${a}, status code: ${i.statusCode}, callid: ${e.stats.callid}`,i.statusCode))}else{try{au(e,i.header,i.data)}catch(e){return void n(e)}var{header:u,body:c,statusCode:d}=Le.V3.decodeResponse(s,new Uint8Array(i.data),e.stats);try{au(e,u,c)}catch(i){return 85104!==i.code||e.isRetry?void n(i):void o.invalidate().then((()=>{t.call({...e,isRetry:!0}).then(r).catch(n)})).catch(n)}var f=function(e,t,r){var n;return n="json"!==e.dataType&&e.dataType||rn(r)?"text"===e.responseType?"string"==typeof t?t:Ce(t.buffer):"arraybuffer"===e.responseType?"string"==typeof t?be(t):t.buffer:t:_e("string"==typeof t?t:Ce(t.buffer)),n}(e,c,d);rr(tu,e,"v3"),r({data:f,statusCode:d,header:u,callID:l.callId,errMsg:`${tu}:ok`})}},fail:n})}catch(e){n(e)}}));return d=function(e,t,r,n,i){var o;return null===(o=e.followRedirect)||void 0===o||o?function e(o,a){return new Promise(((s,u)=>{a.then((a=>{var c;if(rn(a.statusCode)){var l=null!==(c=on.get(t))&&void 0!==c?c:0;if(l>=5)u("reach the max redirect count");else{on.set(t,l+1);var d="";for(var f in a.header)"location"===f.toLowerCase()&&(d=a.header[f]);if(d)if(d.startsWith("/")){var h=X(o);o.path=d,e(h,r(o)).then(s).catch(u)}else re(n.identifiers).request({url:d,method:o.method,header:o.header,data:o.data,dataType:o.dataType,responseType:o.responseType,timeout:o.timeout,success:e=>{s({...e,errMsg:`${i}:ok`})},fail:e=>{u(e.errMsg.replace(/^request/,i))}});else s(a)}}else s(a)})).catch(u)}))}(e,t):t}(e,d,t.call.bind(t),u.context,tu),Er(d,(()=>({url:`gateway.call${e.path}`,method:e.method,headers:e.header,reqBody:ir(e.data),timestampMs:i}))),yield d}))()}}function ou(e){if(e instanceof ArrayBuffer)try{return Ce(e)}catch(e){}return e}function au(e,t,r){if(t["x-wx-system-error"]){var n=+t["x-wx-system-error"];throw r=ou(r),new ru(`${tu}: fail wx system error ${r}, code: ${n}, callid: ${e.stats.callid}`,n)}if(t["x-wx-server-timing"]){var i=(t["x-wx-server-timing"]||"").split(",");i.length>=2&&(e.stats.serverStartTs=Number(i[0]),e.stats.serverEndTs=Number(i[1]))}if(t["x-envoy-upstream-service-time"]){var o=+t["x-envoy-upstream-service-time"];isNaN(o)||(e.stats.upstreamCost=o)}if(t["x-wx-mesh-upstream-service-time"]){var a=t["x-wx-mesh-upstream-service-time"].split(",");a.length>=2&&(e.stats.meshStartTs=Number(a[0]),e.stats.meshEndTs=Number(a[1]))}}function su(e){return{Gateway:{initRequired:!1,fn:nu(e)}}}var uu="services",cu=new WeakMap;function lu(e){e.registerService(function(e){var t={name:uu,identifiers:e.identifiers,request:e.request,isInstance:e.isInstance,get debug(){return e.debug},get appid(){return e.instanceOptions.appid},appConfig:{}};return{name:uu,context:t,getAPIs:su.bind(null,t)}}(e),"services")}function du(e,t){e.fail&&e.fail(t),e.complete&&e.complete(t),e.fail=void 0,e.complete=void 0}var fu=function(){var e=h()((function*(e){try{if(!e.appid)throw new Error("missing appid");var t={appid:e.appid,data:e.reqData},r=(yield new Promise(((r,n)=>re().wx.request({url:`${e.url||"https://servicewechat.com/wxa-qbase/jsoperatewxdata"}`,method:"POST",data:t,success:r,fail:n})))).data;0===r.base_resp.ret?function(e,t){e.success&&e.success(t),e.complete&&e.complete(t),e.success=void 0,e.complete=void 0}(e,{data:JSON.parse(r.data),rawData:r.data}):du(e,{errMsg:`operateWXData:fail base_resp.ret ${r.base_resp.ret}`})}catch(t){du(e,t)}}));return function(t){return e.apply(this,arguments)}}(),hu={_operateWXData:fu,invokeOperateWXData:fu};function pu(){(e=>{ee.push((t=>Object.assign({},t,e)))})(hu)}function gu(e){return{}}var Au="app";var mu={REALTIME_DB_MAX_RECONNECT:5,REALTIME_DB_WS_RECONNECT_INTERVAL:5e3,REALTIME_DB_TOTAL_CONNECTION_TIMEOUT:1/0};const yu={db_doc_size_limit:524288,db_realtime_ping_interval:15e3,db_realtime_pong_wait_timeout:15e3,db_realtime_query_event_cache_timeout:18e4,upload_max_file_size:20971520,get_temp_file_url_max_requests:50,call_function_poll_max_retry:10,call_function_max_req_data_size:5242880,call_function_client_poll_timeout:15e3,call_function_valid_start_retry_gap:6e4,call_container_poll_max_retry:10,call_container_client_poll_timeout:15e3,call_container_valid_start_retry_gap:6e4,call_container_max_req_data_size:5242880,call_container_use_private_http:0};var vu=function(e){return e[e.AutoRecording=1]="AutoRecording",e[e.SdkRecording=2]="SdkRecording",e}(vu||{});function Eu(){var e,t,r,n,i,o,a,s,u;return(null==Pt||null===(e=Pt.appContactInfo)||void 0===e||null===(t=e.stablePassThroughInfo)||void 0===t||null===(r=t.wxob_meta_data)||void 0===r?void 0:r.wxob_mode)===vu.SdkRecording||(null==Pt||null===(n=Pt.appContactInfo)||void 0===n||null===(i=n.wxob_meta_data)||void 0===i?void 0:i.wxob_mode)===vu.SdkRecording||void 0!==(null===(o=Pt.appContactInfo)||void 0===o||null===(a=o.passThroughInfo)||void 0===a||null===(s=a.wxa_mgr)||void 0===s||null===(u=s.mgr_list)||void 0===u?void 0:u.find((e=>929===e.id&&1===e.value)))}function _u(){var e,t,r;if(null!=Pt&&null!==(e=Pt.appContactInfo)&&void 0!==e&&null!==(t=e.stablePassThroughInfo)&&void 0!==t&&t.wxob_meta_data){var n,i,o=null==Pt||null===(n=Pt.appContactInfo)||void 0===n||null===(i=n.stablePassThroughInfo)||void 0===i?void 0:i.wxob_meta_data;return{isWhitelistMaskMode:o.is_whitelist_mask_mode,proportion:o.proportion,encrypt:o.encrypt,cloudServiceProvider:o.cloud_service_provider,minVersion:o.min_available_sdk_version,versionBlackList:o.sdk_version_black_list}}if(void 0!==(null==Pt||null===(r=Pt.appContactInfo)||void 0===r?void 0:r.wxob_meta_data)){var a,s=null==Pt||null===(a=Pt.appContactInfo)||void 0===a?void 0:a.wxob_meta_data;return{isWhitelistMaskMode:s.is_whitelist_mask_mode,proportion:s.proportion,encrypt:s.encrypt,cloudServiceProvider:s.cloud_service_provider,minVersion:s.min_available_sdk_version,versionBlackList:s.sdk_version_black_list}}}function Iu(){return"xxxxx-xxxx-xxxx-xxxx-xxxxx".replace(/[xy]/g,(e=>{var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function Tu(){var e=Pt.system;if(!e||"ios"!==Pt.platform)return!0;var[t,r]=e.split(" ");return"ios"!==t.toLowerCase()||function(e,t){for(var r=e.split(".").map(Number),n=t.split(".").map(Number),i=0;i<r.length;++i){if(n.length===i)return 1;if(r[i]!==n[i])return r[i]>n[i]?1:-1}return r.length!==n.length?-1:0}(r,"14.5")>=0}function wu(){return(wu=h()((function*(){var e,t,r,n,i,o,a={record:{uuid:Iu(),event:JSON.stringify([{type:102}]),path:"",projectKey:null!==(e=null===(t=Pt.accountInfo)||void 0===t?void 0:t.appId)&&void 0!==e?e:"undefined_app_id",sdkVersion:null!==(r=Pt.sdkVersion)&&void 0!==r?r:"",timestamp:Date.now(),webviewId:0}};yield De("https://servicewechat.com/ob/wxob",{method:"POST",headers:{"Content-Type":"application/json","x-wx-ob-env":"appservice","x-wx-ob-sdkversion":null!==(n=Pt.sdkVersion)&&void 0!==n?n:"","x-wx-ob-pack-version":"0","x-wx-ob-project-key":null!==(i=null===(o=Pt.accountInfo)||void 0===o?void 0:o.appId)&&void 0!==i?i:"undefined_app_id"},body:JSON.stringify(a)})}))).apply(this,arguments)}function Su(e){return Cu.apply(this,arguments)}function Cu(){return(Cu=h()((function*(e){try{var t,r=yield Dr({apiName:"webapi_getcloudstoragefederationtoken",reqData:{project_key:null===(t=Pt.accountInfo)||void 0===t?void 0:t.appId,object_prefix:`${e}*`}});if(void 0===r.data)throw new Error("no cos info");if(!bu(r.data))throw new Error("invalid cos info");if(r.data.expire_timestamp){var n=1e3*r.data.expire_timestamp-Date.now()-3e5;setTimeout(h()((function*(){null==ae||ae.log("[wxobs as] reset cosInfo");var t=yield Su(e);re().resetCosInfo({...t,prefix:e})})),n>0?n:1e3)}return r.data}catch(e){throw new Error(`获取 COS 临时秘钥失败: ${e.message}`)}}))).apply(this,arguments)}function bu(e){return!(Ou(e.bucket)||Ou(e.region)||Ou(e.secretid)||Ou(e.secretkey)||Ou(e.token))&&(!Nu(e.bucket)&&!Nu(e.region))}function Nu(e){return e.includes(".")||e.includes("?")||e.includes("/")||e.includes("#")}function Ou(e){return!e||""===e.trim()}var Ru=null,Bu={autoStart:!0,isWhitelistMaskMode:!0,shouldCapturePage:()=>!0};class Du{constructor(e){var t,r,n,i;if(this.attrs={},this.encrypt=void 0,this.cloudServiceProvider=void 0,this.param=void 0,this.prefix=void 0,this.setupState=void 0,this.getUuid=()=>{var e;return null!==(e=this.param.uuid)&&void 0!==e?e:null},this.setAttrs=e=>{if(e){for(var t of Object.keys(e)){var r=e[t];"string"==typeof t&&"string"==typeof r?this.attrs[t]=r:o.warn("[wxobs appservice]the type of attributes must be string")}this.uploadAttrs()}},this.uploadAttrs=()=>{Object.keys(this.attrs).length>0&&re().emitCustomAttrEvent({...this.attrs})},this.param=e,this.cloudServiceProvider=e.cloudServiceProvider,this.encrypt=e.encrypt,null!==(t=_u())&&void 0!==t&&t.versionBlackList&&Pt.sdkVersion&&_u().versionBlackList.indexOf(Pt.sdkVersion)>=0)throw new Error("[wxobs as] this sdk version is blocked");if(!Tu())throw function(){wu.apply(this,arguments)}(),new Error("[wxobs as] this system version is not supported");this.prefix=`${(r=new Date).getFullYear().toString()}${(r.getMonth()+1).toString().padStart(2,"0")}${r.getDate().toString().padStart(2,"0")}${r.getHours().toString().padStart(2,"0")}${r.getMinutes().toString().padStart(2,"0")}`,this.param.uuid=`${this.prefix}/${Iu()}`,this.setupState=new Promise(((e,t)=>{n=e,i=t})),this.setup().then((()=>n())).catch((e=>i(e)))}setup(){var e=this;return h()((function*(){var t,r,n,i=yield Su(e.prefix),a={...Bu,...e.param};re().setupUserBehaviorAnalytics({projectId:null!==(t=null===(r=Pt.accountInfo)||void 0===r?void 0:r.appId)&&void 0!==t?t:"undefined_app_id",encrypt:e.encrypt,cloudServiceProvider:e.cloudServiceProvider,cosInfo:{...i,prefix:e.prefix},...a,dataAttrs:null===(n=e.param.captureDataAttrs)||void 0===n||n}),o.log("[wxobs appservice] obs is setup"),e.setAttrs(e.param.attrs)}))()}}function Lu(){return(Lu=h()((function*(e){var t={};if(!Eu())return t.errMsg="sdk recording mode is not supported",t;if(Ru)return t.errMsg="recording is already setup",t;try{var r,n=_u();return o.log("[wxobs as] sdk record"),Ru=new Du({...e,encrypt:null==n?void 0:n.encrypt,cloudServiceProvider:null==n?void 0:n.cloudServiceProvider}),yield Ru.setupState,t.sessionId=null!==(r=Ru.getUuid())&&void 0!==r?r:void 0,t}catch(e){return t.errMsg=`setup failed: ${e.message}`,t}}))).apply(this,arguments)}try{var Pu;null===(Pu=__subContextEngine__)||void 0===Pu||Pu.onInitReady((()=>{try{Pt.onReady((()=>{if((null==Pt||null===(e=Pt.appContactInfo)||void 0===e||null===(t=e.wxob_meta_data)||void 0===t?void 0:t.wxob_mode)===vu.AutoRecording||(null==Pt||null===(r=Pt.appContactInfo)||void 0===r||null===(n=r.stablePassThroughInfo)||void 0===n||null===(i=n.wxob_meta_data)||void 0===i?void 0:i.wxob_mode)===vu.AutoRecording){var e,t,r,n,i,a=_u();if(o.log("[wxobs appservice]auto recording mode",a),void 0!==a)if(Ru)o.warn("[wxobs appservice]already setup");else try{var{proportion:s,isWhitelistMaskMode:u,encrypt:c,cloudServiceProvider:l}=a;s>=100*Math.random()&&(o.log("[wxobs as] auto record"),Ru=new Du({isWhitelistMaskMode:u,encrypt:c,cloudServiceProvider:l}))}catch(e){o.error("[wxobs appservice]setup failed: ",e)}else o.warn("[wxobs appservice]can not access recording param")}}))}catch(e){null==ae||ae.warn(e)}}))}catch(e){}const Mu={setup:function(e){if(Eu())if(Ru)o.warn("[wxobs appservice] already setup");else try{var t=_u();return o.log("[wxobs as] sdk record"),(Ru=new Du({...e,encrypt:null==t?void 0:t.encrypt,cloudServiceProvider:null==t?void 0:t.cloudServiceProvider})).getUuid()}catch(e){return o.error("[wxobs appservice] setup failed: ",e),null}else o.warn("[wxobs appservice]sdk recording mode is not supported")},asyncSetup:function(e){return Lu.apply(this,arguments)},setAttrs:function(e){Ru?Ru.setAttrs(e):o.warn("[wxobs appservice] not setup")}};var xu=(e={})=>{var{sdk:t}=e,r=e.identifiers||{};return t&&((e,t)=>{Z.set(e,t)})(r,t),new ku(r,!1)},Uu=(e={})=>xu(e).exportAPI;class ku{constructor(e,t){var r=this;this.inited=!1,this.isInstance=void 0,this.services={},this.apiServiceMap={},this.plugins=[],this.meta=void 0,this.config=void 0,this.identifiers=void 0,this.debug=!1,this.request=void 0,this.exportAPI=void 0,this.appConfig=void 0,this.apiPermissions=void 0,this.runtimeInfo=void 0,this.serviceEndpoint=void 0,this.authStorage=void 0,this.testSpeed=h()((function*(){var e,t,n=+new Date,i=n;return Ue((t=(e={cloud:r,apiName:"tcbapi_testspeed",serializedReqData:null}).cloud,{apiName:"qbase_commapi",data:{qbase_api_name:e.apiName,qbase_req:e.serializedReqData,qbase_options:{env:e.env},qbase_meta:t.getMetaData(),cli_req_id:`${+new Date}_${Math.random()}`},cloud:t}),{fireOnIdle:!0,onFire:()=>{n=+new Date,i=n}}).then((e=>{Yt({apiName:"cloud.testspeed",apiEndTime:+new Date,apiStartTime:n,tunnelEndTime:+new Date,tunnelStartTime:i,tunnelTimeNoCSNetCost:e.data.baseresponse.stat.qbase_cost_time})})).catch((e=>{0}))})),this.identifiers=e,this.isInstance=t,this.runtimeInfo=xn(),this.serviceEndpoint=new wt(e),this.request=ke({cloud:this});var n,i=this;this.exportAPI={init:this.init.bind(this),obs:Mu},this.isInstance||(this.exportAPI.Cloud=function(t){return new qu(e,i,t).exportAPI}),Nr(n=this),Jn(n),Js(n),Zs(n),Ln(n),lu(n),this.meta={session_id:Date.now()+""},this.serviceEndpoint.setMetaData(this.getMetaData()),this.serviceEndpoint.setTunnelRequest(this.request),this.config={database:Qu()},this.appConfig={...yu},this.apiPermissions={};try{Pt.onReady((()=>{setTimeout((()=>{(()=>{if(!xt)try{var e=re();e.wx.onAppShow&&e.wx.onAppShow((()=>{qt=Date.now()})),e.wx.getNetworkType({success:e=>{Qt=e.networkType},complete:()=>{xt=!0,$t()}}),e.wx.onNetworkStatusChange((e=>{xt||(xt=!0,$t()),Qt=e.networkType}))}catch(e){}})()}),2e3),en()}))}catch(e){}}getMetaData(){if(!this.meta.sdk_version){var e=re(this.identifiers);if(e){var t=e.wx;t&&t.version&&("miniprogram"===this.runtimeInfo.env?this.meta.sdk_version=`wx-miniprogram-sdk/${t.version.version} (${Date.parse(`${t.version.updateTime} GMT+0800`)} platform/${this.runtimeInfo.platform}})`:this.meta.sdk_version=`wx-web-sdk/undefined (${Date.parse("undefined GMT+0800")})`)}Pt.onReady((()=>{var e;this.meta.filter_user_info="singlePage"===(null===(e=Pt.appLaunchInfo)||void 0===e?void 0:e.mode)}))}return this.meta}getConfig(){return this.config}getEnvForService(e){if(this.isInstance)return this.instanceOptions.resourceEnv;var t=this.config;if(t.env)switch(A(t.env)){case"string":return t.env;case"object":return t.env[e];default:return}}checkAPIPermission(e){return!this.apiPermissions.hasOwnProperty(e)||1===this.apiPermissions[e]}init(e={}){this.inited=!0,this.initConfig(e);try{Ee(500,this.identifiers)}catch(e){null==ae||ae.log("privateGetBackgroundFetchData error",e)}return Promise.all([this.sendInitRequest().then((()=>{Math.random()<.1&&this.testSpeed()}))]).then((()=>{}))}initConfig(e){this.config=JSON.parse(JSON.stringify(e)),this.plugins=(e.plugins||[]).map((e=>cu.get(e))).filter((e=>!!e)),this.config.database?this.config.database=g(this.config.database,Qu()):this.config.database=Qu(),"sdk"===this.runtimeInfo.platform&&pu()}sendInitRequest(){var e="string"==typeof this.config.env?this.config.env:void 0,t=JSON.stringify({trace_user:!1!==this.config.traceUser,env:e,region:this.config.region}),r=+new Date,n=r;return this.request({...this.config,apiName:"tcbapi_init",serializedReqData:t,env:e}).then((e=>{var t=+new Date,i=e.data;this.appConfig={...this.appConfig,...i.config};for(var o=i.tcb_api_list||[],a=0,s=o.length;a<s;a++)this.apiPermissions[o[a].apiname]=o[a].status;Yt({apiName:"cloud.init",apiEndTime:+new Date,apiStartTime:r,tunnelEndTime:t,tunnelStartTime:n,tunnelTimeNoCSNetCost:i.baseresponse.stat.qbase_cost_time})})).catch((e=>{o.error("cloud init error: ",e)}))}registerService(e,t){this.services[e.name]=e;var r=e.getAPIs();for(var n in r)if(this.apiServiceMap[n]=e.name,"function"==typeof r[n])this.registerFunction(n,!0,r[n],t);else{var{initRequired:i,fn:o}=r[n];this.registerFunction(n,i,o,t)}}registerFunction(e,t,r,n){var i=this,o=this.exportAPI;n&&(this.exportAPI[n]={},o=this.exportAPI[n]),o[e]=t?function(){if(!i.inited)throw new C({errMsg:"Cloud API isn't enabled, please call wx.cloud.init first\n请先调用 wx.cloud.init() 完成初始化后再调用其他云 API。"});if(!i.checkAPIPermission(e))throw new C({errCode:S.SDK_API_PERMISSION_DENIED,errMsg:S[S.SDK_API_PERMISSION_DENIED]});return r.apply(i,arguments)}:r}toJSON(){}}class qu extends ku{constructor(e,t,r){if(super(e,!0),this.defaultInstance=void 0,this.instanceOptions=void 0,this.webRequest=void 0,this._webCurrentRefreshTokenPromise=void 0,"web"===this.runtimeInfo.env){if(!r.identityless&&!r.appid)throw new Error("appid must be provided");if(!r.resourceAppid)throw new Error("resourceAppid must be provided")}if(!r.resourceEnv)throw new Error("resourceEnv must be provided");if(r.config||(r.config={}),this.defaultInstance=t,this.instanceOptions=JSON.parse(JSON.stringify(r)),this.meta=t.meta,this.apiPermissions=t.apiPermissions,this.instanceOptions.config.database=g(Qu(),this.instanceOptions.config.database||{}),"web"===this.runtimeInfo.env){if(this.exportAPI.init=this.webInit.bind(this),this.webRequest=(0,Pn.getBoundAuthRequest)(this),this.registerService((0,Pn.createWebService)(this)),!this.instanceOptions.identityless&&(this.authStorage=this.defaultInstance.authStorage,!this.authStorage))throw new Error("authStorage not found")}else"sdk"===this.runtimeInfo.env?(this.exportAPI.init=this.webInit.bind(this),this.registerService((i={name:Au,identifiers:(n=this).identifiers,request:n.request,isInstance:n.isInstance,get debug(){return n.debug},get env(){return n.getEnvForService(Au)},cloud:n,appConfig:{}},{name:Au,context:i,getAPIs:gu.bind(null,i)})),this.instanceOptions.identityless=!0):this.exportAPI.init=this.miniprogramInit.bind(this);var n,i;this.instanceOptions.resourceAppid&&(this.exportAPI.refreshAuth=this.refreshAuth.bind(this))}miniprogramInit(){var e=()=>super.init,t=this;return h()((function*(){if(!t.inited){if(t.instanceOptions.resourceAppid){var r=(yield t.refreshAuth()).data.env_auth_info;return 0===r.errCode?(e().call(t),{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}):{errCode:r.errCode,errMsg:r.errMsg}}e().call(t)}}))()}webInit(){var e=()=>super.init,t=this;return h()((function*(){if(!t.inited){if(!t.instanceOptions.identityless){var r=(yield t.refreshAuth()).data.env_auth_info;return 0===r.errCode?(t.sendInitRequest().then((()=>{t.testSpeed()})),e().call(t),{errCode:r.errCode,errMsg:r.errMsg,expireTime:1e3*r.expire_time}):{errCode:r.errCode,errMsg:r.errMsg}}t.inited=!0}}))()}webRefreshToken(){var e=this;return h()((function*(){return e._webCurrentRefreshTokenPromise||(e._webCurrentRefreshTokenPromise=new Promise(function(){var t=h()((function*(t,r){try{var n=(yield e.webRequest({url:"/refresh_token",method:"POST",json:{appid:e.instanceOptions.appid,refresh_token:e.authStorage.getItem("refreshToken")}})).data;e.authStorage.setItem("appid",n.access_token),t()}catch(e){r(e)}finally{e._webCurrentRefreshTokenPromise=void 0}}));return function(e,r){return t.apply(this,arguments)}}())),e._webCurrentRefreshTokenPromise}))()}refreshAuth(){var e=JSON.stringify({resource_appid:this.instanceOptions.resourceAppid,resource_env:this.instanceOptions.resourceEnv}),t=+new Date,r=t,n=this.request({apiName:"tcbapi_getenvauth",serializedReqData:e});return n.then((e=>{var n=+new Date;Yt({apiName:"cloud.refreshAuth",apiEndTime:+new Date,apiStartTime:t,tunnelEndTime:n,tunnelStartTime:r})})),n}}function Qu(){return{realtime:{maxReconnect:mu.REALTIME_DB_MAX_RECONNECT,reconnectInterval:mu.REALTIME_DB_WS_RECONNECT_INTERVAL,totalConnectionTimeout:mu.REALTIME_DB_TOTAL_CONNECTION_TIMEOUT}}}globalThis.__cloudSDK__={...d,...e};c&&(a.setCloudSDK(globalThis.__cloudSDK__),delete globalThis.__cloudSDK__,delete globalThis.getCloudSDKGlobalVar)})()})()})()}catch(e){console.error("catch sdkSubPackage: cloudSDK error: ",e)}